{"version":3,"sources":["store/stories/index.ts","components/tooltip/tooltip.tsx","components/control/icon-button.tsx","store/prefs/index.ts","store/story-formats/index.ts","components/container/button-bar/button-bar.tsx","components/container/button-bar/button-bar-separator.tsx","dialogs/index.ts","components/container/card/card-content.tsx","store/undoable-stories/index.ts","components/container/dialog-card/dialog-card.tsx","components/container/dialog-card/dialog-editor.tsx","util/geometry.ts","electron/shared/index.ts","store/stories/defaults.ts","components/control/checkbox-button.tsx","store/persistence/persistable-changes.ts","util/is-electron.ts","components/error/error-message.tsx","components/error/global-error-boundary.tsx","components/error/safari-warning-card.tsx","components/control/text-select.tsx","util/story-format/editor-extensions.ts","util/story-format/namespace.ts","util/app-info.ts","components/control/card-button.tsx","util/publish.ts","util/tag.ts","components/control/prompt-button.tsx","components/container/button-card.tsx","components/control/menu-button.tsx","util/parse-links.ts","store/prefs/defaults.ts","codemirror/prefix-trigger.ts","components/control/code-area/code-area.tsx","util/i18n.ts","store/persistence/electron-ipc/prefs/load.ts","store/persistence/electron-ipc/save-json.ts","store/persistence/electron-ipc/prefs/save-middleware.ts","store/persistence/electron-ipc/stories/load.ts","store/persistence/electron-ipc/stories/save-middleware.ts","store/persistence/electron-ipc/stories/save-story.ts","store/persistence/electron-ipc/story-formats/load.ts","store/persistence/electron-ipc/story-formats/save-middleware.ts","store/persistence/local-storage/prefs/load.ts","store/persistence/local-storage/prefs/save-middleware.ts","store/persistence/local-storage/prefs/save.ts","store/persistence/local-storage/stories/save-middleware.ts","store/persistence/local-storage/stories/load.ts","store/persistence/local-storage/comma-list.ts","store/persistence/local-storage/stories/save.ts","store/persistence/local-storage/story-formats/load.ts","store/persistence/local-storage/story-formats/save.ts","store/persistence/local-storage/story-formats/save-middleware.ts","store/persistence/use-persistence.ts","store/persistence/electron-ipc/use-electron-ipc-persistence.ts","store/persistence/local-storage/use-local-storage-persistence.ts","components/tag/add-tag-button.tsx","components/tag/tag-button.tsx","components/control/icon-link.tsx","components/codemirror/indent-buttons.tsx","components/codemirror/undo-redo-buttons.tsx","components/control/text-input.tsx","components/image/icon/empty.tsx","components/image/icon/loading.tsx","components/container/card/card.tsx","store/stories/getters.ts","util/story-format/fetch-properties.ts","store/story-formats/defaults.ts","util/unused-name.ts","store/use-store-error-reporter.ts","util/codemirror-options.ts","util/color.ts","util/regexp.ts","components/tag/tag-stripe.tsx","dialogs/context/dialogs.tsx","dialogs/context/components/CreateOption.tsx","dialogs/context/components/DialogOptions.tsx","dialogs/context/components/UserDialog.tsx","dialogs/context/reducer.ts","dialogs/context/dialogs-context.tsx","util/import.ts","components/passage/rename-passage-button.tsx","store/prefs/use-computed-theme.ts","components/tag/tag-editor.tsx","components/meter/meter.tsx","store/format-loader.tsx","store/prefs/action-creators.ts","store/prefs/getters.ts","electron/shared/story-filename.ts","store/story-formats/action-creators.ts","store/story-formats/getters.ts","dialogs/app-donation.tsx","dialogs/passage-tags.tsx","dialogs/story-javascript.tsx","dialogs/story-search.tsx","dialogs/story-stylesheet.tsx","dialogs/story-tags.tsx","store/stories/action-creators/create-newly-linked-passages.ts","store/stories/action-creators/create-story.ts","store/stories/action-creators/create-untitled-passage.ts","store/stories/action-creators/delete-passage.ts","store/stories/action-creators/delete-story.ts","store/stories/action-creators/duplicate-story.ts","store/stories/action-creators/delete-orphaned-passages.ts","util/passage-is-empty.ts","store/stories/action-creators/update-passage.ts","store/stories/action-creators/find-replace.ts","store/stories/action-creators/highlight-passages.ts","store/stories/action-creators/import-stories.ts","store/stories/action-creators/move-passages.ts","store/stories/action-creators/rename-passage-tag.ts","store/stories/action-creators/rename-story-tag.ts","store/stories/action-creators/select-passage.ts","store/stories/action-creators/select-story.ts","store/stories/action-creators/tag-color.ts","store/stories/action-creators/tag-passage.ts","store/stories/action-creators/update-story.ts","store/stories/reducer/create-passage.ts","store/stories/reducer/delete-passage.ts","store/stories/reducer/repair/repair-passage.ts","store/stories/reducer/repair/repair-story.ts","store/stories/reducer/update-passage.ts","store/stories/reducer/index.ts","store/stories/reducer/create-passages.ts","store/stories/reducer/create-story.ts","store/stories/reducer/delete-passages.ts","store/stories/reducer/delete-story.ts","store/stories/reducer/init.ts","store/stories/reducer/repair/repair-state.ts","store/stories/reducer/update-passages.ts","store/stories/reducer/update-story.ts","store/stories/stories-context.tsx","dialogs/passage-edit/passage-text.tsx","store/use-codemirror-passage-hints.ts","store/use-format-codemirror-mode.ts","dialogs/passage-edit/passage-toolbar.tsx","dialogs/passage-edit/story-format-toolbar.tsx","store/use-format-codemirror-toolbar.ts","dialogs/passage-edit/tag-toolbar.tsx","dialogs/passage-edit/passage-edit.tsx","components/control/file-input.tsx","dialogs/story-import/file-chooser.tsx","dialogs/story-import/story-chooser.tsx","dialogs/story-import/story-import.tsx","store/undoable-stories/reverse-action.ts","store/undoable-stories/reverse-thunk.ts","store/undoable-stories/reducer.ts","store/undoable-stories/undoable-stories-context.tsx","components/story-format/story-format-select.tsx","dialogs/story-details/story-stats.tsx","dialogs/story-details/story-details.tsx","components/control/font-select.tsx","util/locales.ts","dialogs/app-prefs.tsx","store/prefs/prefs-context.tsx","store/prefs/reducer.ts","store/story-formats/story-formats-context.tsx","store/story-formats/reducer.ts","dialogs/about-twine/about-twine.tsx","components/loading-curtain/loading-curtain.tsx","store/locale-switcher.tsx","components/click-away-listener/click-away-listener.tsx","components/container/card-group.tsx","components/document-title/document-title.tsx","components/container/main-content.tsx","components/badge/badge.tsx","components/container/card/selectable-card.tsx","components/story-format/story-format-card/story-format-card-details.tsx","components/story-format/story-format-card/story-format-card.tsx","components/route-toolbar/back-button.tsx","components/route-toolbar/route-toolbar.tsx","store/use-publishing.ts","store/use-story-launch.ts","util/save-html.ts","store/stories/extract_story.ts","route-actions/build-actions.tsx","route-actions/app-actions.tsx","routes/story-format-list/toolbar/formats/add-story-format-button.tsx","routes/story-format-list/toolbar/formats/default-story-format-button.tsx","routes/story-format-list/toolbar/formats/proofing-story-format-button.tsx","routes/story-format-list/toolbar/formats/remove-story-format-button.tsx","routes/story-format-list/toolbar/formats/story-format-extensions-button.tsx","routes/story-format-list/toolbar/formats/format-actions.tsx","routes/story-format-list/toolbar/view-actions.tsx","routes/story-format-list/toolbar/story-format-list-toolbar.tsx","routes/story-format-list/story-format-list-route.tsx","routes/story-edit/toolbar/passage/create-passage-button.tsx","routes/story-edit/toolbar/passage/delete-passages-button.tsx","routes/story-edit/toolbar/passage/edit-passages-buttons.tsx","routes/story-edit/toolbar/passage/select-all-passages-button.tsx","routes/story-edit/toolbar/passage/start-at-passage-button.tsx","routes/story-edit/toolbar/passage/test-passage-button.tsx","routes/story-edit/toolbar/passage/passage-actions.tsx","components/story/rename-story-button.tsx","routes/story-edit/toolbar/story/details-button.tsx","routes/story-edit/toolbar/story/find-replace-button.tsx","routes/story-edit/toolbar/story/javascript-button.tsx","routes/story-edit/toolbar/story/passage-tags-button.tsx","routes/story-edit/toolbar/story/stylesheet-button.tsx","routes/story-edit/toolbar/story/story-actions.tsx","routes/story-edit/toolbar/undo-redo-buttons.tsx","routes/story-edit/toolbar/story-edit-toolbar.tsx","routes/story-edit/use-zoom-transition.ts","components/marquee-selection/marquee-selection.tsx","components/passage/passage-connections/broken-connection.tsx","util/svg.ts","components/passage/passage-connections/passage-connection.tsx","components/passage/passage-connections/self-connection.tsx","components/passage/passage-connections/passage-connection-group.tsx","components/passage/passage-connections/link-markers.tsx","components/passage/passage-connections/start-connection.tsx","store/use-format-reference-parser.ts","components/passage/passage-connections/passage-connections.tsx","components/passage/passage-card.tsx","components/passage/passage-card-group.tsx","components/passage/passage-map/passage-map.tsx","routes/story-edit/marqueeable-passage-map.tsx","routes/story-edit/story-edit-route.tsx","routes/story-edit/use-zoom-shortcuts.ts","components/storage-quota/storage-quota.tsx","routes/story-list/toolbar/library/archive-button.tsx","routes/story-list/toolbar/library/import-story-button.tsx","routes/story-list/toolbar/library/story-tags-button.tsx","routes/story-list/toolbar/library/library-actions.tsx","routes/story-list/toolbar/story/create-story-button.tsx","components/control/confirm-button.tsx","routes/story-list/toolbar/story/delete-story-button.tsx","routes/story-list/toolbar/story/duplicate-story-button.tsx","routes/story-list/toolbar/story/edit-story-button.tsx","routes/story-list/toolbar/story/tag-story-button.tsx","routes/story-list/toolbar/story/story-actions.tsx","routes/story-list/toolbar/view/sort-by-button.tsx","routes/story-list/toolbar/view/tag-filter-button.tsx","routes/story-list/toolbar/view/view-actions.tsx","routes/story-list/toolbar/story-list-toolbar.tsx","util/hue-string.ts","components/story/story-preview.tsx","components/story/story-card.tsx","routes/story-list/story-cards.tsx","routes/story-list/story-list-route.tsx","store/prefs/use-donation-check.ts","util/replace-dom.ts","routes/story-play/story-play-route.tsx","routes/story-proof/story-proof-route.tsx","routes/story-test/story-test-route.tsx","routes/login/session.tsx","routes/home/ifLogin.tsx","routes/home/ifLogout.tsx","routes/home/home-route.tsx","styles/image/sword-svgrepo-com.svg","styles/image/write-svgrepo-com.svg","routes/select/img/mode-apo.png","routes/select/img/mode-fantasy.png","routes/select/components/game_mode_modes.tsx","routes/select/components/game_mode_text.tsx","routes/select/components/game_mode_select.tsx","styles/image/wave_line.svg","routes/select/game_mode.tsx","routes/select/select-route.tsx","routes/game-play/component/right_ui.tsx","routes/game-play/component/main.tsx","styles/image/book-svgrepo-com.svg","styles/image/money.png","styles/image/heart.png","styles/image/heart_b.png","styles/image/hungry.png","styles/image/hungry_b.png","styles/image/money5.png","routes/game-play/component/stat_window.tsx","styles/image/cristal.png","styles/image/cristal_b.png","routes/game-play/component/left_ui.tsx","routes/game-play/game-play-route.tsx","styles/image/google-logo.png","styles/image/arrow-right-svgrepo-com.svg","routes/login/login-route.tsx","styles/image/x.svg","routes/signup/components/signupForm.tsx","routes/signup/components/email-container.tsx","routes/signup/signup-route.tsx","routes/user-board/user-board-route.tsx","routes/index.tsx","store/state-loader.tsx","store/theme-setter.tsx","app.tsx","index.tsx"],"names":["Tooltip","props","anchor","label","position","React","tooltipEl","setTooltipEl","arrowEl","setArrowEl","visible","setVisible","appearTimeout","setAppearTimeout","usePopper","modifiers","name","options","element","placement","strategy","styles","attributes","handleOnEnter","window","setTimeout","handleOnLeave","clearTimeout","addEventListener","removeEventListener","CSSTransition","classNames","in","mountOnEnter","timeout","unmountOnExit","className","ref","role","style","popper","arrow","IconButton","disabled","icon","iconOnly","iconPosition","onClick","preventDefault","selectable","selected","tooltipPosition","variant","button","setButton","undefined","e","ButtonBar","orientation","children","ButtonBarSeparator","CardContent","DialogCard","collapsed","fixedSize","headerLabel","highlighted","maximizable","maximized","onChangeCollapsed","onChangeHighlighted","onChangeMaximized","onClose","useErrorBoundary","didCatch","ErrorBoundary","error","t","useTranslation","console","calcdClassName","onKeyDown","event","key","floating","DialogEditor","lineAngle","p1","p2","Math","atan2","top","left","PI","lineDistance","hypot","rectCenter","rect","width","height","rectFromPoints","rectsIntersect","r1","r2","rectIntersectionWithLine","segmentStart","segmentEnd","result","NaN","segseg","boundingRect","rects","length","Error","right","bottom","i","rectRight","rectBottom","passageDefaults","i18n","tags","text","text_user","storyDefaults","ifid","lastUpdate","Date","passages","script","snapToGrid","startPassage","storyFormat","storyFormatVersion","stylesheet","tagColors","zoom","CheckboxButton","checkedIcon","onChange","uncheckedIcon","value","otherProps","calculatedIcon","trivialPassageProps","trivialStoryProps","trivialStoryFormatProps","isPersistablePassageChange","Object","keys","some","includes","isPersistableStoryChange","isPersistableStoryFormatChange","isElectronRenderer","navigator","userAgent","indexOf","ErrorMessage","GlobalErrorBoundary","href","rel","target","stack","SafariWarningCard","browser","UAParser","getBrowser","version","parseInt","replace","Number","isFinite","safariNavigator","standalone","canAddToHomeScreen","TextSelect","map","option","formatEditorExtensions","format","twineVersion","loadState","properties","editorExtensions","twine","extensions","filter","semverSpec","satisfies","warn","info","namespaceForFormat","toLowerCase","getAppInfo","process","CardButton","ariaLabel","onChangeOpen","focusSelector","open","other","buttonEl","setButtonEl","cardEl","setCardEl","focusTrapOptions","clickOutsideDeactivates","onDeactivate","archiveFilename","timestamp","toLocaleString","publishArchive","stories","appInfo","reduce","output","story","publishStory","startOptional","publishPassage","passage","localId","escape","toString","join","startLocalId","formatOptions","startId","find","p","id","passageData","forEach","index","tagData","tag","publishStoryWithFormat","formatSource","isValidTagName","test","PromptButton","cancelIcon","cancelLabel","onSubmit","prompt","submitIcon","submitLabel","submitVariant","validate","mounted","setOpen","validation","setValidation","a","current","valid","updateValidation","message","buttonType","ButtonCard","MenuButton","items","menuEl","setMenuEl","closer","document","item","separator","checked","internalLinks","link","nonEmptyLinks","removeSetters","noSetter","getField","removeEnclosingBrackets","substr","fields","split","extractLink","tagContent","parseLinks","internalOnly","uniq","match","extractLinkTags","defaults","appTheme","codeEditorFontFamily","codeEditorFontScale","dialogWidth","disabledStoryFormatEditorExtensions","donateShown","editorCursorBlinks","firstRunTime","getTime","lastUpdateSeen","lastUpdateCheckTime","locale","userLanguage","language","browserLanguage","systemLanguage","passageEditorFontFamily","passageEditorFontScale","proofingFormat","storyFormatListFilter","storyListSort","storyListTagFilter","storyTagColors","welcomeSeen","attachments","prefixTriggerOption","cm","prefixes","callback","checkTrigger","state","completionActive","curWord","findWordAt","getDoc","getCursor","ch","prevWordRange","prevWord","getRange","head","push","on","off","editor","inited","CodeMirror","defineOption","CodeArea","fontFamily","fontScale","fontSize","classnames","labelHidden","i18next","createInstance","use","HttpBackend","initReactI18next","init","debug","backend","loadPath","fallbackLng","interpolation","escapeValue","load","twineElectron","prefKeys","ipcRenderer","invoke","prefs","saveJson","filename","data","send","saveMiddleware","action","type","Array","isArray","file","importStories","htmlSource","mtime","lastState","saveStory","formats","formatWithNameAndVersion","source","fetchStoryFormatProperties","url","storyWithName","storyWithId","storyId","oldStory","newStory","once","passageUpdates","passageId","storyFormats","uuid","userAdded","serialized","localStorage","getItem","serializedPref","JSON","parse","previouslySerialized","removeItem","ids","setItem","stringify","save","serializedStories","serializedStory","serializedPassages","serializedPassage","trim","values","addUnique","list","RegExp","contains","remove","substring","doUpdateTransaction","updater","transaction","passageIds","storyIds","savePassage","deletePassageById","passageWithName","deleteStory","passageWithId","serializedFormat","loadError","usePersistence","electronIpcPersistence","localStoragePersistence","AddTagButton","assignedTags","existingTags","onAdd","creatingTag","setCreatingTag","newColor","setNewColor","newName","setNewName","validationMessage","canAdd","tagName","colors","color","TagButton","checkable","onChangeColor","onRemove","IconLink","IndentButtons","execCommand","command","focus","UndoRedoButtons","watch","canRedo","setCanRedo","canUndo","setCanUndo","history","historySize","redo","undo","TextInput","onInput","placeholder","IconEmpty","viewBox","stroke","strokeWidth","fill","strokeLinecap","strokeLinejoin","IconLoading","Card","passageName","passageConnections","connectionParser","parser","passageMap","Map","draggable","broken","Set","connections","self","fixed","targetName","add","targetPassage","get","has","set","passagesMatchingSearch","search","flags","matcher","includePassageNames","matchCase","useRegexes","createRegExp","storyPassageTags","from","sort","storyStats","links","brokenLinks","characters","count","words","storyTags","s","requestQueue","Promise","resolve","jsonpRequester","jsonp","reject","then","resolveQueue","err","builtins","unusedName","existing","suffix","useStoreErrorReporter","useSuspense","ready","reportError","messageKey","alert","codeMirrorOptionsFromPrefs","extraKeys","Insert","cursorBlinkRate","escapeRegExp","escapeRegExpReplace","TagStripe","title","displayName","CreateOption","method","this","onCreate","option_title","status1","amount_change1","status2","amount_change2","after_story","bind","required","cols","rows","Component","DialogOptions","max_option_num","mode","options_id","options_title","options_status1","options_amount_change1","options_status2","options_amount_change2","options_after_story","selected_modify_optionNum","option_creator","lists","setState","_options_title","onTrackingOption","_options_status1","_options_amount_change1","_options_status2","_options_amount_change2","_options_after_story","parentNode","confirm","log","splice","concat","UserDialog","useState","setTitle","context","setContext","optionsTitle","setOptionsTitle","useUndoableStoriesContext","dispatch","regex","useEffect","convertedString","optionTitleArr","_optionsTitle","updateContext","updatePassage","dontUpdateOthers","onWrite","DialogTransition","userDialogText","setUserDialogText","Dialogs","useScrollbarSize","usePrefsContext","useDialogsContext","dialogs","containerStyle","paddingLeft","marginBottom","marginRight","maximizedStyle","dialog","TransitionGroup","component","managementProps","reducer","DialogsContext","DialogsContextProvider","useThunkReducer","Provider","selectors","float","stringValue","parseFloat","query","el","selector","querySelectorAll","parseDimensions","raw","bits","html","lastUpdateOverride","nodes","createElement","innerHTML","storyEl","importedStory","startPassagePid","getAttribute","startPassageId","textContent","passageEl","size","domToObject","DisabledRenamePassageButton","EnabledRenamePassageButton","onRename","RenamePassageButton","useComputedTheme","matchMedia","mediaQuery","matches","systemTheme","setSystemTheme","listener","TagEditor","allTags","onChangeName","Meter","domId","percent","FormatLoader","block","seenFormats","setSeenFormats","useStoryFormatsContext","newFormats","newFormat","oldFormat","loadAllFormatProperties","loadingFormat","f","loadPercent","setPref","formatEditorExtensionsDisabled","storyFileName","createFromProperties","deleteFormat","deselectAllFormats","getFormats","deselectFormat","loadFormatThunk","hydrate","hydrateResult","Function","call","toLoad","allSettled","loadFormatProperties","selectFormat","exclusive","getState","filteredFormats","semverLt","formatImageUrl","image","isAbsoluteUrl","formatWithId","newestFormatNamed","gt","sortFormats","b","AppDonationDialog","PassageTagsDialog","setTagColor","handleChangeColor","renamePassageTag","handleChangeTagName","StoryJavaScriptDialog","cmEditor","setCmEditor","useStoriesContext","editorDidMount","onBeforeChange","updateStory","autofocus","lineWrapping","ignoreTab","Tab","StorySearchDialog","setFlags","setReplace","setFind","debouncedDispatch","debounce","toggleFlag","highlightPassagesMatchingSearch","replaceInStory","StoryStylesheetDialog","StoryTagsDialog","storiesDispatch","prefsDispatch","renameStoryTag","createNewlyLinkedPassages","newText","oldText","oldLinks","toCreate","l","passageDefs","passageGap","newPassagesWidth","needsMoving","createStory","createUntitledPassage","centerX","centerY","defs","bounds","max","round","deletePassages","duplicateStory","deleteOrphanedPassages","newLinks","orphan","orphanPassage","passageIsEmpty","oldName","updatedStory","oldNameEscaped","newNameEscaped","simpleLinkRegexp","compoundLinkRegexp","reverseLinkRegexp","relinkedPassage","replaceText","searchFor","replaceWith","replacer","replaceInPassage","matchIds","oldHighlighted","newHighlighted","toImport","existingStories","importStory","otherStory","existingStory","movePassages","xChange","yChange","deselectPassage","selectAllPassages","selectPassage","selectPassagesInRect","ignoreIds","r","deselectStory","deselectAllStories","selectStory","addPassageTag","removePassageTag","createPassage","passageProps","storyExists","created","newState","newPassage","deletePassage","foundStory","deleted","logRepair","propName","repairedValue","detail","repairStory","allStories","allFormats","defaultFormat","storyDefs","repairs","newId","newIfid","entries","defKey","repairFormat","anyPassageRepaired","repairedPassages","repairedPassage","parentStory","pos","posKey","dim","dimKey","otherPassage","repairPassage","updated","createPassages","storyProps","toUpperCase","repairState","updatePassages","StoriesContext","StoriesContextProvider","storiesPersistence","persistedReducer","PassageText","onEditorChange","storyFormatExtensionsDisabled","changePending","setChangePending","localText","setLocalText","autocompletePassageNames","showHint","completeSingle","character","hint","doc","replaceRange","close","wordRange","word","comps","to","useCodeMirrorPassageHints","formatName","formatVersion","modeName","setModeName","extensionsDisabled","codeMirror","defineMode","useFormatCodeMirrorMode","debouncedOnChange","handleMount","refresh","handleChange","prefixTrigger","PassageToolbar","isStart","handleSetSize","StoryFormatToolbar","onExecCommand","containerRef","toolbarFactory","loaded","setLoaded","toolbarFunc","setToolbarFunc","namespace","commands","commandName","namespacedCommand","toolbar","environment","subitem","useFormatCodeMirrorToolbar","toolbarItems","setToolbarItems","tryToSetToolbar","getComputedStyle","foregroundColor","src","alt","TagToolbar","handleChangeTagColor","InnerPassageEditDialog","storyFormatExtensionsEnabled","setStoryFormatExtensionsEnabled","editorCrashed","setEditorCrashed","resetError","reset","handlePassageTextChange","selections","listSelections","setSelections","PassageEditDialog","FileInput","onError","changeEvent","files","reader","FileReader","loadEvent","readAsText","FileChooser","accept","StoryChooser","onImport","selectedStories","setSelectedStories","willReplaceExisting","StoryImportDialog","setFile","setStories","handleImport","reverseAction","prop","passageResult","reverseThunk","thunk","actions","actionOrThunk","newChange","description","storiesState","newChanges","changes","slice","currentChange","min","change","UndoableStoriesContext","UndoableStoriesContextProvider","dispatchAndRecordStoryAction","redoLabel","undoLabel","StoryFormatSelect","selectedFormat","loadingFormats","loadingCount","dateFormatter","Intl","DateTimeFormat","dateStyle","timeStyle","StoryDetailsDialogStats","stats","date","StoryDetailsDialog","families","scales","FontSelect","familyLabel","onChangeFamily","onChangeScale","scaleLabel","customScaleVisible","setCustomScaleVisible","customFamilyVisible","setCustomFamilyVisible","customFamily","setCustomFamily","customScale","setCustomScale","scale","locales","code","closestAppLocale","roughCode","roughMatch","AppPrefsDialog","PrefsContext","PrefsContextProvider","prefKey","defaultBuiltins","StoryFormatsContext","StoryFormatsContextProvider","builtinFormats","keep","builtinFormat","AboutTwineDialog","dangerouslySetInnerHTML","__html","credits","c","localizations","LoadingCurtain","LocaleSwitcher","changeLanguage","ClickAwayListener","ignoreSelector","onClickAway","closest","CardGroup","gridTemplateColumns","columnWidth","columns","maxWidth","DocumentTitle","querySelector","Helmet","MainContent","grabbable","padded","dragScrollStart","dragMouseStart","container","moveListener","scrollLeft","clientX","scrollTop","clientY","stopGrab","releasePointerCapture","pointerId","cursor","upListener","downListener","setPointerCapture","ignoreContext","Badge","SelectableCard","onDoubleClick","onSelect","ctrlKey","shiftKey","tabIndex","StoryFormatCardDetails","errorMessage","author","license","StoryFormatCard","editorExtensionsDisabled","proofing","BackButton","useHistory","location","pathname","goBack","RouteToolbar","helpUrl","pinnedControls","tabs","selectedTabClassName","tabName","tabContent","usePublishing","storyFormatsDispatch","proofStory","formatProperties","publishOptions","publishStoryData","useStoryLaunch","playStory","testStory","saveHtml","Blob","saveAs","findFirstPassage","extractFirstEpsiodeTitle","firstPassageID","firstPassage","searchOptionsString","sentences","optionsText","charAt","extractEpsiodeText","splitPassageText","extractSomeEpisodeText","Passage","passageText","BuildActions","playError","setPlayError","proofError","setProofError","publishError","setPublishError","testError","setTestError","resetErrors","postEpisode","option_text","episode_id","option_data","health_change","money_change","hungry_change","strength_change","agility_change","armour_change","mental_change","axios","post","episode","result_text","res","catch","genre","mainText","AppActions","isValidUrl","URL","AddStoryFormatButton","newFormatUrl","setNewFormatUrl","storyFormatName","DefaultStoryFormatButton","ProofingStoryFormatButton","RemoveStoryFormatButton","isDefault","isProofing","StoryFormatExtensionsButton","FormatActions","selectedFormats","ViewActions","setFilter","StoryFormatListToolbar","StoryFormatListRoute","formatsDispatch","visibleFormats","disabledFormat","handleSelect","CreatePassageButton","getCenter","handleClick","DeletePassagesButton","useHotkeys","EditPassagesButton","SelectAllPassagesButton","StartAtPassageButton","TestPassageButton","PassageActions","selectedPassages","soloSelectedPassage","handleRename","DisabledRenameStoryButton","EnabledRenameStoryButton","RenameStoryButton","DetailsButton","FindReplaceButton","JavaScriptButton","PassageTagsButton","StylesheetButton","StoryActions","StoryEditToolbar","useZoomTransition","scrollTarget","setCurrent","transition","step","requestAnimationFrame","lastTimestamp","elapsed","setter","start","time","quadOut","transitionStep","newLeft","scrollNormalizedCenter","scrollCenter","newTop","clientWidth","clientHeight","MarqueeSelection","ignoreEventsOnSelector","onSelectRect","onTemporarySelectRect","additive","setAdditive","dragging","setDragging","setStart","currentContainerRect","currentContainer","relativePointerPos","pointerType","getBoundingClientRect","transform","lineOffset","sqrt","BrokenConnection","offset","x1","y1","x2","y2","markerEnd","arc","end","radius","largeArc","sweep","rotation","PassageConnection","path","offsetStart","offsetEnd","startPoint","endPoint","distance","d","SelfConnection","PassageConnectionGroup","connection","LinkMarkers","refX","refY","markerWidth","markerHeight","orient","cx","cy","StartConnection","markerStart","emptyFunc","emptySet","noOffset","PassageConnections","referenceParser","setEditorExtensions","references","parsePassageText","useFormatReferenceParser","draggableLinks","fixedLinks","draggableReferences","fixedReferences","PassageCard","onDeselect","onDrag","onDragStart","onDragStop","onEdit","empty","excerpt","deviceType","handleMouseDown","handleEdit","nodeRef","onMouseDown","onStart","onStop","PassageCardGroup","sortedPassages","dragReducer","dragX","x","dragY","y","startX","startY","PassageMap","visibleZoom","compactCards","setCompactCards","passageBounds","setProperty","handleDragStart","body","classList","handleDrag","handleDragStop","MarqueeablePassageMap","temporaryRect","setTemporaryRect","temporaryAdditive","setTemporaryAdditive","innerPassages","handleTemporarySelectRect","handleSelectRect","InnerStoryEditRoute","setInited","dialogsDispatch","mainContent","useParams","undoableStoriesDispatch","keydown","keyup","useZoomShortcuts","handleDeselectPassage","handleDragPassages","abs","handleEditPassage","handleSelectPassage","logicalRect","center","StoryEditRoute","StorageQuota","lastWatch","setLastWatch","working","setWorking","percentFree","setPercentFree","hide","storage","estimate","quota","usage","toFixed","run","ArchiveButton","ImportStoryButton","StoryTagsButton","LibraryActions","CreateStoryButton","ConfirmButton","confirmIcon","confirmLabel","confirmVariant","onConfirm","DeleteStoryButton","storyName","setStoryName","DuplicateStoryButton","EditStoryButton","TagStoryButton","tagColor","selectedStory","SortByButton","TagFilterButton","StoryListToolbar","hueString","charCodeAt","StoryPreview","hues","minX","POSITIVE_INFINITY","minY","maxX","NEGATIVE_INFINITY","maxY","svg","circle","bgRadius","xmlns","StoryCard","onChangeTagColor","onRemoveTag","StoryCards","onSelectStory","handleRemoveTag","InnerStoryListRoute","shouldShowDonationPrompt","now","useDonationCheck","visibleStories","filteredStories","sortBy","StoryListRoute","replaceDom","SVG","Store","StoryFormat","amdDefine","app","jQuery","write","StoryPlayRoute","StoryProofRoute","StoryTestRoute","SessionStorageAPI","sessionStorage","ifLogin","ifLogout","HomeRoute","targetRef","scrollY","setScrollY","whetherLoginComponent","nickName_","nickname","opacityObj","backgroundColor","Game_mode_modes","click","preserveAspectRatio","apoImg","fantasyImg","Game_mode_text","click_title","click_explain","Game_mode_select","onClickCancel","Game_mode","setClick","explain","contents","click_content","hidden","Line","number","hiddenOff","health_class","hungry_class","money_class","main_episode","normal_episode","SelectRoute","modeHidden","setmodeHidden","swordLogo","writeLogo","Right_Ui","body_text","split_txt","stop_typing_time","typingIdx","height_multiple","main_text_view_basic_size","typing_end","status_change","current_status","current_episode_num","main_episode_num","normal_episode_num","isEnd","Main","episode_text","text_view","main_text_view","episode_option","episode_result_text","episode_result_option","header_text_view","episode_title","episode_number_text","start_episode","click_on","promise","typing_episode","makeResultOptionDiv","makeOptionDiv","innerText","moveScrollBottom","optionDiv","makeResultText","appendChild","optionId","patch","isStatChanged","statName","statMessage","health","hungry","money","strength","agility","armour","mental","update_rightUI","resultDiv","getNormalEpisodeDataFromDB","updateEpisodeValue","floor","random","episodeEnd","helathImg","helathBImg","moneyImg","hungryImg","hungryBImg","money5","Image","moneyLogo","scrollHeight","scrollTo","behavior","mainEpisodes","episode_type","current_episode","Episode_Text","main_text","Option_Texts","Option_Stat_Changes","getMainEpisodeDataFromDB","bookLogo","stat_window_event","StatIconPusher","currentWidth","cristal_arr","BottomStatUI","Left_Ui","GamePlayRoute","statUIOn","setStatUIOn","LoginRoute","email","setEmail","pwd","setPwd","onChangeEmail","onChangePwd","authorizedUser","String","accessToken","googleLogo","htmlFor","password","errorMsg","access_token","sesstionStorage","SignupForm","emailDefault","submitForm","closeForm","EmailContainer","inputRef","createRef","password_con","default_email","signUpComponent","pw","pwc","nic","successMsg","_signUpForm","SignupRoute","onFormSubmit","UserBoardRoute","Routes","exact","render","StateLoader","initing","setIniting","prefsRepaired","setPrefsRepaired","formatsRepaired","setFormatsRepaired","storiesRepaired","setStoriesRepaired","prefsState","formatsState","safeFormat","ThemeSetter","computedTheme","dataset","App","fallback","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.a307f3da.chunk.js","sourcesContent":["export * from './action-creators';\r\nexport * from './defaults';\r\nexport * from './getters';\r\nexport * from './stories-context';\r\nexport * from './stories.types';\r\nexport * from './zoom';\r\n","import * as React from 'react';\r\nimport {CSSTransition} from 'react-transition-group';\r\nimport {usePopper} from 'react-popper';\r\nimport {Placement} from '@popperjs/core';\r\nimport './tooltip.css';\r\n\r\nexport interface TooltipProps {\r\n\tanchor: HTMLElement | null;\r\n\tlabel: string;\r\n\tposition?: Placement;\r\n}\r\n\r\n// This component is intentionally limited in functionality. It should *only* be\r\n// used to duplicate content that is only perceivable by screen readers or other\r\n// assistive technology, e.g. through an `aria-label` attribute. The one use\r\n// case right now in the app are icon-only buttons.\r\n//\r\n// Content in these components is *not* accessible to screen readers and should\r\n// not be. That content should be placed in an `aria-label` attribute instead.\r\n\r\nexport const Tooltip: React.FC<TooltipProps> = props => {\r\n\tconst {anchor, label, position = 'top'} = props;\r\n\tconst [tooltipEl, setTooltipEl] = React.useState<HTMLDivElement | null>(null);\r\n\tconst [arrowEl, setArrowEl] = React.useState<HTMLDivElement | null>(null);\r\n\tconst [visible, setVisible] = React.useState(false);\r\n\tconst [appearTimeout, setAppearTimeout] = React.useState<number>();\r\n\tconst {styles, attributes} = usePopper(anchor, tooltipEl, {\r\n\t\tmodifiers: [{name: 'arrow', options: {element: arrowEl}}, {name: 'flip'}],\r\n\t\tplacement: position,\r\n\t\tstrategy: 'fixed'\r\n\t});\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst handleOnEnter = () =>\r\n\t\t\tsetAppearTimeout(window.setTimeout(() => setVisible(true), 500));\r\n\t\tconst handleOnLeave = () => {\r\n\t\t\tif (appearTimeout) {\r\n\t\t\t\twindow.clearTimeout(appearTimeout);\r\n\t\t\t}\r\n\r\n\t\t\tsetVisible(false);\r\n\t\t};\r\n\r\n\t\tif (anchor) {\r\n\t\t\tanchor.addEventListener('pointerenter', handleOnEnter);\r\n\t\t\tanchor.addEventListener('pointerleave', handleOnLeave);\r\n\t\t\treturn () => {\r\n\t\t\t\tanchor.removeEventListener('pointerenter', handleOnEnter);\r\n\t\t\t\tanchor.removeEventListener('pointerleave', handleOnLeave);\r\n\t\t\t};\r\n\t\t}\r\n\t}, [anchor, appearTimeout]);\r\n\r\n\treturn (\r\n\t\t<CSSTransition\r\n\t\t\tclassNames=\"fade-in-out\"\r\n\t\t\tin={visible}\r\n\t\t\tmountOnEnter\r\n\t\t\ttimeout={200}\r\n\t\t\tunmountOnExit\r\n\t\t>\r\n\t\t\t<div\r\n\t\t\t\taria-hidden\r\n\t\t\t\tclassName=\"tooltip\"\r\n\t\t\t\tref={setTooltipEl}\r\n\t\t\t\trole=\"tooltip\"\r\n\t\t\t\tstyle={styles.popper}\r\n\t\t\t\t{...attributes.popper}\r\n\t\t\t>\r\n\t\t\t\t<div className=\"tooltip-arrow\" ref={setArrowEl} style={styles.arrow} />\r\n\t\t\t\t<div className=\"tooltip-label\">{label}</div>\r\n\t\t\t</div>\r\n\t\t</CSSTransition>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport './icon-button-link.css';\r\nimport {Tooltip, TooltipProps} from '../tooltip';\r\n\r\nexport interface IconButtonProps {\r\n\tbuttonType?: 'button' | 'submit';\r\n\tdisabled?: boolean;\r\n\ticon: React.ReactNode;\r\n\ticonOnly?: boolean;\r\n\ticonPosition?: 'start' | 'end';\r\n\tlabel: string;\r\n\tonClick?: (e: React.MouseEvent) => void;\r\n\tpreventDefault?: boolean;\r\n\tselectable?: boolean;\r\n\tselected?: boolean;\r\n\ttooltipPosition?: TooltipProps['position'];\r\n\tvariant?: 'create' | 'danger' | 'primary' | 'secondary';\r\n}\r\n\r\nexport const IconButton = React.forwardRef<HTMLButtonElement, IconButtonProps>(\r\n\t(props, ref) => {\r\n\t\tconst {\r\n\t\t\tdisabled,\r\n\t\t\ticon,\r\n\t\t\ticonOnly,\r\n\t\t\ticonPosition = 'start',\r\n\t\t\tonClick,\r\n\t\t\tpreventDefault,\r\n\t\t\tselectable = false,\r\n\t\t\tselected = false,\r\n\t\t\ttooltipPosition,\r\n\t\t\tvariant = 'secondary'\r\n\t\t} = props;\r\n\t\tconst className = classNames(\r\n\t\t\t'icon-button',\r\n\t\t\t`icon-position-${iconPosition}`,\r\n\t\t\t{selected: selected},\r\n\t\t\t`variant-${variant}`,\r\n\t\t\t{'icon-only': iconOnly}\r\n\t\t);\r\n\t\tconst [button, setButton] = React.useState<HTMLButtonElement | null>(null);\r\n\t\tReact.useImperativeHandle(ref, () => button as HTMLButtonElement);\r\n\t\tconst handleOnClick = (e: React.MouseEvent) => {\r\n\t\t\tonClick && onClick(e);\r\n\r\n\t\t\tif (preventDefault) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<button\r\n\t\t\t\t\taria-label={iconOnly ? props.label : undefined}\r\n\t\t\t\t\taria-pressed={selectable ? selected : undefined}\r\n\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\tclassName={className}\r\n\t\t\t\t\tonClick={handleOnClick}\r\n\t\t\t\t\tref={setButton}\r\n\t\t\t\t>\r\n\t\t\t\t\t<span className=\"icon\">{icon}</span>\r\n\t\t\t\t\t{!iconOnly && props.label}\r\n\t\t\t\t</button>\r\n\t\t\t\t{iconOnly && (\r\n\t\t\t\t\t<Tooltip\r\n\t\t\t\t\t\tanchor={button}\r\n\t\t\t\t\t\tlabel={props.label}\r\n\t\t\t\t\t\tposition={tooltipPosition}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n);\r\n","export * from './action-creators';\r\nexport * from './defaults';\r\nexport * from './getters';\r\nexport * from './prefs-context';\r\nexport * from './prefs.types';\r\n","export * from './action-creators';\r\nexport * from './defaults';\r\nexport * from './getters';\r\nexport * from './story-formats-context';\r\nexport * from './story-formats.types';\r\n","/**\r\n * Twine의 상단 Menu-bar를 구성하는 코드.\r\n * 위에서 두 번째 Menu-bar\r\n */\r\n\r\n\r\nimport * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport './button-bar.css';\r\n\r\nexport interface ButtonBarProps {\r\n\torientation?: 'horizontal' | 'vertical';\r\n}\r\n\r\nexport const ButtonBar: React.FC<ButtonBarProps> = props => (\r\n\t<div                        \r\n\t\tclassName={classNames(   \r\n\t\t\t'button-bar',\r\n\t\t\t`orientation-${props.orientation ?? 'horizontal'}`\r\n\t\t)}\r\n\t>          \r\n\t\t{props.children}\r\n\t</div>\r\n);\r\n","// CSS 적용 코드\r\n\r\nimport * as React from 'react';\r\nimport './button-bar-separator.css';\r\n\r\nexport const ButtonBarSeparator: React.FC = () => (\r\n\t<div className=\"button-bar-separator\" />\r\n);\r\n","export * from './about-twine';\r\nexport * from './app-donation';\r\nexport * from './app-prefs';\r\nexport * from './context';\r\nexport * from './context/dialogs';\r\nexport * from './dialogs.types';\r\nexport * from './passage-edit';\r\nexport * from './passage-tags';\r\nexport * from './story-import';\r\nexport * from './story-javascript';\r\nexport * from './story-details';\r\nexport * from './story-search';\r\nexport * from './story-stylesheet';\r\nexport * from './story-tags';\r\n","import * as React from 'react';\r\nimport './card-content.css';\r\n\r\nexport const CardContent: React.FC = ({children}) => (\r\n\t<div className=\"card-content\">{children}</div>\r\n);\r\n","export * from './undoable-stories-context';\r\nexport * from './undoable-stories.types';\r\n","/**\r\n * Passage를 더블클릭 하면 옆에 나오는 입력 창을 구성하는 코드.\r\n * 더블클릭 했을 때 나타나는 효과, 여러 개를 띄워놓았을 때 크기가 동적으로 변하는 애니메이션 등을 지정해준 것 같음.\r\n * dialog card의 제목, 최대화 버튼, 닫기 버튼 기능이 들어가 있음.\r\n */\r\n\r\n\r\nimport * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';             // 언어 번역할 때 쓰는 라이브러리 여기서 정확히 어떻게 쓰인 건지는 모르겠음\r\nimport {\r\n\tIconArrowsDiagonal,\r\n\tIconArrowsDiagonalMinimize,\r\n\tIconChevronDown,\r\n\tIconChevronUp,\r\n\tIconX\r\n} from '@tabler/icons';\r\nimport { Card } from '../card';\r\nimport { IconButton } from '../../control/icon-button';\r\nimport './dialog-card.css';\r\nimport useErrorBoundary from 'use-error-boundary';      // 컴포넌트에서 에러가 나는지 추적하는 라이브러리\r\nimport { ErrorMessage } from '../../error';\r\n\r\n\r\nexport interface DialogCardProps {\r\n\tclassName?: string;\r\n\tcollapsed: boolean;\r\n\tfixedSize?: boolean;\r\n\theaderLabel: string;\r\n\thighlighted?: boolean;\r\n\tmaximizable?: boolean;\r\n\tmaximized?: boolean;\r\n\tonChangeCollapsed: (value: boolean) => void;\r\n\tonChangeHighlighted: (value: boolean) => void;\r\n\tonChangeMaximized: (value: boolean) => void;\r\n\tonClose: () => void;\r\n\tsetEzoneButton : any;\r\n}\r\n\r\nexport const DialogCard: React.FC<DialogCardProps> = props => {\r\n\tconst {\r\n\t\tchildren, //props.children은 이 컴포넌트를 부른 부모 태그에서 DialogCard안에 쓴 컴포넌트들을 자식으로 불러옴\r\n\t\tclassName,\r\n\t\tcollapsed,\r\n\t\tfixedSize,\r\n\t\theaderLabel,\r\n\t\thighlighted,\r\n\t\tmaximizable,\r\n\t\tmaximized,\r\n\t\tonChangeCollapsed,\r\n\t\tonChangeHighlighted,\r\n\t\tonChangeMaximized,\r\n\t\tonClose\r\n\t} = props;\r\n\tconst { didCatch, ErrorBoundary, error } = useErrorBoundary();\r\n\tconst { t } = useTranslation();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (error) {\r\n\t\t\tconsole.error(error);\r\n\t\t}\r\n\t}, [error]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (highlighted) {\r\n\t\t\tconst timeout = window.setTimeout(() => onChangeHighlighted(false), 400);\r\n\r\n\t\t\treturn () => window.clearTimeout(timeout);\r\n\t\t}\r\n\t}, [highlighted, onChangeHighlighted]);                 // highlighted값이 바뀔 때 useEffect가 실행되고, 끝나는 시점에 onChangeHilighted 호출\r\n\r\n\tconst calcdClassName = classNames('dialog-card', className, {    // 클래스 추가 함수\r\n\t\tcollapsed,\r\n\t\thighlighted,                       // collapsed, highlighted, maximized 클래스는 기본적으로 추가\r\n\t\t'fixed-size': fixedSize,           // fixed-size 클래스는 fixedSize값이 true일 경우에만 추가        \r\n\t\tmaximized\r\n\t});\r\n\r\n\tfunction handleKeyDown(event: React.KeyboardEvent) {\r\n\t\tif (event.key === 'Escape') {                          // esc 누르면 dialog card 닫힘\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\taria-label={headerLabel}\r\n\t\t\trole=\"dialog\"\r\n\t\t\tclassName={calcdClassName}\r\n\t\t\tonKeyDown={handleKeyDown}\r\n\t\t>\r\n\t\t\t<Card floating>\r\n\t\t\t\t<h2 className='hidden'>\r\n\t\t\t\t\t<div className=\"dialog-card-header\">\r\n\t\t\t\t\t\t<IconButton         \r\n\t\t\t\t\t\t\ticon={collapsed ? <IconChevronUp /> : <IconChevronDown />}   // dialog card가 접혔는지 여부에 따라 아이콘 표시 여부 결정\r\n\t\t\t\t\t\t\tlabel={headerLabel}                                          // dialog card 제목\r\n\t\t\t\t\t\t\tonClick={() => onChangeCollapsed(!collapsed)}                // 카드 접기&펼치기 기능\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"dialog-card-header-controls\">\r\n\t\t\t\t\t\t{maximizable && (                                 \t\t\t\t//Iconbutton들의 기능\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//최대화 버튼 \r\n\t\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\t\ticon={\r\n\t\t\t\t\t\t\t\t\tmaximized ? (\r\n\t\t\t\t\t\t\t\t\t\t<IconArrowsDiagonalMinimize />\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<IconArrowsDiagonal />\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\ticonOnly\r\n\t\t\t\t\t\t\t\tlabel={\r\n\t\t\t\t\t\t\t\t\tmaximized ? t('common.unmaximize') : t('common.maximize')\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tonClick={() => onChangeMaximized(!maximized)}\r\n\t\t\t\t\t\t\t\t// onClick={()=>props.setEzoneButton(true)}\t\r\n\t\t\t\t\t\t\t\ttooltipPosition=\"bottom\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\t\ticonOnly\r\n\t\t\t\t\t\t\tlabel={t('common.close')}\r\n\t\t\t\t\t\t\tonClick={onClose}                 // 닫기 버튼\r\n\t\t\t\t\t\t\ttooltipPosition=\"bottom\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</h2>\r\n\t\t\t\t{didCatch ? (\r\n\t\t\t\t\t<ErrorMessage>\r\n\t\t\t\t\t\t{t('components.dialogCard.contentsCrashed')}\r\n\t\t\t\t\t</ErrorMessage>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<ErrorBoundary>{!collapsed && children }</ErrorBoundary> //여기 children에 마지막 anonymous \r\n\t\t\t\t)}\r\n\t\t\t</Card>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport './dialog-editor.css';\r\n\r\nexport const DialogEditor: React.FC = props => (\r\n\t<div className=\"dialog-editor\">{props.children}</div>\r\n);\r\n","import segseg, {SegSegVector} from 'segseg';\r\n\r\nexport interface Point {\r\n\ttop: number;\r\n\tleft: number;\r\n}\r\n\r\nexport interface Rect extends Point {\r\n\theight: number;\r\n\twidth: number;\r\n}\r\n\r\n/**\r\n * Returns the angle between two points in degrees.\r\n * @see https://gist.github.com/conorbuck/2606166\r\n */\r\nexport function lineAngle(p1: Point, p2: Point) {\r\n\treturn (Math.atan2(p2.top - p1.top, p2.left - p1.left) * 180) / Math.PI;\r\n}\r\n\r\n/**\r\n * Returns the length of the line segment between two points.\r\n */\r\nexport function lineDistance(p1: Point, p2: Point) {\r\n\treturn Math.hypot(p1.left - p2.left, p1.top - p2.top);\r\n}\r\n\r\n/**\r\n * Returns the center of a rectangle.\r\n */\r\nexport function rectCenter(rect: Rect): Point {\r\n\treturn {left: rect.left + rect.width / 2, top: rect.top + rect.height / 2};\r\n}\r\n\r\n/**\r\n * Creates a rectangle from two points, regardless of their relative position.\r\n */\r\n\r\nexport function rectFromPoints(p1: Point, p2: Point): Rect {\r\n\tconst rect: Rect = {height: 0, left: 0, top: 0, width: 0};\r\n\r\n\tif (p1.left < p2.left) {\r\n\t\trect.left = p1.left;\r\n\t\trect.width = p2.left - p1.left;\r\n\t} else {\r\n\t\trect.left = p2.left;\r\n\t\trect.width = p1.left - p2.left;\r\n\t}\r\n\r\n\tif (p1.top < p2.top) {\r\n\t\trect.top = p1.top;\r\n\t\trect.height = p2.top - p1.top;\r\n\t} else {\r\n\t\trect.top = p2.top;\r\n\t\trect.height = p1.top - p2.top;\r\n\t}\r\n\r\n\treturn rect;\r\n}\r\n\r\n/**\r\n * Returns whether two rectangles intersect.\r\n * @see http://stackoverflow.com/questions/2752349/fast-rectangle-to-rectangle-intersection\r\n */\r\nexport function rectsIntersect(r1: Rect, r2: Rect) {\r\n\treturn !(\r\n\t\tr2.left > r1.left + r1.width ||\r\n\t\tr2.left + r2.width < r1.left ||\r\n\t\tr2.top > r1.top + r1.height ||\r\n\t\tr2.top + r2.height < r1.top\r\n\t);\r\n}\r\n\r\n/**\r\n * Returns the intersection point between a rectangle and a line segment. If\r\n * none exists, this returns null.\r\n */\r\nexport function rectIntersectionWithLine(\r\n\trect: Rect,\r\n\tsegmentStart: Point,\r\n\tsegmentEnd: Point\r\n): Point | null {\r\n\tlet result: SegSegVector = [NaN, NaN];\r\n\r\n\t// Left side.\r\n\r\n\tif (\r\n\t\tsegseg(\r\n\t\t\tresult,\r\n\t\t\t[rect.left, rect.top],\r\n\t\t\t[rect.left, rect.top + rect.height],\r\n\t\t\t[segmentStart.left, segmentStart.top],\r\n\t\t\t[segmentEnd.left, segmentEnd.top]\r\n\t\t)\r\n\t) {\r\n\t\treturn {\r\n\t\t\tleft: result[0],\r\n\t\t\ttop: result[1]\r\n\t\t};\r\n\t}\r\n\r\n\t// Right side.\r\n\r\n\tif (\r\n\t\tsegseg(\r\n\t\t\tresult,\r\n\t\t\t[rect.left + rect.width, rect.top],\r\n\t\t\t[rect.left + rect.width, rect.top + rect.height],\r\n\t\t\t[segmentStart.left, segmentStart.top],\r\n\t\t\t[segmentEnd.left, segmentEnd.top]\r\n\t\t)\r\n\t) {\r\n\t\treturn {\r\n\t\t\tleft: result[0],\r\n\t\t\ttop: result[1]\r\n\t\t};\r\n\t}\r\n\r\n\t// Top side.\r\n\r\n\tif (\r\n\t\tsegseg(\r\n\t\t\tresult,\r\n\t\t\t[rect.left, rect.top],\r\n\t\t\t[rect.left + rect.width, rect.top],\r\n\t\t\t[segmentStart.left, segmentStart.top],\r\n\t\t\t[segmentEnd.left, segmentEnd.top]\r\n\t\t)\r\n\t) {\r\n\t\treturn {\r\n\t\t\tleft: result[0],\r\n\t\t\ttop: result[1]\r\n\t\t};\r\n\t}\r\n\r\n\t// Bottom side.\r\n\r\n\tif (\r\n\t\tsegseg(\r\n\t\t\tresult,\r\n\t\t\t[rect.left, rect.top + rect.height],\r\n\t\t\t[rect.left + rect.width, rect.top + rect.height],\r\n\t\t\t[segmentStart.left, segmentStart.top],\r\n\t\t\t[segmentEnd.left, segmentEnd.top]\r\n\t\t)\r\n\t) {\r\n\t\treturn {\r\n\t\t\tleft: result[0],\r\n\t\t\ttop: result[1]\r\n\t\t};\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * Returns a rectangle enclosing a set of rectangles.\r\n */\r\nexport function boundingRect(rects: Rect[]) {\r\n\tif (rects.length === 0) {\r\n\t\tthrow new Error(\"Can't calculate bounding rect for 0 rects\");\r\n\t}\r\n\r\n\tlet left = rects[0].left;\r\n\tlet right = rects[0].left + rects[0].width;\r\n\tlet top = rects[0].top;\r\n\tlet bottom = rects[0].top + rects[0].height;\r\n\r\n\tfor (let i = 1; i < rects.length; i++) {\r\n\t\tconst rectRight = rects[i].left + rects[i].width;\r\n\t\tconst rectBottom = rects[i].top + rects[i].height;\r\n\r\n\t\tif (rects[i].left < left) {\r\n\t\t\tleft = rects[i].left;\r\n\t\t}\r\n\r\n\t\tif (rects[i].top < top) {\r\n\t\t\ttop = rects[i].top;\r\n\t\t}\r\n\r\n\t\tif (rectRight > right) {\r\n\t\t\tright = rectRight;\r\n\t\t}\r\n\r\n\t\tif (rectBottom > bottom) {\r\n\t\t\tbottom = rectBottom;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {left, top, height: bottom - top, width: right - left};\r\n}\r\n","export * from './electron-shared.types';\r\nexport * from './story-filename';\r\n","import {i18n} from '../../util/i18n';\r\nimport {Passage, Story} from './stories.types';\r\n\r\nexport const passageDefaults = (): Omit<Passage, 'id' | 'story'> => ({\r\n\theight: 100,\r\n\thighlighted: false,\r\n\tleft: 0,\r\n\tname: i18n.t('store.passageDefaults.name'),\r\n\tselected: false,\r\n\ttags: [],\r\n\ttext: '',\r\n\ttop: 0,\r\n\twidth: 100,\r\n\toptions:[],\r\n\ttext_user:\"\"\r\n});\r\n\r\nexport const storyDefaults = (): Omit<Story, 'id'> => ({\r\n\tifid: '',\r\n\tlastUpdate: new Date(),\r\n\tpassages: [],\r\n\tname: i18n.t('store.storyDefaults.name'),\r\n\tscript: '',\r\n\tselected: false,\r\n\tsnapToGrid: true,\r\n\tstartPassage: '',\r\n\tstoryFormat: '',\r\n\tstoryFormatVersion: '',\r\n\tstylesheet: '',\r\n\ttags: [],\r\n\ttagColors: {},\r\n\tzoom: 1\r\n});\r\n","import * as React from 'react';\r\nimport {IconSquare, IconSquareCheck} from '@tabler/icons';\r\nimport {IconButton, IconButtonProps} from './icon-button';\r\n\r\nexport interface CheckboxButtonProps\r\n\textends Omit<IconButtonProps, 'icon' | 'onClick'> {\r\n\tcheckedIcon?: React.ReactNode;\r\n\ticon?: React.ReactNode;\r\n\tonChange: (value: boolean) => void;\r\n\tuncheckedIcon?: React.ReactNode;\r\n\tvalue: boolean;\r\n}\r\n\r\nexport const CheckboxButton: React.FC<CheckboxButtonProps> = props => {\r\n\tconst {\r\n\t\tcheckedIcon,\r\n\t\ticon,\r\n\t\tonChange,\r\n\t\tuncheckedIcon,\r\n\t\tvalue,\r\n\t\t...otherProps\r\n\t} = props;\r\n\tconst calculatedIcon = value\r\n\t\t? checkedIcon ?? <IconSquareCheck />\r\n\t\t: uncheckedIcon ?? <IconSquare />;\r\n\r\n\treturn (\r\n\t\t<span\r\n\t\t\taria-disabled={otherProps.disabled}\r\n\t\t\tclassName=\"checkbox-button\"\r\n\t\t\trole=\"checkbox\"\r\n\t\t\taria-checked={value}\r\n\t\t>\r\n\t\t\t<IconButton\r\n\t\t\t\ticon={icon ?? calculatedIcon}\r\n\t\t\t\tonClick={() => onChange(!value)}\r\n\t\t\t\t{...otherProps}\r\n\t\t\t/>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import {Passage, Story} from '../stories';\r\nimport {StoryFormat} from '../story-formats';\r\n\r\nconst trivialPassageProps: (keyof Passage)[] = ['highlighted', 'selected'];\r\nconst trivialStoryProps: (keyof Story)[] = ['lastUpdate', 'selected'];\r\n\r\n// Loosely typing this because of the different load states possible in the type.\r\nconst trivialStoryFormatProps: string[] = [\r\n\t'loadError',\r\n\t'loadState',\r\n\t'properties',\r\n\t'selected'\r\n];\r\n\r\n/**\r\n * Is a passage change persistable? e.g. is it nontrivial?\r\n */\r\nexport function isPersistablePassageChange(props: Partial<Passage>) {\r\n\treturn Object.keys(props).some(\r\n\t\tkey => !trivialPassageProps.includes(key as keyof Passage)\r\n\t);\r\n}\r\n\r\n/**\r\n * Is a story change persistable? e.g. is it nontrivial?\r\n */\r\nexport function isPersistableStoryChange(props: Partial<Story>) {\r\n\treturn Object.keys(props).some(\r\n\t\tkey => !trivialStoryProps.includes(key as keyof Story)\r\n\t);\r\n}\r\n\r\n/**\r\n * Is a story format persistable? e.g. is it nontrivial?\r\n */\r\nexport function isPersistableStoryFormatChange(props: Partial<StoryFormat>) {\r\n\treturn Object.keys(props).some(\r\n\t\tkey => !trivialStoryFormatProps.includes(key as keyof StoryFormat)\r\n\t);\r\n}","/**\r\n * Is this code currently in an Electron renderer process? Returns false if\r\n * either this is running in the Electron main process, or Electron is not\r\n * involved at all.\r\n * @see https://github.com/electron/electron/issues/2288#issuecomment-337858978\r\n */\r\nexport const isElectronRenderer = () =>\r\n\twindow.navigator.userAgent.indexOf('Electron') !== -1;\r\n\r\n/**\r\n * Is this code currently running in an Electron main process? Returns false if\r\n * either this is running in an Electron renderer process, or Electron is not\r\n * involved at all.\r\n * @see https://github.com/electron/electron/issues/2288#issuecomment-611231970\r\n */\r\n\r\nexport const isElectronMain = () => process.versions.hasOwnProperty('electron');\r\n","import {IconAlertOctagon} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport './error-message.css';\r\n\r\nexport const ErrorMessage: React.FC = ({children}) => (\r\n\t<div className=\"error-message\">\r\n\t\t<IconAlertOctagon />\r\n\t\t<div className=\"message\">{children}</div>\r\n\t</div>\r\n);\r\n","import * as React from 'react';\r\nimport useErrorBoundary from 'use-error-boundary';\r\nimport {ErrorMessage} from './error-message';\r\nimport './global-error-boundary.css';\r\n\r\nexport const GlobalErrorBoundary: React.FC = ({children}) => {\r\n\tconst {ErrorBoundary, didCatch, error} = useErrorBoundary();\r\n\r\n\t// Non-localized because our localization might be broken.\r\n\r\n\treturn didCatch ? (\r\n\t\t<div className=\"global-error-boundary\">\r\n\t\t\t<div>\r\n\t\t\t\t<ErrorMessage>\r\n\t\t\t\t\t<p>Something went wrong and Twine can't continue.</p>\r\n\t\t\t\t\t<p>Please try restarting Twine or reloading the page.</p>\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tIf you see this message repeatedly, please{' '}\r\n\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\thref=\"https://twinery.org/2bugs\"\r\n\t\t\t\t\t\t\trel=\"noreferrer\"\r\n\t\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\treport a bug\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</ErrorMessage>\r\n\t\t\t\t<p>Details:</p>\r\n\t\t\t\t<pre>{error.stack}</pre>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t) : (\r\n\t\t<ErrorBoundary>{children}</ErrorBoundary>\r\n\t);\r\n};","import {IconInfoCircle} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport UAParser from 'ua-parser-js';\r\nimport {ButtonBar} from '../container/button-bar';\r\nimport {Card} from '../container/card';\r\nimport {IconLink} from '../control/icon-link';\r\nimport {ErrorMessage} from '../error';\r\nimport './safari-warning-card.css';\r\n\r\nexport interface SafariNavigator extends Navigator {\r\n\tstandalone?: boolean;\r\n}\r\n\r\nexport const SafariWarningCard: React.FC = props => {\r\n\tconst {t} = useTranslation();\r\n\tconst browser = new UAParser().getBrowser();\r\n\r\n\tif (browser.name !== 'Safari') {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif (browser.version) {\r\n\t\tconst version = parseInt(browser.version.replace(/\\..*/, ''));\r\n\r\n\t\tif (Number.isFinite(version) && version < 13) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tconst safariNavigator = window.navigator as SafariNavigator;\r\n\r\n\tif (safariNavigator.standalone) {\r\n\t\t// We are in \"standalone\" or full-screen mode. This is supposed to have\r\n\t\t// its own localStorage which is not subject to the seven-day limit.\r\n\t\t// https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst canAddToHomeScreen = safariNavigator.standalone !== undefined;\r\n\r\n\treturn (\r\n\t\t<div className=\"safari-warning-card\">\r\n\t\t\t<Card>\r\n\t\t\t\t<ErrorMessage>\r\n\t\t\t\t\t<p>{t('components.safariWarningCard.message')}</p>\r\n\t\t\t\t\t{canAddToHomeScreen && (\r\n\t\t\t\t\t\t<p>{t('components.safariWarningCard.addToHomeScreen')}</p>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<p>{t('components.safariWarningCard.archiveAndUseAnotherBrowser')}</p>\r\n\t\t\t\t</ErrorMessage>\r\n\t\t\t\t<ButtonBar>\r\n\t\t\t\t\t<IconLink\r\n\t\t\t\t\t\thref=\"https://twinery.org/2ioslocalstorage\"\r\n\t\t\t\t\t\ticon={<IconInfoCircle />}\r\n\t\t\t\t\t\tlabel={t('components.safariWarningCard.learnMore')}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{canAddToHomeScreen && (\r\n\t\t\t\t\t\t<IconLink\r\n\t\t\t\t\t\t\thref=\"https://twinery.org/2ioshomescreen\"\r\n\t\t\t\t\t\t\ticon={<IconInfoCircle />}\r\n\t\t\t\t\t\t\tlabel={t('components.safariWarningCard.howToAddToHomeScreen')}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</ButtonBar>\r\n\t\t\t</Card>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport './text-select.css';\r\n\r\nexport interface SelectOption {\r\n\tdisabled?: boolean;\r\n\tlabel: string;\r\n\tvalue: string;\r\n}\r\n\r\nexport interface TextSelectProps {\r\n\tchildren: React.ReactNode;\r\n\tonChange?: React.ChangeEventHandler<HTMLSelectElement>;\r\n\toptions: SelectOption[];\r\n\torientation?: 'horizontal' | 'vertical';\r\n\tvalue: string;\r\n}\r\n\r\nexport const TextSelect: React.FC<TextSelectProps> = props => {\r\n\tconst {children, onChange, options, orientation, value} = props;\r\n\tconst className = classNames(\r\n\t\t'text-select',\r\n\t\t`orientation-${orientation ?? 'horizontal'}`\r\n\t);\r\n\r\n\treturn (\r\n\t\t<span className={className}>\r\n\t\t\t<label>\r\n\t\t\t\t<span className=\"text-select-label\">{children}</span>\r\n\t\t\t\t<span className=\"text-select-control\">\r\n\t\t\t\t\t<select onChange={onChange} value={value}>\r\n\t\t\t\t\t\t{options.map(option => (\r\n\t\t\t\t\t\t\t<option\r\n\t\t\t\t\t\t\t\tdisabled={option.disabled}\r\n\t\t\t\t\t\t\t\tkey={option.value}\r\n\t\t\t\t\t\t\t\tvalue={option.value}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{option.label}\r\n\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</span>\r\n\t\t\t</label>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import {StoryFormat} from '../../store/story-formats';\r\nimport {satisfies} from 'semver';\r\n\r\n/**\r\n * Returns editor extensions in a format that fit the Twine version specified.\r\n * If none are available, then this returns undefined.\r\n */\r\nexport function formatEditorExtensions(\r\n\t//StoryFormat타입은 BaseStoryFormat 이라는 id, name 등등의 정보가 담긴 인터페이스랑,\r\n\t//로딩 상태를 나타내는 정보를 담는 게 같이 있음.\r\n\tformat: StoryFormat,\r\n\ttwineVersion: string\r\n) {\r\n\tif (format.loadState !== 'loaded') {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (!format.properties.editorExtensions?.twine) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst extensions = Object.keys(\r\n\t\tformat.properties.editorExtensions.twine\r\n\t).filter(semverSpec => satisfies(twineVersion, semverSpec));\r\n\r\n\tif (extensions.length === 0) {\r\n\t\tconsole.info(\r\n\t\t\t`${format.name} ${format.version} has editor extensions, but none that ${twineVersion} satisfies`\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (extensions.length > 1) {\r\n\t\tconsole.warn(\r\n\t\t\t`More than one set of editor extensions for ${format.name} ${format.version} is satisfied by ${twineVersion}. Using the first.`\r\n\t\t);\r\n\t}\r\n\r\n\treturn format.properties.editorExtensions.twine[extensions[0]];\r\n}\r\n","import {StoryFormat} from '../../store/story-formats';\r\n\r\n/**\r\n * Returns a namespace prefix for a story format that is compatible with\r\n * CodeMirror names (modes and commands).\r\n */\r\nexport function namespaceForFormat(format: StoryFormat) {\r\n\treturn format.name.toLowerCase().replace(/\\s/g, '-') + '-' + format.version;\r\n}\r\n","export interface AppInfo {\r\n\tname: string;\r\n\tversion: string;\r\n}\r\n\r\n/**\r\n * Retrieves information about the Twine app itself based on buildtime\r\n * environment\r\n */\r\nexport function getAppInfo(): AppInfo {\r\n\treturn {\r\n\t\tname: process.env.REACT_APP_NAME as string,\r\n\t\tversion: process.env.REACT_APP_VERSION as string\r\n\t};\r\n}\r\n","import * as React from 'react';\r\nimport {usePopper} from 'react-popper';\r\nimport {CSSTransition} from 'react-transition-group';\r\nimport {Card} from '../container/card';\r\nimport {IconButton, IconButtonProps} from './icon-button';\r\nimport './card-button.css';\r\nimport FocusTrap from 'focus-trap-react';\r\n\r\nexport interface CardButtonProps extends IconButtonProps {\r\n\t/**\r\n\t * ARIA label for the card that opens.\r\n\t */\r\n\tariaLabel: string;\r\n\t/**\r\n\t * CSS selector for the element inside the card that should be focused when it\r\n\t * is opened. Otherwise, the first text input or button in source order will\r\n\t * be focused.\r\n\t */\r\n\tfocusSelector?: string;\r\n\t/**\r\n\t * Callback for when the open status of the card should change.\r\n\t */\r\n\tonChangeOpen: (value: boolean) => void;\r\n\t/**\r\n\t * Is the card currently open?\r\n\t */\r\n\topen?: boolean;\r\n}\r\n\r\nexport const CardButton: React.FC<CardButtonProps> = props => {\r\n\tconst {ariaLabel, children, focusSelector, onChangeOpen, open, ...other} =\r\n\t\tprops;\r\n\tconst [buttonEl, setButtonEl] = React.useState<HTMLButtonElement | null>(\r\n\t\tnull\r\n\t);\r\n\tconst [cardEl, setCardEl] = React.useState<HTMLDivElement | null>(null);\r\n\tconst {styles, attributes} = usePopper(buttonEl, cardEl, {strategy: 'fixed'});\r\n\r\n\treturn (\r\n\t\t<span className=\"card-button\">\r\n\t\t\t<IconButton\r\n\t\t\t\tonClick={() => onChangeOpen(!open)}\r\n\t\t\t\t{...other}\r\n\t\t\t\tref={setButtonEl}\r\n\t\t\t/>\r\n\t\t\t<CSSTransition\r\n\t\t\t\tclassNames=\"fade-out\"\r\n\t\t\t\tin={open}\r\n\t\t\t\tmountOnEnter\r\n\t\t\t\ttimeout={200}\r\n\t\t\t\tunmountOnExit\r\n\t\t\t>\r\n\t\t\t\t<FocusTrap\r\n\t\t\t\t\tfocusTrapOptions={{\r\n\t\t\t\t\t\tclickOutsideDeactivates: true,\r\n\t\t\t\t\t\tonDeactivate: () => onChangeOpen(false)\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\taria-label={ariaLabel}\r\n\t\t\t\t\t\tclassName=\"card-button-card\"\r\n\t\t\t\t\t\tref={setCardEl}\r\n\t\t\t\t\t\trole=\"dialog\"\r\n\t\t\t\t\t\tstyle={styles.popper}\r\n\t\t\t\t\t\t{...attributes.popper}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Card floating>{children}</Card>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</FocusTrap>\r\n\t\t\t</CSSTransition>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import escape from 'lodash/escape';\r\nimport {Passage, Story} from '../store/stories';\r\nimport {AppInfo} from './app-info';\r\nimport {i18n} from './i18n';\r\n\r\nexport interface PublishOptions {\r\n\t/**\r\n\t * Options that will be passed as-is to the format in the `options` attribute\r\n\t * of the published `<tw-storydata>` tag.\r\n\t * \r\n\t * 스토리 파일의 포맷\r\n\t * 스토리 파일이 HTML형태로 저장될 때, 가장 바깥에 <tw-storydata> 태그가 있음\r\n\t * <tw-storydata>의 format 속성에 전달되는 값\r\n\t */\r\n\tformatOptions?: string;\r\n\r\n\t/**\r\n\t * ID of the passage to start the story at. This overrides what is set at the\r\n\t * story level.\r\n\t * \r\n\t * 시작 passage의 아이디\r\n\t * 뒷문장은 무슨 소린지 모르겠음\r\n\t */\r\n\tstartId?: string;\r\n\r\n\t/**\r\n\t * If true, publishing will proceed even if the story has no starting passage\r\n\t * set and one wasn't set manually.\r\n\t * \r\n\t * 스토리의 시작 passage가 설정되어 있지 않더라도 HTML파일로 만들어진다.\r\n\t */\r\n\tstartOptional?: boolean;\r\n}\r\n\r\n/**\r\n * Returns a filename for an archive file.\r\n * \r\n * 아카이브 파일의 파일명을 반환\r\n */\r\nexport function archiveFilename() {\r\n\tconst timestamp = new Date().toLocaleString().replace(/[/:\\\\]/g, '.');    // 지정된 지역에서 표현하는 방식의 날짜를 문자열로 리턴\r\n\r\n\treturn i18n.t('store.archiveFilename', {timestamp});         // 해당 지역의 문자열로 번역\r\n}\r\n\r\n/**\r\n * Publishes an archive of stories, e.g. all stories in one file with no story\r\n * format binding.\r\n * \r\n * 아카이브 파일 퍼블리싱.\r\n * 모든 스토리 파일을 한꺼번에 내보냄\r\n */\r\nexport function publishArchive(stories: Story[], appInfo: AppInfo) {\r\n\treturn stories.reduce((output, story) => {\r\n\t\t// Force publishing even if there is no start point set.\r\n\t\t// 스토리에 시작 지점이 없더라도 강제적으로 퍼블리싱\r\n\r\n\t\treturn (\r\n\t\t\toutput + publishStory(story, appInfo, {startOptional: true}) + '\\n\\n'\r\n\t\t);\r\n\t}, '');\r\n}\r\n\r\n/**\r\n * Publishes a passage to an HTML fragment. This takes a id argument because\r\n * passages are numbered sequentially in published stories, not with a UUID.\r\n * \r\n * passage를 HTML 조각으로 퍼블리싱.\r\n * <tw-passagedata> 태그로 감싸는 걸 말하는 것 같음\r\n * escape()는 &, <, > 등의 특수문자들을 그에 대응하는 HTML 요소로 변환해줌\r\n * join()은 배열 요소 사이사이에 입력한 내용을 집어넣어준다. 밑에 코드에서는 공백을 넣었다\r\n */\r\nexport function publishPassage(passage: Passage, localId: number) {\r\n\treturn (\r\n\t\t`<tw-passagedata pid=\"${escape(localId.toString())}\" ` +\r\n\t\t`name=\"${escape(passage.name)}\" ` +\r\n\t\t`tags=\"${escape(passage.tags.join(' '))}\" ` +\r\n\t\t`position=\"${passage.left},${passage.top}\" ` +\r\n\t\t`size=\"${passage.width},${passage.height}\">` +\r\n\t\t`${escape(passage.text)}</tw-passagedata>`\r\n\t);\r\n}\r\n\r\n/**\r\n * Does a \"naked\" publish of a story -- creating an HTML representation of it,\r\n * but without any story format binding.\r\n * \r\n * 스토리 HTML파일의 초기 형태\r\n * 스토리 포맷이 없는 상태인듯\r\n */\r\nexport function publishStory(\r\n\tstory: Story,\r\n\tappInfo: AppInfo,\r\n\t{formatOptions, startId, startOptional}: PublishOptions = {}\r\n) {\r\n\tstartId = startId ?? story.startPassage;\r\n\r\n\t// Verify that the start passage exists.\r\n\t// 시작 passage가 있는지 검사\r\n\r\n\tif (!startOptional) {\r\n\t\tif (!startId) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t'There is no starting point set for this story and none was set manually.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (!story.passages.find(p => p.id === startId)) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t'The passage set as starting point for this story does not exist.'\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t// The id of the start passage as it is published (*not* a UUID).\r\n\t/**\r\n\t * 스토리 파일의 시작 passage\r\n\t * 이 밑으로 스토리 HTML파일을 생성하는 코드\r\n\t */\r\n\r\n\tlet startLocalId;\r\n\tlet passageData = '';\r\n\r\n\tstory.passages.forEach((p, index) => {\r\n\t\tpassageData += publishPassage(p, index + 1);\r\n\r\n\t\tif (p.id === startId) {\r\n\t\t\tstartLocalId = index + 1;\r\n\t\t}\r\n\t});\r\n\r\n\tconst tagData = Object.keys(story.tagColors).reduce(\r\n\t\t(result, tag) =>\r\n\t\t\tresult +\r\n\t\t\t`<tw-tag name=\"${escape(tag)}\" color=\"${escape(\r\n\t\t\t\tstory.tagColors[tag]\r\n\t\t\t)}\"></tw-tag>`,\r\n\t\t''\r\n\t);\r\n\r\n\treturn (\r\n\t\t`<tw-storydata name=\"${escape(story.name)}\" ` +\r\n\t\t`startnode=\"${startLocalId || ''}\" ` +\r\n\t\t`creator=\"${escape(appInfo.name)}\" ` +\r\n\t\t`creator-version=\"${escape(appInfo.version)}\" ` +\r\n\t\t`format=\"${escape(story.storyFormat)}\" ` +\r\n\t\t`format-version=\"${escape(story.storyFormatVersion)}\" ` +\r\n\t\t`ifid=\"${escape(story.ifid)}\" ` +\r\n\t\t`options=\"${escape(formatOptions)}\" ` +\r\n\t\t`tags=\"${escape(story.tags.join(' '))}\" ` +\r\n\t\t`zoom=\"${escape(story.zoom.toString())}\" hidden>` +\r\n\t\t`<style role=\"stylesheet\" id=\"twine-user-stylesheet\" ` +\r\n\t\t`type=\"text/twine-css\">` +\r\n\t\tstory.stylesheet +\r\n\t\t`</style>` +\r\n\t\t`<script role=\"script\" id=\"twine-user-script\" ` +\r\n\t\t`type=\"text/twine-javascript\">` +\r\n\t\tstory.script +\r\n\t\t`</script>` +\r\n\t\ttagData +\r\n\t\tpassageData +\r\n\t\t`</tw-storydata>`\r\n\t);\r\n}\r\n\r\n/**\r\n * Publishes a story and binds it to the source of a story format.\r\n * \r\n * use-publishing.ts에서 아래 함수를 호출\r\n * formatSource를 받아서 위에서 생성한 스토리 파일을 스토리 포맷에 맞게 바인딩\r\n */\r\nexport function publishStoryWithFormat(\r\n\tstory: Story,\r\n\tformatSource: string,\r\n\tappInfo: AppInfo,\r\n\t{formatOptions, startId}: PublishOptions = {}\r\n) {\r\n\tif (!formatSource) {\r\n\t\tthrow new Error('Story format source cannot be empty.');\r\n\t}\r\n\r\n\tlet output = formatSource;        \r\n\r\n\t// We use function replacements to protect the data from accidental\r\n\t// interactions with the special string replacement patterns.\r\n\r\n\t/**\r\n\t * formatSource에 스토리 파일의 이름과 데이터를 넣어서 반환\r\n\t */\r\n\r\n\toutput = output.replace(/{{STORY_NAME}}/g, () => escape(story.name));\r\n\toutput = output.replace(/{{STORY_DATA}}/g, () =>\r\n\t\tpublishStory(story, appInfo, {formatOptions, startId})\r\n\t);\r\n\r\n\treturn output;\r\n}\r\n","export function isValidTagName(value: string) {\r\n\treturn value.length > 0 && !/\\s/.test(value);\r\n}\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconCheck, IconX} from '@tabler/icons';\r\nimport {ButtonBar} from '../container/button-bar';\r\nimport {CardContent} from '../container/card';\r\nimport {CardButton, CardButtonProps} from './card-button';\r\nimport {IconButton, IconButtonProps} from './icon-button';\r\nimport {TextInput} from './text-input';\r\n\r\nexport interface PromptValidationResponse {\r\n\tmessage?: string;\r\n\tvalid: boolean;\r\n}\r\n\r\nexport type PromptButtonValidator = (\r\n\tvalue: string\r\n) => PromptValidationResponse | Promise<PromptValidationResponse>;\r\n\r\nexport interface PromptButtonProps\r\n\textends Omit<CardButtonProps, 'ariaLabel' | 'onChangeOpen' | 'open'> {\r\n\tcancelIcon?: React.ReactNode;\r\n\tcancelLabel?: string;\r\n\tonChange: React.ChangeEventHandler<HTMLInputElement>;\r\n\tonSubmit: (value: string) => void;\r\n\tprompt: string;\r\n\tsubmitIcon?: React.ReactNode;\r\n\tsubmitLabel?: string;\r\n\tsubmitVariant?: IconButtonProps['variant'];\r\n\tvalidate?: PromptButtonValidator;\r\n\tvalue: string;\r\n}\r\n\r\nexport const PromptButton: React.FC<PromptButtonProps> = props => {\r\n\tconst {\r\n\t\tcancelIcon,\r\n\t\tcancelLabel,\r\n\t\tonChange,\r\n\t\tonSubmit,\r\n\t\tprompt,\r\n\t\tsubmitIcon,\r\n\t\tsubmitLabel,\r\n\t\tsubmitVariant,\r\n\t\tvalidate,\r\n\t\tvalue,\r\n\t\t...other\r\n\t} = props;\r\n\tconst mounted = React.useRef(true);\r\n\tconst [open, setOpen] = React.useState(false);\r\n\tconst [validation, setValidation] =\r\n\t\tReact.useState<PromptValidationResponse>();\r\n\tconst {t} = useTranslation();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function updateValidation() {\r\n\t\t\tif (validate) {\r\n\t\t\t\tconst validation = await validate(value);\r\n\r\n\t\t\t\tif (mounted.current) {\r\n\t\t\t\t\tsetValidation(validation);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (mounted.current) {\r\n\t\t\t\t\tsetValidation({valid: true});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tupdateValidation();\r\n\t}, [validate, value]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tmounted.current = false;\r\n\t\t};\r\n\t}, []);\r\n\r\n\tfunction handleCancel(event: React.MouseEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tsetOpen(false);\r\n\t}\r\n\r\n\tfunction handleSubmit(event: React.FormEvent) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// It's possible to submit with the Enter key and bypass us disabling the\r\n\t\t// submit button, so we need to catch that here.\r\n\r\n\t\tif (validation?.valid) {\r\n\t\t\tonSubmit(value);\r\n\t\t\tsetOpen(false);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<span className=\"prompt-button\">\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={prompt}\r\n\t\t\t\tonChangeOpen={setOpen}\r\n\t\t\t\topen={open}\r\n\t\t\t\t{...other}\r\n\t\t\t>\r\n\t\t\t\t<form onSubmit={handleSubmit}>\r\n\t\t\t\t\t<CardContent>\r\n\t\t\t\t\t\t<TextInput onChange={onChange} orientation=\"vertical\" value={value}>\r\n\t\t\t\t\t\t\t{prompt}\r\n\t\t\t\t\t\t</TextInput>\r\n\t\t\t\t\t\t{validation?.message && <p>{validation.message}</p>}\r\n\t\t\t\t\t</CardContent>\r\n\t\t\t\t\t<ButtonBar>\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\tbuttonType=\"submit\"\r\n\t\t\t\t\t\t\tdisabled={!validation?.valid}\r\n\t\t\t\t\t\t\ticon={submitIcon ?? <IconCheck />}\r\n\t\t\t\t\t\t\tlabel={submitLabel ?? t('common.ok')}\r\n\t\t\t\t\t\t\tvariant={submitVariant ?? 'primary'}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\tbuttonType=\"button\"\r\n\t\t\t\t\t\t\ticon={cancelIcon ?? <IconX />}\r\n\t\t\t\t\t\t\tlabel={cancelLabel ?? t('common.cancel')}\r\n\t\t\t\t\t\t\tonClick={handleCancel}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</ButtonBar>\r\n\t\t\t\t</form>\r\n\t\t\t</CardButton>\r\n\t\t</span>\r\n\t);\r\n};\r\n","// css 적용하는 코드인듯\r\n\r\n\r\nimport * as React from 'react';\r\nimport {Card, CardProps} from './card/card';\r\nimport './button-card.css';\r\n\r\nexport const ButtonCard: React.FC<CardProps> = props => (\r\n\t<div className=\"button-card\">\r\n\t\t<Card {...props} />\r\n\t</div>\r\n);\r\n","import * as React from 'react';\r\nimport {usePopper} from 'react-popper';\r\nimport {CSSTransition} from 'react-transition-group';\r\nimport {ButtonBar, ButtonBarSeparator} from '../container/button-bar';\r\nimport {ButtonCard} from '../container/button-card';\r\nimport {IconEmpty} from '../image/icon';\r\nimport {IconButton, IconButtonProps} from './icon-button';\r\nimport './menu-button.css';\r\nimport {CheckboxButton} from './checkbox-button';\r\nimport {IconCheck} from '@tabler/icons';\r\n\r\nexport interface UncheckableLabeledMenuItem {\r\n\tdisabled?: boolean;\r\n\tlabel: string;\r\n\tonClick: () => void;\r\n\tseparator?: undefined;\r\n\tvariant?: IconButtonProps['variant'];\r\n}\r\n\r\nexport interface CheckableLabeledMenuItem extends UncheckableLabeledMenuItem {\r\n\tcheckable: true;\r\n\tchecked: boolean;\r\n}\r\n\r\nexport type LabeledMenuItem =\r\n\t| UncheckableLabeledMenuItem\r\n\t| CheckableLabeledMenuItem;\r\n\r\nexport interface MenuSeparator {\r\n\tdisabled?: boolean;\r\n\tlabel?: string;\r\n\tonClick?: (e: React.MouseEvent) => void;\r\n\tvariant?: IconButtonProps['variant'];\r\n\tseparator: true;\r\n}\r\n\r\nexport interface MenuButtonProps extends Omit<IconButtonProps, 'onClick'> {\r\n\titems: (LabeledMenuItem | MenuSeparator)[];\r\n}\r\n\r\nexport const MenuButton: React.FC<MenuButtonProps> = props => {\r\n\tconst {items, ...other} = props;\r\n\tconst [buttonEl, setButtonEl] = React.useState<HTMLButtonElement | null>(\r\n\t\tnull\r\n\t);\r\n\tconst [menuEl, setMenuEl] = React.useState<HTMLDivElement | null>(null);\r\n\tconst [open, setOpen] = React.useState(false);\r\n\tconst {styles, attributes} = usePopper(buttonEl, menuEl, {strategy: 'fixed'});\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst closer = () => setOpen(false);\r\n\r\n\t\tif (open) {\r\n\t\t\tdocument.addEventListener('click', closer);\r\n\t\t}\r\n\r\n\t\treturn () => document.removeEventListener('click', closer);\r\n\t}, [menuEl, open, setOpen]);\r\n\r\n\treturn (\r\n\t\t<span className=\"menu-button\">\r\n\t\t\t<IconButton\r\n\t\t\t\t{...other}\r\n\t\t\t\tonClick={() => setOpen(open => !open)}\r\n\t\t\t\tref={setButtonEl}\r\n\t\t\t/>\r\n\t\t\t<CSSTransition\r\n\t\t\t\tclassNames=\"fade-out\"\r\n\t\t\t\tin={open}\r\n\t\t\t\tmountOnEnter\r\n\t\t\t\ttimeout={200}\r\n\t\t\t\tunmountOnExit\r\n\t\t\t>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"menu-button-menu\"\r\n\t\t\t\t\tref={setMenuEl}\r\n\t\t\t\t\tstyle={styles.popper}\r\n\t\t\t\t\t{...attributes.popper}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ButtonCard floating>\r\n\t\t\t\t\t\t<ButtonBar orientation=\"vertical\">\r\n\t\t\t\t\t\t\t{items.map((item, index) => {\r\n\t\t\t\t\t\t\t\tif (item.separator) {\r\n\t\t\t\t\t\t\t\t\treturn <ButtonBarSeparator key={index} />;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\treturn 'checkable' in item ? (\r\n\t\t\t\t\t\t\t\t\t<CheckboxButton\r\n\t\t\t\t\t\t\t\t\t\tcheckedIcon={<IconCheck />}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={item.disabled}\r\n\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\tlabel={item.label}\r\n\t\t\t\t\t\t\t\t\t\tonChange={item.onClick}\r\n\t\t\t\t\t\t\t\t\t\tuncheckedIcon={<IconEmpty />}\r\n\t\t\t\t\t\t\t\t\t\tvalue={item.checked}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\t\t\t\tdisabled={item.disabled}\r\n\t\t\t\t\t\t\t\t\t\ticon={<IconEmpty />}\r\n\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\tlabel={item.label}\r\n\t\t\t\t\t\t\t\t\t\tonClick={item.onClick}\r\n\t\t\t\t\t\t\t\t\t\tvariant={item.variant}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</ButtonBar>\r\n\t\t\t\t\t</ButtonCard>\r\n\t\t\t\t</div>\r\n\t\t\t</CSSTransition>\r\n\t\t</span>\r\n\t);\r\n};\r\n","/*\r\nParses passage text for links. Optionally, it returns internal links only --\r\ne.g. those pointing to other passages in a story, not to an external web site.\r\n*/\r\n\r\nimport uniq from 'lodash/uniq';\r\n\r\n// The top level regular expression to catch links -- i.e. [[link]].\r\n//모든 일치 항목의 배열을 반환하며, 없으면 빈 배열을 반환함.\r\nconst extractLinkTags = (text: string) => text.match(/\\[\\[.*?\\]\\]/g) || [];\r\n\r\n// Links _not_ starting with a protocol, e.g. abcd://.\r\n// http:// 와 같이 링크 형식인지 확인하는 것 같음.\r\nconst internalLinks = (link: string) => !/^\\w+:\\/\\/\\/?\\w/i.test(link);\r\n\r\n// Links with some text in them.\r\nconst nonEmptyLinks = (link: string) => link !== '';\r\n\r\n// Setter is the second [] block if exists.\r\nconst removeSetters = (link: string) => {\r\n\tconst noSetter = getField(link, '][', 0);\r\n\r\n\treturn noSetter ?? link;\r\n};\r\n\r\nconst removeEnclosingBrackets = (link: string) =>\r\n\tlink.substr(2, link.length - 4);\r\n\r\n/**\r\n * Split the link by the separator and return the field in the given index.\r\n * Negative indices start from the end of the array.\r\n */\r\nconst getField = (link: string, separator: string, index: number) => {\r\n\tconst fields = link.split(separator);\r\n\r\n\tif (fields.length === 1) {\r\n\t\t/* Separator not present. */\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\treturn index < 0 ? fields[fields.length + index] : fields[index];\r\n};\r\n\r\n// Arrow links:\r\n// [[display text->link]] format\r\n// [[link<-display text]] format\r\n// Interpret the rightmost '->' and the leftmost '<-' as the divider.\r\n\r\nconst extractLink = (tagContent: string) => {\r\n\treturn (\r\n\t\tgetField(tagContent, '->', -1) ||\r\n\t\tgetField(tagContent, '<-', 0) ||\r\n\t\t//  TiddlyWiki links:\r\n\t\t//  [[display text|link]] format\r\n\r\n\t\tgetField(tagContent, '|', -1) ||\r\n\t\t// [[link]] format\r\n\t\ttagContent\r\n\t);\r\n};\r\n\r\n/**\r\n * Returns a list of unique links in passage source code.\r\n */\r\nexport function parseLinks(text: string, internalOnly?: boolean) {\r\n\t// Link matching regexps ignore setter components, should they exist.\r\n\r\n\t//map함수는 배열의 각 요소에 모두 접근하여 인자로 주는 함수를 적용하는 함수.\r\n\tlet result = uniq(\r\n\t\textractLinkTags(text)\r\n\t\t\t.map(removeEnclosingBrackets)\r\n\t\t\t.map(removeSetters)\r\n\t\t\t.map(extractLink)\r\n\t\t\t.filter(nonEmptyLinks)//filter는 배열중 인자로 주어진 조건을 만족하는 애들만 추출해서 얕은 복사를 함.\r\n\t);\r\n\r\n\tif (internalOnly) {\r\n\t\tresult = result.filter(internalLinks);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","import {PrefsState} from './prefs.types';\r\n\r\nexport const defaults = (): PrefsState => ({\r\n\tappTheme: 'system',\r\n\tcodeEditorFontFamily: 'var(--font-monospaced)',\r\n\tcodeEditorFontScale: 1,\r\n\tdialogWidth: 600,\r\n\tdisabledStoryFormatEditorExtensions: [],\r\n\tdonateShown: false,\r\n\teditorCursorBlinks: true,\r\n\tfirstRunTime: new Date().getTime(),\r\n\tlastUpdateSeen: '',\r\n\tlastUpdateCheckTime: new Date().getTime(),\r\n\tlocale:\r\n\t\t(window.navigator as any).userLanguage ||\r\n\t\twindow.navigator.language ||\r\n\t\t(window.navigator as any).browserLanguage ||\r\n\t\t(window.navigator as any).systemLanguage ||\r\n\t\t'en-us',\r\n\tpassageEditorFontFamily: 'var(--font-system)',\r\n\tpassageEditorFontScale: 1,\r\n\tproofingFormat: {\r\n\t\tname: 'Paperthin',\r\n\t\tversion: '1.0.0'\r\n\t},\r\n\tstoryFormat: {\r\n\t\tname: 'Harlowe',\r\n\t\tversion: '3.3.3'\r\n\t},\r\n\tstoryFormatListFilter: 'current',\r\n\tstoryListSort: 'name',\r\n\tstoryListTagFilter: [],\r\n\tstoryTagColors: {},\r\n\twelcomeSeen: false\r\n});\r\n","// This automatically triggers a function when typing a word that is prefixed by\r\n// certain text. We use this to automatically pop open the autocomplete when the\r\n// user is probably typing a passage name.\r\n\r\nimport CodeMirror from 'codemirror';\r\nimport {Editor} from 'codemirror';\r\n\r\nlet attachments: Editor[] = [];\r\n\r\nexport interface CMPrefixTriggerOptions {\r\n\t/**\r\n\t * Called when the user types a prefix in.\r\n\t */\r\n\tcallback?: (editor: Editor) => void;\r\n\t/**\r\n\t * An array of strings that will trigger the callback, case-sensitive.\r\n\t */\r\n\tprefixes?: string[];\r\n}\r\n\r\nexport function prefixTriggerOption(\r\n\tcm: Editor,\r\n\toptions: CMPrefixTriggerOptions\r\n) {\r\n\tconst {prefixes, callback} = options;\r\n\r\n\tfunction checkTrigger(cm: Editor) {\r\n\t\tif (cm.state.completionActive || !prefixes || !callback) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Back up two words from the cursor.\r\n\r\n\t\tconst curWord = cm.findWordAt(cm.getDoc().getCursor());\r\n\r\n\t\tcurWord.anchor.ch--;\r\n\r\n\t\tconst prevWordRange = cm.findWordAt(curWord.anchor);\r\n\t\tconst prevWord = cm.getRange(prevWordRange.anchor, prevWordRange.head);\r\n\r\n\t\t// Do we have a match? Only trigger this once.\r\n\r\n\t\tfor (const prefix of prefixes) {\r\n\t\t\tif (prevWord === prefix) {\r\n\t\t\t\tcallback(cm);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (callback && prefixes && !attachments.includes(cm)) {\r\n\t\tattachments.push(cm);\r\n\t\tcm.on('inputRead', checkTrigger);\r\n\t} else if (attachments.includes(cm)) {\r\n\t\tcm.off('inputRead', checkTrigger);\r\n\t\tattachments = attachments.filter(editor => editor !== cm);\r\n\t}\r\n}\r\n\r\nlet inited = false;\r\n\r\nexport function initPrefixTriggerGlobally() {\r\n\tif (!inited) {\r\n\t\tCodeMirror.defineOption('prefixTrigger', [], prefixTriggerOption);\r\n\t\tinited = true;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { useRef } from 'react';\r\nimport {\r\n\tControlled as CodeMirror,\r\n\tIControlledCodeMirror\r\n} from 'react-codemirror2';\r\nimport 'codemirror/addon/display/placeholder';\r\nimport 'codemirror/addon/hint/show-hint';\r\nimport 'codemirror/addon/hint/show-hint.css';\r\nimport 'codemirror/lib/codemirror.css';\r\nimport 'codemirror/mode/css/css';\r\nimport 'codemirror/mode/javascript/javascript';\r\nimport './code-area.css';\r\nimport './codemirror-theme.css';\r\nimport classnames from 'classnames';\r\nimport {initPrefixTriggerGlobally} from '../../../codemirror/prefix-trigger';\r\n\r\n// Not ideal by far to do this init here, outside of a component, but we have to\r\n// set up CodeMirror before the first render. Otherwise, CodeMirror doesn't pick\r\n// up on options properly.\r\n\r\ninitPrefixTriggerGlobally();\r\n\r\nexport interface CodeAreaProps extends IControlledCodeMirror {\r\n\tfontFamily?: string;\r\n\tfontScale?: number;\r\n\tlabel: string;\r\n\tlabelHidden?: boolean;\r\n\tvalue: string;//textarea에 적는 모든 string을 저장하는 value이다.? script인가?\r\n}\r\nexport const CodeArea: React.FC<CodeAreaProps> = props => {\r\n\tconst {fontFamily, fontScale, label, ...otherProps} = props;\r\n\tconst style: React.CSSProperties = {};\r\n\r\n\tif (fontFamily) {\r\n\t\tstyle.fontFamily = fontFamily.includes(' ')\r\n\t\t\t? `\"${fontFamily}\"`\r\n\t\t\t: fontFamily;\r\n\t}\r\n\r\n\tif (fontScale) {\r\n\t\tstyle.fontSize = `${fontScale * 100}%`;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"code-area\" style={style}>\r\n\t\t\t<label>\r\n\t\t\t\t<span\r\n\t\t\t\t\tclassName={classnames('label', {\r\n\t\t\t\t\t\t'screen-reader-only': props.labelHidden\r\n\t\t\t\t\t})}\r\n\t\t\t\t>\r\n\t\t\t\t\t{label}\r\n\t\t\t\t</span>\r\n\t\t\t\t<CodeMirror {...otherProps} />\r\n\t\t\t</label>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import i18next from 'i18next';\r\nimport HttpBackend from 'i18next-http-backend';\r\nimport {initReactI18next} from 'react-i18next';\r\n\r\nexport const i18n = i18next.createInstance();\r\n\r\ni18n\r\n\t.use(HttpBackend)\r\n\t.use(initReactI18next)\r\n\t.init({\r\n\t\tdebug: process.env.NODE_ENV === 'development',\r\n\t\tbackend: {\r\n\t\t\tloadPath: `${process.env.PUBLIC_URL}/locales/{{lng}}.json`\r\n\t\t},\r\n\t\tfallbackLng: 'en-us',\r\n\t\tinterpolation: {\r\n\t\t\tescapeValue: false\r\n\t\t},\r\n\t\tload: 'currentOnly'\r\n\t});\r\n","import {PrefsState} from '../../../prefs';\r\nimport {TwineElectronWindow} from '../../../../electron/shared';\r\nimport {defaults} from '../../../prefs/defaults';\r\n\r\nexport async function load(): Promise<Partial<PrefsState>> {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\tconst result: Partial<PrefsState> = {};\r\n\tconst prefKeys = Object.keys(defaults());\r\n\r\n\tif (!twineElectron) {\r\n\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t}\r\n\r\n\tconst prefs = await twineElectron?.ipcRenderer.invoke('load-prefs');\r\n\r\n\tif (prefs && typeof prefs === 'object') {\r\n\t\tfor (const key in prefs) {\r\n\t\t\tif (prefKeys.includes(key)) {\r\n\t\t\t\t(result as any)[key] = prefs[key];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","import {TwineElectronWindow} from '../../../electron/shared';\r\n\r\nexport function saveJson(filename: string, data: any) {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\r\n\tif (!twineElectron) {\r\n\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t}\r\n\r\n\ttwineElectron.ipcRenderer.send('save-json', filename, data);\r\n}\r\n","import {PrefsAction, PrefsState} from '../../../prefs';\r\nimport {saveJson} from '../save-json';\r\n\r\n/**\r\n * A middleware function to save changes to disk. This should be called\r\n * *after* the main reducer runs.\r\n */\r\nexport function saveMiddleware(state: PrefsState, action: PrefsAction) {\r\n\tif (action.type === 'repair' || action.type === 'update') {\r\n\t\tsaveJson('prefs.json', state);\r\n\t}\r\n}\r\n","import {TwineElectronWindow} from '../../../../electron/shared';\r\nimport {Story} from '../../../stories/stories.types';\r\nimport {importStories} from '../../../../util/import';\r\n\r\nexport async function load(): Promise<Story[]> {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\r\n\tif (!twineElectron) {\r\n\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t}\r\n\r\n\tconst stories = await twineElectron?.ipcRenderer.invoke('load-stories');\r\n\r\n\tif (stories && Array.isArray(stories)) {\r\n\t\treturn stories.reduce((result, file) => {\r\n\t\t\tconst story = importStories(file.htmlSource, file.mtime);\r\n\r\n\t\t\tif (story[0]) {\r\n\t\t\t\treturn [...result, story[0]];\r\n\t\t\t}\r\n\r\n\t\t\tconsole.warn('Could not hydrate story: ', file.htmlSource);\r\n\t\t\treturn result;\r\n\t\t}, [] as Story[]);\r\n\t} else {\r\n\t\tconsole.warn('No stories to hydrate in Electron bridge');\r\n\t}\r\n\r\n\treturn [];\r\n}\r\n","import {TwineElectronWindow} from '../../../../electron/shared';\r\nimport {\r\n\tStoriesAction,\r\n\tStoriesState,\r\n\tstoryWithId,\r\n\tstoryWithName\r\n} from '../../../stories';\r\nimport {StoryFormatsState} from '../../../story-formats';\r\nimport {\r\n\tisPersistablePassageChange,\r\n\tisPersistableStoryChange\r\n} from '../../persistable-changes';\r\nimport {saveStory} from './save-story';\r\n\r\n// When a story is deleted, we need to be able to look up information about it\r\n// from the last state.\r\n\r\nlet lastState: StoriesState;\r\n\r\n/**\r\n * A middleware function to save changes to disk. This should be called *after*\r\n * the main reducer runs.\r\n *\r\n * This has an extra argument: functions to archive and publish a story. This is\r\n * because the Electron app saves stories in published format.\r\n */\r\nexport function saveMiddleware(\r\n\tstate: StoriesState,\r\n\taction: StoriesAction,\r\n\tformats: StoryFormatsState\r\n) {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\r\n\tif (!twineElectron) {\r\n\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t}\r\n\r\n\tswitch (action.type) {\r\n\t\tcase 'init':\r\n\t\tcase 'repair':\r\n\t\t\t// We take no action here on a repair action. This is to prevent messing up a\r\n\t\t\t// story's last modified date. If the user then edits the story, we'll save\r\n\t\t\t// their change and the repair then.\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'createStory':\r\n\t\t\tif (!action.props.name) {\r\n\t\t\t\tthrow new Error('Passage was created but with no name specified');\r\n\t\t\t}\r\n\r\n\t\t\tsaveStory(storyWithName(state, action.props.name), formats);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'deleteStory': {\r\n\t\t\t// We have to look up the story in our saved last state to know what file\r\n\t\t\t// to delete.\r\n\r\n\t\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t\t'delete-story',\r\n\t\t\t\tstoryWithId(lastState, action.storyId)\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'updateStory':\r\n\t\t\tif (isPersistableStoryChange(action.props)) {\r\n\t\t\t\tif (action.props.name) {\r\n\t\t\t\t\t// The story has been renamed, and we need to process it\r\n\t\t\t\t\t// specially. We rename the story file, then save it to catch\r\n\t\t\t\t\t// any other changes.\r\n\r\n\t\t\t\t\tconst oldStory = storyWithId(lastState, action.storyId);\r\n\t\t\t\t\tconst newStory = storyWithId(state, action.storyId);\r\n\r\n\t\t\t\t\t// It's crucial that we only respond to this event once. Otherwise,\r\n\t\t\t\t\t// multiple renames in one session will cause mayhem.\r\n\r\n\t\t\t\t\ttwineElectron.ipcRenderer.once('story-renamed', () =>\r\n\t\t\t\t\t\tsaveStory(newStory, formats)\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttwineElectron.ipcRenderer.send('rename-story', oldStory, newStory);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// An ordinary update.\r\n\r\n\t\t\t\t\tsaveStory(storyWithId(state, action.storyId), formats);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'createPassage':\r\n\t\tcase 'createPassages':\r\n\t\tcase 'deletePassage':\r\n\t\tcase 'deletePassages':\r\n\t\t\tsaveStory(storyWithId(state, action.storyId), formats);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'updatePassage':\r\n\t\t\t// Skip updates that wouldn't be saved.\r\n\t\t\tif (isPersistablePassageChange(action.props)) {\r\n\t\t\t\tsaveStory(storyWithId(state, action.storyId), formats);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'updatePassages':\r\n\t\t\t// Skip updates that wouldn't be saved.\r\n\t\t\tif (\r\n\t\t\t\tObject.keys(action.passageUpdates).some(passageId =>\r\n\t\t\t\t\tisPersistablePassageChange(action.passageUpdates[passageId])\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\tsaveStory(storyWithId(state, action.storyId), formats);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Story action ${\r\n\t\t\t\t\t(action as any).type\r\n\t\t\t\t} has no Electron persistence handler`\r\n\t\t\t);\r\n\t}\r\n\r\n\tlastState = [...state];\r\n}\r\n","import {TwineElectronWindow} from '../../../../electron/shared';\r\nimport {Story} from '../../../stories';\r\nimport {publishStory, publishStoryWithFormat} from '../../../../util/publish';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tStoryFormatsState\r\n} from '../../../story-formats';\r\nimport {getAppInfo} from '../../../../util/app-info';\r\nimport {fetchStoryFormatProperties} from '../../../../util/story-format/fetch-properties';\r\n\r\n/**\r\n * Sends an IPC message to save a story to disk, ideally in published form.\r\n */\r\nexport async function saveStory(story: Story, formats: StoryFormatsState) {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\r\n\tif (!twineElectron) {\r\n\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t}\r\n\r\n\ttry {\r\n\t\tconst format = formatWithNameAndVersion(\r\n\t\t\tformats,\r\n\t\t\tstory.storyFormat,\r\n\t\t\tstory.storyFormatVersion\r\n\t\t);\r\n\r\n\t\tif (format.loadState === 'loaded') {\r\n\t\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t\t'save-story-html',\r\n\t\t\t\tstory,\r\n\t\t\t\tpublishStoryWithFormat(story, format.properties.source, getAppInfo(), {\r\n\t\t\t\t\tstartOptional: true\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tconst {source} = await fetchStoryFormatProperties(format.url);\r\n\r\n\t\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t\t'save-story-html',\r\n\t\t\t\tstory,\r\n\t\t\t\tpublishStoryWithFormat(story, source, getAppInfo(), {\r\n\t\t\t\t\tstartOptional: true\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tconsole.warn(\r\n\t\t\t`Could not save full story (${error.message}). Trying to save story data only.`\r\n\t\t);\r\n\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t'save-story-html',\r\n\t\t\tstory,\r\n\t\t\tpublishStory(story, getAppInfo(), {startOptional: true})\r\n\t\t);\r\n\t}\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {TwineElectronWindow} from '../../../../electron/shared';\r\nimport {StoryFormatsState} from '../../../story-formats/story-formats.types';\r\n\r\nexport async function load(): Promise<StoryFormatsState> {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\r\n\tif (!twineElectron) {\r\n\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t}\r\n\r\n\tconst storyFormats = await twineElectron?.ipcRenderer.invoke(\r\n\t\t'load-story-formats'\r\n\t);\r\n\r\n\tif (!storyFormats || !Array.isArray(storyFormats)) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\treturn storyFormats.map(data => ({\r\n\t\tid: uuid(),\r\n\t\tloadState: 'unloaded',\r\n\t\tname: data.name,\r\n\t\tselected: false,\r\n\t\tversion: data.version,\r\n\t\turl: data.url,\r\n\t\tuserAdded: data.userAdded\r\n\t}));\r\n}\r\n","import {StoryFormatsAction, StoryFormatsState} from '../../../story-formats';\r\nimport {isPersistableStoryFormatChange} from '../../persistable-changes';\r\nimport {saveJson} from '../save-json';\r\n\r\n/**\r\n * A middleware function to save changes to disk. This should be called\r\n * *after* the main reducer runs.\r\n */\r\nexport function saveMiddleware(\r\n\tstate: StoryFormatsState,\r\n\taction: StoryFormatsAction\r\n) {\r\n\tconst shouldSave =\r\n\t\taction.type === 'create' ||\r\n\t\taction.type === 'delete' ||\r\n\t\taction.type === 'repair' ||\r\n\t\t(action.type === 'update' && isPersistableStoryFormatChange(action.props));\r\n\r\n\tif (shouldSave) {\r\n\t\tsaveJson(\r\n\t\t\t'story-formats.json',\r\n\t\t\tstate.map(format => ({\r\n\t\t\t\tid: format.id,\r\n\t\t\t\tname: format.name,\r\n\t\t\t\tselected: undefined,\r\n\t\t\t\tversion: format.version,\r\n\t\t\t\turl: format.url,\r\n\t\t\t\tuserAdded: format.userAdded\r\n\t\t\t}))\r\n\t\t);\r\n\t}\r\n}\r\n","import {PrefsState} from '../../../prefs';\r\n\r\nexport async function load(): Promise<Partial<PrefsState>> {\r\n\tconst serialized = window.localStorage.getItem('twine-prefs');\r\n\tconst result: Partial<PrefsState> = {};\r\n\r\n\tif (!serialized) {\r\n\t\treturn {};\r\n\t}\r\n\r\n\tserialized.split(',').forEach(id => {\r\n\t\ttry {\r\n\t\t\tconst serializedPref = window.localStorage.getItem(`twine-prefs-${id}`);\r\n\r\n\t\t\tif (!serializedPref) {\r\n\t\t\t\tconsole.warn(`No preference stored at twine-prefs-${id}`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst item = JSON.parse(serializedPref);\r\n\r\n\t\t\t(result as any)[item.name] = item.value;\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Preference ${id} had corrupt serialized value, skipping`,\r\n\t\t\t\twindow.localStorage.getItem(`twine-prefs-${id}`),\r\n\t\t\t\te\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn result;\r\n}\r\n","import {PrefsAction, PrefsState} from '../../../prefs';\r\nimport {save} from './save';\r\n\r\nexport function saveMiddleware(state: PrefsState, action: PrefsAction) {\r\n\tif (action.type === 'repair' || action.type === 'update') {\r\n\t\tsave(state);\r\n\t}\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {PrefsState} from '../../../prefs';\r\n\r\nexport function save(state: PrefsState) {\r\n\t// Delete existing prefs in local storage, since we aren't bothering to\r\n\t// preserve IDs.\r\n\r\n\tconst previouslySerialized = window.localStorage.getItem('twine-prefs');\r\n\r\n\tif (previouslySerialized) {\r\n\t\tpreviouslySerialized.split(',').forEach(id => {\r\n\t\t\twindow.localStorage.removeItem(`twine-prefs-${id}`);\r\n\t\t});\r\n\t}\r\n\r\n\t/* Save new ones. */\r\n\r\n\tlet ids: string[] = [];\r\n\r\n\tfor (const name in state) {\r\n\t\tconst id = uuid();\r\n\r\n\t\tids.push(id);\r\n\t\twindow.localStorage.setItem(\r\n\t\t\t`twine-prefs-${id}`,\r\n\t\t\tJSON.stringify({\r\n\t\t\t\tid,\r\n\t\t\t\tname,\r\n\t\t\t\tvalue: state[name as keyof PrefsState]\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\twindow.localStorage.setItem('twine-prefs', ids.join(','));\r\n}\r\n","import {\r\n\tpassageWithId,\r\n\tpassageWithName,\r\n\tStoriesAction,\r\n\tStoriesState,\r\n\tstoryWithId,\r\n\tstoryWithName\r\n} from '../../../stories';\r\nimport {isPersistablePassageChange} from '../../persistable-changes';\r\nimport {\r\n\tdeletePassageById,\r\n\tdeleteStory,\r\n\tdoUpdateTransaction,\r\n\tsavePassage,\r\n\tsaveStory\r\n} from './save';\r\n\r\nlet lastState: StoriesState;\r\n\r\n/**\r\n * A middleware function to save changes to local storage. This should be called\r\n * *after* the main reducer runs.\r\n */\r\nexport function saveMiddleware(state: StoriesState, action: StoriesAction) {\r\n\tswitch (action.type) {\r\n\t\tcase 'init':\r\n\t\tcase 'repair':\r\n\t\t\t// We take no action here on a repair action. This is to prevent messing up a\r\n\t\t\t// story's last modified date. If the user then edits the story, we'll save\r\n\t\t\t// their change and the repair then.\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'createPassage': {\r\n\t\t\tif (!action.props.name) {\r\n\t\t\t\tthrow new Error('Passage was created but with no name specified');\r\n\t\t\t}\r\n\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\t\t\tconst passage = passageWithName(state, story.id, action.props.name);\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\tsavePassage(transaction, passage);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'createPassages': {\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\taction.props.forEach(props => {\r\n\t\t\t\t\tif (!props.name) {\r\n\t\t\t\t\t\tthrow new Error('Passage was created but with no name specified');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsavePassage(\r\n\t\t\t\t\t\ttransaction,\r\n\t\t\t\t\t\tpassageWithName(state, story.id, props.name)\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'createStory':\r\n\t\t\tif (!action.props.name) {\r\n\t\t\t\tthrow new Error('Story was created but with no name specified');\r\n\t\t\t}\r\n\r\n\t\t\tconst story = storyWithName(state, action.props.name);\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\tstory.passages.forEach(passage => savePassage(transaction, passage));\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'deletePassage': {\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\r\n\t\t\t// We can't dig up the passage in question right now, because\r\n\t\t\t// previousStories is only a shallow copy, and it's gone there at\r\n\t\t\t// this point in time.\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\tdeletePassageById(transaction, action.passageId);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'deletePassages': {\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\r\n\t\t\t// See above comment about passages.\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\taction.passageIds.forEach(passageId =>\r\n\t\t\t\t\tdeletePassageById(transaction, passageId)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'deleteStory': {\r\n\t\t\t// The story will be gone from state by the time we're called, so we\r\n\t\t\t// need a cached copy.\r\n\r\n\t\t\tconst story = storyWithId(lastState, action.storyId);\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\t// We have to delete all passages, then the story itself.\r\n\r\n\t\t\t\tstory.passages.forEach(passage =>\r\n\t\t\t\t\tdeletePassageById(transaction, passage.id)\r\n\t\t\t\t);\r\n\r\n\t\t\t\tdeleteStory(transaction, story);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'updatePassage':\r\n\t\t\tif (isPersistablePassageChange(action.props)) {\r\n\t\t\t\tconst story = storyWithId(state, action.storyId);\r\n\t\t\t\tconst passage = passageWithId(state, action.storyId, action.passageId);\r\n\r\n\t\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\t\tsavePassage(transaction, passage);\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'updatePassages': {\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\tObject.keys(action.passageUpdates)\r\n\t\t\t\t\t.filter(passageId =>\r\n\t\t\t\t\t\tisPersistablePassageChange(action.passageUpdates[passageId])\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.forEach(passageId =>\r\n\t\t\t\t\t\tsavePassage(\r\n\t\t\t\t\t\t\ttransaction,\r\n\t\t\t\t\t\t\tpassageWithId(state, action.storyId, passageId)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'updateStory': {\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\r\n\t\t\tdoUpdateTransaction(transaction => {\r\n\t\t\t\tsaveStory(transaction, story);\r\n\t\t\t\tstory.passages.forEach(passage => savePassage(transaction, passage));\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tdefault:\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Story action ${\r\n\t\t\t\t\t(action as any).type\r\n\t\t\t\t} has no local storage persistence handler`\r\n\t\t\t);\r\n\t}\r\n\r\n\tlastState = state;\r\n}\r\n","import {passageDefaults, storyDefaults} from '../../../stories/defaults';\r\nimport {Passage, Story} from '../../../stories/stories.types';\r\n\r\n/**\r\n * Parses initial state from local storage.\r\n */\r\nexport async function load(): Promise<Story[]> {\r\n\tconst stories: Record<string, Story> = {};\r\n\tconst serializedStories = window.localStorage.getItem('twine-stories');\r\n\r\n\tif (!serializedStories) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\t// First, deserialize stories. We index them by ID so that we can quickly add\r\n\t// passages to them as they are deserialized.\r\n\r\n\tserializedStories.split(',').forEach(id => {\r\n\t\tconst serializedStory = window.localStorage.getItem(`twine-stories-${id}`);\r\n\r\n\t\tif (!serializedStory) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Story list contained ID ${id}, but twine-stories-${id} does not exist, skipping`\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst story: Story = JSON.parse(serializedStory);\r\n\r\n\t\t\tif (!story.id) {\r\n\t\t\t\tconsole.warn('Story in local storage had no ID, skipping', story);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tstories[story.id] = {\r\n\t\t\t\t...storyDefaults(),\r\n\t\t\t\t...story,\r\n\r\n\t\t\t\t// Coerce lastUpdate to a date.\r\n\t\t\t\tlastUpdate: story.lastUpdate\r\n\t\t\t\t\t? new Date(Date.parse(story.lastUpdate as unknown as string))\r\n\t\t\t\t\t: new Date(),\r\n\r\n\t\t\t\t// Force the passages property to be an empty array -- we'll populate it\r\n\t\t\t\t// when we load passages below.\r\n\t\t\t\tpassages: []\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Could not parse story as JSON, skipping: ${serializedStory}`\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\t// Then create passages, adding them to their parent story.\r\n\r\n\tconst serializedPassages = window.localStorage.getItem('twine-passages');\r\n\r\n\tif (serializedPassages) {\r\n\t\tserializedPassages.split(',').forEach(id => {\r\n\t\t\tconst serializedPassage = window.localStorage.getItem(\r\n\t\t\t\t`twine-passages-${id}`\r\n\t\t\t);\r\n\r\n\t\t\tif (!serializedPassage) {\r\n\t\t\t\tconsole.warn(\r\n\t\t\t\t\t`Passage list contained ID ${id}, but twine-passages-${id} does not exist, skipping`\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst passage: Passage = JSON.parse(serializedPassage);\r\n\r\n\t\t\t\tif (!passage || !passage.story) {\r\n\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t`Passage ${id} did not have parent story ID, skipping`,\r\n\t\t\t\t\t\tpassage\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!stories[passage.story]) {\r\n\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t`Passage ${id} is orphaned (looking for story ID ${passage.story}), skipping`\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstories[passage.story].passages.push({\r\n\t\t\t\t\t...passageDefaults,\r\n\t\t\t\t\t...passage,\r\n\r\n\t\t\t\t\t// Remove empty tags.\r\n\t\t\t\t\ttags: passage.tags ? passage.tags.filter(t => t.trim() !== '') : []\r\n\t\t\t\t});\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.warn(\r\n\t\t\t\t\t`Could not parse passage as JSON, skipping: ${serializedPassage}`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Flatten the stories object.\r\n\treturn Object.values(stories);\r\n}\r\n","// Lightweight functions for dealing with comma-delimited strings (e.g. that don't\r\n// deal with all the intracacies of dealing with the actual CSV format, e.g.\r\n// quotation marks).\r\n\r\n/**\r\n * Returns whether a list contains a value.\r\n */\r\nexport function contains(list: string, value: string) {\r\n\treturn new RegExp('\\\\b' + value + '\\\\b').test(list);\r\n}\r\n\r\n/**\r\n * Adds a value to a list if it's not already present.\r\n */\r\nexport function addUnique(list: string, value: string) {\r\n\tif (list === '') {\r\n\t\treturn value;\r\n\t}\r\n\r\n\tif (contains(list, value)) {\r\n\t\treturn list;\r\n\t}\r\n\r\n\treturn list + ',' + value;\r\n}\r\n\r\n/**\r\n * Removes a value from a list.\r\n */\r\nexport function remove(list: string, value: string) {\r\n\tlist = list.replace(new RegExp(',?' + value), '');\r\n\r\n\t// We end up with a leading comma if we just removed the first value.\r\n\r\n\tif (list[0] === ',') {\r\n\t\treturn list.substring(1);\r\n\t}\r\n\r\n\treturn list;\r\n}\r\n","// Functions for moving stories into local storage. This module in particular\r\n// needs to remain well-optimized, as it has a direct effect on load time. As a\r\n// result, saving requires that you start and end a transaction manually. This\r\n// minimizes the number of writes to local storage.\r\n\r\nimport {Passage, Story} from '../../../stories/stories.types';\r\nimport {addUnique, remove} from '../comma-list';\r\n\r\nexport interface StorageTransaction {\r\n\tpassageIds: string;\r\n\tstoryIds: string;\r\n}\r\n\r\nexport type StorageUpdater = (transaction: StorageTransaction) => void;\r\n\r\n/**\r\n * A wrapper for a series of save/delete operations. This takes a function as\r\n * argument that will receive an object keeping track of the transaction. This\r\n * function should then make save and delete calls as necessary, passing the\r\n * provided transaction object as their first argument.\r\n */\r\nexport function doUpdateTransaction(updater: StorageUpdater) {\r\n\tconst transaction = {\r\n\t\tpassageIds: window.localStorage.getItem('twine-passages') ?? '',\r\n\t\tstoryIds: window.localStorage.getItem('twine-stories') ?? ''\r\n\t};\r\n\r\n\tupdater(transaction);\r\n\r\n\twindow.localStorage.setItem('twine-stories', transaction.storyIds);\r\n\twindow.localStorage.setItem('twine-passages', transaction.passageIds);\r\n}\r\n\r\n/**\r\n * Saves a story to local storage. This does *not* affect any child passages.\r\n **/\r\nexport function saveStory(transaction: StorageTransaction, story: Story) {\r\n\tif (!story.id) {\r\n\t\tthrow new Error('Story has no ID');\r\n\t}\r\n\r\n\ttransaction.storyIds = addUnique(transaction.storyIds, story.id);\r\n\r\n\t// We have to remove the passages property before serializing the story,\r\n\t// as those are serialized under separate keys.\r\n\r\n\twindow.localStorage.setItem(\r\n\t\t`twine-stories-${story.id}`,\r\n\t\tJSON.stringify({...story, passages: undefined})\r\n\t);\r\n}\r\n\r\n/**\r\n * Deletes a story from local storage. This does *not* affect any child\r\n * passages. You *must* delete child passages manually.\r\n */\r\nexport function deleteStory(transaction: StorageTransaction, story: Story) {\r\n\tif (!story.id) {\r\n\t\tthrow new Error('Story has no ID');\r\n\t}\r\n\r\n\ttransaction.storyIds = remove(transaction.storyIds, story.id);\r\n\twindow.localStorage.removeItem(`twine-stories-${story.id}`);\r\n}\r\n\r\n/**\r\n * Saves a passage to local storage.\r\n */\r\nexport function savePassage(transaction: StorageTransaction, passage: Passage) {\r\n\tif (!passage.id) {\r\n\t\tthrow new Error('Passage has no ID');\r\n\t}\r\n\r\n\ttransaction.passageIds = addUnique(transaction.passageIds, passage.id);\r\n\twindow.localStorage.setItem(\r\n\t\t`twine-passages-${passage.id}`,\r\n\t\tJSON.stringify(passage)\r\n\t);\r\n}\r\n\r\n/**\r\n * Deletes a passage from local storage.\r\n */\r\nexport function deletePassage(\r\n\ttransaction: StorageTransaction,\r\n\tpassage: Passage\r\n) {\r\n\tif (!passage.id) {\r\n\t\tthrow new Error('Passage has no ID');\r\n\t}\r\n\r\n\tdeletePassageById(transaction, passage.id);\r\n}\r\n\r\n/**\r\n * Deletes a passage from local storage by ID only.\r\n */\r\nexport function deletePassageById(\r\n\ttransaction: StorageTransaction,\r\n\tpassageId: string\r\n) {\r\n\ttransaction.passageIds = remove(transaction.passageIds, passageId);\r\n\twindow.localStorage.removeItem(`twine-passages-${passageId}`);\r\n}\r\n","import {StoryFormatsState} from '../../../story-formats/story-formats.types';\r\n\r\nexport async function load(): Promise<StoryFormatsState> {\r\n\tconst result: StoryFormatsState = [];\r\n\tconst serialized = window.localStorage.getItem('twine-storyformats');\r\n\r\n\tif (!serialized) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tserialized.split(',').forEach(id => {\r\n\t\ttry {\r\n\t\t\tconst serializedFormat = window.localStorage.getItem(\r\n\t\t\t\t`twine-storyformats-${id}`\r\n\t\t\t);\r\n\r\n\t\t\tif (!serializedFormat) {\r\n\t\t\t\tconsole.warn(\r\n\t\t\t\t\t`No story format stored at twine-storyformats-${id}, skipping`\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tresult.push({...JSON.parse(serializedFormat), loadState: 'unloaded'});\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Story format ${id} had corrupt serialized value, skipping`,\r\n\t\t\t\twindow.localStorage.getItem(`twine-storyformats-${id}`)\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn result;\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {StoryFormatsState} from '../../../story-formats/story-formats.types';\r\n\r\nexport function save(state: StoryFormatsState) {\r\n\t// Delete existing formats in local storage, since we aren't bothering to\r\n\t// preserve ids.\r\n\r\n\tconst previouslySerialized = window.localStorage.getItem(\r\n\t\t'twine-storyformats'\r\n\t);\r\n\r\n\tif (previouslySerialized) {\r\n\t\tpreviouslySerialized.split(',').forEach(id => {\r\n\t\t\twindow.localStorage.removeItem(`twine-storyformats-${id}`);\r\n\t\t});\r\n\t}\r\n\r\n\t// Save new ones.\r\n\r\n\tlet ids: string[] = [];\r\n\r\n\tstate.forEach(format => {\r\n\t\tconst id = uuid();\r\n\r\n\t\t// We have to remove the `properties` property if it exists, as that is\r\n\t\t// dynamically added when loading.\r\n\r\n\t\tids.push(id);\r\n\t\twindow.localStorage.setItem(\r\n\t\t\t`twine-storyformats-${id}`,\r\n\t\t\tJSON.stringify({\r\n\t\t\t\t...format,\r\n\t\t\t\tloadError: undefined,\r\n\t\t\t\tloadState: undefined,\r\n\t\t\t\tproperties: undefined,\r\n\t\t\t\tselected: undefined\r\n\t\t\t})\r\n\t\t);\r\n\t});\r\n\r\n\twindow.localStorage.setItem('twine-storyformats', ids.join(','));\r\n}\r\n","import {StoryFormatsAction, StoryFormatsState} from '../../../story-formats';\r\nimport {isPersistableStoryFormatChange} from '../../persistable-changes';\r\nimport {save} from './save';\r\n\r\n/**\r\n * A middleware function to save changes to local storage. This should be called\r\n * *after* the main reducer runs.\r\n */\r\nexport function saveMiddleware(\r\n\tstate: StoryFormatsState,\r\n\taction: StoryFormatsAction\r\n) {\r\n\tswitch (action.type) {\r\n\t\tcase 'create':\r\n\t\tcase 'delete':\r\n\t\tcase 'repair':\r\n\t\t\tsave(state);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'update':\r\n\t\t\t// Is this a significant update?\r\n\t\t\tif (isPersistableStoryFormatChange(action.props)) {\r\n\t\t\t\tsave(state);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {useElectronIpcPersistence} from './electron-ipc/use-electron-ipc-persistence';\r\nimport {useLocalStoragePersistence} from './local-storage/use-local-storage-persistence';\r\nimport {isElectronRenderer} from '../../util/is-electron';\r\nimport {StoriesAction, StoriesState} from '../stories';\r\nimport {StoryFormatsAction, StoryFormatsState} from '../story-formats';\r\nimport {PrefsAction, PrefsState} from '../prefs';\r\n\r\nexport interface PersistenceHooks {\r\n\tprefs: {\r\n\t\tload: () => Promise<Partial<PrefsState>>;\r\n\t\tsaveMiddleware: (state: PrefsState, action: PrefsAction) => void;\r\n\t};\r\n\tstories: {\r\n\t\tload: () => Promise<StoriesState>;\r\n\t\t//인자 타입 선언\r\n\t\tsaveMiddleware: (\r\n\t\t\tstate: StoriesState,\r\n\t\t\taction: StoriesAction,\r\n\t\t\tformats: StoryFormatsState\r\n\t\t) => void;\r\n\t};\r\n\tstoryFormats: {\r\n\t\tload: () => Promise<StoryFormatsState>;\r\n\t\tsaveMiddleware: (\r\n\t\t\tstate: StoryFormatsState,\r\n\t\t\taction: StoryFormatsAction\r\n\t\t) => void;\r\n\t};\r\n}\r\n\r\nexport function usePersistence(): PersistenceHooks {\r\n\tconst electronIpcPersistence = useElectronIpcPersistence();\r\n\tconst localStoragePersistence = useLocalStoragePersistence();\r\n\r\n\treturn React.useMemo(\r\n\t\t() =>\r\n\t\t\tisElectronRenderer() ? electronIpcPersistence : localStoragePersistence,\r\n\t\t[electronIpcPersistence, localStoragePersistence]\r\n\t);\r\n}\r\n","import * as React from 'react';\r\nimport * as prefs from './prefs';\r\nimport * as stories from './stories';\r\nimport * as storyFormats from './story-formats';\r\n\r\nexport function useElectronIpcPersistence() {\r\n\treturn React.useMemo(\r\n\t\t() => ({\r\n\t\t\tprefs: {\r\n\t\t\t\tload: prefs.load,\r\n\t\t\t\tsaveMiddleware: prefs.saveMiddleware\r\n\t\t\t},\r\n\t\t\tstories: {\r\n\t\t\t\tload: stories.load,\r\n\t\t\t\tsaveMiddleware: stories.saveMiddleware\r\n\t\t\t},\r\n\t\t\tstoryFormats: {\r\n\t\t\t\tload: storyFormats.load,\r\n\t\t\t\tsaveMiddleware: storyFormats.saveMiddleware\r\n\t\t\t}\r\n\t\t}),\r\n\t\t[]\r\n\t);\r\n}\r\n","import * as React from 'react';\r\nimport * as prefs from './prefs';\r\nimport * as stories from './stories';\r\nimport * as storyFormats from './story-formats';\r\n\r\nexport function useLocalStoragePersistence() {\r\n\treturn React.useMemo(\r\n\t\t() => ({\r\n\t\t\tprefs: {\r\n\t\t\t\tload: prefs.load,\r\n\t\t\t\tsaveMiddleware: prefs.saveMiddleware\r\n\t\t\t},\r\n\t\t\tstories: {\r\n\t\t\t\tload: stories.load,\r\n\t\t\t\tsaveMiddleware: stories.saveMiddleware\r\n\t\t\t},\r\n\t\t\tstoryFormats: {\r\n\t\t\t\tload: storyFormats.load,\r\n\t\t\t\tsaveMiddleware: storyFormats.saveMiddleware\r\n\t\t\t}\r\n\t\t}),\r\n\t\t[]\r\n\t);\r\n}\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {colors, Color} from '../../util/color';\r\nimport {IconPlus, IconX} from '@tabler/icons';\r\nimport {ButtonBar} from '../container/button-bar';\r\nimport {CardContent} from '../container/card';\r\nimport {CardButton} from '../control/card-button';\r\nimport {IconButton} from '../control/icon-button';\r\nimport {TextInput} from '../control/text-input';\r\nimport {TextSelect} from '../control/text-select';\r\nimport {isValidTagName} from '../../util/tag';\r\nimport './add-tag-button.css';\r\n\r\nexport interface AddTagButtonProps {\r\n\t/**\r\n\t * Tags that have been assigned to this object.\r\n\t */\r\n\tassignedTags: string[];\r\n\t/**\r\n\t * Is the button disabled?\r\n\t */\r\n\tdisabled?: boolean;\r\n\t/**\r\n\t * Other tags that have been assigned to this type of object.\r\n\t */\r\n\texistingTags: string[];\r\n\t/**\r\n\t * Icon for the button.\r\n\t */\r\n\ticon?: React.ReactNode;\r\n\t/**\r\n\t * Label for the button.\r\n\t */\r\n\tlabel?: string;\r\n\t/**\r\n\t * Called when the user chooses to add a tag. If they are adding a\r\n\t * pre-existing tag, it will only send a name.\r\n\t */\r\n\tonAdd: (name: string, color?: Color) => void;\r\n}\r\n\r\nexport const AddTagButton: React.FC<AddTagButtonProps> = props => {\r\n\tconst {assignedTags, disabled, existingTags, icon, label, onAdd} = props;\r\n\tconst [creatingTag, setCreatingTag] = React.useState(true);\r\n\tconst [newColor, setNewColor] = React.useState<Color>('none');\r\n\tconst [newName, setNewName] = React.useState('');\r\n\tconst [open, setOpen] = React.useState(false);\r\n\tconst {t} = useTranslation();\r\n\r\n\tlet validationMessage: string | undefined = undefined;\r\n\tlet canAdd = isValidTagName(newName);\r\n\r\n\tif (!canAdd && newName !== '') {\r\n\t\tvalidationMessage = t('components.addTagButton.invalidName');\r\n\t}\r\n\r\n\tif (canAdd && creatingTag) {\r\n\t\tcanAdd = !existingTags.includes(newName);\r\n\r\n\t\tif (!canAdd) {\r\n\t\t\tvalidationMessage = t('components.addTagButton.alreadyAdded');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleAdd() {\r\n\t\tif (creatingTag) {\r\n\t\t\tonAdd(newName, newColor);\r\n\t\t} else {\r\n\t\t\tonAdd(newName);\r\n\t\t}\r\n\r\n\t\tsetOpen(false);\r\n\t}\r\n\r\n\tfunction handleSelectChange(event: React.ChangeEvent<HTMLSelectElement>) {\r\n\t\tconst tagName = event.target.value;\r\n\r\n\t\tsetNewName(tagName);\r\n\t\tsetCreatingTag(tagName === '');\r\n\t}\r\n\r\n\treturn (\r\n\t\t<span className=\"add-tag-button\">\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={t('components.addTagButton.addLabel')}\r\n\t\t\t\tdisabled={disabled}\r\n\t\t\t\ticon={icon ?? <IconPlus />}\r\n\t\t\t\tlabel={label ?? t('common.tag')}\r\n\t\t\t\tonChangeOpen={setOpen}\r\n\t\t\t\topen={open}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<TextSelect\r\n\t\t\t\t\t\tonChange={handleSelectChange}\r\n\t\t\t\t\t\toptions={[\r\n\t\t\t\t\t\t\t{label: t('components.addTagButton.newTag'), value: ''},\r\n\t\t\t\t\t\t\t...existingTags.map(tag => ({\r\n\t\t\t\t\t\t\t\tdisabled: assignedTags.includes(tag),\r\n\t\t\t\t\t\t\t\tlabel: tag,\r\n\t\t\t\t\t\t\t\tvalue: tag\r\n\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t]}\r\n\t\t\t\t\t\tvalue={creatingTag ? '' : newName}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{t('components.addTagButton.addLabel')}\r\n\t\t\t\t\t</TextSelect>\r\n\t\t\t\t\t{creatingTag && (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<TextInput\r\n\t\t\t\t\t\t\t\tonChange={e => setNewName(e.target.value.replace(/\\s/g, '-'))}\r\n\t\t\t\t\t\t\t\tvalue={newName}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{t('components.addTagButton.tagNameLabel')}\r\n\t\t\t\t\t\t\t</TextInput>\r\n\t\t\t\t\t\t\t<TextSelect\r\n\t\t\t\t\t\t\t\tonChange={e => setNewColor(e.target.value)}\r\n\t\t\t\t\t\t\t\toptions={colors.map(color => ({\r\n\t\t\t\t\t\t\t\t\tlabel: t(`colors.${color}`),\r\n\t\t\t\t\t\t\t\t\tvalue: color\r\n\t\t\t\t\t\t\t\t}))}\r\n\t\t\t\t\t\t\t\tvalue={newColor}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{t('components.addTagButton.tagColorLabel')}\r\n\t\t\t\t\t\t\t</TextSelect>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{creatingTag && !!validationMessage && <p>{validationMessage}</p>}\r\n\t\t\t\t</CardContent>\r\n\t\t\t\t<ButtonBar>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\tdisabled={!canAdd}\r\n\t\t\t\t\t\ticon={<IconPlus />}\r\n\t\t\t\t\t\tlabel={t('common.add')}\r\n\t\t\t\t\t\tonClick={handleAdd}\r\n\t\t\t\t\t\tvariant=\"create\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\tlabel={t('common.cancel')}\r\n\t\t\t\t\t\tonClick={() => setOpen(false)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</ButtonBar>\r\n\t\t\t</CardButton>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconChevronDown} from '@tabler/icons';\r\nimport {MenuButton} from '../control/menu-button';\r\nimport {colors, Color} from '../../util/color';\r\nimport './tag-button.css';\r\n\r\nexport interface TagButtonProps {\r\n\tcolor?: Color;\r\n\tname: string;\r\n\tonChangeColor: (color: Color) => void;\r\n\tonRemove: () => void;\r\n}\r\n\r\nexport const TagButton: React.FC<TagButtonProps> = props => {\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<span className={classNames('tag-button', `color-${props.color}`)}>\r\n\t\t\t<MenuButton\r\n\t\t\t\ticon={<IconChevronDown />}\r\n\t\t\t\ticonPosition=\"end\"\r\n\t\t\t\titems={[\r\n\t\t\t\t\t...colors.map(color => ({\r\n\t\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\t\tchecked: color === 'none' ? !props.color : color === props.color,\r\n\t\t\t\t\t\tlabel: t(`colors.${color}`),\r\n\t\t\t\t\t\tonClick: () => props.onChangeColor(color)\r\n\t\t\t\t\t})),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tseparator: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: t('common.remove'),\r\n\t\t\t\t\t\tonClick: props.onRemove\r\n\t\t\t\t\t}\r\n\t\t\t\t]}\r\n\t\t\t\tlabel={props.name}\r\n\t\t\t/>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport './icon-button-link.css';\r\n\r\nexport interface IconLinkProps {\r\n\thref: string;\r\n\ticon: React.ReactNode;\r\n\tlabel: string;\r\n\tvariant?: 'create' | 'danger' | 'primary' | 'secondary';\r\n\ttarget?: string;\r\n}\r\n\r\nexport const IconLink: React.FC<IconLinkProps> = props => {\r\n\tconst {href, icon, label, target, variant} = props;\r\n\tconst className = classNames('icon-link', `variant-${variant}`);\r\n\r\n\treturn (\r\n\t\t<a href={href} className={className} target={target ?? '_blank'}>\r\n\t\t\t<span className=\"icon\">{icon}</span>\r\n\t\t\t{label}\r\n\t\t</a>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconIndentDecrease, IconIndentIncrease} from '@tabler/icons';\r\nimport {IconButton} from '../control/icon-button';\r\n\r\nexport interface IndentButtonsProps {\r\n\t/**\r\n\t * CodeMirror instance to interact with.\r\n\t */\r\n\teditor?: CodeMirror.Editor;\r\n}\r\n\r\nexport const IndentButtons: React.FC<IndentButtonsProps> = props => {\r\n\tconst {editor} = props;\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction execCommand(command: string) {\r\n\t\teditor?.execCommand(command);\r\n\t\teditor?.focus();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={!editor}\r\n\t\t\t\ticon={<IconIndentIncrease />}\r\n\t\t\t\tlabel={t('components.indentButtons.indent')}\r\n\t\t\t\tonClick={() => execCommand('indentMore')}\r\n\t\t\t/>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={!editor}\r\n\t\t\t\ticon={<IconIndentDecrease />}\r\n\t\t\t\tlabel={t('components.indentButtons.unindent')}\r\n\t\t\t\tonClick={() => execCommand('indentLess')}\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconArrowBack, IconArrowForward} from '@tabler/icons';\r\nimport {IconButton} from '../control/icon-button';\r\n\r\nexport interface UndoRedoButtonsProps {\r\n\t/**\r\n\t * CodeMirror instance to interact with.\r\n\t */\r\n\teditor?: CodeMirror.Editor;\r\n\t/**\r\n\t * A change in this prop triggers a render (probably, put the editor value\r\n\t * here). This is necessary because the editor instance itself is mutable, so\r\n\t * we need some way of knowing when to re-check whether undo/redo is availble.\r\n\t */\r\n\twatch: string;\r\n}\r\n\r\nexport const UndoRedoButtons: React.FC<UndoRedoButtonsProps> = props => {\r\n\tconst {editor, watch} = props;\r\n\tconst {t} = useTranslation();\r\n\tconst [canRedo, setCanRedo] = React.useState(false);\r\n\tconst [canUndo, setCanUndo] = React.useState(false);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (editor) {\r\n\t\t\tconst history = editor.historySize();\r\n\r\n\t\t\tsetCanRedo(history.redo > 0);\r\n\t\t\tsetCanUndo(history.undo > 0);\r\n\t\t} else {\r\n\t\t\tsetCanRedo(false);\r\n\t\t\tsetCanUndo(false);\r\n\t\t}\r\n\t}, [editor, watch]);\r\n\r\n\tfunction execCommand(command: string) {\r\n\t\teditor?.execCommand(command);\r\n\t\teditor?.focus();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={!canUndo}\r\n\t\t\t\ticon={<IconArrowBack />}\r\n\t\t\t\tlabel={t('common.undo')}\r\n\t\t\t\tonClick={() => execCommand('undo')}\r\n\t\t\t/>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={!canRedo}\r\n\t\t\t\ticon={<IconArrowForward />}\r\n\t\t\t\tlabel={t('common.redo')}\r\n\t\t\t\tonClick={() => execCommand('redo')}\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n};\r\n","import classNames from 'classnames';\r\nimport * as React from 'react';\r\nimport './text-input.css';\r\n\r\nexport interface TextInputProps {\r\n\tonChange?: (event: React.ChangeEvent<HTMLInputElement>) => void;\r\n\tonInput?: (event: React.FormEvent<HTMLInputElement>) => void;\r\n\torientation?: 'horizontal' | 'vertical';\r\n\tplaceholder?: string;\r\n\ttype?: 'search' | 'text';\r\n\tvalue: string;\r\n}\r\n\r\nexport const TextInput: React.FC<TextInputProps> = props => {\r\n\tconst className = classNames(\r\n\t\t'text-input',\r\n\t\t`orientation-${props.orientation}`,\r\n\t\t`type-${props.type}`\r\n\t);\r\n\r\n\treturn (\r\n\t\t<span className={className}>\r\n\t\t\t<label>\r\n\t\t\t\t<span className=\"text-input-label\">{props.children}</span>\r\n\t\t\t\t<input\r\n\t\t\t\t\tonChange={props.onChange}\r\n\t\t\t\t\tonInput={props.onInput}\r\n\t\t\t\t\tplaceholder={props.placeholder}\r\n\t\t\t\t\ttype={props.type ?? 'text'}\r\n\t\t\t\t\tvalue={props.value}\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\n\r\nexport const IconEmpty: React.FC = () => (\r\n\t<svg\r\n\t\tviewBox=\"0 0 24 24\"\r\n\t\twidth=\"24\"\r\n\t\theight=\"24\"\r\n\t\tstroke=\"currentColor\"\r\n\t\tstrokeWidth=\"2\"\r\n\t\tfill=\"none\"\r\n\t\tstrokeLinecap=\"round\"\r\n\t\tstrokeLinejoin=\"round\"\r\n\t></svg>\r\n);\r\n","import * as React from 'react';\r\nimport {IconCircle} from '@tabler/icons';\r\nimport './loading.css';\r\n\r\nexport const IconLoading: React.FC = () => {\r\n\treturn (\r\n\t\t<span className=\"icon-loading\">\r\n\t\t\t<IconCircle />\r\n\t\t</span>\r\n\t);\r\n};\r\n","import * as React from 'react';                            // 스토리 카드 구성\r\nimport classNames from 'classnames';\r\nimport './card.css';\r\n\r\nexport interface CardProps {\r\n\tfloating?: boolean;                      // 카드 띄울지 말지\r\n\thighlighted?: boolean;                   // 카드에 하이라이트 넣을지 말지\r\n}\r\n\r\nexport const Card: React.FC<CardProps> = props => {\r\n\tconst {children, floating, highlighted} = props;\r\n\r\n\tconst className = classNames('card', {             // card.css에 있는 스타일 적용\r\n\t\tfloating,\r\n\t\thighlighted\r\n\t});\r\n\r\n\treturn <div className={className}>{children}</div>;    // 자식 스토리 카드를 반환\r\n};\r\n","import uniq from 'lodash/uniq';\r\nimport {Passage, StorySearchFlags, Story} from './stories.types';\r\nimport {createRegExp} from '../../util/regexp';\r\nimport {parseLinks} from '../../util/parse-links';\r\nimport { StoryImportDialogProps } from '../../dialogs';\r\n\r\n\r\n//외부로 내보내는 함수.\r\n//passage.선택지 = \"\";\r\nexport function passageWithId(\r\n\tstories: Story[],\r\n\tstoryId: string,\r\n\tpassageId: string\r\n) {\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst result = story.passages.find(p => p.id === passageId);\r\n\r\n\tif (result) {\r\n\t\treturn result;\r\n\t}\r\n\r\n\tthrow new Error(\r\n\t\t`There is no passage with ID \"${passageId}\" in a story with ID \"${storyId}\".`\r\n\t);\r\n}\r\n\r\n//Story 배열과 StoryId 와 passage 이름을 인자로 넣으면 \r\n//find함수는 배열의 특정 값을 찾는 함수이다.\r\n//passages는 Passage의 배열이므로 값 하나는 passage하나이다.\r\nexport function passageWithName(\r\n\tstories: Story[],\r\n\tstoryId: string,\r\n\tpassageName: string\r\n) {\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst result = story.passages.find(p => p.name === passageName);\r\n\r\n\tif (result) {\r\n\t\treturn result;\r\n\t}\r\n\r\n\tthrow new Error(\r\n\t\t`There is no passage with name \"${passageName}\" in a story with ID \"${storyId}\".`\r\n\t);\r\n}\r\n\r\n/**\r\n * Returns connections between passages in a structure optimized for rendering.\r\n * Connections are divided between draggable and fixed, depending on whether\r\n * either of their passages are selected (and could be dragged by the user).\r\n */\r\n//passage 사이에 연결고리를 만들어주는 함수이듯함.\r\nexport function passageConnections(\r\n\tpassages: Passage[],\r\n\tconnectionParser?: (text: string) => string[]\r\n) {\r\n\tconst parser = connectionParser ?? ((text: string) => parseLinks(text, true));\r\n\tconst passageMap = new Map(passages.map(p => [p.name, p]));\r\n\tconst result = {\r\n\t\tdraggable: {\r\n\t\t\tbroken: new Set<Passage>(),\r\n\t\t\tconnections: new Map<Passage, Set<Passage>>(),\r\n\t\t\tself: new Set<Passage>()\r\n\t\t},\r\n\t\tfixed: {\r\n\t\t\tbroken: new Set<Passage>(),\r\n\t\t\tconnections: new Map<Passage, Set<Passage>>(),\r\n\t\t\tself: new Set<Passage>()\r\n\t\t}\r\n\t};\r\n\r\n\tpassages.forEach(passage =>\r\n\t\tparser(passage.text).forEach(targetName => {\r\n\t\t\tif (targetName === passage.name) {\r\n\t\t\t\t(passage.selected ? result.draggable : result.fixed).self.add(passage);\r\n\t\t\t} else {\r\n\t\t\t\tconst targetPassage = passageMap.get(targetName);\r\n\r\n\t\t\t\tif (targetPassage) {\r\n\t\t\t\t\tconst target =\r\n\t\t\t\t\t\tpassage.selected || targetPassage.selected\r\n\t\t\t\t\t\t\t? result.draggable\r\n\t\t\t\t\t\t\t: result.fixed;\r\n\r\n\t\t\t\t\tif (target.connections.has(passage)) {\r\n\t\t\t\t\t\ttarget.connections.get(passage)!.add(targetPassage);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttarget.connections.set(passage, new Set([targetPassage]));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(passage.selected ? result.draggable : result.fixed).broken.add(\r\n\t\t\t\t\t\tpassage\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t);\r\n\r\n\treturn result;\r\n}\r\n\r\n/**\r\n * Returns all passages matching a search criteria. Use\r\n * `highlightPassageMatches()` to highlight exactly what matched.\r\n */\r\nexport function passagesMatchingSearch(\r\n\tpassages: Passage[],\r\n\tsearch: string,\r\n\tflags: StorySearchFlags\r\n): Passage[] {\r\n\tif (search === '') {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst {includePassageNames, matchCase, useRegexes} = flags;\r\n\tlet matcher: RegExp;\r\n\r\n\ttry {\r\n\t\tmatcher = createRegExp(search, {matchCase, useRegexes});\r\n\t} catch (error) {\r\n\t\t// The regexp was malformed. Take no action.\r\n\t\treturn [];\r\n\t}\r\n\r\n\treturn passages.reduce((result, passage) => {\r\n\t\tif (\r\n\t\t\tmatcher.test(passage.text) ||\r\n\t\t\t(includePassageNames && matcher.test(passage.name))\r\n\t\t) {\r\n\t\t\treturn [...result, passage];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}, [] as Passage[]);\r\n}\r\n\r\nexport function storyPassageTags(story: Story) {\r\n\treturn Array.from(\r\n\t\tstory.passages.reduce((result, passage) => {\r\n\t\t\tpassage.tags && passage.tags.forEach(tag => result.add(tag));\r\n\t\t\treturn result;\r\n\t\t}, new Set<string>())\r\n\t).sort();\r\n}\r\n\r\nexport function storyStats(story: Story) {\r\n\tconst links = story.passages.reduce<string[]>(\r\n\t\t(links, passage) => [\r\n\t\t\t...links,\r\n\t\t\t...parseLinks(passage.text).filter(link => links.indexOf(link) === -1)\r\n\t\t],\r\n\t\t[]\r\n\t);\r\n\r\n\tconst brokenLinks = uniq(links).filter(\r\n\t\tlink => !story.passages.some(passage => passage.name === link)\r\n\t);\r\n\r\n\treturn {\r\n\t\tbrokenLinks,\r\n\t\tlinks,\r\n\t\tcharacters: story.passages.reduce(\r\n\t\t\t(count, passage) => count + passage.text.length,\r\n\t\t\t0\r\n\t\t),\r\n\t\tpassages: story.passages.length,\r\n\t\twords: story.passages.reduce(\r\n\t\t\t(count, passage) => count + passage.text.split(/\\s+/).length,\r\n\t\t\t0\r\n\t\t)\r\n\t};\r\n}\r\n\r\nexport function storyTags(stories: Story[]) {\r\n\treturn Array.from(\r\n\t\tstories.reduce((result, story) => {\r\n\t\t\tstory.tags && story.tags.forEach(tag => result.add(tag));\r\n\t\t\treturn result;\r\n\t\t}, new Set<string>())\r\n\t).sort();\r\n}\r\n\r\n//story id로 story 배열을 받아오는 함수. passage 배열이 아닌, story 배열인게 의아함.\r\nexport function storyWithId(stories: Story[], storyId: string) {\r\n\tconst result = stories.find(s => s.id === storyId);\r\n\r\n\tif (result) {\r\n\t\treturn result;\r\n\t}\r\n\r\n\tthrow new Error(`There is no story with ID \"${storyId}\".`);\r\n}\r\n\r\nexport function storyWithName(stories: Story[], name: string) {\r\n\tconst result = stories.find(s => s.name === name);\r\n\r\n\tif (result) {\r\n\t\treturn result;\r\n\t}\r\n\r\n\tthrow new Error(`There is no story with name \"${name}\".`);\r\n}\r\n","// Manages requesting a story format via URL. There are two aspects that add\r\n// complexity:\r\n//\r\n// - The difference between web and Electron contexts. In a web context, the app is\r\n//   able to make JSON requests freely. In Electron contexts, however, it is\r\n//   restricted to HTTP/HTTPS only. To allow users to add story formats via\r\n//   file:/// URL, the main process will make JSONP requests on behalf of a web\r\n//   process.\r\n//\r\n//   This is only needed for requests outside the app bundle (e.g. loading a locale\r\n//   or an external story format).\r\n//\r\n// - Throttling requests. Because all story formats load via the same global\r\n//   callback, we can only load one at a time safely--otherwise they will compete\r\n//   for the same callback.\r\n\r\nimport jsonp from 'jsonp';\r\nimport {TwineElectronWindow} from '../../electron/shared';\r\nimport {StoryFormatProperties} from '../../store/story-formats';\r\nimport {isElectronRenderer} from '../is-electron';\r\n\r\nlet requestQueue = Promise.resolve();\r\n\r\n/**\r\n * Fetches a story format's properties via JSONP. If multiple requests are made\r\n * at once, they will be queued by this function.\r\n */\r\nexport async function fetchStoryFormatProperties(\r\n\turl: string,\r\n\ttimeout = 2000\r\n): Promise<StoryFormatProperties> {\r\n\tconst {twineElectron} = window as TwineElectronWindow;\r\n\tconst jsonpRequester =\r\n\t\tisElectronRenderer() && twineElectron?.jsonp ? twineElectron.jsonp : jsonp;\r\n\r\n\treturn new Promise(\r\n\t\t(resolve, reject) =>\r\n\t\t\t(requestQueue = requestQueue.then(\r\n\t\t\t\t() =>\r\n\t\t\t\t\tnew Promise(resolveQueue => {\r\n\t\t\t\t\t\tjsonpRequester(url, {timeout, name: 'storyFormat'}, (err, data) => {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve(data);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tresolveQueue();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t))\r\n\t);\r\n}\r\n","export const builtins = () => [\r\n\t{\r\n\t\tname: 'Chapbook',\r\n\t\turl: 'story-formats/chapbook-1.2.2/format.js',\r\n\t\tversion: '1.2.2'\r\n\t},\r\n\t{\r\n\t\tname: 'Harlowe',\r\n\t\turl: 'story-formats/harlowe-1.2.4/format.js',\r\n\t\tversion: '1.2.4'\r\n\t},\r\n\t{\r\n\t\tname: 'Harlowe',\r\n\t\turl: 'story-formats/harlowe-2.1.0/format.js',\r\n\t\tversion: '2.1.0'\r\n\t},\r\n\t{\r\n\t\tname: 'Harlowe',\r\n\t\turl: 'story-formats/harlowe-3.3.3/format.js',\r\n\t\tversion: '3.3.3'\r\n\t},\r\n\t{\r\n\t\tname: 'Paperthin',\r\n\t\turl: 'story-formats/paperthin-1.0.0/format.js',\r\n\t\tversion: '1.0.0'\r\n\t},\r\n\t{\r\n\t\tname: 'Snowman',\r\n\t\turl: 'story-formats/snowman-1.4.0/format.js',\r\n\t\tversion: '1.4.0'\r\n\t},\r\n\t{\r\n\t\tname: 'Snowman',\r\n\t\turl: 'story-formats/snowman-2.0.2/format.js',\r\n\t\tversion: '2.0.2',\r\n\t\tuserAdded: false\r\n\t},\r\n\t{\r\n\t\tname: 'SugarCube',\r\n\t\turl: 'story-formats/sugarcube-1.0.35/format.js',\r\n\t\tversion: '1.0.35'\r\n\t},\r\n\t{\r\n\t\tname: 'SugarCube',\r\n\t\turl: 'story-formats/sugarcube-2.36.1/format.js',\r\n\t\tversion: '2.36.1'\r\n\t}\r\n];\r\n","/**\r\n * Returns an unique name among an array of existing, making it unique if need\r\n * be by adding a number at the end.\r\n */\r\nexport function unusedName(name: string, existing: string[]): string {\r\n\tif (existing.includes(name)) {\r\n\t\tlet suffix = 1;\r\n\r\n\t\twhile (existing.includes(`${name} ${suffix}`)) {\r\n\t\t\tsuffix++;\r\n\t\t}\r\n\r\n\t\treturn `${name} ${suffix}`;\r\n\t}\r\n\r\n\treturn name;\r\n}\r\n","import {useTranslation} from 'react-i18next';\r\nimport {isElectronRenderer} from '../util/is-electron';\r\n\r\nexport function useStoreErrorReporter() {\r\n\t// We can't use suspense here because we're too high in the component tree--we\r\n\t// need to report errors as soon as possible, and if prefs fail, we might not\r\n\t// have i18n initialized.\r\n\r\n\tconst {t, ready} = useTranslation('', {useSuspense: false});\r\n\r\n\treturn {\r\n\t\treportError(error: Error, messageKey: string) {\r\n\t\t\tconsole.error('Twine store error', error);\r\n\r\n\t\t\tif (ready) {\r\n\t\t\t\twindow.alert(\r\n\t\t\t\t\tt(messageKey, {error: error.message}) +\r\n\t\t\t\t\t\t' ' +\r\n\t\t\t\t\t\tt(\r\n\t\t\t\t\t\t\t`store.errors.${\r\n\t\t\t\t\t\t\t\tisElectronRenderer() ? 'electron' : 'web'\r\n\t\t\t\t\t\t\t}Remediation`\r\n\t\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\twindow.alert(\r\n\t\t\t\t\t`An error occurred while saving (${error.message}). Reloading or restarting the application may help.`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n","import {EditorConfiguration} from 'codemirror';\r\nimport {PrefsState} from '../store/prefs';\r\n\r\n/**\r\n * Returns baseline CodeMirror options based on user preferences.\r\n */\r\nexport function codeMirrorOptionsFromPrefs(\r\n\tprefs: PrefsState\r\n): EditorConfiguration {\r\n\t// Disable overstrike mode.\r\n\r\n\tlet result: EditorConfiguration = {\r\n\t\textraKeys: {\r\n\t\t\tInsert() {}\r\n\t\t}\r\n\t};\r\n\r\n\tif (!prefs.editorCursorBlinks) {\r\n\t\tresult.cursorBlinkRate = 0;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","// See https://stackoverflow.com/a/64174790\r\n\r\nexport const colors = [\r\n\t'none',\r\n\t'red',\r\n\t'orange',\r\n\t'yellow',\r\n\t'green',\r\n\t'blue',\r\n\t'purple'\r\n];\r\n\r\nexport type Color = typeof colors[number];\r\n","import escapeRegExp from 'lodash/escapeRegExp';\r\nimport {StorySearchFlags} from '../store/stories/stories.types';\r\n\r\n/**\r\n * Creates RegExps using UI-visible settings.\r\n */\r\nexport function createRegExp(\r\n\tsearch: string,\r\n\tflags: Omit<StorySearchFlags, 'includePassages'>\r\n) {\r\n\treturn new RegExp(\r\n\t\tflags.useRegexes ? search : escapeRegExp(search),\r\n\t\tflags.matchCase ? 'g' : 'gi'\r\n\t);\r\n}\r\n\r\n/**\r\n * Escapes replacement strings if the user didn't intend them to be regexps.\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#Specifying_a_string_as_a_parameter\r\n */\r\nexport function escapeRegExpReplace(source: string) {\r\n\t// This implementation is a little tricky in that it needs to escape the $s\r\n\t// itself in the replacement.\r\n\r\n\treturn source.replace(/\\$/g, '$$$$');\r\n}\r\n","import * as React from 'react';\r\nimport {TagColors} from '../../store/stories';\r\nimport './tag-stripe.css';\r\n\r\nexport interface TagStripeProps {\r\n\ttagColors: TagColors;\r\n\ttags: string[];\r\n}\r\n\r\nexport const TagStripe: React.FC<TagStripeProps> = React.memo(props => {\r\n\treturn (\r\n\t\t<div className=\"tag-stripe\">\r\n\t\t\t{props.tags.map(tag => (\r\n\t\t\t\t<span\r\n\t\t\t\t\tclassName={`color-${props.tagColors[tag]}`}\r\n\t\t\t\t\tkey={tag}\r\n\t\t\t\t\ttitle={tag}\r\n\t\t\t\t/>\r\n\t\t\t))}\r\n\t\t</div>\r\n\t);\r\n});\r\n\r\nTagStripe.displayName = 'TagStripe';\r\n","import * as React from 'react';\r\nimport {useScrollbarSize} from 'react-scrollbar-size';\r\nimport {CSSTransition, TransitionGroup} from 'react-transition-group';\r\nimport {useDialogsContext} from '.';\r\nimport {usePrefsContext} from '../../store/prefs';\r\nimport { passageWithId } from '../../store/stories';\r\nimport { useUndoableStoriesContext } from '../../store/undoable-stories';\r\nimport { storyWithId } from '../../store/stories';\r\nimport { useState} from \"react\";\r\nimport './dialogs.css';\r\nimport {UserDialog} from './components/UserDialog';\r\n\r\nlet story;\r\nlet passage;\r\n\r\nconst DialogTransition: React.FC = props =>{ \r\n\t\r\n\tconst [userDialogText, setUserDialogText] = useState();\r\n\r\n\treturn (\r\n\t//이곳에 DialogTransition의 css를 적용함\r\n\t//classNames는 뒤에 '-enter-done'이라는 문장이 붙음. 아마 CSSTranstion.d.ts 파일에서 후처리를 해줌. 거기에 주석으로 설명되어 있음\r\n\t\t\r\n\t\t<div>\r\n\t\t\t<UserDialog passage={passage} story={story} onWrite={function(value){\r\n\t\t\t\t\t\t\t\t\t\t\tsetUserDialogText(value)\r\n\t\t\t\t\t\t\t\t\t\t}}></UserDialog>\r\n\t\t\t<CSSTransition classNames=\"hidden pop\" timeout={200} {...props} userDialogText={userDialogText} >\r\n\t\t\t\t{props.children}\r\n\t\t\t</CSSTransition>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n\r\nexport const Dialogs: React.FC = props => { //텍스트 편집 창\r\n\tconst {height, width} = useScrollbarSize();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst {dispatch, dialogs} = useDialogsContext();\r\n\tconst [userDialogText, setUserDialogText] = useState();\r\n\t\r\n\tconst hasUnmaximized = dialogs.some(dialog => !dialog.maximized);\r\n\t// const containerStyle: React.CSSProperties = {\r\n\t// \tpaddingLeft: `calc(100% - (${prefs.dialogWidth}px + 2 * (var(--grid-size))))`,\r\n\t// \tmarginBottom: height,\r\n\t// \tmarginRight: width\r\n\t// };\r\n\t// const maximizedStyle: React.CSSProperties = {\r\n\t// \tmarginRight: hasUnmaximized\r\n\t// \t\t? `calc(${prefs.dialogWidth}px + var(--grid-size))`\r\n\t// \t\t: 0\r\n\t// };\r\n\r\n\tconst containerStyle: React.CSSProperties = {\r\n\t\tpaddingLeft: `calc(100% - (850px + 2 * (var(--grid-size))))`,\r\n\t\tmarginBottom: height,\r\n\t\tmarginRight: width\r\n\t};\r\n\tconst maximizedStyle: React.CSSProperties = {\r\n\t\tmarginRight: hasUnmaximized\r\n\t\t\t? `calc(850px + var(--grid-size))`\r\n\t\t\t: 0\r\n\t};\r\n\r\n\t//dialog 변경을 위해 추가한 코드\r\n\tconst {stories} = useUndoableStoriesContext();\r\n\t\r\n\treturn (\r\n\t\t<div className=\"dialogs\" style={containerStyle}>\r\n\t\t\t<TransitionGroup component={null}>\r\n\t\t\t\t{dialogs.map((dialog, index) => {\r\n\t\t\t\t\t//dialog 변경을 위해 추가한 코드\r\n\t\t\t\t\tpassage = passageWithId(stories, dialogs[0].props.storyId, dialogs[0].props.passageId)\r\n\t\t\t\t\tstory = storyWithId(stories, dialogs[0].props.storyId);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\tconst managementProps = {\r\n\t\t\t\t\t\tcollapsed: dialog.collapsed,\r\n\t\t\t\t\t\thighlighted: dialog.highlighted,\r\n\t\t\t\t\t\tmaximized: dialog.maximized,\r\n\t\t\t\t\t\tonChangeCollapsed: (collapsed: boolean) =>\r\n\t\t\t\t\t\t\tdispatch({type: 'setDialogCollapsed', collapsed, index}), //대화 상자 축소 \r\n\t\t\t\t\t\tonChangeHighlighted: (highlighted: boolean) =>\r\n\t\t\t\t\t\t\tdispatch({type: 'setDialogHighlighted', highlighted, index}),\r\n\t\t\t\t\t\tonChangeMaximized: (maximized: boolean) =>\r\n\t\t\t\t\t\t\tdispatch({type: 'setDialogMaximized', maximized, index}),\r\n\t\t\t\t\t\tonClose: () => dispatch({type: 'removeDialog', index})\r\n\t\t\t\t\t};\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t//결국 실행되는 dialog창은 아래의 값\r\n\r\n\t\t\t\t\t\t/*더블 클릭을 하면 함수가 실행되어 컴포넌트가 생성되는게 아니라, \r\n\t\t\t\t\t\t이미 생성된 컴포넌트가 바뀌는 구조.\r\n\t\t\t\t\t\t더블 클릭 시 story-edit-route의 함수가 실행되고 dialog의 값이 바뀌면서 \r\n\t\t\t\t\t\tusecontext로 dialogs를 사용하고 있는 이 파일의 Transition Group 함수가 다시 랜더링 되고\r\n\t\t\t\t\t\t아래 함수가 다시 실행 된다*/\r\n\t\t\t\t\t\t<DialogTransition key={index}> \r\n\t\t\t\t\t\t\t{dialog.maximized ? (\r\n\t\t\t\t\t\t\t\t<div className=\"maximized \" style={maximizedStyle}>\r\n\t\t\t\t\t\t\t\t\t<dialog.component {...dialog.props} {...managementProps} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<dialog.component {...dialog.props} {...managementProps} />\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</DialogTransition>\r\n\t\t\t\t\t);\r\n\t\t\t\t})}\r\n\t\t\t</TransitionGroup>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import React from 'react';\r\nimport { Component } from 'react';\r\nimport './option.css';\r\n\r\n/* state에 저장해서 DB로 보내줘야하는 선택지 정보 나열\r\n1. 어떤 에피소드의 선택지인가 - int\r\n2. 선택지 내용(텍스트) - string\r\n3. 어떤 스테이터스가 변화하는지 - string\r\n4. 얼마나 변화하는지 - int\r\n5. 선택지 클릭시 결과 스토리 - string\r\n\r\n+ 에피소드가 적대적인지 복합적인지 친화적인지 판단할 정보*/\r\n\r\ntype Modes_props = {\r\n    onCreate:any;\r\n}\r\n\r\nclass CreateOption extends Component<Modes_props> {\r\n    constructor(props){\r\n        super(props);\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div className='options-making__container'>\r\n                <form action='' method='post'\r\n                onSubmit={function(e) {\r\n                    e.preventDefault();\r\n                    this.props.onCreate(e.target.option_title.value, e.target.status1.value, e.target.amount_change1.value, e.target.status2.value, e.target.amount_change2.value, e.target.after_story.value);\r\n                }.bind(this)}>\r\n                    \r\n                    <input className='option-mini-title' name='option_title' placeholder='선택지 출력 내용' required></input>\r\n\r\n                    <div className='mini-line'></div>\r\n\r\n                    <div>\r\n                        <select className='select-dropdown' name='status1' required>\r\n                            <option value=\"\">(능력)</option>\r\n                            <option value=\"health\">체력</option>\r\n                            <option value=\"money\">돈</option>\r\n                            <option value=\"satiety\">포만감</option>\r\n                            <option value=\"strength\">힘</option>\r\n                            <option value=\"agility\">민첩</option>\r\n                            <option value=\"armor\">내구도</option>\r\n                            <option value=\"mental\">정신력</option>\r\n                        </select>\r\n\r\n                        <select className='select-dropdown' name='amount_change1' required>\r\n                            <option value=\"\">(변화량)</option>\r\n                            <option value=\"1\">+1</option>\r\n                            <option value=\"0\">0</option>\r\n                            <option value=\"-1\">-1</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className='mini-line'></div>\r\n\r\n                    <div>\r\n                        <select className='select-dropdown' name='status2' required>\r\n                            <option value=\"\">(능력2)</option>\r\n                            <option value=\"null\">(없음)</option>\r\n                            <option value=\"health\">체력</option>\r\n                            <option value=\"money\">돈</option>\r\n                            <option value=\"satiety\">포만감</option>\r\n                            <option value=\"strength\">힘</option>\r\n                            <option value=\"agility\">민첩</option>\r\n                            <option value=\"armor\">내구도</option>\r\n                            <option value=\"mental\">정신력</option>\r\n                        </select>\r\n\r\n                        <select className='select-dropdown' name='amount_change2' required>\r\n                            <option value=\"0\">0</option>\r\n                            <option value=\"1\">+1</option>\r\n                            <option value=\"-1\">-1</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className='mini-line'></div>\r\n\r\n                    \r\n                    <textarea placeholder='플레이어가 선택지 선택 후에 등장하는 결과 이야기' className='option-mini-textarea' name=\"after_story\" id=\"\" cols={30} rows={10} required></textarea>\r\n                    \r\n                    <input className='option-submit-btn' type=\"submit\" value=\"생성하기\"></input>\r\n                </form>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default CreateOption;","import React from 'react';\r\nimport { Component } from 'react';\r\nimport './option.css'\r\nimport CreateOption from './CreateOption';\r\n\r\ntype Modes_props = {\r\n    onTrackingOption : any;\r\n}\r\ntype State_type = {\r\n    mode:string;\r\n    options_id:string[],\r\n    options_title: string[],\r\n    options_status1: string[],\r\n    options_amount_change1: string[],\r\n    options_status2:string[],\r\n    options_amount_change2: string[],\r\n    options_after_story: string[],\r\n    selected_modify_optionNum: number\r\n}\r\n\r\nclass DialogOptions extends Component<Modes_props, State_type>{\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.max_option_num = 0; //선택지 갯수. 이만큼 반복출력\r\n        this.state = {\r\n\r\n            mode:'default',//default, optionCreate, optionModify, optionDelete\r\n            //{id:1, _option_title:\"\", _status1: \"\", _amount_change1: 0, _status2: \"\", _amount_change2: 0, _after_story}\r\n            options_id:[],\r\n            options_title: [],\r\n            options_status1: [],\r\n            options_amount_change1: [],\r\n            options_status2: [],\r\n            options_amount_change2: [],\r\n            options_after_story: [],\r\n            //수정할 옵션의 숫자\r\n            selected_modify_optionNum: 0,\r\n        }\r\n    }\r\n\r\n    max_option_num:number;\r\n    \r\n    render(){\r\n\r\n        //옵션 만든것들 출력 및 수정 가능하도록 변경하는 함수\r\n        let lists = [];\r\n\r\n        for(let i=0; i < this.max_option_num; i++){\r\n            //i번째 요소에 i라는 key를 주고 있는데 아예 선택지의 고유 ID를 만들면 그걸로 대체해도 될듯\r\n            //고유 id는 곧 i+1이다.\r\n            //if문에 걸리는 수정하려는 선택지만 form형태의 수정 가능한 html 출력.\r\n            if(this.state.mode === \"optionModify\" &&  this.state.selected_modify_optionNum === i){\r\n                lists.push(\r\n                    <div key={i} id={i.toString()} className=\"option-list-div option-list-div-onmodify\">\r\n                        <div className='info-icon-onmodify'>선택지{i+1}</div>\r\n                        <div className='options-making__container'>\r\n                            <form action='' method='post' key={i} id={i.toString()} onSubmit={function(e){//인자로 id까지 받아서 배열에 넣기\r\n                                e.preventDefault();\r\n                                this.setState({ mode: \"default\"});\r\n                            }.bind(this)}>\r\n                                <input className='option-mini-title' value={this.state.options_title[i]} onChange={function(e){\r\n                                    \r\n                                    let _options_title = this.state.options_title.map((value, index) => {\r\n                                        if(i === index){//바꾸려고 시도하는 index와 아이디(i=순서)가 같다면\r\n                                            return e.target.value;\r\n                                        }\r\n                                        return value;\r\n                                    });\r\n                                    this.setState({options_title: _options_title});\r\n\r\n                                    //상위 컴포넌트(Twine)으로 값 전달\r\n                                    this.props.onTrackingOption(_options_title);\r\n                                }.bind(this)} required></input>\r\n\r\n                                <div className='mini-line'></div>\r\n\r\n                                <div>\r\n                                    <select className='select-dropdown' name='status1' required onChange={function(e){\r\n                                        let _options_status1 = this.state.options_status1.map((value, index) => {\r\n                                            return value;\r\n                                        });\r\n                                        this.setState({options_status1: _options_status1});\r\n                                    }.bind(this)}>\r\n                                        <option value=\"\">(능력)</option>\r\n                                        <option value=\"health\">체력</option>\r\n                                        <option value=\"money\">돈</option>\r\n                                        <option value=\"satiety\">포만감</option>\r\n                                        <option value=\"strength\">힘</option>\r\n                                        <option value=\"agility\">민첩</option>\r\n                                        <option value=\"armor\">내구도</option>\r\n                                        <option value=\"mental\">정신력</option>\r\n                                    </select>\r\n\r\n                                    <select className='select-dropdown' name='amount_change1' required onChange={function(e){\r\n                                        let _options_amount_change1 = this.state.options_amount_change1.map((value, index) => {\r\n                                            if(i === index){//바꾸려고 시도하는 index와 아이디(i=순서)가 같다면\r\n                                                //값 치환\r\n                                                return e.target.value;\r\n                                            }\r\n                                            return value;\r\n                                        });\r\n                                        this.setState({options_amount_change1: _options_amount_change1});\r\n                                    }.bind(this)}>\r\n                                        <option value=\"\">(변화량)</option>\r\n                                        <option value=\"1\">+1</option>\r\n                                        <option value=\"0\">0</option>\r\n                                        <option value=\"-1\">-1</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div className='mini-line'></div>\r\n\r\n                                <div>\r\n                                    <select className='select-dropdown' name='status2' required onChange={function(e){\r\n                                        let _options_status2 = this.state.options_status2.map((value, index) => {\r\n                                            if(i === index){//바꾸려고 시도하는 index와 아이디(i=순서)가 같다면\r\n                                                return e.target.value;\r\n                                            }\r\n                                            return value;\r\n                                        });\r\n                                        this.setState({options_status2: _options_status2});\r\n                                    }.bind(this)}>\r\n                                        <option value=\"\">(능력2)</option>\r\n                                        <option value=\"null\">없음</option>\r\n                                        <option value=\"health\">체력</option>\r\n                                        <option value=\"money\">돈</option>\r\n                                        <option value=\"satiety\">포만감</option>\r\n                                        <option value=\"strength\">힘</option>\r\n                                        <option value=\"agility\">민첩</option>\r\n                                        <option value=\"armor\">내구도</option>\r\n                                        <option value=\"mental\">정신력</option>\r\n                                    </select>\r\n\r\n                                    <select className='select-dropdown' name='amount_change2' required onChange={function(e){\r\n                                        let _options_amount_change2 = this.state.options_amount_change2.map((value, index) => {\r\n                                            if(i === index){//바꾸려고 시도하는 index와 아이디(i=순서)가 같다면\r\n                                                \r\n                                                //변화한 값으로 출력\r\n                                                return e.target.value;\r\n                                            }\r\n                                            return value;\r\n                                        });\r\n                                        this.setState({options_amount_change2: _options_amount_change2});\r\n                                    }.bind(this)}>\r\n                                        <option value=\"0\">0</option>\r\n                                        <option value=\"1\">+1</option>\r\n                                        <option value=\"-1\">-1</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div className='mini-line'></div>\r\n\r\n                                <textarea className='option-mini-textarea' value={this.state.options_after_story[i]} onChange={function(e){\r\n                                    \r\n                                    let _options_after_story = this.state.options_after_story.map((value, index) => {\r\n                                        if(i === index){//바꾸려고 시도하는 index와 아이디(i=순서)가 같다면\r\n                                            return e.target.value;\r\n                                        }\r\n                                        return value;\r\n                                    });\r\n                                    this.setState({options_after_story: _options_after_story});\r\n                                }.bind(this)} required></textarea>\r\n\r\n                                <input className='option-submit-btn' value=\"확인\" type=\"submit\"></input>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            } else {\r\n                let status1;\r\n                let status2;\r\n                switch(this.state.options_status1[i]){\r\n                    case 'null':\r\n                        status1=\"변화없음\";\r\n                        break;\r\n                    case 'health':\r\n                        status1=\"체력\";\r\n                        break;\r\n                    case 'money':\r\n                        status1=\"돈\";\r\n                        break;\r\n                    case 'satiety':\r\n                        status1=\"포만감\";\r\n                        break;\r\n                    case 'strength':\r\n                        status1=\"힘\";\r\n                        break;\r\n                    case 'agility':\r\n                        status1=\"속도\";\r\n                        break;\r\n                    case 'armor':\r\n                        status1=\"내구도\";\r\n                        break;\r\n                    case 'mental':\r\n                        status1=\"정신력\";\r\n                        break;\r\n                    default:\r\n                        status1 =\"없음\";\r\n                }\r\n                switch(this.state.options_status2[i]){\r\n                    case 'null':\r\n                        status2=\"없음\";\r\n                        break;\r\n                    case 'health':\r\n                        status2=\"체력\";\r\n                        break;\r\n                    case 'money':\r\n                        status2=\"돈\";\r\n                        break;\r\n                    case 'satiety':\r\n                        status2=\"포만감\";\r\n                        break;\r\n                    case 'strength':\r\n                        status2=\"힘\";\r\n                        break;\r\n                    case 'agility':\r\n                        status2=\"속도\";\r\n                        break;\r\n                    case 'armor':\r\n                        status2=\"내구도\";\r\n                        break;\r\n                    case 'mental':\r\n                        status2=\"정신력\";\r\n                        break;\r\n                    default:\r\n                        status2 =\"없음\";\r\n                }\r\n                lists.push(\r\n                    <div key={i} id={i.toString()} className=\"option-list-div\">\r\n                        <div className='info-icon'>선택지{i+1}</div>\r\n                        <div className='option-info-container'>\r\n                            <div className='option-info-title'>{this.state.options_title[i]}</div>\r\n                            <div className='option-info-main'>\r\n                                <span>{status1}</span>\r\n                                <span>{this.state.options_amount_change1[i]}</span>\r\n                                <span></span>\r\n                                <span>{status2}</span>\r\n                                <span>{this.state.options_amount_change2[i]}</span>\r\n                                <span></span>\r\n                                <span className='after-story-preview-btn'>\r\n                                    <span>에필로그</span>\r\n                                    <div>{this.state.options_after_story[i]}</div>\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                        <button className='option-list-m-btn' onClick={function(e){\r\n                            e.preventDefault();\r\n                            this.setState({ mode: \"optionModify\"});\r\n                            this.setState({selected_modify_optionNum: parseInt(e.target.parentNode.id)});\r\n                        }.bind(this)}>수정</button>\r\n                        <button className='option-list-d-btn' onClick={function(e){\r\n                            //splice(제거를 시작할 index, 시작지점부텨 몇개 지울선지, (선택사항) 지운 자리에 넣을 배열)\r\n                            \r\n                            if(window.confirm(\"선택지를 삭제하시겠습니까?\")) {\r\n                                const index = parseInt(e.target.parentNode.id);\r\n                                console.log(index);\r\n\r\n                                //let _options_id = Array.from(this.state.options_id);\r\n                                let _options_title = Array.from(this.state.options_title);\r\n                                let _options_status1 = Array.from(this.state.options_status1);\r\n                                let _options_amount_change1 = Array.from(this.state.options_amount_change1);\r\n                                let _options_status2 = Array.from(this.state.options_status2);\r\n                                let _options_amount_change2 = Array.from(this.state.options_amount_change2);\r\n                                let _options_after_story = Array.from(this.state.options_after_story);\r\n\r\n                                //_options_id.splice(index, 1);\r\n                                _options_title.splice(index, 1);\r\n                                _options_status1.splice(index, 1);\r\n                                _options_amount_change1.splice(index, 1);\r\n                                _options_status2.splice(index, 1);\r\n                                _options_amount_change2.splice(index, 1);\r\n                                _options_after_story.splice(index, 1);\r\n\r\n                                console.log(_options_title);\r\n\r\n                                this.max_option_num = this.max_option_num -1;\r\n\r\n                                this.setState({\r\n                                    //options_id: _options_id,\r\n                                    options_title: _options_title,\r\n                                    options_status1: _options_status1,\r\n                                    options_amount_change1: _options_amount_change1,\r\n                                    options_status2: _options_status2,\r\n                                    options_amount_change2: _options_amount_change2,\r\n                                    options_after_story: _options_after_story\r\n                                });\r\n                                //상위 컴포넌트(Twine)으로 값 전달\r\n                                this.props.onTrackingOption(_options_title);\r\n                            } else {\r\n\r\n                            }\r\n                        }.bind(this)}>삭제</button>\r\n                    </div>\r\n                );\r\n            }\r\n        }\r\n\r\n        //선택지 생성 컴포넌트 만들기\r\n        let option_creator;\r\n        if(this.state.mode === 'optionCreate'){\r\n            //선택지 갯수 5개 이상 불가\r\n            if(this.max_option_num > 4){\r\n                this.setState({mode: \"default\"});\r\n                alert(\"선택지는 최대 5개까지 만들 수 있습니다.\");\r\n            }\r\n            else{\r\n                option_creator = <CreateOption onCreate={\r\n                    function(option_title, status1, amount_change1, status2, amount_change2, after_story) {\r\n    \r\n                        //선택지 목록 아이디를 위한 갯수 추가\r\n                        this.max_option_num = this.max_option_num + 1;\r\n                        //새로 만든 배열 추가하여 생성\r\n    \r\n                        //const _options_id = this.state.options_id.concat(this.max_option_num);\r\n                        const _options_title = this.state.options_title.concat(option_title);\r\n                        const _options_status1 = this.state.options_status1.concat(status1);\r\n                        const _options_amount_change1 = this.state.options_amount_change1.concat(amount_change1);\r\n                        const _options_status2 = this.state.options_status2.concat(status2);\r\n                        const _options_amount_change2 = this.state.options_amount_change2.concat(amount_change2);\r\n                        const _options_after_story = this.state.options_after_story.concat(after_story);\r\n                        //배열 새로 저장. 원본을 바꾸지 않는 형태로 진행하기 위한 코드임.\r\n                        this.setState({\r\n                            //options_id: _options_id,\r\n                            options_title: _options_title,\r\n                            options_status1: _options_status1,\r\n                            options_amount_change1: _options_amount_change1,\r\n                            options_status2: _options_status2,\r\n                            options_amount_change2: _options_amount_change2,\r\n                            options_after_story: _options_after_story,\r\n                            mode: \"default\"\r\n                        });\r\n\r\n                        //상위 컴포넌트(Twine)으로 값 전달\r\n                        this.props.onTrackingOption(_options_title);\r\n                    }.bind(this)\r\n                }/>;\r\n            }\r\n        }\r\n        else{\r\n            option_creator='';\r\n        }\r\n\r\n        //선택지 제거하기\r\n        //if(this.state.mode === '')\r\n\r\n\r\n        return(\r\n            <div className=\"option-ui__container\">\r\n                {/* 수정 이벤트 함수(mode와 어떤 option선택 되었는지 id올리기), 제거 이벤트 함수, 데이터, 선택지 갯수 정보 보냄 */}\r\n                <div className=\"options-show__container\">\r\n                    {lists}\r\n                </div>\r\n\r\n                <div className='add-option-btn-container'>\r\n                    {\r\n                        option_creator\r\n                    }\r\n                    <a className='add-option-btn' href='/' onClick={function(e){\r\n                        e.preventDefault();\r\n                        if(this.state.mode === 'optionCreate'){\r\n                            if(window.confirm(\"작성 중인 선택지 정보가 사라집니다.\\n정말 선택지 생성 창을 닫으시겠습니까?\")){\r\n                                this.setState({mode: 'default'});\r\n                            }\r\n                        }\r\n                        else{\r\n                            this.setState({mode: 'optionCreate'});\r\n                        }\r\n                        }.bind(this) }>\r\n                            + 선택지 추가하기</a>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default DialogOptions;","import React from \"react\";\r\nimport { Component } from \"react\";\r\nimport DialogOptions from \"./DialogOptions\";\r\nimport { useEffect , useState} from \"react\";\r\nimport './option_window.css'\r\nimport { useUndoableStoriesContext } from \"../../../store/undoable-stories\";\r\nimport { updatePassage } from \"../../../store/stories\";\r\n\r\ntype Modes_props = {    \r\n    passage : any\r\n    story : any\r\n    onWrite : any\r\n}\r\n\r\n\r\nexport const UserDialog: React.FC<Modes_props> = (props) => {\r\n\r\n    const [title, setTitle] = useState(props.passage.name);\r\n    const [context, setContext] = useState(props.passage.text);\r\n    const [optionsTitle, setOptionsTitle] = useState([]);\r\n    const {dispatch, stories} = useUndoableStoriesContext();\r\n    let regex = /\\[\\[.*\\]\\]/g\r\n    useEffect(()=>{\r\n        console.log(context.match(regex))\r\n    }, [])   \r\n    //isFriendly:\"complex\", //friendly, complex, hostile 중 하나.\r\n    useEffect(()=>{\r\n        setTitle(props.passage.name);\r\n        setContext(props.passage.text);\r\n        \r\n    },[props.passage.name, props.passage.text])\r\n    \r\n    let convertedString:string = \"\";\r\n\r\n    \r\n    //제목 변경 함수\r\n    function handleRename(name: string) {\r\n\t\tdispatch(updatePassage(props.story, props.passage, {name}, {dontUpdateOthers: true}));\r\n\t}\r\n\r\n    //main과 options에 this.updateContext()로 추가해주기\r\n    function updateContext():void{\r\n        //값 초기화.\r\n        convertedString = context;\r\n        for(let i = 0; i< optionsTitle.length; i++){\r\n            convertedString = convertedString + \"\\n\" + \"[[\" + optionsTitle[i] + \"]]\";\r\n        }\r\n    }\r\n\r\n    return(\r\n        <div className=\"making-all-container\">\r\n            <div className=\"making-window\">\r\n                <div className=\"making-window-header\">\r\n                    <div className=\"title-info-icon info-icon\">제목</div>\r\n                    <input value={title} onChange={function(e){\r\n                        setTitle(e.target.value)\r\n                    }} />\r\n                </div>\r\n                <div className=\"making-window-main\">\r\n                    <div className=\"main-info-icon info-icon\">본문</div>\r\n                    <textarea value={context} name=\"\" id=\"\" cols={30} rows={10} onChange={function(e){\r\n                        setContext(e.target.value)\r\n                        // if(Array.isArray(optionsTitle)){\r\n                        //     updateContext(optionsTitle.length);\r\n                        // }\r\n                    }}></textarea>\r\n                </div>\r\n                <DialogOptions onTrackingOption={function(optionTitleArr){\r\n                    let _optionsTitle = optionTitleArr.concat();\r\n                    \r\n                    setOptionsTitle(_optionsTitle);\r\n                    // if(Array.isArray(_optionsTitle)){\r\n                    //     updateContext(_optionsTitle);\r\n                    // }\r\n                }}></DialogOptions>\r\n                <div className=\"save-btn-container\">\r\n                    <button onClick={function(e){\r\n                        updateContext();\r\n                        handleRename(title)\r\n                        props.onWrite(convertedString)\r\n                    }}\r\n                    >작성완료</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n}\r\n","import * as React from 'react';\r\nimport isEqual from 'lodash/isEqual';\r\nimport {DialogsAction, DialogsState} from '../dialogs.types';\r\n\r\n//dialog 창의 크기를 조정하거나 삭제하는 함수가 담겨있다\r\nexport const reducer: React.Reducer<DialogsState, DialogsAction> = (\r\n\tstate, //창이 안띄어져 있으면 그냥 배열값 출력되는 듯\r\n\taction //story-edit-route에서 전달받은 인자값이 들어있음\r\n) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'addDialog': //story-edit-route에서 실행하는 dialogDispatch \r\n\t\t\t// If the dialog has been previously added, expand and/or highlight it.\r\n\t\t\t// Otherwise, add it to the end.\r\n\r\n\t\t\t// let exists = false;\r\n\t\t\t// const editedState = state.map(stateDialog => { //창이 없으면 state에 값이 없어서 editStaet는 그냥 공배열\r\n\t\t\t// \tif (\r\n\t\t\t// \t\tisEqual(stateDialog, {\r\n\t\t\t// \t\t\t// Ignore collapsed, highlighted, and maximized properties for comparison.\r\n\t\t\t// \t\t\tcollapsed: stateDialog.collapsed,\r\n\t\t\t// \t\t\tcomponent: action.component,\r\n\t\t\t// \t\t\thighlighted: stateDialog.highlighted,\r\n\t\t\t// \t\t\tmaximized: stateDialog.maximized,\r\n\t\t\t// \t\t\tprops: action.props\r\n\t\t\t// \t\t})\r\n\t\t\t// \t) {\r\n\t\t\t// \t\texists = true;\r\n\t\t\t// \t\treturn {...stateDialog, collapsed: false, highlighted: true};\r\n\t\t\t// \t}\r\n\r\n\t\t\t// \treturn stateDialog;\r\n\t\t\t// });\r\n\r\n\t\t\t// if (exists) {\r\n\t\t\t// \treturn editedState;\r\n\t\t\t// }\r\n\r\n\t\t\treturn [\r\n\t\t\t\t// ...state,\r\n\t\t\t\t{\r\n\t\t\t\t\tcollapsed: false,\r\n\t\t\t\t\tcomponent: action.component,\r\n\t\t\t\t\thighlighted: false,\r\n\t\t\t\t\tmaximized: false,\r\n\t\t\t\t\tprops: action.props\r\n\t\t\t\t}\r\n\t\t\t];\r\n\r\n\t\t//dialog 창의 크기를 조정하거나 삭제하는 함수들\r\n\t\tcase 'removeDialog':\r\n\t\t\treturn state.filter((dialog, index) => index !== action.index);\r\n\t\t\t//반환 값을 찍어보면 하나만 반환한다. js의 구조분해할당에서는 인자의 값이 없으면 들어가지 않는다. 그러니까 dialogs의 값만 업데이트 하고 dispatch는 수정하지 않는 것이다\r\n\r\n\t\tcase 'setDialogCollapsed':\r\n\t\t\tlet a = state.map((dialog, index) =>\r\n\t\t\t\tindex === action.index\r\n\t\t\t\t\t? {...dialog, collapsed: action.collapsed}\r\n\t\t\t\t\t: dialog\r\n\t\t\t);\r\n\t\t\treturn state.map((dialog, index) =>\r\n\t\t\t\tindex === action.index\r\n\t\t\t\t\t? {...dialog, collapsed: action.collapsed}\r\n\t\t\t\t\t: dialog\r\n\t\t\t);\r\n\t\t\t\r\n\r\n\t\tcase 'setDialogHighlighted':\r\n\t\t\treturn state.map((dialog, index) =>\r\n\t\t\t\tindex === action.index\r\n\t\t\t\t\t? {...dialog, highlighted: action.highlighted}\r\n\t\t\t\t\t: dialog\r\n\t\t\t);\r\n\r\n\t\tcase 'setDialogMaximized':\r\n\t\t\treturn state.map((dialog, index) => ({\r\n\t\t\t\t...dialog,\r\n\t\t\t\tmaximized: index === action.index ? action.maximized : false\r\n\t\t\t}));\r\n\t}\r\n};\r\n","import * as React from 'react';\r\nimport useThunkReducer, {Thunk} from 'react-hook-thunk-reducer';\r\nimport {reducer} from './reducer';\r\nimport {Dialogs} from './dialogs';\r\nimport {DialogsAction, DialogsState} from '../dialogs.types';\r\n\r\nexport interface DialogsContextProps {\r\n\tdispatch: React.Dispatch<DialogsAction | Thunk<DialogsState, DialogsAction>>;\r\n\tdialogs: DialogsState;\r\n}\r\n\r\nexport const DialogsContext = React.createContext<DialogsContextProps>({\r\n\tdispatch: () => {},\r\n\tdialogs: []\r\n});\r\n\r\nDialogsContext.displayName = 'Dialogs';\r\n\r\nexport const useDialogsContext = () => React.useContext(DialogsContext);\r\n\r\nexport const DialogsContextProvider: React.FC = props => {\r\n\tconst [dialogs, dispatch] = useThunkReducer(reducer, []); //thunkreducer는 객체 대신 함수를 반환할 수 있게 해주는 것 같다. useState대신에 사용했다.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  //dispatch에 reducer.ts의 함수가 들어간다\r\n\r\n\treturn (\r\n\t\t<DialogsContext.Provider value={{dispatch, dialogs}}>\r\n\t\t\t{props.children}\r\n\t\t\t<Dialogs />\r\n\t\t</DialogsContext.Provider>\r\n\t);\r\n};\r\n","// Handles importing HTML source code into story objects ready to be saved to\r\n// the store. This works on both published story files and archives.\r\n//\r\n// It's important that this code be as efficient as possible, as it directly\r\n// affects startup time in the Twine desktop app. This module moves data from\r\n// the filesystem into local storage, and the app can't begin until it's done.\r\n\r\nimport defaults from 'lodash/defaults';\r\nimport uuid from 'tiny-uuid';\r\nimport {passageDefaults, storyDefaults, Passage, Story} from '../store/stories';\r\n\r\n/**\r\n * An imported story, which may contain incomplete or malformed data.\r\n */\r\nexport interface ImportedStory extends Omit<Partial<Story>, 'passages'> {\r\n\tpassages: Partial<Passage>[];\r\n}\r\n\r\n/**\r\n * HTML selectors used to find data in HTML format.\r\n */\r\nconst selectors = {\r\n\tpassage: 'tw-passage',\r\n\tstory: 'tw-story',\r\n\tscript: '[role=script]',\r\n\tstylesheet: '[role=stylesheet]',\r\n\tstoryData: 'tw-storydata',\r\n\ttagColors: 'tw-tag',\r\n\tpassageData: 'tw-passagedata'\r\n};\r\n\r\n/**\r\n * Convenience function to convert a string value to an float.\r\n */\r\nfunction float(stringValue: string) {\r\n\treturn parseFloat(stringValue);\r\n}\r\n\r\n/**\r\n * Convenience function to query an element by a selector.\r\n */\r\nfunction query(el: Element, selector: string) {\r\n\treturn Array.from(el.querySelectorAll(selector));\r\n}\r\n\r\n/**\r\n * Convenience function to parse a string like \"100,50\".\r\n */\r\nfunction parseDimensions(raw: any): [string, string] | undefined {\r\n\tif (typeof raw !== 'string') {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tconst bits = raw.split(',');\r\n\r\n\tif (bits.length === 2) {\r\n\t\treturn [bits[0], bits[1]];\r\n\t}\r\n\r\n\treturn undefined;\r\n}\r\n\r\n/**\r\n * Converts a DOM <tw-storydata> element to a story object matching the format\r\n * in the store. This *may* be missing data, or data it returns may be\r\n * malformed. This function does its best to reflect the contents of the\r\n * element.\r\n */\r\nfunction domToObject(storyEl: Element): ImportedStory {\r\n\tconst startPassagePid = storyEl.getAttribute('startnode');\r\n\tlet startPassageId: string | undefined = undefined;\r\n\tconst story: ImportedStory = {\r\n\t\tifid: storyEl.getAttribute('ifid') ?? uuid(),\r\n\t\tid: uuid(),\r\n\t\tlastUpdate: undefined,\r\n\t\tname: storyEl.getAttribute('name') ?? undefined,\r\n\t\tstoryFormat: storyEl.getAttribute('format') ?? undefined,\r\n\t\tstoryFormatVersion: storyEl.getAttribute('format-version') ?? undefined,\r\n\t\tscript: query(storyEl, selectors.script)\r\n\t\t\t.map(el => el.textContent)\r\n\t\t\t.join('\\n'),\r\n\t\tstylesheet: query(storyEl, selectors.stylesheet)\r\n\t\t\t.map(el => el.textContent)\r\n\t\t\t.join('\\n'),\r\n\t\ttags: storyEl.getAttribute('tags')\r\n\t\t\t? storyEl.getAttribute('tags')!.split(/\\s+/)\r\n\t\t\t: [],\r\n\t\tzoom: parseFloat(storyEl.getAttribute('zoom') ?? '1'),\r\n\t\ttagColors: query(storyEl, selectors.tagColors).reduce((result, el) => {\r\n\t\t\tconst tagName = el.getAttribute('name');\r\n\r\n\t\t\tif (typeof tagName !== 'string') {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\treturn {...result, [tagName]: el.getAttribute('color')};\r\n\t\t}, {}),\r\n\t\tpassages: query(storyEl, selectors.passageData).map(passageEl => {\r\n\t\t\tconst id = uuid();\r\n\t\t\tconst position = parseDimensions(passageEl.getAttribute('position'));\r\n\t\t\tconst size = parseDimensions(passageEl.getAttribute('size'));\r\n\r\n\t\t\tif (passageEl.getAttribute('pid') === startPassagePid) {\r\n\t\t\t\tstartPassageId = id;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tid,\r\n\t\t\t\tleft: position ? float(position[0]) : undefined,\r\n\t\t\t\ttop: position ? float(position[1]) : undefined,\r\n\t\t\t\twidth: size ? float(size[0]) : undefined,\r\n\t\t\t\theight: size ? float(size[1]) : undefined,\r\n\t\t\t\ttags: passageEl.getAttribute('tags')\r\n\t\t\t\t\t? passageEl.getAttribute('tags')!.split(/\\s+/)\r\n\t\t\t\t\t: [],\r\n\t\t\t\tname: passageEl.getAttribute('name') ?? undefined,\r\n\t\t\t\ttext: passageEl.textContent ?? undefined\r\n\t\t\t};\r\n\t\t})\r\n\t};\r\n\r\n\tstory.startPassage = startPassageId;\r\n\treturn story;\r\n}\r\n\r\n/**\r\n * Imports stories from HTML. If there are any missing attributes in the HTML,\r\n * defaults will be applied.\r\n */\r\nexport function importStories(\r\n\thtml: string,\r\n\tlastUpdateOverride?: Date\r\n): Story[] {\r\n\tconst nodes = document.createElement('div');\r\n\r\n\tnodes.innerHTML = html;\r\n\r\n\treturn query(nodes, selectors.storyData).map(storyEl => {\r\n\t\tconst importedStory = domToObject(storyEl);\r\n\r\n\t\t// Merge in defaults. We can't use object spreads here because undefined\r\n\t\t// values would override defaults.\r\n\r\n\t\tconst story: Story = defaults(importedStory, {id: uuid()}, storyDefaults());\r\n\r\n\t\t// Override the last update as requested.\r\n\r\n\t\tif (lastUpdateOverride) {\r\n\t\t\tstory.lastUpdate = lastUpdateOverride;\r\n\t\t}\r\n\r\n\t\t// Merge in passage defaults. We don't need to set ID here--domToObject did\r\n\t\t// this for us.\r\n\r\n\t\tstory.passages = story.passages.map(passage =>\r\n\t\t\tdefaults(passage, passageDefaults(), {story: story.id})\r\n\t\t);\r\n\r\n\t\treturn story;\r\n\t});\r\n}\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconWriting} from '@tabler/icons';\r\nimport {PromptButton} from '../control/prompt-button';\r\nimport {Passage, Story} from '../../store/stories';\r\nimport {IconButton} from '../control/icon-button';\r\n\r\nconst DisabledRenamePassageButton: React.FC = () => {\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton disabled icon={<IconWriting />} label={t('common.rename')} />\r\n\t);\r\n};\r\n\r\nexport interface EnabledRenamePassageButtonProps {\r\n\tonRename: (value: string) => void;\r\n\tpassage: Passage;\r\n\tstory: Story;\r\n}\r\n\r\nexport const EnabledRenamePassageButton: React.FC<EnabledRenamePassageButtonProps> = props => {\r\n\tconst {onRename, passage, story} = props;\r\n\tconst [newName, setNewName] = React.useState(passage.name);\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction validate(name: string) {\r\n\t\tif (name.trim() === '') {\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t('components.renamePassageButton.emptyName'),\r\n\t\t\t\tvalid: false\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (story.passages.some(p => p.id !== passage.id && p.name === name)) {\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t('components.renamePassageButton.nameAlreadyUsed'),\r\n\t\t\t\tvalid: false\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {valid: true};\r\n\t}\r\n\r\n\treturn (\r\n\t\t<PromptButton\r\n\t\t\ticon={<IconWriting />}\r\n\t\t\tlabel={t('common.rename')}\r\n\t\t\tonChange={event => setNewName(event.target.value)}\r\n\t\t\tonSubmit={onRename}\r\n\t\t\tprompt={t('common.renamePrompt', {name: passage.name})}\r\n\t\t\tvalidate={validate}\r\n\t\t\tvalue={newName}\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nexport interface RenamePassageButtonProps\r\n\textends Omit<EnabledRenamePassageButtonProps, 'passage'> {\r\n\tpassage?: Passage;\r\n}\r\n\r\nexport const RenamePassageButton: React.FC<RenamePassageButtonProps> = props => {\r\n\tif (props.passage) {\r\n\t\treturn (\r\n\t\t\t<EnabledRenamePassageButton\r\n\t\t\t\t{...(props as EnabledRenamePassageButtonProps)}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\treturn <DisabledRenamePassageButton />;\r\n};","import * as React from 'react';\r\nimport {usePrefsContext} from '.';\r\n\r\nexport function useComputedTheme() {\r\n\t// See https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\r\n\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst [mediaQuery] = React.useState(\r\n\t\twindow.matchMedia('(prefers-color-scheme: dark)')\r\n\t);\r\n\tconst [systemTheme, setSystemTheme] = React.useState<'dark' | 'light'>(\r\n\t\tmediaQuery.matches ? 'dark' : 'light'\r\n\t);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst listener = (event: MediaQueryListEvent) =>\r\n\t\t\tsetSystemTheme(event.matches ? 'dark' : 'light');\r\n\r\n\t\tmediaQuery.addEventListener('change', listener);\r\n\t\treturn () => mediaQuery.removeEventListener('change', listener);\r\n\t}, [mediaQuery]);\r\n\r\n\treturn prefs.appTheme === 'system' ? systemTheme : prefs.appTheme;\r\n}\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport {IconWriting} from '@tabler/icons';\r\nimport {colors, Color} from '../../util/color';\r\nimport {PromptButton, PromptValidationResponse} from '../control/prompt-button';\r\nimport {TextSelect} from '../control/text-select';\r\nimport './tag-editor.css';\r\n\r\nexport interface TagEditorProps {\r\n\tallTags: string[];\r\n\tcolor?: Color;\r\n\tname: string;\r\n\tonChangeColor: (color: Color) => void;\r\n\tonChangeName: (name: string) => void;\r\n}\r\n\r\nexport const TagEditor: React.FC<TagEditorProps> = props => {\r\n\tconst {allTags, color, name, onChangeColor, onChangeName} = props;\r\n\tconst [newName, setNewName] = React.useState(name);\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction validate(value: string): PromptValidationResponse {\r\n\t\tif (value !== name && allTags.includes(value)) {\r\n\t\t\treturn {message: t('components.tagEditor.alreadyExists'), valid: false};\r\n\t\t}\r\n\r\n\t\treturn {valid: true};\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"tag-editor\">\r\n\t\t\t<span className={classNames('tag-name', `color-${props.color}`)}>\r\n\t\t\t\t{props.name}\r\n\t\t\t</span>\r\n\t\t\t<PromptButton\r\n\t\t\t\ticon={<IconWriting />}\r\n\t\t\t\tlabel={t('common.rename')}\r\n\t\t\t\tonChange={e => setNewName(e.target.value.replace(/\\s/g, '-'))}\r\n\t\t\t\tonSubmit={() => onChangeName(newName)}\r\n\t\t\t\tprompt={t('common.renamePrompt', {name})}\r\n\t\t\t\tvalue={newName}\r\n\t\t\t\tvalidate={validate}\r\n\t\t\t/>\r\n\t\t\t<TextSelect\r\n\t\t\t\tonChange={e => onChangeColor(e.target.value)}\r\n\t\t\t\toptions={colors.map(color => ({\r\n\t\t\t\t\tlabel: t(`colors.${color}`),\r\n\t\t\t\t\tvalue: color\r\n\t\t\t\t}))}\r\n\t\t\t\tvalue={color ?? ''}\r\n\t\t\t>\r\n\t\t\t\t{t('common.color')}\r\n\t\t\t</TextSelect>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport './meter.css';\r\n\r\nexport interface MeterProps {\r\n\tdomId: string;\r\n\tpercent: number;\r\n}\r\n\r\nexport const Meter: React.FC<MeterProps> = ({children, domId, percent}) => {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"meter\"\r\n\t\t\tid={domId}\r\n\t\t\trole=\"meter\"\r\n\t\t\taria-labelledby={`${domId}-label`}\r\n\t\t\taria-valuemin={0}\r\n\t\t\taria-valuemax={100}\r\n\t\t\taria-valuenow={percent * 100}\r\n\t\t>\r\n\t\t\t<div className=\"meter-bar\">\r\n\t\t\t\t<span className=\"filled\" style={{width: percent * 100 + '%'}}></span>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"meter-label\" id={`${domId}-label`}>\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n","// Initiates story format loading, optionally showing a progress meter while it works.\r\n\r\nimport * as React from 'react';\r\nimport {Meter} from '../components/meter';\r\nimport {\r\n\tloadAllFormatProperties,\r\n\tuseStoryFormatsContext,\r\n\tStoryFormat\r\n} from './story-formats';\r\n\r\nexport interface FormatLoaderProps {\r\n\tblock?: boolean;\r\n}\r\n\r\nexport const FormatLoader: React.FC<FormatLoaderProps> = ({\r\n\tblock,\r\n\tchildren\r\n}) => {\r\n\tconst [seenFormats, setSeenFormats] = React.useState<StoryFormat[]>([]);\r\n\tconst {dispatch, formats} = useStoryFormatsContext();\r\n\r\n\t// We can't directly use formats in an effect because it will change as\r\n\t// loading takes place. Instead, we need to maintain a list of formats to load\r\n\t// that only ever changes if new formats appear in state.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst newFormats = formats.filter(\r\n\t\t\tnewFormat =>\r\n\t\t\t\t!seenFormats.find(\r\n\t\t\t\t\toldFormat =>\r\n\t\t\t\t\t\toldFormat.name === newFormat.name &&\r\n\t\t\t\t\t\toldFormat.version === newFormat.version\r\n\t\t\t\t)\r\n\t\t);\r\n\r\n\t\tif (newFormats.length > 0) {\r\n\t\t\tdispatch(loadAllFormatProperties(newFormats));\r\n\t\t\tsetSeenFormats([...seenFormats, ...newFormats]);\r\n\t\t}\r\n\t}, [dispatch, formats, seenFormats]);\r\n\r\n\tconst loadingFormat = formats.find(f => f.loadState === 'loading');\r\n\tconst loadPercent =\r\n\t\tformats.filter(f => f.loadState === 'loaded').length / formats.length;\r\n\r\n\tif (block && loadPercent < 1) {\r\n\t\treturn (\r\n\t\t\t<Meter domId=\"story-format-loader\" percent={loadPercent}>\r\n\t\t\t\t{loadingFormat && (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\tLoading {loadingFormat.name} {loadingFormat.version}\r\n\t\t\t\t\t</>\r\n\t\t\t\t)}\r\n\t\t\t</Meter>\r\n\t\t);\r\n\t}\r\n\r\n\treturn <>{children}</>;\r\n};\r\n","import {PrefsAction, PrefsState} from './prefs.types';\r\nimport {Color} from '../../util/color';\r\n\r\nexport function setPref(\r\n\tname: keyof PrefsState,\r\n\tvalue:\r\n\t\t| boolean\r\n\t\t| number\r\n\t\t| string\r\n\t\t| {name: string; version: string}\r\n\t\t| {name: string; version: string}[]\r\n\t\t| Record<string, Color>\r\n): PrefsAction {\r\n\treturn {type: 'update', name, value};\r\n}\r\n","import {PrefsState} from './prefs.types';\r\n\r\n/**\r\n * Returns whether the user has disabled editor extensions for a story format.\r\n */\r\nexport function formatEditorExtensionsDisabled(\r\n\tprefs: PrefsState,\r\n\tname: string,\r\n\tversion: string\r\n) {\r\n\treturn prefs.disabledStoryFormatEditorExtensions.some(\r\n\t\tf => f.name === name && f.version === version\r\n\t);\r\n}\r\n","import {Story} from '../../store/stories/stories.types';\r\n\r\n/**\r\n * Returns a filename for a story object that's guaranteed to be safe across all\r\n * platforms. For this, we use POSIX's definition\r\n * (http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_276)\r\n * with the addition of spaces, for legibility.\r\n */\r\nexport function storyFileName(story: Story) {\r\n\treturn story.name.replace(/[^\\w. -]/g, '_') + '.html';\r\n}\r\n","/**\r\n * 새로운 스토리 포맷 생성 코드\r\n * 사용자가 직접 스토리 포맷을 만들고 삭제하는 코드인듯\r\n */\r\n\r\nimport {Thunk} from 'react-hook-thunk-reducer';\r\nimport {StoryFormatsState} from '.';\r\nimport {fetchStoryFormatProperties} from '../../util/story-format/fetch-properties';\r\nimport {\r\n\tStoryFormat,\r\n\tStoryFormatProperties,\r\n\tStoryFormatsAction,\r\n\tStoryFormatsDispatch\r\n} from './story-formats.types';\r\n\r\n/**\r\n * Creates a new story format based on properties (probably loaded externally).\r\n */\r\nexport function createFromProperties(\r\n\turl: string,\r\n\tproperties: StoryFormatProperties\r\n): StoryFormatsAction {\r\n\tif (!properties.name || !properties.version) {\r\n\t\tthrow new Error('Missing required properties for a new story format');\r\n\t}\r\n\r\n\treturn {\r\n\t\ttype: 'create',\r\n\t\tprops: {\r\n\t\t\turl,\r\n\t\t\tname: properties.name,\r\n\t\t\tselected: false,\r\n\t\t\tuserAdded: true,\r\n\t\t\tversion: properties.version\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Deletes a story format.\r\n */\r\nexport function deleteFormat(format: StoryFormat): StoryFormatsAction {\r\n\treturn {type: 'delete', id: format.id};\r\n}\r\n\r\n/**\r\n * Deselects all formats.\r\n */\r\nexport function deselectAllFormats(): Thunk<StoryFormat[], StoryFormatsAction> {\r\n\treturn (dispatch, getFormats) => {\r\n\t\tfor (const format of getFormats()) {\r\n\t\t\tif (format.selected) {\r\n\t\t\t\tdispatch({type: 'update', id: format.id, props: {selected: false}});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Deselects a single format.\r\n */\r\nexport function deselectFormat(format: StoryFormat): StoryFormatsAction {\r\n\treturn {type: 'update', id: format.id, props: {selected: false}};\r\n}\r\n\r\nasync function loadFormatThunk(\r\n\tformat: StoryFormat,\r\n\tdispatch: StoryFormatsDispatch\r\n) {\r\n\tdispatch({\r\n\t\ttype: 'update',\r\n\t\tid: format.id,\r\n\t\tprops: {loadState: 'loading'}\r\n\t});\r\n\r\n\ttry {\r\n\t\tlet properties = await fetchStoryFormatProperties(format.url);\r\n\r\n\t\t// If the format contains a `hydrate` property, try running it and merge in\r\n\t\t// properties that function creates by modifiying what's bound to its\r\n\t\t// `this`. This allows creation of properties that can't be serialized to\r\n\t\t// JSON on the format. The hydrate function cannot override properties\r\n\t\t// already present in the format properties, e.g. to change its source.\r\n\r\n\t\tif (properties.hydrate) {\r\n\t\t\ttry {\r\n\t\t\t\tconst hydrateResult: Partial<StoryFormatProperties> = {};\r\n\r\n\t\t\t\t// eslint-disable-next-line no-new-func\r\n\t\t\t\tconst hydrateFunc = new Function(properties.hydrate);\r\n\r\n\t\t\t\thydrateFunc.call(hydrateResult);\r\n\t\t\t\tproperties = {...hydrateResult, ...properties};\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t`Format ${format.id} has a hydrate property but it threw an error when called`,\r\n\t\t\t\t\te\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispatch({\r\n\t\t\ttype: 'update',\r\n\t\t\tid: format.id,\r\n\t\t\tprops: {properties, loadState: 'loaded'}\r\n\t\t});\r\n\r\n\t\treturn properties;\r\n\t} catch (loadError) {\r\n\t\tdispatch({\r\n\t\t\ttype: 'update',\r\n\t\t\tid: format.id,\r\n\t\t\tprops: {loadError: (loadError as unknown) as Error, loadState: 'error'}\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/**\r\n * Loads all format properties. If loading previously failed, this will try\r\n * again.\r\n */\r\nexport function loadAllFormatProperties(\r\n\tformats: StoryFormat[]\r\n): Thunk<StoryFormat[], StoryFormatsAction> {\r\n\tconst toLoad = formats.filter(\r\n\t\tf => f.loadState !== 'loaded' && f.loadState !== 'loading'\r\n\t);\r\n\r\n\tif (!toLoad) {\r\n\t\treturn () => {};\r\n\t}\r\n\r\n\treturn async (dispatch: StoryFormatsDispatch) => {\r\n\t\tawait Promise.allSettled(\r\n\t\t\ttoLoad.map(format => loadFormatThunk(format, dispatch))\r\n\t\t);\r\n\t};\r\n}\r\n\r\n/**\r\n * Loads a format's properties. If loading previously failed, this function will\r\n * try again. This returns a thunk which in turns returns a promise resolving to\r\n * the format properties, which can be useful if you need them immediately.\r\n */\r\nexport function loadFormatProperties(format: StoryFormat) {\r\n\tif (format.loadState === 'loaded') {\r\n\t\treturn () => format.properties;\r\n\t}\r\n\r\n\treturn async (dispatch: StoryFormatsDispatch) =>\r\n\t\tawait loadFormatThunk(format, dispatch);\r\n}\r\n\r\n/**\r\n * Selects a single format.\r\n */\r\nexport function selectFormat(\r\n\tformat: StoryFormat,\r\n\texclusive?: boolean\r\n): Thunk<StoryFormatsState, StoryFormatsAction> {\r\n\treturn (dispatch, getState) => {\r\n\t\tif (!format.selected) {\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: 'update',\r\n\t\t\t\tid: format.id,\r\n\t\t\t\tprops: {selected: true}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (exclusive) {\r\n\t\t\tfor (const other of getState()) {\r\n\t\t\t\tif (other.id !== format.id && other.selected) {\r\n\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\ttype: 'update',\r\n\t\t\t\t\t\tid: other.id,\r\n\t\t\t\t\t\tprops: {selected: false}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}","import isAbsoluteUrl from 'is-absolute-url';\r\nimport semverLt from 'semver/functions/lt';\r\nimport {StoryFormat} from './story-formats.types';\r\nimport {PrefsState} from '../prefs';\r\nimport {gt} from 'semver';\r\n\r\nexport function filteredFormats(\r\n\tformats: StoryFormat[],\r\n\tfilter: PrefsState['storyFormatListFilter']\r\n): StoryFormat[] {\r\n\tswitch (filter) {\r\n\t\tcase 'all':\r\n\t\t\treturn formats;\r\n\r\n\t\tcase 'current':\r\n\t\t\treturn Object.values(\r\n\t\t\t\tformats.reduce<Record<string, StoryFormat>>((result, format) => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t!result[format.name] ||\r\n\t\t\t\t\t\tsemverLt(result[format.name].version, format.version)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\treturn {...result, [format.name]: format};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}, {})\r\n\t\t\t);\r\n\r\n\t\tcase 'user':\r\n\t\t\treturn formats.filter(format => format.userAdded);\r\n\t}\r\n}\r\n\r\nexport function formatImageUrl(format: StoryFormat) {\r\n\tif (format.loadState !== 'loaded' || !format.properties.image) {\r\n\t\tthrow new Error('Format has no image property');\r\n\t}\r\n\r\n\tif (isAbsoluteUrl(format.properties.image)) {\r\n\t\treturn format.properties.image;\r\n\t}\r\n\r\n\treturn format.url.replace(/\\/[^/]*?$/, '/') + format.properties.image;\r\n}\r\n\r\nexport function formatWithId(formats: StoryFormat[], id: string) {\r\n\tconst result = formats.find(f => f.id === id);\r\n\r\n\tif (result) {\r\n\t\treturn result;\r\n\t}\r\n\r\n\tthrow new Error(`There is no story format with ID \"${id}\".`);\r\n}\r\n\r\nexport function formatWithNameAndVersion(\r\n\tformats: StoryFormat[],\r\n\tname: string,\r\n\tversion: string\r\n) {\r\n\tconst result = formats.find(f => f.name === name && f.version === version);\r\n\r\n\tif (result) {\r\n\t\treturn result;\r\n\t}\r\n\r\n\tthrow new Error(\r\n\t\t`There is no story format with name \"${name}\" and version \"${version}\".`\r\n\t);\r\n}\r\n\r\nexport function newestFormatNamed(formats: StoryFormat[], name: string) {\r\n\treturn formats.reduce<StoryFormat | undefined>((result, format) => {\r\n\t\tif (format.name !== name) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tif (!result || gt(format.version, result.version)) {\r\n\t\t\treturn format;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}, undefined);\r\n}\r\n\r\nexport function sortFormats(formats: StoryFormat[]) {\r\n\treturn formats.sort((a, b) => {\r\n\t\t// First sort by name ascending...\r\n\r\n\t\tif (a.name < b.name) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tif (a.name > b.name) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\t// ... then by version, in descending order.\r\n\r\n\t\tif (a.version === b.version) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tif (semverLt(b.version, a.version)) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\treturn 1;\r\n\t});\r\n}\r\n","import {IconHeart, IconX} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {ButtonBar} from '../components/container/button-bar';\r\nimport {CardContent} from '../components/container/card';\r\nimport {DialogCard} from '../components/container/dialog-card';\r\nimport {IconButton} from '../components/control/icon-button';\r\nimport {IconLink} from '../components/control/icon-link';\r\nimport {setPref, usePrefsContext} from '../store/prefs';\r\nimport {DialogComponentProps} from './dialogs.types';\r\n\r\n//import 파일을 집어넣는 상자(추정)\r\nexport const AppDonationDialog: React.FC<DialogComponentProps> = props => {\r\n\tconst {dispatch} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tReact.useEffect(() => dispatch(setPref('donateShown', true)), [dispatch]);\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...props}\r\n\t\t\tclassName=\"app-donation-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.appDonation.title')}\r\n\t\t>\r\n\t\t\t<CardContent>\r\n\t\t\t\t<div className=\"text\">\r\n\t\t\t\t\t<p>{t('dialogs.appDonation.supportMessage')}</p>\r\n\t\t\t\t\t<p>{t('dialogs.appDonation.onlyOnce')}</p>\r\n\t\t\t\t</div>\r\n\t\t\t</CardContent>\r\n\t\t\t<ButtonBar>\r\n\t\t\t\t<IconLink\r\n\t\t\t\t\thref=\"https://twinery.org/donate\"\r\n\t\t\t\t\ticon={<IconHeart />}\r\n\t\t\t\t\tlabel={t('dialogs.appDonation.donate')}\r\n\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t/>\r\n\t\t\t\t<IconButton\r\n\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\tlabel={t('dialogs.appDonation.noThanks')}\r\n\t\t\t\t\tonClick={props.onClose}\r\n\t\t\t\t/>\r\n\t\t\t</ButtonBar>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {DialogCard} from '../components/container/dialog-card';\r\nimport {CardContent} from '../components/container/card';\r\nimport {DialogComponentProps} from './dialogs.types';\r\nimport {\r\n\tsetTagColor,\r\n\tstoryWithId,\r\n\trenamePassageTag,\r\n\tstoryPassageTags\r\n} from '../store/stories';\r\nimport {useUndoableStoriesContext} from '../store/undoable-stories';\r\nimport {Color} from '../util/color';\r\nimport {TagEditor} from '../components/tag/tag-editor';\r\n\r\nexport interface PassageTagsDialogProps extends DialogComponentProps {\r\n\tstoryId: string;\r\n}\r\n\r\nexport const PassageTagsDialog: React.FC<PassageTagsDialogProps> = props => {\r\n\tconst {storyId, ...other} = props;\r\n\tconst {dispatch, stories} = useUndoableStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst tags = storyPassageTags(story);\r\n\r\n\tfunction handleChangeColor(tagName: string, color: Color) {\r\n\t\tdispatch(\r\n\t\t\tsetTagColor(story, tagName, color),\r\n\t\t\tt('undoChange.changeTagColor')\r\n\t\t);\r\n\t}\r\n\r\n\tfunction handleChangeTagName(tagName: string, newName: string) {\r\n\t\tdispatch(\r\n\t\t\trenamePassageTag(story, tagName, newName),\r\n\t\t\tt('undoChange.renameTag')\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\tclassName=\"passage-tags-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.passageTags.title')}\r\n\t\t\t{...other}\r\n\t\t>\r\n\t\t\t<CardContent>\r\n\t\t\t\t{tags.length > 0 ? (\r\n\t\t\t\t\ttags.map(tag => (\r\n\t\t\t\t\t\t<TagEditor\r\n\t\t\t\t\t\t\tallTags={tags}\r\n\t\t\t\t\t\t\tcolor={story.tagColors[tag]}\r\n\t\t\t\t\t\t\tkey={tag}\r\n\t\t\t\t\t\t\tname={tag}\r\n\t\t\t\t\t\t\tonChangeColor={color => handleChangeColor(tag, color)}\r\n\t\t\t\t\t\t\tonChangeName={newName => handleChangeTagName(tag, newName)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<p>{t('dialogs.passageTags.noTags')}</p>\r\n\t\t\t\t)}\r\n\t\t\t</CardContent>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IndentButtons, UndoRedoButtons} from '../components/codemirror';\r\nimport {ButtonBar} from '../components/container/button-bar';\r\nimport {DialogCard, DialogEditor} from '../components/container/dialog-card';\r\nimport {CodeArea} from '../components/control/code-area';\r\nimport {usePrefsContext} from '../store/prefs';\r\nimport {storyWithId, updateStory, useStoriesContext} from '../store/stories';\r\nimport {codeMirrorOptionsFromPrefs} from '../util/codemirror-options';\r\nimport {DialogComponentProps} from './dialogs.types';\r\nimport './story-javascript.css';\r\n\r\nexport interface StoryJavaScriptDialogProps extends DialogComponentProps {\r\n\tstoryId: string;\r\n}\r\n\r\nexport const StoryJavaScriptDialog: React.FC<StoryJavaScriptDialogProps> = props => {\r\n\tconst {storyId, ...other} = props;\r\n\tconst [cmEditor, setCmEditor] = React.useState<CodeMirror.Editor>();\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst handleChange = (\r\n\t\teditor: CodeMirror.Editor,\r\n\t\tdata: CodeMirror.EditorChange,\r\n\t\ttext: string\r\n\t) => {\r\n\t\tsetCmEditor(editor);\r\n\t\tdispatch(updateStory(stories, story, {script: text}));\r\n\t};\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...other}\r\n\t\t\tclassName=\"story-javascript-dialog\"\r\n\t\t\theaderLabel={t('dialogs.storyJavaScript.title')}\r\n\t\t\tmaximizable\r\n\t\t>\r\n\t\t\t<ButtonBar>\r\n\t\t\t\t<UndoRedoButtons editor={cmEditor} watch={story.script} />\r\n\t\t\t\t<IndentButtons editor={cmEditor} />\r\n\t\t\t</ButtonBar>\r\n\t\t\t<DialogEditor>\r\n\t\t\t\t<CodeArea\r\n\t\t\t\t\teditorDidMount={setCmEditor}\r\n\t\t\t\t\tfontFamily={prefs.codeEditorFontFamily}\r\n\t\t\t\t\tfontScale={prefs.codeEditorFontScale}\r\n\t\t\t\t\tlabel={t('dialogs.storyJavaScript.editorLabel')}\r\n\t\t\t\t\tlabelHidden\r\n\t\t\t\t\tonBeforeChange={handleChange}\r\n\t\t\t\t\toptions={{\r\n\t\t\t\t\t\t...codeMirrorOptionsFromPrefs(prefs),\r\n\t\t\t\t\t\tautofocus: true,\r\n\t\t\t\t\t\tlineWrapping: true,\r\n\t\t\t\t\t\tmode: 'javascript',\r\n\t\t\t\t\t\tplaceholder: t('dialogs.storyJavaScript.explanation')\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tvalue={story.script}//스토리의 자바스크립트가 들어가서 적용되는듯??\r\n\t\t\t\t/>\r\n\t\t\t</DialogEditor>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import {debounce} from 'lodash';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconReplace} from '@tabler/icons';\r\nimport {DialogCard} from '../components/container/dialog-card';\r\nimport {CheckboxButton} from '../components/control/checkbox-button';\r\nimport {CodeArea} from '../components/control/code-area';\r\nimport {IconButton} from '../components/control/icon-button';\r\nimport {\r\n\thighlightPassagesMatchingSearch,\r\n\tpassagesMatchingSearch,\r\n\treplaceInStory,\r\n\tstoryWithId,\r\n\tStorySearchFlags\r\n} from '../store/stories';\r\nimport {useUndoableStoriesContext} from '../store/undoable-stories';\r\nimport {DialogComponentProps} from './dialogs.types';\r\nimport './story-search.css';\r\n\r\n// See https://github.com/codemirror/CodeMirror/issues/5444\r\n\r\nconst ignoreTab: any = {\r\n\tTab: false,\r\n\t'Shift-Tab': false\r\n};\r\n\r\nexport interface StorySearchDialogProps extends DialogComponentProps {\r\n\tstoryId: string;\r\n}\r\n\r\nexport const StorySearchDialog: React.FC<StorySearchDialogProps> = props => {\r\n\tconst {storyId, ...other} = props;\r\n\tconst [flags, setFlags] = React.useState<StorySearchFlags>({\r\n\t\tincludePassageNames: true,\r\n\t\tmatchCase: false,\r\n\t\tuseRegexes: false\r\n\t});\r\n\tconst [replace, setReplace] = React.useState('');\r\n\tconst [find, setFind] = React.useState('');\r\n\tconst {dispatch, stories} = useUndoableStoriesContext();\r\n\tconst debouncedDispatch = React.useMemo(\r\n\t\t() => debounce(dispatch, 250),\r\n\t\t[dispatch]\r\n\t);\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst matches = passagesMatchingSearch(story.passages, find, flags);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tdebouncedDispatch(highlightPassagesMatchingSearch(story, find, flags));\r\n\r\n\t\treturn () =>\r\n\t\t\tdebouncedDispatch(highlightPassagesMatchingSearch(story, '', {}));\r\n\t}, [debouncedDispatch, find, flags, story]);\r\n\r\n\tfunction handleReplaceWithChange(\r\n\t\teditor: CodeMirror.Editor,\r\n\t\tdata: CodeMirror.EditorChange,\r\n\t\ttext: string\r\n\t) {\r\n\t\tsetReplace(text);\r\n\t}\r\n\r\n\tfunction handleSearchForChange(\r\n\t\teditor: CodeMirror.Editor,\r\n\t\tdata: CodeMirror.EditorChange,\r\n\t\ttext: string\r\n\t) {\r\n\t\tsetFind(text);\r\n\t}\r\n\r\n\tfunction handleReplace() {\r\n\t\tdispatch(\r\n\t\t\treplaceInStory(story, find, replace, flags),\r\n\t\t\t'undoChange.replaceAllText'\r\n\t\t);\r\n\t}\r\n\r\n\tfunction toggleFlag(name: keyof StorySearchFlags) {\r\n\t\tsetFlags(flags => ({...flags, [name]: !flags[name]}));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...other}\r\n\t\t\tclassName=\"story-search-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.storySearch.title')}\r\n\t\t>\r\n\t\t\t<div className=\"search-fields\">\r\n\t\t\t\t<CodeArea\r\n\t\t\t\t\tlabel={t('dialogs.storySearch.find')}\r\n\t\t\t\t\tonBeforeChange={handleSearchForChange}\r\n\t\t\t\t\toptions={{\r\n\t\t\t\t\t\textraKeys: ignoreTab,\r\n\t\t\t\t\t\tmode: 'text'\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tvalue={find}\r\n\t\t\t\t/>\r\n\t\t\t\t<CodeArea\r\n\t\t\t\t\tlabel={t('dialogs.storySearch.replaceWith')}\r\n\t\t\t\t\tonBeforeChange={handleReplaceWithChange}\r\n\t\t\t\t\toptions={{extraKeys: ignoreTab, mode: 'text'}}\r\n\t\t\t\t\tvalue={replace}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"search-flags\">\r\n\t\t\t\t<CheckboxButton\r\n\t\t\t\t\tlabel={t('dialogs.storySearch.includePassageNames')}\r\n\t\t\t\t\tonChange={() => toggleFlag('includePassageNames')}\r\n\t\t\t\t\tvalue={flags.includePassageNames ?? false}\r\n\t\t\t\t/>\r\n\t\t\t\t<CheckboxButton\r\n\t\t\t\t\tlabel={t('dialogs.storySearch.matchCase')}\r\n\t\t\t\t\tonChange={() => toggleFlag('matchCase')}\r\n\t\t\t\t\tvalue={flags.matchCase ?? false}\r\n\t\t\t\t/>\r\n\t\t\t\t<CheckboxButton\r\n\t\t\t\t\tlabel={t('dialogs.storySearch.useRegexes')}\r\n\t\t\t\t\tonChange={() => toggleFlag('useRegexes')}\r\n\t\t\t\t\tvalue={flags.useRegexes ?? false}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"search-results\">\r\n\t\t\t\t<IconButton\r\n\t\t\t\t\tdisabled={matches.length === 0}\r\n\t\t\t\t\ticon={<IconReplace />}\r\n\t\t\t\t\tlabel={t('dialogs.storySearch.replaceAll')}\r\n\t\t\t\t\tonClick={handleReplace}\r\n\t\t\t\t\tvariant=\"danger\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span>\r\n\t\t\t\t\t{find &&\r\n\t\t\t\t\t\t(matches.length > 0\r\n\t\t\t\t\t\t\t? t('dialogs.storySearch.matchCount', {count: matches.length})\r\n\t\t\t\t\t\t\t: t('dialogs.storySearch.noMatches'))}\r\n\t\t\t\t</span>\r\n\t\t\t</div>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IndentButtons, UndoRedoButtons} from '../components/codemirror';\r\nimport {ButtonBar} from '../components/container/button-bar';\r\nimport {DialogCard, DialogEditor} from '../components/container/dialog-card';\r\nimport {CodeArea} from '../components/control/code-area';\r\nimport {usePrefsContext} from '../store/prefs';\r\nimport {storyWithId, updateStory, useStoriesContext} from '../store/stories';\r\nimport {codeMirrorOptionsFromPrefs} from '../util/codemirror-options';\r\nimport {DialogComponentProps} from './dialogs.types';\r\nimport './story-stylesheet.css';\r\n\r\nexport interface StoryStylesheetDialogProps extends DialogComponentProps {\r\n\tstoryId: string;\r\n}\r\n\r\nexport const StoryStylesheetDialog: React.FC<StoryStylesheetDialogProps> = props => {\r\n\tconst {storyId, ...other} = props;\r\n\tconst [cmEditor, setCmEditor] = React.useState<CodeMirror.Editor>();\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst handleChange = (\r\n\t\teditor: CodeMirror.Editor,\r\n\t\tdata: CodeMirror.EditorChange,\r\n\t\ttext: string\r\n\t) => {\r\n\t\tsetCmEditor(editor);\r\n\t\tdispatch(updateStory(stories, story, {stylesheet: text}));\r\n\t};\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...other}\r\n\t\t\tclassName=\"story-stylesheet-dialog\"\r\n\t\t\theaderLabel={t('dialogs.storyStylesheet.title')}\r\n\t\t\tmaximizable\r\n\t\t>\r\n\t\t\t<ButtonBar>\r\n\t\t\t\t<UndoRedoButtons editor={cmEditor} watch={story.script} />\r\n\t\t\t\t<IndentButtons editor={cmEditor} />\r\n\t\t\t</ButtonBar>\r\n\t\t\t<DialogEditor>\r\n\t\t\t\t<CodeArea\r\n\t\t\t\t\teditorDidMount={setCmEditor}\r\n\t\t\t\t\tfontFamily={prefs.codeEditorFontFamily}\r\n\t\t\t\t\tfontScale={prefs.codeEditorFontScale}\r\n\t\t\t\t\tlabel={t('dialogs.storyStylesheet.editorLabel')}\r\n\t\t\t\t\tlabelHidden\r\n\t\t\t\t\tonBeforeChange={handleChange}\r\n\t\t\t\t\toptions={{\r\n\t\t\t\t\t\t...codeMirrorOptionsFromPrefs(prefs),\r\n\t\t\t\t\t\tautofocus: true,\r\n\t\t\t\t\t\tlineWrapping: true,\r\n\t\t\t\t\t\tmode: 'css',\r\n\t\t\t\t\t\tplaceholder: t('dialogs.storyStylesheet.explanation')\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tvalue={story.stylesheet}\r\n\t\t\t\t/>\r\n\t\t\t</DialogEditor>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {DialogCard} from '../components/container/dialog-card';\r\nimport {CardContent} from '../components/container/card';\r\nimport {DialogComponentProps} from './dialogs.types';\r\nimport {renameStoryTag, storyTags} from '../store/stories';\r\nimport {setPref, usePrefsContext} from '../store/prefs';\r\nimport {useUndoableStoriesContext} from '../store/undoable-stories';\r\nimport {Color} from '../util/color';\r\nimport {TagEditor} from '../components/tag/tag-editor';\r\n\r\nexport type StoryTagsDialogProps = DialogComponentProps;\r\n\r\nexport const StoryTagsDialog: React.FC<StoryTagsDialogProps> = props => {\r\n\tconst {dispatch: storiesDispatch, stories} = useUndoableStoriesContext();\r\n\tconst {dispatch: prefsDispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst tags = storyTags(stories);\r\n\r\n\tfunction handleChangeColor(tagName: string, color: Color) {\r\n\t\tprefsDispatch(\r\n\t\t\tsetPref('storyTagColors', {...prefs.storyTagColors, [tagName]: color})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction handleChangeTagName(tagName: string, newName: string) {\r\n\t\tstoriesDispatch(renameStoryTag(stories, tagName, newName));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\tclassName=\"story-tags-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.storyTags.title')}\r\n\t\t\t{...props}\r\n\t\t>\r\n\t\t\t<CardContent>\r\n\t\t\t\t{tags.length > 0 ? (\r\n\t\t\t\t\ttags.map(tag => (\r\n\t\t\t\t\t\t<TagEditor\r\n\t\t\t\t\t\t\tallTags={tags}\r\n\t\t\t\t\t\t\tcolor={prefs.storyTagColors[tag]}\r\n\t\t\t\t\t\t\tkey={tag}\r\n\t\t\t\t\t\t\tname={tag}\r\n\t\t\t\t\t\t\tonChangeColor={color => handleChangeColor(tag, color)}\r\n\t\t\t\t\t\t\tonChangeName={newName => handleChangeTagName(tag, newName)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<p>{t('dialogs.storyTags.noTags')}</p>\r\n\t\t\t\t)}\r\n\t\t\t</CardContent>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {\r\n\tCreatePassagesAction,\r\n\tPassage,\r\n\tStoriesState,\r\n\tStory\r\n} from '../stories.types';\r\nimport {passageDefaults} from '../defaults';\r\nimport {rectsIntersect} from '../../../util/geometry';\r\nimport {parseLinks} from '../../../util/parse-links';\r\n\r\n/**\r\n * Creates newly linked passages from a passage. You shouldn't need to call this\r\n * directly--it will be invoked automatically by updatePassage() if you change\r\n * the passage text.\r\n */\r\nexport function createNewlyLinkedPassages(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\tnewText: string,\r\n\toldText: string\r\n): Thunk<StoriesState, CreatePassagesAction> {\r\n\tif (!story.passages.some(p => p.id === passage.id)) {\r\n\t\tthrow new Error('This passage does not belong to this story.');\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\tconst oldLinks = parseLinks(oldText);\r\n\t\tconst toCreate = parseLinks(newText).filter(\r\n\t\t\tl => !oldLinks.includes(l) && !story.passages.some(p => p.name === l)\r\n\t\t);\r\n\r\n\t\tif (toCreate.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst passageDefs = passageDefaults();\r\n\t\tconst passageGap = 25;\r\n\r\n\t\tlet top = passage.top + passage.height + passageGap;\r\n\t\tconst newPassagesWidth =\r\n\t\t\ttoCreate.length * passageDefs.width + (toCreate.length - 1) * passageGap;\r\n\r\n\t\t// Horizontally center the passages.\r\n\r\n\t\tlet left = passage.left + (passage.width - newPassagesWidth) / 2;\r\n\r\n\t\t// Move them to avoid overlaps.\r\n\r\n\t\tconst needsMoving = () =>\r\n\t\t\tstory.passages.some(passage =>\r\n\t\t\t\trectsIntersect(passage, {\r\n\t\t\t\t\tleft,\r\n\t\t\t\t\ttop,\r\n\t\t\t\t\theight: passageDefs.height,\r\n\t\t\t\t\twidth: newPassagesWidth\r\n\t\t\t\t})\r\n\t\t\t);\r\n\r\n\t\twhile (needsMoving()) {\r\n\t\t\t// Try rightward.\r\n\r\n\t\t\tleft += passageDefs.width + passageGap;\r\n\r\n\t\t\tif (!needsMoving()) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Try leftward.\r\n\r\n\t\t\tleft -= 2 * (passageDefs.width + passageGap);\r\n\r\n\t\t\tif (!needsMoving()) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Move downward and try again.\r\n\r\n\t\t\tleft += passageDefs.width + passageGap;\r\n\t\t\ttop += passageDefs.height + passageGap;\r\n\t\t}\r\n\r\n\t\t// Actually create them.\r\n\r\n\t\tdispatch({\r\n\t\t\ttype: 'createPassages',\r\n\t\t\tstoryId: story.id,\r\n\t\t\tprops: toCreate.map(name => {\r\n\t\t\t\tconst result = {left, name, top};\r\n\r\n\t\t\t\tleft += passageDefs.width + passageGap;\r\n\t\t\t\treturn result;\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport uuid from 'tiny-uuid';\r\nimport {PrefsState} from '../../prefs';\r\nimport {StoriesAction, StoriesState, Story} from '../stories.types';\r\n\r\n/**\r\n * Creates a new story with the default story format.\r\n */\r\nexport function createStory(\r\n\tstories: Story[],\r\n\tprefs: PrefsState,\r\n\tprops: Partial<Omit<Story, 'id'>> & Pick<Story, 'name'>\r\n): Thunk<StoriesState, StoriesAction> {\r\n\tconst id = uuid();\r\n\r\n\tif (props.name.trim() === '') {\r\n\t\tthrow new Error('Story name cannot be empty');\r\n\t}\r\n\r\n\tif (\r\n\t\tstories.some(story => story.name.toLowerCase() === props.name.toLowerCase())\r\n\t) {\r\n\t\tthrow new Error(`There is already a story named \"${props.name}\"`);\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\tdispatch({\r\n\t\t\ttype: 'createStory',\r\n\t\t\tprops: {\r\n\t\t\t\tid,\r\n\t\t\t\tstoryFormat: prefs.storyFormat.name,\r\n\t\t\t\tstoryFormatVersion: prefs.storyFormat.version,\r\n\t\t\t\t...props\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn id;\r\n\t};\r\n}\r\n","import {passageDefaults} from '../defaults';\r\nimport {CreatePassageAction, Story} from '../stories.types';\r\nimport {rectsIntersect} from '../../../util/geometry';\r\nimport {unusedName} from '../../../util/unused-name';\r\n\r\n/**\r\n * Creates a new, untitled passage centered at a point in the story. This\r\n * automatically increments a number at the end of the passage name to ensure\r\n * it's unique.\r\n */\r\nexport function createUntitledPassage(\r\n\tstory: Story,\r\n\tcenterX: number,\r\n\tcenterY: number\r\n): CreatePassageAction {\r\n\tif (!Number.isFinite(centerX) || !Number.isFinite(centerY)) {\r\n\t\tthrow new Error('Center must be a finite coordinate pair');\r\n\t}\r\n\r\n\tconst defs = passageDefaults();\r\n\tconst passageName = unusedName(\r\n\t\tdefs.name,\r\n\t\tstory.passages.map(passage => passage.name)\r\n\t);\r\n\r\n\t// Center it at the position requested, but move it outward until no overlaps are found.\r\n\r\n\tconst passageGap = 25;\r\n\tconst bounds = {\r\n\t\theight: defs.height,\r\n\t\tleft: Math.max(centerX - defs.width / 2, 0),\r\n\t\ttop: Math.max(centerY - defs.height / 2, 0),\r\n\t\twidth: defs.width\r\n\t};\r\n\r\n\tif (story.snapToGrid) {\r\n\t\tbounds.left = Math.round(bounds.left / passageGap) * passageGap;\r\n\t\tbounds.top = Math.round(bounds.top / passageGap) * passageGap;\r\n\t}\r\n\r\n\tconst needsMoving = () =>\r\n\t\tstory.passages.some(passage => rectsIntersect(passage, bounds));\r\n\r\n\twhile (needsMoving()) {\r\n\t\t// Try rightward.\r\n\r\n\t\tbounds.left += bounds.width + passageGap;\r\n\r\n\t\tif (!needsMoving()) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Try downward.\r\n\r\n\t\tbounds.left -= bounds.width + passageGap;\r\n\t\tbounds.top += bounds.height + passageGap;\r\n\r\n\t\tif (!needsMoving()) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Try leftward.\r\n\r\n\t\tif (bounds.left >= bounds.width + passageGap) {\r\n\t\t\tbounds.left -= bounds.width + passageGap;\r\n\r\n\t\t\tif (!needsMoving()) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tbounds.left += bounds.width + passageGap;\r\n\t\t}\r\n\r\n\t\t// Move downward permanently and repeat.\r\n\r\n\t\tbounds.top += bounds.height + passageGap;\r\n\t}\r\n\r\n\treturn {\r\n\t\ttype: 'createPassage',\r\n\t\tstoryId: story.id,\r\n\t\tprops: {\r\n\t\t\t...bounds,\r\n\t\t\tstory: story.id,\r\n\t\t\tname: passageName\r\n\t\t}\r\n\t};\r\n}\r\n","import {\r\n\tPassage,\r\n\tStory,\r\n\tDeletePassageAction,\r\n\tDeletePassagesAction\r\n} from '../stories.types';\r\n\r\n/**\r\n * Deletes a passage.\r\n */\r\nexport function deletePassage(\r\n\tstory: Story,\r\n\tpassage: Passage\r\n): DeletePassageAction {\r\n\tif (!story.passages.some(p => p.id === passage.id)) {\r\n\t\tthrow new Error('This passage does not belong to this story.');\r\n\t}\r\n\r\n\treturn {type: 'deletePassage', storyId: story.id, passageId: passage.id};\r\n}\r\n\r\n/**\r\n * Deletes multiple passages.\r\n */\r\nexport function deletePassages(\r\n\tstory: Story,\r\n\tpassages: Passage[]\r\n): DeletePassagesAction {\r\n\treturn {\r\n\t\ttype: 'deletePassages',\r\n\t\tstoryId: story.id,\r\n\t\tpassageIds: passages.map(passage => passage.id)\r\n\t};\r\n}\r\n","import {StoriesAction, Story} from '../stories.types';\r\n\r\nexport function deleteStory(story: Story): StoriesAction {\r\n\treturn {type: 'deleteStory', storyId: story.id};\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {CreateStoryAction, Story} from '../stories.types';\r\nimport {unusedName} from '../../../util/unused-name';\r\n\r\n/**\r\n * Creates a duplicate of an existing story.\r\n */\r\nexport function duplicateStory(\r\n\tstory: Story,\r\n\tstories: Story[]\r\n): CreateStoryAction {\r\n\treturn {\r\n\t\ttype: 'createStory',\r\n\t\tprops: {\r\n\t\t\t...story,\r\n\t\t\tid: uuid(),\r\n\t\t\tifid: uuid(),\r\n\t\t\tname: unusedName(\r\n\t\t\t\tstory.name,\r\n\t\t\t\tstories.map(story => story.name)\r\n\t\t\t)\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {parseLinks} from '../../../util/parse-links';\r\nimport {passageIsEmpty} from '../../../util/passage-is-empty';\r\nimport {\r\n\tDeletePassagesAction,\r\n\tPassage,\r\n\tStoriesState,\r\n\tStory\r\n} from '../stories.types';\r\n\r\n/**\r\n * Deletes empty, orphaned passages from a story after passage text changes. An orphan\r\n * must meet all these criteria:\r\n *\r\n * - It is considered empty (see util/passage-is-empty.ts)\r\n * - It is not the story start\r\n * - It was linked previously from the passage, but is not anymore\r\n * - It is only linked to from the passage whose text is changing\r\n *\r\n * The intent is to delete passages that were automatically created in the past,\r\n * but the user has removed the link through editing without ever editing the\r\n * passage.\r\n */\r\nexport function deleteOrphanedPassages(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\tnewText: string,\r\n\toldText: string\r\n): Thunk<StoriesState, DeletePassagesAction> {\r\n\tif (!story.passages.some(p => p.id === passage.id)) {\r\n\t\tthrow new Error('This passage does not belong to this story.');\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\tconst oldLinks = parseLinks(oldText);\r\n\t\tconst newLinks = parseLinks(newText);\r\n\t\tconst orphans = oldLinks.filter(link => !newLinks.includes(link));\r\n\r\n\t\tconst passageIds = orphans.reduce<string[]>((result, orphan) => {\r\n\t\t\tconst orphanPassage = story.passages.find(p => p.name === orphan);\r\n\r\n\t\t\t// These tests are fast because they look at the passage object only.\r\n\r\n\t\t\tif (\r\n\t\t\t\t!orphanPassage ||\r\n\t\t\t\t!passageIsEmpty(orphanPassage) ||\r\n\t\t\t\tstory.startPassage === orphanPassage.id\r\n\t\t\t) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\t// This is O(n) potentially.\r\n\r\n\t\t\tif (\r\n\t\t\t\tstory.passages.some(\r\n\t\t\t\t\tp => p.id !== passage.id && parseLinks(p.text).includes(orphan)\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\treturn [...result, orphanPassage.id];\r\n\t\t}, []);\r\n\r\n\t\tif (passageIds.length > 0) {\r\n\t\t\tdispatch({type: 'deletePassages', passageIds, storyId: story.id});\r\n\t\t}\r\n\t};\r\n}\r\n","import {Passage} from '../store/stories';\r\n\r\n/**\r\n * Returns whether a passage is considered empty, e.g. whether the user has put\r\n * any content into it.\r\n */\r\nexport function passageIsEmpty(passage: Passage) {\r\n\treturn (\r\n\t\tpassage.text === '' &&\r\n\t\tpassage.tags.length === 0 &&\r\n\t\tpassage.width === 100 &&\r\n\t\tpassage.height === 100\r\n\t);\r\n}\r\n","import escapeRegExp from 'lodash/escapeRegExp';\r\nimport {Thunk} from 'react-hook-thunk-reducer';\r\nimport {storyWithId} from '../getters';\r\nimport {Passage, StoriesAction, StoriesState, Story} from '../stories.types';\r\nimport {createNewlyLinkedPassages} from './create-newly-linked-passages';\r\nimport {deleteOrphanedPassages} from './delete-orphaned-passages';\r\n\r\nexport interface UpdatePassageOptions {\r\n\tdontUpdateOthers?: boolean;\r\n}\r\n\r\n/**\r\n * General update of a passage.\r\n */\r\nexport function updatePassage(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\tprops: Partial<Passage>,\r\n\toptions: UpdatePassageOptions = {}\r\n): Thunk<StoriesState, StoriesAction> {\r\n\tif (!story.passages.some(p => p.id === passage.id)) {\r\n\t\tthrow new Error('This passage does not belong to this story.');\r\n\t}\r\n\r\n\tif (\r\n\t\t'name' in props &&\r\n\t\tstory.passages\r\n\t\t\t.filter(p => p.name === props.name)\r\n\t\t\t.some(p => p.id !== passage.id)\r\n\t) {\r\n\t\tthrow new Error(`There is already a passage named \"${props.name}\".`);\r\n\t}\r\n\r\n\treturn (dispatch, getState) => {\r\n\t\t// Do the passage update itself.\r\n\r\n\t\tconst oldName = passage.name;\r\n\t\tconst oldText = passage.text;\r\n\r\n\t\tdispatch({\r\n\t\t\tprops,\r\n\t\t\ttype: 'updatePassage',\r\n\t\t\tpassageId: passage.id,\r\n\t\t\tstoryId: story.id\r\n\t\t});\r\n\r\n\t\t// Side effects from changes.\r\n\r\n\t\tif (!options.dontUpdateOthers && props.text) {\r\n\t\t\tdispatch(deleteOrphanedPassages(story, passage, props.text, oldText));\r\n\r\n\t\t\t// We need to get an up-to-date version of the story so placement of new\r\n\t\t\t// passages is correct.\r\n\t\t\t//\r\n\t\t\t// still causes passage bounces sometimes :( this is because the placement\r\n\t\t\t// algorithm works differently based on the number of passages it sees.\r\n\t\t\t// will anyone care?? could there be a 'suggested positions'? how would we\r\n\t\t\t// communicate back and forth?\r\n\r\n\t\t\tconst updatedStory = storyWithId(getState(), story.id);\r\n\r\n\t\t\tdispatch(\r\n\t\t\t\tcreateNewlyLinkedPassages(updatedStory, passage, props.text, oldText)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (props.name) {\r\n\t\t\tconst oldNameEscaped = escapeRegExp(oldName);\r\n\r\n\t\t\t// We only need to escape $ stuff in the new name, because it will be the\r\n\t\t\t// second argument to replace(). This is a little mindbending, but the\r\n\t\t\t// purpose of this is to replace $ with $$.\r\n\r\n\t\t\tconst newNameEscaped = props.name.replace(/\\$/g, '$$$$');\r\n\r\n\t\t\tconst simpleLinkRegexp = new RegExp(\r\n\t\t\t\t'\\\\[\\\\[' + oldNameEscaped + '(\\\\]\\\\[.*?)?\\\\]\\\\]',\r\n\t\t\t\t'g'\r\n\t\t\t);\r\n\t\t\tconst compoundLinkRegexp = new RegExp(\r\n\t\t\t\t'\\\\[\\\\[(.*?)(\\\\||->)' + oldNameEscaped + '(\\\\]\\\\[.*?)?\\\\]\\\\]',\r\n\t\t\t\t'g'\r\n\t\t\t);\r\n\t\t\tconst reverseLinkRegexp = new RegExp(\r\n\t\t\t\t'\\\\[\\\\[' + oldNameEscaped + '(<-.*?)(\\\\]\\\\[.*?)?\\\\]\\\\]',\r\n\t\t\t\t'g'\r\n\t\t\t);\r\n\r\n\t\t\tstory.passages.forEach(relinkedPassage => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tsimpleLinkRegexp.test(relinkedPassage.text) ||\r\n\t\t\t\t\tcompoundLinkRegexp.test(relinkedPassage.text) ||\r\n\t\t\t\t\treverseLinkRegexp.test(relinkedPassage.text)\r\n\t\t\t\t) {\r\n\t\t\t\t\tlet newText = relinkedPassage.text;\r\n\r\n\t\t\t\t\tnewText = newText.replace(\r\n\t\t\t\t\t\tsimpleLinkRegexp,\r\n\t\t\t\t\t\t'[[' + newNameEscaped + '$1]]'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tnewText = newText.replace(\r\n\t\t\t\t\t\tcompoundLinkRegexp,\r\n\t\t\t\t\t\t'[[$1$2' + newNameEscaped + '$3]]'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tnewText = newText.replace(\r\n\t\t\t\t\t\treverseLinkRegexp,\r\n\t\t\t\t\t\t'[[' + newNameEscaped + '$1$2]]'\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tupdatePassage(\r\n\t\t\t\t\t\tstory,\r\n\t\t\t\t\t\trelinkedPassage,\r\n\t\t\t\t\t\t{text: newText},\r\n\t\t\t\t\t\toptions\r\n\t\t\t\t\t)(dispatch, getState);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {createRegExp, escapeRegExpReplace} from '../../../util/regexp';\r\nimport {updatePassage} from './update-passage';\r\nimport {\r\n\tPassage,\r\n\tStoriesAction,\r\n\tStoriesState,\r\n\tStory,\r\n\tStorySearchFlags\r\n} from '../stories.types';\r\n\r\n/**\r\n * Core logic for replacing text using flags.\r\n */\r\nfunction replaceText(source: string, searchFor: string, replaceWith: string, flags: StorySearchFlags) {\r\n\tconst {matchCase, useRegexes} = flags;\r\n\tconst matcher = createRegExp(searchFor, {matchCase, useRegexes});\r\n\tconst replacer = useRegexes\r\n\t? replaceWith\r\n\t: escapeRegExpReplace(replaceWith);\r\n\r\n\treturn source.replace(matcher, replacer);\r\n}\r\n\r\nexport function replaceInPassage(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\tsearchFor: string,\r\n\treplaceWith: string,\r\n\tflags: StorySearchFlags\r\n): Thunk<StoriesState, StoriesAction> {\r\n\treturn (dispatch, getState) => {\r\n\t\tif (searchFor === '') {\r\n\t\t\tthrow new Error(\"Can't replace an empty string\");\r\n\t\t}\r\n\r\n\t\tif (passage.story !== story.id) {\r\n\t\t\tthrow new Error('Passage does not belong to story');\r\n\t\t}\r\n\r\n\t\tconst {includePassageNames} = flags;\r\n\t\tconst props: Partial<Passage> = {};\r\n\r\n\t\tconst newText = replaceText(passage.text, searchFor, replaceWith, flags);\r\n\r\n\t\tif (newText !== passage.text) {\r\n\t\t\tprops.text = newText;\r\n\t\t}\r\n\r\n\t\tif (includePassageNames) {\r\n\t\t\tconst newName = replaceText(passage.name, searchFor, replaceWith, flags);\r\n\r\n\t\t\tif (newName !== passage.name) {\r\n\t\t\t\tprops.name = newName;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (Object.keys(props).length > 0) {\r\n\t\t\tupdatePassage(story, passage, props)(dispatch, getState);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport function replaceInStory(\r\n\tstory: Story,\r\n\tsearchFor: string,\r\n\treplaceWith: string,\r\n\tflags: StorySearchFlags\r\n): Thunk<StoriesState, StoriesAction> {\r\n\treturn (dispatch, getState) => {\r\n\t\tif (searchFor === '') {\r\n\t\t\tthrow new Error(\"Can't replace an empty string\");\r\n\t\t}\r\n\r\n\t\tif (flags.includePassageNames) {\r\n\t\t\t// Do replaces in passage names first, so that if a replace will change\r\n\t\t\t// both a link and a passage name, the updatePassage action will see that\r\n\t\t\t// the passage exists when the link is changed, and not create a new\r\n\t\t\t// passage that will conflict with the existing one.\r\n\t\t\t\r\n\t\t\tfor (const passage of story.passages) {\r\n\t\t\t\tconst name = replaceText(passage.name, searchFor, replaceWith, flags);\r\n\r\n\t\t\t\tif (name !== passage.name) {\r\n\t\t\t\t\tupdatePassage(story, passage, {name})(dispatch, getState);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (const passage of story.passages) {\r\n\t\t\t\tconst text = replaceText(passage.text, searchFor, replaceWith, flags);\r\n\r\n\t\t\t\tif (text !== passage.text) {\r\n\t\t\t\t\tupdatePassage(story, passage, {text})(dispatch, getState);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// We're only updating passage text, so we can do it the easy way.\r\n\r\n\t\t\tfor (const passage of story.passages) {\r\n\t\t\t\treplaceInPassage(\r\n\t\t\t\t\tstory,\r\n\t\t\t\t\tpassage,\r\n\t\t\t\t\tsearchFor,\r\n\t\t\t\t\treplaceWith,\r\n\t\t\t\t\tflags\r\n\t\t\t\t)(dispatch, getState);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {\r\n\tPassage,\r\n\tStoriesState,\r\n\tStory,\r\n\tStorySearchFlags,\r\n\tUpdatePassagesAction\r\n} from '../stories.types';\r\nimport {passagesMatchingSearch} from '../getters';\r\n\r\nexport function highlightPassagesMatchingSearch(\r\n\tstory: Story,\r\n\tsearch: string,\r\n\tflags: StorySearchFlags\r\n): Thunk<StoriesState, UpdatePassagesAction> {\r\n\treturn dispatch => {\r\n\t\tlet passageUpdates: Record<string, Partial<Passage>> = {};\r\n\r\n\t\tif (search === '') {\r\n\t\t\t// Remove all highlights.\r\n\t\t\tpassageUpdates = story.passages.reduce((result, passage) => {\r\n\t\t\t\tif (passage.highlighted) {\r\n\t\t\t\t\treturn {...result, [passage.id]: {highlighted: false}};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}, {});\r\n\t\t} else {\r\n\t\t\tconst matchIds = passagesMatchingSearch(\r\n\t\t\t\tstory.passages,\r\n\t\t\t\tsearch,\r\n\t\t\t\tflags\r\n\t\t\t).map(passage => passage.id);\r\n\r\n\t\t\tstory.passages.forEach(passage => {\r\n\t\t\t\tconst oldHighlighted = passage.highlighted;\r\n\t\t\t\tconst newHighlighted = matchIds.includes(passage.id);\r\n\r\n\t\t\t\tif (newHighlighted !== oldHighlighted) {\r\n\t\t\t\t\tpassageUpdates[passage.id] = {highlighted: newHighlighted};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Object.keys(passageUpdates).length > 0) {\r\n\t\t\tdispatch({\r\n\t\t\t\tpassageUpdates,\r\n\t\t\t\ttype: 'updatePassages',\r\n\t\t\t\tstoryId: story.id\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {\r\n\tCreateStoryAction,\r\n\tStoriesState,\r\n\tStory,\r\n\tUpdateStoryAction\r\n} from '../stories.types';\r\nimport {storyFileName} from '../../../electron/shared';\r\n\r\n/**\r\n * Imports stories, overwriting any stories with the same name.\r\n */\r\nexport function importStories(\r\n\ttoImport: Story[],\r\n\texistingStories: Story[]\r\n): Thunk<StoriesState, CreateStoryAction | UpdateStoryAction> {\r\n\ttoImport.forEach(importStory => {\r\n\t\tif (\r\n\t\t\ttoImport.some(\r\n\t\t\t\totherStory =>\r\n\t\t\t\t\totherStory !== importStory &&\r\n\t\t\t\t\tstoryFileName(otherStory) === storyFileName(importStory)\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`Stories to import cannot have the same name: \"${importStory.name}\"`\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn dispatch => {\r\n\t\ttoImport.forEach(importStory => {\r\n\t\t\t// Remove the temp ID that was assigned to the new story.\r\n\r\n\t\t\tconst props: Partial<Story> = {...importStory};\r\n\r\n\t\t\tdelete props.id;\r\n\r\n\t\t\tconst existingStory = existingStories.find(\r\n\t\t\t\ts => storyFileName(s) === storyFileName(importStory)\r\n\t\t\t);\r\n\r\n\t\t\t// Do an update so that if something goes awry, we won't have deleted the\r\n\t\t\t// story. We need to update passage props so that their parent story ID is\r\n\t\t\t// set properly.\r\n\r\n\t\t\tif (existingStory) {\r\n\t\t\t\tif (props.passages) {\r\n\t\t\t\t\tprops.passages = props.passages.map(passage => ({\r\n\t\t\t\t\t\t...passage,\r\n\t\t\t\t\t\tstory: existingStory.id\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdispatch({props, type: 'updateStory', storyId: existingStory.id});\r\n\t\t\t} else {\r\n\t\t\t\tdispatch({props, type: 'createStory'});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n}\r\n","import {Passage, Story, UpdatePassagesAction} from '../stories.types';\r\n\r\n/**\r\n * Moves passages by an offset, e.g. after dragging.\r\n */\r\nexport function movePassages(\r\n\tstory: Story,\r\n\tpassageIds: string[],\r\n\txChange: number,\r\n\tyChange: number\r\n): UpdatePassagesAction {\r\n\tconst passageUpdates: Record<string, Partial<Passage>> = {}; //record는 타입. 키가 Key이고 값이 Type\r\n\r\n\tif (!Number.isFinite(xChange) || !Number.isFinite(yChange)) {\r\n\t\tthrow new Error('Offset must be a finite number.');\r\n\t}\r\n\r\n\tpassageIds.forEach(passageId => {\r\n\t\tconst passage = story.passages.find(p => p.id === passageId);\r\n\r\n\t\tif (!passage) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`There is no passage in this story with ID \"${passageId}\".`\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet left = Math.max(passage.left + xChange, 0);\r\n\t\tlet top = Math.max(passage.top + yChange, 0);\r\n\r\n\t\t//큰 눈금 하나당 움직이도록 25 -> 100 으로 모두 바꿔줌.\r\n\t\tif (story.snapToGrid) {\r\n\t\t\tleft = Math.round(left / 100) * 100;\r\n\t\t\ttop = Math.round(top / 100) * 100;\r\n\t\t}\r\n\r\n\t\tpassageUpdates[passage.id] = {left, top}; //하지만 이새끼 뭔지 모름\r\n\t});\r\n\r\n\treturn {type: 'updatePassages', passageUpdates, storyId: story.id};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {\r\n\tPassage,\r\n\tStoriesState,\r\n\tStory,\r\n\tUpdatePassagesAction,\r\n\tUpdateStoryAction\r\n} from '../stories.types';\r\nimport {isValidTagName} from '../../../util/tag';\r\n\r\nexport function renamePassageTag(\r\n\tstory: Story,\r\n\toldName: string,\r\n\tnewName: string\r\n): Thunk<StoriesState, UpdatePassagesAction | UpdateStoryAction> {\r\n\tif (!isValidTagName(newName)) {\r\n\t\tthrow new Error(`\"${newName}\" is not a valid tag name.`);\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\t// Change tags in passages.\r\n\r\n\t\tconst passageUpdates: Record<string, Partial<Passage>> = {};\r\n\r\n\t\tstory.passages.forEach(passage => {\r\n\t\t\tif (passage.tags.includes(oldName)) {\r\n\t\t\t\tpassageUpdates[passage.id] = {\r\n\t\t\t\t\ttags: passage.tags.map(tag => (tag === oldName ? newName : tag))\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (Object.keys(passageUpdates).length > 0) {\r\n\t\t\tdispatch({type: 'updatePassages', passageUpdates, storyId: story.id});\r\n\r\n\t\t\t// Move the tag color to the new one.\r\n\r\n\t\t\tconst tagColors = {...story.tagColors};\r\n\r\n\t\t\tdelete tagColors[oldName];\r\n\t\t\ttagColors[newName] = story.tagColors[oldName];\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: 'updateStory',\r\n\t\t\t\tprops: {tagColors},\r\n\t\t\t\tstoryId: story.id\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {StoriesAction, StoriesState, Story} from '../stories.types';\r\nimport {isValidTagName} from '../../../util/tag';\r\n\r\nexport function renameStoryTag(\r\n\tstories: Story[],\r\n\toldName: string,\r\n\tnewName: string\r\n): Thunk<StoriesState, StoriesAction> {\r\n\tif (!isValidTagName(newName)) {\r\n\t\tthrow new Error(`\"${newName}\" is not a valid tag name.`);\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\tstories.forEach(story => {\r\n\t\t\tif (story.tags.includes(oldName)) {\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'updateStory',\r\n\t\t\t\t\tstoryId: story.id,\r\n\t\t\t\t\tprops: {\r\n\t\t\t\t\t\ttags: story.tags.map(tag => (tag === oldName ? newName : tag))\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {Rect, rectsIntersect} from '../../../util/geometry';\r\nimport {\r\n\tPassage,\r\n\tStoriesState,\r\n\tStory,\r\n\tUpdatePassageAction,\r\n\tUpdatePassagesAction\r\n} from '../stories.types';\r\n\r\n/**\r\n * Deselects all passages.\r\n */\r\nexport function deselectAllPassages(\r\n\tstory: Story\r\n): Thunk<StoriesState, UpdatePassagesAction> {\r\n\treturn dispatch => {\r\n\t\tconst passageUpdates: Record<string, Partial<Passage>> = {};\r\n\r\n\t\tstory.passages.forEach(passage => {\r\n\t\t\tif (passage.selected) {\r\n\t\t\t\tpassageUpdates[passage.id] = {selected: false};\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (Object.keys(passageUpdates).length > 0) {\r\n\t\t\tdispatch({\r\n\t\t\t\tpassageUpdates,\r\n\t\t\t\ttype: 'updatePassages',\r\n\t\t\t\tstoryId: story.id\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Deselects a single passage.\r\n */\r\nexport function deselectPassage(\r\n\tstory: Story,\r\n\tpassage: Passage\r\n): Thunk<StoriesState, UpdatePassageAction> {\r\n\tif (passage.story !== story.id) {\r\n\t\tthrow new Error('This passage does not belong to this story');\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\tif (passage.selected) {\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: 'updatePassage',\r\n\t\t\t\tpassageId: passage.id,\r\n\t\t\t\tprops: {selected: false},\r\n\t\t\t\tstoryId: story.id\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Selects all passages.\r\n */\r\nexport function selectAllPassages(\r\n\tstory: Story\r\n): Thunk<StoriesState, UpdatePassagesAction> {\r\n\treturn dispatch => {\r\n\t\tconst passageUpdates: Record<string, Partial<Passage>> = {};\r\n\r\n\t\tstory.passages.forEach(passage => {\r\n\t\t\tif (!passage.selected) {\r\n\t\t\t\tpassageUpdates[passage.id] = {selected: true};\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (Object.keys(passageUpdates).length > 0) {\r\n\t\t\tdispatch({\r\n\t\t\t\tpassageUpdates,\r\n\t\t\t\ttype: 'updatePassages',\r\n\t\t\t\tstoryId: story.id\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Selects a single passage.\r\n */\r\nexport function selectPassage(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\texclusive: boolean\r\n): Thunk<StoriesState, UpdatePassagesAction> {\r\n\tif (passage.story !== story.id) {\r\n\t\tthrow new Error('This passage does not belong to this story');\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\tconst passageUpdates: Record<string, Partial<Passage>> = {};\r\n\r\n\t\tif (!passage.selected) {\r\n\t\t\tpassageUpdates[passage.id] = {selected: true};\r\n\t\t}\r\n\r\n\t\tif (exclusive) {\r\n\t\t\tstory.passages.forEach(p => {\r\n\t\t\t\tif (p.id !== passage.id && p.selected) {\r\n\t\t\t\t\tpassageUpdates[p.id] = {selected: false};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (Object.keys(passageUpdates).length > 0) {\r\n\t\t\tdispatch({type: 'updatePassages', passageUpdates, storyId: story.id});\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport function selectPassagesInRect(\r\n\tstory: Story,\r\n\trect: Rect,\r\n\tignoreIds: string[] = []\r\n): Thunk<StoriesState, UpdatePassagesAction> {\r\n\treturn dispatch => {\r\n\t\tconst passageUpdates: Record<string, Partial<Passage>> = {};\r\n\r\n\t\tstory.passages.forEach(passage => {\r\n\t\t\tif (ignoreIds.find(r => r === passage.id)) {\r\n\t\t\t\t// We are ignoring this passage, e.g. this is an additive selection and it\r\n\t\t\t\t// was already selected.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst selected = rectsIntersect(rect, passage);\r\n\r\n\t\t\tif (passage.selected !== selected) {\r\n\t\t\t\tpassageUpdates[passage.id] = {selected};\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (Object.keys(passageUpdates).length > 0) {\r\n\t\t\tdispatch({type: 'updatePassages', passageUpdates, storyId: story.id});\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {StoriesState, Story, UpdateStoryAction} from '../stories.types';\r\n\r\n/**\r\n * Deselects a single story.\r\n */\r\nexport function deselectStory(\r\n\tstory: Story\r\n): Thunk<StoriesState, UpdateStoryAction> {\r\n\treturn (dispatch, getState) => {\r\n\t\tif (!story.selected) {\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: 'updateStory',\r\n\t\t\t\tstoryId: story.id,\r\n\t\t\t\tprops: {selected: false}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Deselects all stories.\r\n */\r\nexport function deselectAllStories(): Thunk<StoriesState, UpdateStoryAction> {\r\n\treturn (dispatch, getState) => {\r\n\t\tfor (const story of getState()) {\r\n\t\t\tif (story.selected) {\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'updateStory',\r\n\t\t\t\t\tstoryId: story.id,\r\n\t\t\t\t\tprops: {selected: false}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Selects a single story.\r\n */\r\nexport function selectStory(\r\n\tstory: Story,\r\n\texclusive: boolean\r\n): Thunk<StoriesState, UpdateStoryAction> {\r\n\treturn (dispatch, getState) => {\r\n\t\tif (!story.selected) {\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: 'updateStory',\r\n\t\t\t\tstoryId: story.id,\r\n\t\t\t\tprops: {selected: true}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (exclusive) {\r\n\t\t\tfor (const other of getState()) {\r\n\t\t\t\tif (other.id !== story.id && other.selected) {\r\n\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\ttype: 'updateStory',\r\n\t\t\t\t\t\tstoryId: other.id,\r\n\t\t\t\t\t\tprops: {selected: false}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {Color} from '../../../util/color';\r\nimport {isValidTagName} from '../../../util/tag';\r\nimport {StoriesState, Story, UpdateStoryAction} from '../stories.types';\r\n\r\nexport function setTagColor(\r\n\tstory: Story,\r\n\tname: string,\r\n\tcolor: Color\r\n): Thunk<StoriesState, UpdateStoryAction> {\r\n\tif (!isValidTagName(name)) {\r\n\t\tthrow new Error(`\"${name}\" is not a valid tag name.`);\r\n\t}\r\n\r\n\treturn dispatch => {\r\n\t\t// Special handling: if the color is set to none, just delete it.\r\n\r\n\t\tif (color === 'none') {\r\n\t\t\tif (name in story.tagColors) {\r\n\t\t\t\tconst tagColors = {...story.tagColors};\r\n\r\n\t\t\t\tdelete tagColors[name];\r\n\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'updateStory',\r\n\t\t\t\t\tprops: {tagColors},\r\n\t\t\t\t\tstoryId: story.id\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: 'updateStory',\r\n\t\t\t\tprops: {tagColors: {...story.tagColors, [name]: color}},\r\n\t\t\t\tstoryId: story.id\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n","import {Passage, Story, UpdatePassageAction} from '../stories.types';\r\nimport {isValidTagName} from '../../../util/tag';\r\n\r\n/**\r\n * Adds a tag to a passage.\r\n */\r\nexport function addPassageTag(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\ttagName: string\r\n): UpdatePassageAction {\r\n\tif (passage.story !== story.id) {\r\n\t\tthrow new Error('This passage does not belong to this story.');\r\n\t}\r\n\r\n\tif (!isValidTagName(tagName)) {\r\n\t\tthrow new Error(`\"${tagName}\" is not a valid tag name.`);\r\n\t}\r\n\r\n\tif (passage.tags.includes(tagName)) {\r\n\t\tthrow new Error(`This passage already has the tag \"${tagName}\".`);\r\n\t}\r\n\r\n\treturn {\r\n\t\ttype: 'updatePassage',\r\n\t\tpassageId: passage.id,\r\n\t\tstoryId: story.id,\r\n\t\tprops: {tags: [...passage.tags, tagName]}\r\n\t};\r\n}\r\n\r\n/**\r\n * Removes a tag from a passage.\r\n */\r\nexport function removePassageTag(\r\n\tstory: Story,\r\n\tpassage: Passage,\r\n\ttagName: string\r\n): UpdatePassageAction {\r\n\tif (passage.story !== story.id) {\r\n\t\tthrow new Error('This passage does not belong to this story.');\r\n\t}\r\n\r\n\tif (!isValidTagName(tagName)) {\r\n\t\tthrow new Error(`\"${tagName}\" is not a valid tag name.`);\r\n\t}\r\n\r\n\tif (!passage.tags.includes(tagName)) {\r\n\t\tthrow new Error(`This passage does not have the tag \"${tagName}\".`);\r\n\t}\r\n\r\n\treturn {\r\n\t\ttype: 'updatePassage',\r\n\t\tpassageId: passage.id,\r\n\t\tstoryId: story.id,\r\n\t\tprops: {tags: passage.tags.filter(t => t !== tagName)}\r\n\t};\r\n}\r\n","import {Story, UpdateStoryAction} from '../stories.types';\r\nimport {storyFileName} from '../../../electron/shared';\r\n\r\n/**\r\n * General update of a story.\r\n */\r\nexport function updateStory(\r\n\tstories: Story[],\r\n\tstory: Story,\r\n\tprops: Partial<Story>\r\n): UpdateStoryAction {\r\n\tif (\r\n\t\tprops.name &&\r\n\t\tstories\r\n\t\t\t.filter(s => storyFileName(s) === storyFileName({...s, ...props}))\r\n\t\t\t.some(s => s.id !== story.id)\r\n\t) {\r\n\t\tthrow new Error(`There is already a story named \"${props.name}\".`);\r\n\t}\r\n\r\n\treturn {\r\n\t\tprops,\r\n\t\tstoryId: story.id,\r\n\t\ttype: 'updateStory'\r\n\t};\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {passageDefaults} from '../defaults';\r\nimport {Passage, Story, StoriesState} from '../stories.types';\r\n\r\nexport function createPassage(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tpassageProps: Partial<Passage>\r\n) {\r\n\tlet storyExists = false;\r\n\tlet created = false;\r\n\tconst newState = state.map(story => {\r\n\t\tif (story.id !== storyId) {\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tstoryExists = true;\r\n\r\n\t\tif (story.passages.some(passage => passage.id === passageProps.id)) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`There is already a passage in this story with ID \"${passageProps.id}\", taking no action`\r\n\t\t\t);\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\t'name' in passageProps &&\r\n\t\t\tstory.passages.some(passage => passage.name === passageProps.name)\r\n\t\t) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`There is already a passage in this story with name \"${passageProps.name}\", taking no action`\r\n\t\t\t);\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tconst newPassage: Passage = {\r\n\t\t\t...passageDefaults(),\r\n\t\t\tid: uuid(),\r\n\t\t\t...passageProps,\r\n\t\t\tstory: story.id\r\n\t\t};\r\n\t\tconst newStory: Story = {\r\n\t\t\t...story,\r\n\t\t\tlastUpdate: new Date(),\r\n\t\t\tpassages: [...story.passages, newPassage]\r\n\t\t};\r\n\r\n\t\tif (newStory.passages.length === 1) {\r\n\t\t\tnewStory.startPassage = newPassage.id;\r\n\t\t}\r\n\r\n\t\tcreated = true;\r\n\t\treturn newStory;\r\n\t});\r\n\r\n\tif (!storyExists) {\r\n\t\tconsole.warn(`No story in state with ID \"${storyId}\", taking no action`);\r\n\t\treturn state;\r\n\t}\r\n\r\n\tif (!created) {\r\n\t\t// Should have warned above.\r\n\t\treturn state;\r\n\t}\r\n\r\n\treturn newState;\r\n}\r\n","import {StoriesState} from '../stories.types';\r\n\r\nexport function deletePassage(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tpassageId: string\r\n) {\r\n\tlet foundStory = false;\r\n\tlet deleted = false;\r\n\r\n\tconst newState = state.map(story => {\r\n\t\tif (story.id !== storyId) {\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tfoundStory = true;\r\n\r\n\t\tconst newStory = {\r\n\t\t\t...story,\r\n\t\t\tpassages: story.passages.filter(passage => {\r\n\t\t\t\tif (passage.id === passageId) {\r\n\t\t\t\t\tdeleted = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t})\r\n\t\t};\r\n\r\n\t\tif (deleted) {\r\n\t\t\tnewStory.lastUpdate = new Date();\r\n\t\t\treturn newStory;\r\n\t\t}\r\n\r\n\t\treturn story;\r\n\t});\r\n\r\n\tif (!foundStory) {\r\n\t\tconsole.warn(`No story in state with ID \"${storyId}\", taking no action`);\r\n\t\treturn state;\r\n\t}\r\n\r\n\tif (!deleted) {\r\n\t\tconsole.warn(\r\n\t\t\t`Asked to delete a passage with ID \"${passageId}\", but it does not exist in story ID ${storyId}, taking no action`\r\n\t\t);\r\n\t\treturn state;\r\n\t}\r\n\r\n\treturn newState;\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {passageDefaults} from '../../defaults';\r\nimport {Passage, Story} from '../../stories.types';\r\n\r\nfunction logRepair(\r\n\tpassage: Passage,\r\n\tpropName: keyof Passage,\r\n\trepairedValue: any,\r\n\tdetail?: string\r\n) {\r\n\tlet message =\r\n\t\t`Repairing passage (name: \"${passage.name}\", id: ${passage.id}): ` +\r\n\t\t`setting ${propName} to ${repairedValue}, was ${passage[propName]}`;\r\n\r\n\tif (detail) {\r\n\t\tmessage += ` (${detail})`;\r\n\t}\r\n\r\n\tconsole.info(message);\r\n}\r\n\r\nexport function repairPassage(passage: Passage, parentStory: Story): Passage {\r\n\tconst passageDefs = passageDefaults();\r\n\tconst repairs: Partial<Passage> = {};\r\n\r\n\t// Give the passage an ID if it has none.\r\n\r\n\tif (typeof passage.id !== 'string' || passage.id === '') {\r\n\t\tconst newId = uuid();\r\n\r\n\t\tlogRepair(passage, 'id', newId, 'was undefined or empty string');\r\n\t\trepairs.id = uuid();\r\n\t}\r\n\r\n\t// Apply default properties to the passage.\r\n\r\n\tObject.entries(passageDefs).forEach(([key, value]) => {\r\n\t\tconst defKey = key as keyof typeof passageDefs;\r\n\r\n\t\tif (\r\n\t\t\t(typeof value === 'number' && !Number.isFinite(passage[defKey])) ||\r\n\t\t\ttypeof value !== typeof passage[defKey]\r\n\t\t) {\r\n\t\t\tlogRepair(passage, defKey, passageDefs[defKey]);\r\n\t\t\t(repairs[defKey] as Passage[typeof defKey]) = passageDefs[defKey];\r\n\t\t}\r\n\t});\r\n\r\n\t// Make passage coordinates 0 or greater.\r\n\r\n\t['left', 'top'].forEach(pos => {\r\n\t\tconst posKey = pos as keyof Passage;\r\n\r\n\t\tif (passage[posKey] < 0) {\r\n\t\t\tlogRepair(passage, posKey, 0, 'was negative');\r\n\t\t\t(repairs[posKey] as Passage[typeof posKey]) = 0;\r\n\t\t}\r\n\t});\r\n\r\n\t// Make passage dimensions 5 or greater.\r\n\r\n\t['height', 'width'].forEach(dim => {\r\n\t\tconst dimKey = dim as keyof Passage;\r\n\r\n\t\tif (passage[dimKey] < 5) {\r\n\t\t\tlogRepair(passage, dimKey, 0, 'was less than 5');\r\n\t\t\t(repairs[dimKey] as Passage[typeof dimKey]) = 5;\r\n\t\t}\r\n\t});\r\n\r\n\t// Repair story property if it doesn't point to the parent story.\r\n\r\n\tif (passage.story !== parentStory.id) {\r\n\t\tlogRepair(passage, 'story', parentStory.id, \"didn't match parent story\");\r\n\t\trepairs.story = parentStory.id;\r\n\t}\r\n\r\n\t// Repair ID conflicts with any other passage in the story.\r\n\r\n\tif (\r\n\t\tparentStory.passages.some(otherPassage => {\r\n\t\t\tif (otherPassage === passage) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn otherPassage.id === passage.id;\r\n\t\t})\r\n\t) {\r\n\t\tconst newId = uuid();\r\n\r\n\t\tlogRepair(\r\n\t\t\tpassage,\r\n\t\t\t'id',\r\n\t\t\tnewId,\r\n\t\t\t'conflicted with another passage in the story'\r\n\t\t);\r\n\t\trepairs.id = newId;\r\n\t}\r\n\r\n\tif (Object.keys(repairs).length > 0) {\r\n\t\treturn {...passage, ...repairs};\r\n\t}\r\n\r\n\treturn passage;\r\n}\r\n","import {satisfies} from 'semver';\r\nimport uuid from 'tiny-uuid';\r\nimport {Story} from '../../stories.types';\r\nimport {storyDefaults} from '../../defaults';\r\nimport {StoryFormat} from '../../../story-formats';\r\nimport {repairPassage} from './repair-passage';\r\n\r\nfunction logRepair(\r\n\tstory: Story,\r\n\tpropName: keyof Story,\r\n\trepairedValue: any,\r\n\tdetail?: string\r\n) {\r\n\tlet message =\r\n\t\t`Repairing story (name: \"${story.name}\", id: ${story.id}) by ` +\r\n\t\t`setting ${propName} to ${repairedValue}, was ${story[propName]}`;\r\n\r\n\tif (detail) {\r\n\t\tmessage += ` (${detail})`;\r\n\t}\r\n\r\n\tconsole.info(message);\r\n}\r\n\r\nexport function repairStory(\r\n\tstory: Story,\r\n\tallStories: Story[],\r\n\tallFormats: StoryFormat[],\r\n\tdefaultFormat: StoryFormat\r\n): Story {\r\n\tconst storyDefs = storyDefaults();\r\n\tconst repairs: Partial<Story> = {};\r\n\r\n\t// Give the story an ID if it has none.\r\n\r\n\tif (typeof story.id !== 'string' || story.id === '') {\r\n\t\tconst newId = uuid();\r\n\r\n\t\tlogRepair(story, 'id', newId, 'was bad type or empty string');\r\n\t\trepairs.id = newId;\r\n\t}\r\n\r\n\t// Give the story an IFID if it has none.\r\n\r\n\tif (typeof story.ifid !== 'string' || story.id === '') {\r\n\t\tconst newIfid = uuid();\r\n\r\n\t\tlogRepair(story, 'ifid', newIfid, 'was bad type or empty string');\r\n\t\trepairs.ifid = newIfid;\r\n\t}\r\n\r\n\t// Apply default properties to the story.\r\n\r\n\tObject.entries(storyDefs).forEach(([key, value]) => {\r\n\t\tconst defKey = key as keyof typeof storyDefs;\r\n\r\n\t\tif (\r\n\t\t\t(typeof value === 'number' && !Number.isFinite(story[defKey])) ||\r\n\t\t\ttypeof value !== typeof story[defKey]\r\n\t\t) {\r\n\t\t\tlogRepair(story, defKey, storyDefs[defKey]);\r\n\t\t\t(repairs[defKey] as Story[typeof defKey]) = storyDefs[defKey];\r\n\t\t}\r\n\t});\r\n\r\n\tif (\r\n\t\ttypeof story.storyFormat !== 'string' ||\r\n\t\tstory.storyFormat === '' ||\r\n\t\ttypeof story.storyFormatVersion !== 'string' ||\r\n\t\tstory.storyFormatVersion === ''\r\n\t) {\r\n\t\t// Assign the story the default story format if it has none.\r\n\r\n\t\tlogRepair(\r\n\t\t\tstory,\r\n\t\t\t'storyFormat',\r\n\t\t\tdefaultFormat.name,\r\n\t\t\t'was bad type or unset'\r\n\t\t);\r\n\t\tlogRepair(\r\n\t\t\tstory,\r\n\t\t\t'storyFormatVersion',\r\n\t\t\tdefaultFormat.version,\r\n\t\t\t'was bad type or unset'\r\n\t\t);\r\n\t\trepairs.storyFormat = defaultFormat.name;\r\n\t\trepairs.storyFormatVersion = defaultFormat.version;\r\n\t} else if (\r\n\t\t!allFormats.some(\r\n\t\t\tformat =>\r\n\t\t\t\tformat.name === story.storyFormat &&\r\n\t\t\t\tformat.version === story.storyFormatVersion\r\n\t\t)\r\n\t) {\r\n\t\t// If the story has a nonexistent story format, try to match it to one that\r\n\t\t// does, using semver as a guide.\r\n\r\n\t\tconst repairFormat = allFormats.find(\r\n\t\t\tformat =>\r\n\t\t\t\tformat.name === story.storyFormat &&\r\n\t\t\t\tsatisfies(format.version, '^' + story.storyFormatVersion)\r\n\t\t);\r\n\r\n\t\tif (repairFormat) {\r\n\t\t\tlogRepair(\r\n\t\t\t\tstory,\r\n\t\t\t\t'storyFormat',\r\n\t\t\t\trepairFormat.name,\r\n\t\t\t\t'no match in existing formats but found one that satisfies semver'\r\n\t\t\t);\r\n\t\t\tlogRepair(\r\n\t\t\t\tstory,\r\n\t\t\t\t'storyFormatVersion',\r\n\t\t\t\trepairFormat.version,\r\n\t\t\t\t'no match in existing formats but found one that satisfies semver'\r\n\t\t\t);\r\n\t\t\trepairs.storyFormat = repairFormat.name;\r\n\t\t\trepairs.storyFormatVersion = repairFormat.version;\r\n\t\t} else {\r\n\t\t\tlogRepair(\r\n\t\t\t\tstory,\r\n\t\t\t\t'storyFormat',\r\n\t\t\t\tdefaultFormat.name,\r\n\t\t\t\t'no match in existing formats and could not find one that satisfies semver'\r\n\t\t\t);\r\n\t\t\tlogRepair(\r\n\t\t\t\tstory,\r\n\t\t\t\t'storyFormatVersion',\r\n\t\t\t\tdefaultFormat.version,\r\n\t\t\t\t'no match in existing formats and could not find one that satisfies semver'\r\n\t\t\t);\r\n\t\t\trepairs.storyFormat = defaultFormat.name;\r\n\t\t\trepairs.storyFormatVersion = defaultFormat.version;\r\n\t\t}\r\n\t}\r\n\r\n\t// Repair ID conflicts with other stories.\r\n\r\n\tif (\r\n\t\tallStories.some(otherStory => {\r\n\t\t\tif (otherStory === story) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn otherStory.id === story.id;\r\n\t\t})\r\n\t) {\r\n\t\tconst newId = uuid();\r\n\r\n\t\tlogRepair(story, 'id', newId, \"conflicted with another story's ID\");\r\n\t\trepairs.id = newId;\r\n\t}\r\n\r\n\t// Repair all passages. All story ID changes must be before this to prevent\r\n\t// mismatches. We merge in repairs temporarily here so that passages see the\r\n\t// most correct ID.\r\n\r\n\tlet anyPassageRepaired = false;\r\n\tconst repairedPassages = story.passages.map(passage => {\r\n\t\tconst repairedPassage = repairPassage(passage, {...story, ...repairs});\r\n\r\n\t\tif (repairedPassage !== passage) {\r\n\t\t\tanyPassageRepaired = true;\r\n\t\t\treturn repairedPassage;\r\n\t\t}\r\n\r\n\t\treturn passage;\r\n\t});\r\n\r\n\tif (anyPassageRepaired) {\r\n\t\trepairs.passages = repairedPassages;\r\n\t}\r\n\r\n\tif (Object.keys(repairs).length > 0) {\r\n\t\treturn {...story, ...repairs};\r\n\t}\r\n\r\n\treturn story;\r\n}\r\n","import {Passage, Story, StoriesState} from '../stories.types';\r\nimport {isPersistablePassageChange} from '../../persistence/persistable-changes';\r\n\r\nexport function updatePassage(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tpassageId: string,\r\n\tpassageProps: Omit<Partial<Passage>, 'id' | 'story'>\r\n) {\r\n\tlet storyExists = false;\r\n\tlet updated = false;\r\n\tconst newState = state.map(story => {\r\n\t\tif (story.id !== storyId) {\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tstoryExists = true;\r\n\r\n\t\tif (\r\n\t\t\t'name' in passageProps &&\r\n\t\t\tstory.passages.some(\r\n\t\t\t\tpassage =>\r\n\t\t\t\t\tpassage.name === passageProps.name && passage.id !== passageId\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`There is already a passage in this story with name \"${passageProps.name}\", taking no action`\r\n\t\t\t);\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tconst newStory: Story = {\r\n\t\t\t...story,\r\n\t\t\tpassages: story.passages.map(passage => {\r\n\t\t\t\tif (passage.id !== passageId) {\r\n\t\t\t\t\treturn passage;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tupdated = true;\r\n\t\t\t\treturn {...passage, ...passageProps};\r\n\t\t\t})\r\n\t\t};\r\n\r\n\t\tif (updated) {\r\n\t\t\tif (isPersistablePassageChange(passageProps)) {\r\n\t\t\t\tnewStory.lastUpdate = new Date();\r\n\t\t\t}\r\n\r\n\t\t\treturn newStory;\r\n\t\t}\r\n\r\n\t\tconsole.warn(\r\n\t\t\t`Asked to update a passage with ID \"${passageId}\", but it does not exist in story ID ${storyId}, taking no action`\r\n\t\t);\r\n\t\treturn story;\r\n\t});\r\n\r\n\tif (!storyExists) {\r\n\t\tconsole.warn(`No story in state with ID \"${storyId}\", taking no action`);\r\n\t\treturn state;\r\n\t}\r\n\r\n\tif (!updated) {\r\n\t\t// Should have warned above.\r\n\t\treturn state;\r\n\t}\r\n\r\n\treturn newState;\r\n}\r\n","import {createPassage} from './create-passage';\r\nimport {createPassages} from './create-passages';\r\nimport {createStory} from './create-story';\r\nimport {deletePassage} from './delete-passage';\r\nimport {deletePassages} from './delete-passages';\r\nimport {deleteStory} from './delete-story';\r\nimport {initState} from './init';\r\nimport {repairState} from './repair';\r\nimport {updatePassage} from './update-passage';\r\nimport {updatePassages} from './update-passages';\r\nimport {updateStory} from './update-story';\r\nimport {StoriesAction, StoriesState} from '../stories.types';\r\n\r\nexport const reducer: React.Reducer<StoriesState, StoriesAction> = (\r\n\tstate,\r\n\taction\r\n) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'createPassage':\r\n\t\t\treturn createPassage(state, action.storyId, action.props);\r\n\r\n\t\tcase 'createPassages':\r\n\t\t\treturn createPassages(state, action.storyId, action.props);\r\n\r\n\t\tcase 'createStory':\r\n\t\t\treturn createStory(state, action.props);\r\n\r\n\t\tcase 'deletePassage':\r\n\t\t\treturn deletePassage(state, action.storyId, action.passageId);\r\n\r\n\t\tcase 'deletePassages':\r\n\t\t\treturn deletePassages(state, action.storyId, action.passageIds);\r\n\r\n\t\tcase 'deleteStory':\r\n\t\t\treturn deleteStory(state, action.storyId);\r\n\r\n\t\tcase 'init':\r\n\t\t\treturn initState(state, action.state);\r\n\r\n\t\tcase 'repair':\r\n\t\t\treturn repairState(state, action.allFormats, action.defaultFormat);\r\n\r\n\t\tcase 'updatePassage':\r\n\t\t\treturn updatePassage(\r\n\t\t\t\tstate,\r\n\t\t\t\taction.storyId,\r\n\t\t\t\taction.passageId,\r\n\t\t\t\taction.props\r\n\t\t\t);\r\n\r\n\t\tcase 'updatePassages':\r\n\t\t\treturn updatePassages(state, action.storyId, action.passageUpdates);\r\n\r\n\t\tcase 'updateStory':\r\n\t\t\treturn updateStory(state, action.storyId, action.props);\r\n\r\n\t\tdefault:\r\n\t\t\tconsole.warn(`${(action as any).type} not implemented yet`);\r\n\t}\r\n\r\n\treturn state;\r\n};\r\n","import {Passage, StoriesState} from '../stories.types';\r\nimport {createPassage} from './create-passage';\r\n\r\nexport function createPassages(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tpassageProps: Partial<Passage>[]\r\n) {\r\n\treturn passageProps.reduce(\r\n\t\t(state, props) => createPassage(state, storyId, props),\r\n\t\tstate\r\n\t);\r\n}\r\n","import uuid from 'tiny-uuid';\r\nimport {passageDefaults, storyDefaults} from '../defaults';\r\nimport {Story, StoriesState} from '../stories.types';\r\n\r\nexport function createStory(state: StoriesState, storyProps: Partial<Story>) {\r\n\tif ('id' in storyProps && state.some(story => story.id === storyProps.id)) {\r\n\t\tconsole.warn(\r\n\t\t\t`There is already a story in state with ID \"${storyProps.id}\", taking no action`\r\n\t\t);\r\n\t\treturn state;\r\n\t}\r\n\r\n\tif (\r\n\t\t'name' in storyProps &&\r\n\t\tstate.some(story => story.name === storyProps.name)\r\n\t) {\r\n\t\tconsole.warn(\r\n\t\t\t`There is already a story in state with name \"${storyProps.name}\", taking no action`\r\n\t\t);\r\n\t\treturn state;\r\n\t}\r\n\r\n\tlet story: Story = {\r\n\t\tid: uuid(),\r\n\t\t...storyDefaults(),\r\n\t\tifid: uuid().toUpperCase(),\r\n\t\tlastUpdate: new Date(),\r\n\t\tpassages: [],\r\n\t\ttags: [],\r\n\t\ttagColors: {},\r\n\t\t...storyProps\r\n\t};\r\n\r\n\t// If we are prepopulating the story with passages, make sure they have the\r\n\t// correct ID linkage, and at least make sure basic properties are set.\r\n\r\n\tstory.passages = story.passages.map(passage => ({\r\n\t\t...passageDefaults,\r\n\t\t...passage,\r\n\t\tstory: story.id\r\n\t}));\r\n\r\n\treturn [...state, story];\r\n}\r\n","import {StoriesState} from '../stories.types';\r\nimport {deletePassage} from './delete-passage';\r\n\r\nexport function deletePassages(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tpassageIds: string[]\r\n) {\r\n\treturn passageIds.reduce(\r\n\t\t(state, passageId) => deletePassage(state, storyId, passageId),\r\n\t\tstate\r\n\t);\r\n}\r\n","import {StoriesState} from '../stories.types';\r\n\r\nexport function deleteStory(state: StoriesState, storyId: string) {\r\n\tlet deleted = false;\r\n\tconst newState = state.filter(story => {\r\n\t\tif (story.id === storyId) {\r\n\t\t\tdeleted = true;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\tif (!deleted) {\r\n\t\tconsole.warn(\r\n\t\t\t`Asked to delete a story with ID \"${storyId}\", but it does not exist in state`\r\n\t\t);\r\n\t\treturn state;\r\n\t}\r\n\r\n\treturn newState;\r\n}\r\n","import {Story, StoriesState} from '../stories.types';\r\n\r\nexport function initState(state: StoriesState, init: Story[]) {\r\n\treturn [...init];\r\n}\r\n","import {repairStory} from './repair-story';\r\nimport {StoryFormat} from '../../../story-formats';\r\nimport {StoriesState} from '../../stories.types';\r\n\r\nexport function repairState(\r\n\tstate: StoriesState,\r\n\tallFormats: StoryFormat[],\r\n\tdefaultFormat: StoryFormat\r\n): StoriesState {\r\n\treturn state.map(story =>\r\n\t\trepairStory(story, state, allFormats, defaultFormat)\r\n\t);\r\n}\r\n","import {Passage, StoriesState} from '../stories.types';\r\nimport {updatePassage} from './update-passage';\r\n\r\nexport function updatePassages(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tpassageUpdates: Record<string, Partial<Passage>>\r\n) {\r\n\treturn Object.keys(passageUpdates).reduce(\r\n\t\t(state, passageId) =>\r\n\t\t\tupdatePassage(state, storyId, passageId, passageUpdates[passageId]),\r\n\t\tstate\r\n\t);\r\n}\r\n","import {Story, StoriesState} from '../stories.types';\r\nimport {isPersistableStoryChange} from '../../persistence/persistable-changes';\r\n\r\nexport function updateStory(\r\n\tstate: StoriesState,\r\n\tstoryId: string,\r\n\tstoryProps: Partial<Omit<Story, 'id'>>\r\n) {\r\n\tif (\r\n\t\t'name' in storyProps &&\r\n\t\tstate.some(story => story.name === storyProps.name && story.id !== storyId)\r\n\t) {\r\n\t\tconsole.warn(\r\n\t\t\t`There is another story in state with name \"${storyProps.name}\", taking no action`\r\n\t\t);\r\n\t\treturn state;\r\n\t}\r\n\r\n\tlet updated = false;\r\n\tconst newState = state.map(story => {\r\n\t\tif (story.id !== storyId) {\r\n\t\t\treturn story;\r\n\t\t}\r\n\r\n\t\tupdated = true;\r\n\r\n\t\tconst updatedStory = {...story, ...storyProps};\r\n\r\n\t\tif (isPersistableStoryChange(storyProps)) {\r\n\t\t\tupdatedStory.lastUpdate = new Date();\r\n\t\t}\r\n\r\n\t\treturn updatedStory;\r\n\t});\r\n\r\n\tif (!updated) {\r\n\t\tconsole.warn(\r\n\t\t\t`Asked to update a story with ID \"${storyId}\", but it does not exist in state`\r\n\t\t);\r\n\t\treturn state;\r\n\t}\r\n\r\n\treturn newState;\r\n}\r\n","import * as React from 'react';\r\nimport useThunkReducer from 'react-hook-thunk-reducer';\r\nimport {usePersistence} from '../persistence/use-persistence';\r\nimport {reducer} from './reducer';\r\nimport {\r\n\tStoriesContextProps,\r\n\tStoriesAction,\r\n\tStoriesState\r\n} from './stories.types';\r\nimport {useStoryFormatsContext} from '../story-formats';\r\nimport {useStoreErrorReporter} from '../use-store-error-reporter';\r\n\r\nexport const StoriesContext = React.createContext<StoriesContextProps>({\r\n\tdispatch: () => {},\r\n\tstories: []\r\n});\r\n\r\nStoriesContext.displayName = 'Stories';\r\n\r\nexport const useStoriesContext = () => React.useContext(StoriesContext);\r\n\r\nexport const StoriesContextProvider: React.FC = props => {\r\n\t//스토리 관련 변수인가? 이 값을 반환하는 함수인가?\r\n\tconst {stories: storiesPersistence} = usePersistence();\r\n\r\n\t//스토리 포멘 관련 변수인가? 이 값을 반환하는 함수인가?\r\n\tconst {formats} = useStoryFormatsContext();\r\n\r\n\tconst {reportError} = useStoreErrorReporter();\r\n\tconst persistedReducer: React.Reducer<\r\n\t\tStoriesState,\r\n\t\tStoriesAction\r\n\t> = React.useMemo(\r\n\t\t() => (state, action) => {\r\n\t\t\tconst newState = reducer(state, action);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tstoriesPersistence.saveMiddleware(newState, action, formats);\r\n\t\t\t} catch (error) {\r\n\t\t\t\treportError(error, 'store.errors.cantPersistStories');\r\n\t\t\t}\r\n\r\n\t\t\treturn newState;\r\n\t\t},\r\n\t\t[formats, reportError, storiesPersistence]\r\n\t);\r\n\tconst [stories, dispatch] = useThunkReducer(persistedReducer, []);\r\n\r\n\treturn (\r\n\t\t<StoriesContext.Provider value={{dispatch, stories}}>\r\n\t\t\t{props.children}\r\n\t\t</StoriesContext.Provider>\r\n\t);\r\n};\r\n","import {debounce} from 'lodash';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {DialogEditor} from '../../components/container/dialog-card';\r\nimport {CodeArea} from '../../components/control/code-area';\r\nimport {usePrefsContext} from '../../store/prefs';\r\nimport {Passage, Story} from '../../store/stories';\r\nimport {StoryFormat} from '../../store/story-formats';\r\nimport {useCodeMirrorPassageHints} from '../../store/use-codemirror-passage-hints';\r\nimport {useFormatCodeMirrorMode} from '../../store/use-format-codemirror-mode';\r\nimport {codeMirrorOptionsFromPrefs} from '../../util/codemirror-options';\r\nimport { UserDialog } from '../context/components/UserDialog';\r\n\r\nexport interface PassageTextProps {\r\n\tonChange: (value: string) => void;\r\n\tonEditorChange: (value: CodeMirror.Editor) => void;\r\n\tpassage: Passage;\r\n\tstory: Story;\r\n\tstoryFormat: StoryFormat;\r\n\tstoryFormatExtensionsDisabled?: boolean;\r\n}\r\n\r\nexport const PassageText: React.FC<PassageTextProps> = props => {\r\n\tconst {\r\n\t\tonChange,\r\n\t\tonEditorChange,\r\n\t\tpassage,\r\n\t\tstory,\r\n\t\tstoryFormat,\r\n\t\tstoryFormatExtensionsDisabled,\r\n\t} = props;\r\n\tconst [changePending, setChangePending] = React.useState(false);\r\n\tconst [localText, setLocalText] = React.useState(passage.text);\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst autocompletePassageNames = useCodeMirrorPassageHints(story);\r\n\tconst mode =\r\n\t\tuseFormatCodeMirrorMode(storyFormat.name, storyFormat.version) ?? 'text';\r\n\tconst {t} = useTranslation();\r\n\r\n\t// Effects to handle debouncing updates upward. The idea here is that the\r\n\t// component maintains a local state so that the CodeMirror instance always is\r\n\t// up-to-date with what the user has typed, but the global context may not be.\r\n\t// This is because updating global context causes re-rendering in the story\r\n\t// map, which can be time-intensive.\r\n\r\n\r\n\t//텍스트 입력 기능을 위해 잠시 주석처리\r\n\tReact.useEffect(() => {\r\n\t\t// A change to passage text has occurred externally, e.g. through a find and\r\n\t\t// replace. We ignore this if a change is pending so that users don't see\r\n\t\t// things they've typed in disappear or be replaced.\r\n\t\tif (!changePending && localText !== passage.text) {\r\n\t\t\tsetLocalText(passage.text);\r\n\t\t}\r\n\t}, [changePending, localText, passage.text]);\r\n\r\n\t// The code below handles user changes in the text field. 1 second is a\r\n\t// guesstimate.\r\n\r\n\tconst debouncedOnChange = React.useMemo(\r\n\t\t() =>\r\n\t\t\tdebounce((value: string) => {\r\n\t\t\t\tonChange(value);\r\n\t\t\t\tsetChangePending(false);\r\n\t\t\t}, 1000),\r\n\t\t[onChange]\r\n\t);\r\n\r\n\tconst handleMount = React.useCallback(\r\n\t\t(editor: CodeMirror.Editor) => {\r\n\t\t\tonEditorChange(editor);\r\n\r\n\t\t\t// The potential combination of loading a mode and the dialog entrance\r\n\t\t\t// animation seems to mess up CodeMirror's cursor rendering. The delay below\r\n\t\t\t// is intended to run after the animation completes.\r\n\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\teditor.focus();\r\n\t\t\t\teditor.refresh();\r\n\t\t\t}, 400);\r\n\t\t},\r\n\t\t[onEditorChange]\r\n\t);\r\n\r\n\tconst handleChange = React.useCallback(\r\n\t\t(\r\n\t\t\teditor: CodeMirror.Editor,\r\n\t\t\tdata: CodeMirror.EditorChange,\r\n\t\t\ttext: string\r\n\t\t) => {\r\n\t\t\tonEditorChange(editor);\r\n\t\t\tsetChangePending(true);\r\n\t\t\tdebouncedOnChange(text);\r\n\t\t\tsetLocalText(text);\r\n\t\t},\r\n\t\t[debouncedOnChange, onEditorChange]\r\n\t);\r\n\r\n\tconst options = React.useMemo(\r\n\t\t() => ({\r\n\t\t\t...codeMirrorOptionsFromPrefs(prefs),\r\n\t\t\tmode: storyFormatExtensionsDisabled ? 'text' : mode,\r\n\t\t\tlineWrapping: true,\r\n\t\t\tplaceholder: t('dialogs.passageEdit.passageTextPlaceholder'),\r\n\t\t\tprefixTrigger: {\r\n\t\t\t\tcallback: autocompletePassageNames,\r\n\t\t\t\tprefixes: ['[[', '->']\r\n\t\t\t}\r\n\t\t}),\r\n\t\t[autocompletePassageNames, mode, prefs, storyFormatExtensionsDisabled, t]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<DialogEditor>\r\n\t\t\t<CodeArea\r\n\t\t\t\teditorDidMount={handleMount}\r\n\t\t\t\tfontFamily={prefs.passageEditorFontFamily}\r\n\t\t\t\tfontScale={prefs.passageEditorFontScale}\r\n\t\t\t\tlabel={t('dialogs.passageEdit.passageTextEditorLabel')}\r\n\t\t\t\tlabelHidden\r\n\t\t\t\tonBeforeChange={handleChange}\r\n\t\t\t\tonChange={onEditorChange}\r\n\t\t\t\toptions={options}\r\n\t\t\t\tvalue={localText}\r\n\t\t\t/>\r\n\t\t</DialogEditor>\r\n\t);\r\n};\r\n","import CodeMirror, {Editor, Handle} from 'codemirror';\r\nimport * as React from 'react';\r\nimport {Story} from './stories';\r\n\r\ntype HintExtraKeyHandler = (editor: Editor, hint: Handle) => void;\r\n\r\nexport function useCodeMirrorPassageHints(story: Story) {\r\n\treturn React.useCallback(\r\n\t\t(editor: Editor) => {\r\n\t\t\teditor.showHint({\r\n\t\t\t\tcompleteSingle: false,\r\n\t\t\t\textraKeys:\r\n\t\t\t\t\t// Any of the characters below are an indication the user is finished\r\n\t\t\t\t\t// typing a passage name in a link and the hint should close. We need\r\n\t\t\t\t\t// to 'type' this character for the user since our handler consumes\r\n\t\t\t\t\t// the event.\r\n\t\t\t\t\t[']', '-', '|'].reduce<Record<string, HintExtraKeyHandler>>(\r\n\t\t\t\t\t\t(result, character) => {\r\n\t\t\t\t\t\t\tresult[character] = (editor, hint) => {\r\n\t\t\t\t\t\t\t\tconst doc = editor.getDoc();\r\n\r\n\t\t\t\t\t\t\t\tdoc.replaceRange(character, doc.getCursor());\r\n\t\t\t\t\t\t\t\thint.close();\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{}\r\n\t\t\t\t\t),\r\n\t\t\t\thint() {\r\n\t\t\t\t\tconst wordRange = editor.findWordAt(editor.getCursor());\r\n\t\t\t\t\tconst word = editor\r\n\t\t\t\t\t\t.getRange(wordRange.anchor, wordRange.head)\r\n\t\t\t\t\t\t.toLowerCase();\r\n\r\n\t\t\t\t\tconst comps = {\r\n\t\t\t\t\t\tlist: story.passages.reduce<string[]>((result, passage) => {\r\n\t\t\t\t\t\t\tif (passage.name.toLowerCase().includes(word)) {\r\n\t\t\t\t\t\t\t\treturn [...result, passage.name];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t\t}, []),\r\n\t\t\t\t\t\tfrom: wordRange.anchor,\r\n\t\t\t\t\t\tto: wordRange.head\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tCodeMirror.on(comps, 'pick', () => {\r\n\t\t\t\t\t\tconst doc = editor.getDoc();\r\n\r\n\t\t\t\t\t\tdoc.replaceRange(']] ', doc.getCursor());\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn comps;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t[story.passages]\r\n\t);\r\n}\r\n","import {version as twineVersion} from '../../package.json';\r\nimport CodeMirror from 'codemirror';\r\nimport * as React from 'react';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tloadFormatProperties,\r\n\tuseStoryFormatsContext\r\n} from './story-formats';\r\nimport {formatEditorExtensions, namespaceForFormat} from '../util/story-format';\r\nimport {formatEditorExtensionsDisabled, usePrefsContext} from './prefs';\r\n\r\n/**\r\n * Sets up a CodeMirror mode for a format, if the format has defined one via\r\n * properties.codeMirror.mode. Once one is fully set up, this returns the name\r\n * of that mode. If the mode is being set up or the format hasn't defined one,\r\n * this returns undefined.\r\n */\r\nexport function useFormatCodeMirrorMode(\r\n\tformatName: string,\r\n\tformatVersion: string\r\n) {\r\n\tconst {dispatch, formats} = useStoryFormatsContext();\r\n\tconst format = formatWithNameAndVersion(formats, formatName, formatVersion);\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst [modeName, setModeName] = React.useState<string>();\r\n\tconst extensionsDisabled = formatEditorExtensionsDisabled(\r\n\t\tprefs,\r\n\t\tformatName,\r\n\t\tformatVersion\r\n\t);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (extensionsDisabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (format.loadState === 'unloaded') {\r\n\t\t\tdispatch(loadFormatProperties(format));\r\n\t\t} else if (format.loadState === 'loaded') {\r\n\t\t\tconst editorExtensions = formatEditorExtensions(format, twineVersion);\r\n\r\n\t\t\tif (editorExtensions?.codeMirror?.mode) {\r\n\t\t\t\tCodeMirror.defineMode(\r\n\t\t\t\t\tnamespaceForFormat(format),\r\n\t\t\t\t\teditorExtensions.codeMirror.mode\r\n\t\t\t\t);\r\n\t\t\t\tsetModeName(namespaceForFormat(format));\r\n\t\t\t}\r\n\t\t}\r\n\t}, [dispatch, extensionsDisabled, format]);\r\n\r\n\treturn modeName;\r\n}\r\n","import {IconResize} from '@tabler/icons';\r\nimport {Editor} from 'codemirror';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {UndoRedoButtons} from '../../components/codemirror';\r\nimport {ButtonBar} from '../../components/container/button-bar';\r\nimport {CheckboxButton} from '../../components/control/checkbox-button';\r\nimport {MenuButton} from '../../components/control/menu-button';\r\nimport {RenamePassageButton} from '../../components/passage/rename-passage-button';\r\nimport {AddTagButton} from '../../components/tag';\r\nimport {\r\n\taddPassageTag,\r\n\tPassage,\r\n\tsetTagColor,\r\n\tStory,\r\n\tstoryPassageTags,\r\n\tupdatePassage,\r\n\tupdateStory\r\n} from '../../store/stories';\r\nimport {useUndoableStoriesContext} from '../../store/undoable-stories';\r\nimport {Color} from '../../util/color';\r\n\r\nexport interface PassageToolbarProps {\r\n\teditor?: Editor;\r\n\tpassage: Passage;\r\n\tstory: Story;\r\n}\r\n\r\nexport const PassageToolbar: React.FC<PassageToolbarProps> = props => {\r\n\tconst {editor, passage, story} = props;\r\n\tconst {dispatch, stories} = useUndoableStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\tconst isStart = story.startPassage === passage.id;\r\n\r\n\tfunction handleAddTag(name: string, color?: Color) {\r\n\t\t// Kind of tricky. We make adding the tag to the passage undoable, but not\r\n\t\t// any color change associated with this. This is because we only set a\r\n\t\t// color here when creating an entirely new tag. If the user is adding an\r\n\t\t// existing tag, then we would only receive the name here, since it's\r\n\t\t// currently impossible to add an existing tag and change its color\r\n\t\t// simultaneously.\r\n\t\t//\r\n\t\t// If this changes, then this should change too.\r\n\r\n\t\tdispatch(addPassageTag(story, passage, name), t('undoChange.addTag'));\r\n\r\n\t\tif (color) {\r\n\t\t\tdispatch(setTagColor(story, name, color));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleRename(name: string) {\r\n\t\t// Don't create newly linked passages here because the update action will\r\n\t\t// try to recreate the passage as it's been renamed--it sees new links in\r\n\t\t// existing passages, updates them, but does not see that the passage name\r\n\t\t// has been updated since that hasn't happened yet.\r\n\r\n\t\tdispatch(updatePassage(story, passage, {name}, {dontUpdateOthers: true}));\r\n\t}\r\n\r\n\tfunction handleSetAsStart() {\r\n\t\tdispatch(updateStory(stories, story, {startPassage: passage.id}));\r\n\t}\r\n\r\n\tfunction handleSetSize({height, width}: {height: number; width: number}) {\r\n\t\tdispatch(updatePassage(story, passage, {height, width}));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<UndoRedoButtons editor={editor} watch={passage.text} />\r\n\t\t\t<AddTagButton\r\n\t\t\t\tassignedTags={passage.tags}\r\n\t\t\t\texistingTags={storyPassageTags(story)}\r\n\t\t\t\tonAdd={handleAddTag}\r\n\t\t\t/>\r\n\t\t\t<MenuButton\r\n\t\t\t\ticon={<IconResize />}\r\n\t\t\t\titems={[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\t\tchecked: passage.height === 100 && passage.width === 100,\r\n\t\t\t\t\t\tlabel: t('dialogs.passageEdit.sizeSmall'),\r\n\t\t\t\t\t\tonClick: () => handleSetSize({height: 100, width: 100})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\t\tchecked: passage.height === 200 && passage.width === 200,\r\n\t\t\t\t\t\tlabel: t('dialogs.passageEdit.sizeLarge'),\r\n\t\t\t\t\t\tonClick: () => handleSetSize({height: 200, width: 200})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\t\tchecked: passage.height === 200 && passage.width === 100,\r\n\t\t\t\t\t\tlabel: t('dialogs.passageEdit.sizeTall'),\r\n\t\t\t\t\t\tonClick: () => handleSetSize({height: 200, width: 100})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\t\tchecked: passage.height === 100 && passage.width === 200,\r\n\t\t\t\t\t\tlabel: t('dialogs.passageEdit.sizeWide'),\r\n\t\t\t\t\t\tonClick: () => handleSetSize({height: 100, width: 200})\r\n\t\t\t\t\t}\r\n\t\t\t\t]}\r\n\t\t\t\tlabel={t('dialogs.passageEdit.size')}\r\n\t\t\t/>\r\n\t\t\t<RenamePassageButton\r\n\t\t\t\tonRename={handleRename}\r\n\t\t\t\tpassage={passage}\r\n\t\t\t\tstory={story}\r\n\t\t\t/>\r\n\t\t\t<CheckboxButton\r\n\t\t\t\tdisabled={isStart}\r\n\t\t\t\tlabel={t('dialogs.passageEdit.setAsStart')}\r\n\t\t\t\tonChange={handleSetAsStart}\r\n\t\t\t\tvalue={isStart}\r\n\t\t\t/>\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport CodeMirror from 'codemirror';\r\nimport {usePrefsContext} from '../../store/prefs';\r\nimport {StoryFormat, StoryFormatToolbarItem} from '../../store/story-formats';\r\nimport {useComputedTheme} from '../../store/prefs/use-computed-theme';\r\nimport {useFormatCodeMirrorToolbar} from '../../store/use-format-codemirror-toolbar';\r\nimport {ButtonBar} from '../../components/container/button-bar';\r\nimport {IconButton} from '../../components/control/icon-button';\r\nimport {MenuButton} from '../../components/control/menu-button';\r\nimport './story-format-toolbar.css';\r\n\r\nexport interface StoryFormatToolbarProps {\r\n\teditor?: CodeMirror.Editor;\r\n\tonExecCommand: (name: string) => void;\r\n\tstoryFormat: StoryFormat;\r\n}\r\n\r\nexport const StoryFormatToolbar: React.FC<StoryFormatToolbarProps> = props => {\r\n\tconst {editor, onExecCommand, storyFormat} = props;\r\n\tconst containerRef = React.useRef<HTMLDivElement>(null);\r\n\tconst appTheme = useComputedTheme();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst toolbarFactory = useFormatCodeMirrorToolbar(\r\n\t\tstoryFormat.name,\r\n\t\tstoryFormat.version\r\n\t);\r\n\tconst [toolbarItems, setToolbarItems] = React.useState<\r\n\t\tStoryFormatToolbarItem[]\r\n\t>([]);\r\n\r\n\tconst tryToSetToolbar = React.useCallback(() => {\r\n\t\tif (toolbarFactory && containerRef.current && editor) {\r\n\t\t\ttry {\r\n\t\t\t\tconst style = window.getComputedStyle(containerRef.current);\r\n\r\n\t\t\t\tsetToolbarItems(\r\n\t\t\t\t\ttoolbarFactory(editor, {\r\n\t\t\t\t\t\tappTheme,\r\n\t\t\t\t\t\tforegroundColor: style.color,\r\n\t\t\t\t\t\tlocale: prefs.locale\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t`Toolbar function for ${storyFormat.name} ${storyFormat.version} threw an error, skipping update`,\r\n\t\t\t\t\terror\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsetToolbarItems([]);\r\n\t\t}\r\n\t}, [\r\n\t\tappTheme,\r\n\t\teditor,\r\n\t\tprefs.locale,\r\n\t\tstoryFormat.name,\r\n\t\tstoryFormat.version,\r\n\t\ttoolbarFactory\r\n\t]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (editor) {\r\n\t\t\t// Run the toolbar factory initially.\r\n\r\n\t\t\ttryToSetToolbar();\r\n\r\n\t\t\t// React to both content changes and the selection and cursor moving,\r\n\t\t\t// since the toolbar factory might want to do different things based on\r\n\t\t\t// the cursor position or selection.\r\n\r\n\t\t\teditor.on('cursorActivity', tryToSetToolbar);\r\n\t\t\treturn () => editor.off('cursorActivity', tryToSetToolbar);\r\n\t\t}\r\n\t}, [editor, tryToSetToolbar]);\r\n\r\n\tfunction execCommand(name: string) {\r\n\t\t// Run the command, then update the toolbar after the current execution\r\n\t\t// context finishes.\r\n\r\n\t\tonExecCommand(name);\r\n\t\tPromise.resolve().then(tryToSetToolbar);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"story-format-toolbar\" ref={containerRef}>\r\n\t\t\t<ButtonBar>\r\n\t\t\t\t{toolbarItems.map((item, index) => {\r\n\t\t\t\t\tswitch (item.type) {\r\n\t\t\t\t\t\tcase 'button':\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\t\t\tdisabled={item.disabled}\r\n\t\t\t\t\t\t\t\t\ticon={<img src={item.icon} alt=\"\" />}\r\n\t\t\t\t\t\t\t\t\ticonOnly={item.iconOnly}\r\n\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\tlabel={item.label}\r\n\t\t\t\t\t\t\t\t\tonClick={() => execCommand(item.command)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tcase 'menu': {\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<MenuButton\r\n\t\t\t\t\t\t\t\t\tdisabled={item.disabled}\r\n\t\t\t\t\t\t\t\t\ticon={<img src={item.icon} alt=\"\" />}\r\n\t\t\t\t\t\t\t\t\ticonOnly={item.iconOnly}\r\n\t\t\t\t\t\t\t\t\titems={item.items\r\n\t\t\t\t\t\t\t\t\t\t.filter(subitem =>\r\n\t\t\t\t\t\t\t\t\t\t\t['button', 'separator'].includes(subitem.type)\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t.map(subitem => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (subitem.type === 'button') {\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'button',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled: subitem.disabled,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: subitem.label,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick: () => execCommand(subitem.command)\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\treturn {separator: true};\r\n\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\tlabel={item.label}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t})}\r\n\t\t\t</ButtonBar>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import CodeMirror from 'codemirror';\r\nimport * as React from 'react';\r\nimport {version as twineVersion} from '../../package.json';\r\nimport {formatEditorExtensions, namespaceForFormat} from '../util/story-format';\r\nimport {formatEditorExtensionsDisabled, usePrefsContext} from './prefs';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tloadFormatProperties,\r\n\tStoryFormatToolbarFactory,\r\n\tStoryFormatToolbarFactoryEnvironment,\r\n\tStoryFormatToolbarItem,\r\n\tuseStoryFormatsContext\r\n} from './story-formats';\r\n\r\n/**\r\n * Manages working with a CodeMirror toolbar for a story format, which consists\r\n * of:\r\n *\r\n * - (optionally, but usually) a set of CodeMirror commands\r\n * - A function that returns an array of objects describing the toolbar, which\r\n *   uses those commands for functionality\r\n *\r\n * This loads the story format if it hasn't already been loaded, and installs\r\n * CodeMirror commands it provides. It returns the toolbar factory function if\r\n * everything succeeds. Otherwise, it will return undefined.\r\n */\r\nexport function useFormatCodeMirrorToolbar(\r\n\tformatName: string,\r\n\tformatVersion: string\r\n) {\r\n\tconst {dispatch, formats} = useStoryFormatsContext();\r\n\tconst [loaded, setLoaded] = React.useState<Record<string, boolean>>({});\r\n\tconst [\r\n\t\ttoolbarFunc,\r\n\t\tsetToolbarFunc\r\n\t] = React.useState<StoryFormatToolbarFactory>();\r\n\tconst format = formatWithNameAndVersion(formats, formatName, formatVersion);\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst extensionsDisabled = formatEditorExtensionsDisabled(\r\n\t\tprefs,\r\n\t\tformatName,\r\n\t\tformatVersion\r\n\t);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (extensionsDisabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (format.loadState === 'unloaded') {\r\n\t\t\tdispatch(loadFormatProperties(format));\r\n\t\t} else if (\r\n\t\t\tformat.loadState === 'loaded' &&\r\n\t\t\t!loaded[namespaceForFormat(format)]\r\n\t\t) {\r\n\t\t\tconst namespace = namespaceForFormat(format);\r\n\t\t\tconst editorExtensions = formatEditorExtensions(format, twineVersion);\r\n\r\n\t\t\tif (editorExtensions?.codeMirror?.commands) {\r\n\t\t\t\tfor (const commandName in editorExtensions.codeMirror.commands) {\r\n\t\t\t\t\tconst namespacedCommand = namespace + commandName;\r\n\r\n\t\t\t\t\tif (namespacedCommand in CodeMirror.commands) {\r\n\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t`CodeMirror already has a \"${namespacedCommand}\" command defined, skipping`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Using any here because the type is defined with factory\r\n\t\t\t\t\t\t// commands only.\r\n\r\n\t\t\t\t\t\t(CodeMirror.commands as any)[\r\n\t\t\t\t\t\t\tnamespacedCommand\r\n\t\t\t\t\t\t] = editorExtensions.codeMirror!.commands![commandName];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (editorExtensions?.codeMirror?.toolbar) {\r\n\t\t\t\tsetToolbarFunc(\r\n\t\t\t\t\t() => (\r\n\t\t\t\t\t\teditor: CodeMirror.Editor,\r\n\t\t\t\t\t\tenvironment: StoryFormatToolbarFactoryEnvironment\r\n\t\t\t\t\t) => {\r\n\t\t\t\t\t\t// If somehow we lost our format's toolbar function, exit early.\r\n\r\n\t\t\t\t\t\tif (!editorExtensions?.codeMirror?.toolbar) {\r\n\t\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst items = editorExtensions.codeMirror.toolbar(\r\n\t\t\t\t\t\t\teditor,\r\n\t\t\t\t\t\t\tenvironment\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t// If we didn't get an array from the function, coerce it to an\r\n\t\t\t\t\t\t// empty one.\r\n\r\n\t\t\t\t\t\tif (!Array.isArray(items)) {\r\n\t\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Namespace command properties and filter out any types that aren't\r\n\t\t\t\t\t\t// buttons or menus.\r\n\r\n\t\t\t\t\t\treturn items.reduce((result, item) => {\r\n\t\t\t\t\t\t\tswitch (item.type) {\r\n\t\t\t\t\t\t\t\tcase 'button':\r\n\t\t\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t\t\t...result,\r\n\t\t\t\t\t\t\t\t\t\t{...item, command: namespace + item.command}\r\n\t\t\t\t\t\t\t\t\t];\r\n\r\n\t\t\t\t\t\t\t\tcase 'menu':\r\n\t\t\t\t\t\t\t\t\tif (Array.isArray(item.items)) {\r\n\t\t\t\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t\t\t\t...result,\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\titems: item.items\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.filter(subitem =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t['button', 'separator'].includes(subitem.type)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.map(subitem =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsubitem.type === 'separator'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? subitem\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...subitem,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommand: namespace + subitem.command\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t\t}, [] as StoryFormatToolbarItem[]);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tsetLoaded(loaded => ({...loaded, [namespaceForFormat(format)]: true}));\r\n\t\t}\r\n\t}, [dispatch, extensionsDisabled, format, loaded]);\r\n\r\n\treturn toolbarFunc;\r\n}\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {ButtonBar} from '../../components/container/button-bar';\r\nimport {TagButton} from '../../components/tag';\r\nimport {\r\n\tPassage,\r\n\tremovePassageTag,\r\n\tStory,\r\n\tupdateStory\r\n} from '../../store/stories';\r\nimport {useUndoableStoriesContext} from '../../store/undoable-stories';\r\nimport {Color} from '../../util/color';\r\n\r\nexport interface TagToolbarProps {\r\n\tpassage: Passage;\r\n\tstory: Story;\r\n}\r\n\r\nexport const TagToolbar: React.FC<TagToolbarProps> = props => {\r\n\tconst {passage, story} = props;\r\n\tconst {dispatch, stories} = useUndoableStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleChangeTagColor(name: string, color: Color) {\r\n\t\tdispatch(\r\n\t\t\tupdateStory(stories, story, {\r\n\t\t\t\ttagColors: {...story.tagColors, [name]: color}\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction handleRemoveTag(name: string) {\r\n\t\tdispatch(removePassageTag(story, passage, name), t('undoChange.removeTag'));\r\n\t}\r\n\r\n\tif (passage.tags.length === 0) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"tags\">\r\n\t\t\t<ButtonBar>\r\n\t\t\t\t{passage.tags.map(tag => (\r\n\t\t\t\t\t<TagButton\r\n\t\t\t\t\t\tcolor={story.tagColors[tag]}\r\n\t\t\t\t\t\tkey={tag}\r\n\t\t\t\t\t\tname={tag}\r\n\t\t\t\t\t\tonChangeColor={color => handleChangeTagColor(tag, color)}\r\n\t\t\t\t\t\tonRemove={() => handleRemoveTag(tag)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t))}\r\n\t\t\t</ButtonBar>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport useErrorBoundary from 'use-error-boundary';\r\nimport {\r\n\tDialogCard,\r\n\tDialogCardProps\r\n} from '../../components/container/dialog-card';\r\nimport {ErrorMessage} from '../../components/error';\r\nimport {passageWithId, storyWithId, updatePassage} from '../../store/stories';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tuseStoryFormatsContext\r\n} from '../../store/story-formats';\r\nimport {useUndoableStoriesContext} from '../../store/undoable-stories';\r\nimport './passage-edit.css';\r\nimport {PassageText} from './passage-text';\r\nimport {PassageToolbar} from './passage-toolbar';\r\nimport {StoryFormatToolbar} from './story-format-toolbar';\r\nimport {TagToolbar} from './tag-toolbar';\r\n\r\n\r\nexport interface PassageEditDialogProps\r\n\textends Omit<DialogCardProps, 'headerLabel'> {\r\n\tpassageId: string;\r\n\tstoryId: string;\r\n\tuserDialogText:any;\r\n\tonClose :any;\r\n}\r\n\r\nexport const InnerPassageEditDialog: React.FC<\r\n\tPassageEditDialogProps\r\n> = props => {\r\n\tconst {passageId, storyId, ...other} = props;\r\n\tconst [storyFormatExtensionsEnabled, setStoryFormatExtensionsEnabled] =\r\n\t\tReact.useState(true);\r\n\tconst [editorCrashed, setEditorCrashed] = React.useState(false);\r\n\tconst [cmEditor, setCmEditor] = React.useState<CodeMirror.Editor>();\r\n\tconst {ErrorBoundary, error, reset: resetError} = useErrorBoundary();\r\n\tconst {dispatch, stories} = useUndoableStoriesContext();\r\n\tconst {formats} = useStoryFormatsContext();\r\n\tconst passage = passageWithId(stories, storyId, passageId);\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst storyFormat = formatWithNameAndVersion(\r\n\t\tformats,\r\n\t\tstory.storyFormat,\r\n\t\tstory.storyFormatVersion\r\n\t);\r\n\tconst {t} = useTranslation();\r\n\tReact.useEffect(() => {\r\n\t\tif (error) {\r\n\t\t\tif (storyFormatExtensionsEnabled) {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t'Passage editor crashed, trying without format extensions',\r\n\t\t\t\t\terror\r\n\t\t\t\t);\r\n\t\t\t\tsetStoryFormatExtensionsEnabled(false);\r\n\t\t\t} else {\r\n\t\t\t\tsetEditorCrashed(true);\r\n\t\t\t}\r\n\r\n\t\t\tresetError();\r\n\t\t}\r\n\t}, [error, resetError, storyFormatExtensionsEnabled]);\r\n\r\n\t\r\n\r\n\tconst handlePassageTextChange = React.useCallback(\r\n\t\t(text: string) => {\r\n\t\t\tdispatch(updatePassage(story, passage, {text}));\r\n\t\t},\r\n\t\t[dispatch, passage, story]\r\n\t);\r\n\r\n\tReact.useEffect(()=>{\r\n\t\t\r\n\t\tif(other.userDialogText){\r\n\t\t\thandlePassageTextChange(other.userDialogText);\r\n\t\t\tprops.onClose();\r\n\t\t}\r\n\t}, [other.userDialogText])\r\n\r\n\tfunction handleExecCommand(name: string) {\r\n\t\t// A format toolbar command probably will affect the editor content. It\r\n\t\t// appears that react-codemirror2 can't maintain the selection properly in\r\n\t\t// all cases when this happens (particularly when using\r\n\t\t// `replaceSelection('something', 'around')`), so we take a snapshot\r\n\t\t// immediately after the command runs, let react-codemirror2 work, then\r\n\t\t// reapply the selection ASAP.\r\n\r\n\t\tif (!cmEditor) {\r\n\t\t\tthrow new Error('No editor set');\r\n\t\t}\r\n\r\n\t\tcmEditor.execCommand(name);\r\n\r\n\t\tconst selections = cmEditor.listSelections();\r\n\r\n\t\tPromise.resolve().then(() => cmEditor.setSelections(selections));\r\n\t}\r\n\treturn (\r\n\t\t\t\r\n\t\t\t<DialogCard\r\n\t\t\t{...other}\r\n\t\t\tclassName=\"passage-edit-dialog\"\r\n\t\t\theaderLabel={passage.name}\t\r\n\t\t\tmaximizable\r\n\t\t>\r\n\t\t\t{editorCrashed ? (\r\n\t\t\t\t<ErrorMessage>{t('dialogs.passageEdit.editorCrashed')}</ErrorMessage>\r\n\t\t\t) \r\n\t\t\t: (//빈 컴포넌트는 아무 것도 없는 것으로 취급된다\r\n\t\t\t\t<> \r\n\t\t\t\t\t<PassageToolbar editor={cmEditor} passage={passage} story={story} />\r\n\t\t\t\t\t{storyFormatExtensionsEnabled && (\r\n\t\t\t\t\t\t<StoryFormatToolbar\r\n\t\t\t\t\t\t\teditor={cmEditor}\r\n\t\t\t\t\t\t\tonExecCommand={handleExecCommand}\r\n\t\t\t\t\t\t\tstoryFormat={storyFormat}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<TagToolbar passage={passage} story={story} />\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t<PassageText\r\n\t\t\t\t\t\t\tonChange={handlePassageTextChange}\r\n\t\t\t\t\t\t\tonEditorChange={setCmEditor}\r\n\t\t\t\t\t\t\tpassage={passage}\r\n\t\t\t\t\t\t\tstory={story}\r\n\t\t\t\t\t\t\tstoryFormat={storyFormat}\r\n\t\t\t\t\t\t\tstoryFormatExtensionsDisabled={!storyFormatExtensionsEnabled}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t</DialogCard>\r\n\t\t\r\n\t);\r\n};\r\n\r\nexport const PassageEditDialog: React.FC<PassageEditDialogProps> = props => {\r\n\t// Check for the existence of the passage. If it doesn't (e.g. it was deleted\r\n\t// after the dialog was opened), render nothing and call onClose.\r\n\r\n\tconst {stories} = useUndoableStoriesContext();\r\n\r\n\ttry {\r\n\t\tpassageWithId(stories, props.storyId, props.passageId);\r\n\t} catch (err) {\r\n\t\tprops.onClose();\r\n\t\treturn null;\r\n\t}\r\n\treturn <InnerPassageEditDialog {...props} />;\r\n};\r\n","import classNames from 'classnames';\r\nimport * as React from 'react';\r\nimport './file-input.css';\r\n\r\n// See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file\r\n\r\nexport interface FileInputProps {\r\n\taccept?: string;\r\n\tchildren: React.ReactNode;\r\n\tonChange: (file: File, data: string) => void;\r\n\tonError?: (error: Error) => void;\r\n\torientation?: 'horizontal' | 'vertical';\r\n}\r\n\r\nexport const FileInput: React.FC<FileInputProps> = props => {\r\n\tconst {children, onChange, onError, orientation, ...otherProps} = props;\r\n\tconst className = classNames(\r\n\t\t'file-input',\r\n\t\t`orientation-${orientation ?? 'horizontal'}`\r\n\t);\r\n\r\n\tfunction handleChange(changeEvent: React.ChangeEvent<HTMLInputElement>) {\r\n\t\tif (!changeEvent.target.files) {\r\n\t\t\tthrow new Error('Change event occurred but no files present');\r\n\t\t}\r\n\r\n\t\tconst file = changeEvent.target.files[0];\r\n\t\tconst reader = new FileReader();\r\n\r\n\t\treader.addEventListener('loadend', loadEvent => {\r\n\t\t\tif (reader.error) {\r\n\t\t\t\tconsole.warn(reader.error);\r\n\r\n\t\t\t\tif (onError) {\r\n\t\t\t\t\tonError(reader.error);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tonChange(file, reader.result as string);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.readAsText(file);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<span className={className}>\r\n\t\t\t<label>\r\n\t\t\t\t<span className=\"file-input-label\">{children}</span>\r\n\t\t\t\t<span className=\"file-input-control\">\r\n\t\t\t\t\t<input {...otherProps} onChange={handleChange} type=\"file\" />\r\n\t\t\t\t</span>\r\n\t\t\t</label>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {FileInput} from '../../components/control/file-input';\r\nimport {Story} from '../../store/stories';\r\nimport {importStories} from '../../util/import';\r\n\r\nexport interface FileChooserProps {\r\n\tonChange: (file: File, stories: Story[]) => void;\r\n}\r\n\r\nexport const FileChooser: React.FC<FileChooserProps> = props => {\r\n\tconst {onChange} = props;\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleChange(file: File, data: string) {\r\n\t\tonChange(file, importStories(data));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"file-chooser\">\r\n\t\t\t<p>\r\n\t\t\t\t<FileInput\r\n\t\t\t\t\taccept=\".html\"\r\n\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\torientation=\"vertical\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('dialogs.storyImport.filePrompt')}\r\n\t\t\t\t</FileInput>\r\n\t\t\t</p>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import {IconFileImport} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {CheckboxButton} from '../../components/control/checkbox-button';\r\nimport {IconButton} from '../../components/control/icon-button';\r\nimport {storyFileName} from '../../electron/shared';\r\nimport {Story} from '../../store/stories';\r\nimport './story-chooser.css';\r\n\r\nexport interface StoryChooserProps {\r\n\texistingStories: Story[];\r\n\tonImport: (stories: Story[]) => void;\r\n\tstories: Story[];\r\n}\r\n\r\nexport const StoryChooser: React.FC<StoryChooserProps> = props => {\r\n\tconst {existingStories, onImport, stories} = props;\r\n\tconst [selectedStories, setSelectedStories] = React.useState<Story[]>([]);\r\n\tconst {t} = useTranslation();\r\n\r\n\t// Whenever either existing stories or stories to import changes, select all\r\n\t// stories that do not conflict.\r\n\r\n\tconst willReplaceExisting = React.useCallback(\r\n\t\t(story: Story) => {\r\n\t\t\treturn existingStories.some(\r\n\t\t\t\tother => storyFileName(other) === storyFileName(story)\r\n\t\t\t);\r\n\t\t},\r\n\t\t[existingStories]\r\n\t);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tsetSelectedStories(stories.filter(story => !willReplaceExisting(story)));\r\n\t}, [stories, willReplaceExisting]);\r\n\r\n\tfunction handleChange(story: Story, selected: boolean) {\r\n\t\tif (selected) {\r\n\t\t\tsetSelectedStories(current => [...current, story]);\r\n\t\t} else {\r\n\t\t\tsetSelectedStories(current =>\r\n\t\t\t\tcurrent.filter(other => other.id !== story.id)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"story-chooser\">\r\n\t\t\t<p>{t('dialogs.storyImport.storiesPrompt')}</p>\r\n\t\t\t<ul>\r\n\t\t\t\t{stories.map(story => (\r\n\t\t\t\t\t<li key={story.id}>\r\n\t\t\t\t\t\t<CheckboxButton\r\n\t\t\t\t\t\t\tlabel={story.name}\r\n\t\t\t\t\t\t\tonChange={selected => handleChange(story, selected)}\r\n\t\t\t\t\t\t\tvalue={selectedStories.includes(story)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{selectedStories.includes(story) && willReplaceExisting(story) && (\r\n\t\t\t\t\t\t\t<span className=\"replace-warning\">\r\n\t\t\t\t\t\t\t\t{t('dialogs.storyImport.willReplaceExisting')}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</li>\r\n\t\t\t\t))}\r\n\t\t\t</ul>\r\n\t\t\t<div className=\"actions\">\r\n\t\t\t\t<IconButton\r\n\t\t\t\t\tdisabled={selectedStories.length === 0}\r\n\t\t\t\t\ticon={<IconFileImport />}\r\n\t\t\t\t\tlabel={t('dialogs.storyImport.importSelected')}\r\n\t\t\t\t\tonClick={() => onImport(selectedStories)}\r\n\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {CardContent} from '../../components/container/card';\r\nimport {\r\n\tDialogCard,\r\n\tDialogCardProps\r\n} from '../../components/container/dialog-card';\r\nimport {storyFileName} from '../../electron/shared';\r\nimport {importStories, Story, useStoriesContext} from '../../store/stories';\r\nimport {FileChooser} from './file-chooser';\r\nimport {StoryChooser} from './story-chooser';\r\nimport './story-import.css';\r\n\r\nexport type StoryImportDialogProps = Omit<DialogCardProps, 'headerLabel'>;\r\n\r\nexport const StoryImportDialog: React.FC<StoryImportDialogProps> = props => {\r\n\tconst {onClose} = props;\r\n\tconst {t} = useTranslation();\r\n\tconst {dispatch, stories: existingStories} = useStoriesContext();\r\n\tconst [file, setFile] = React.useState<File>();\r\n\tconst [stories, setStories] = React.useState<Story[]>([]);\r\n\r\n\tfunction handleImport(stories: Story[]) {\r\n\t\tdebugger;\r\n\t\tdispatch(importStories(stories, existingStories)); //dispatch : useState 대신 사용하는 redux같은 것\r\n\t\tonClose();\r\n\t}\r\n\r\n\tfunction handleFileChange(file: File, stories: Story[]) {\r\n\t\tdebugger;\r\n\t\t// If there are no conflicts in the stories, import them now. Otherwise, set\r\n\t\t// them in state and let the user choose via <StoryChooser>.\r\n\r\n\t\tif (\r\n\t\t\tstories.length === 0 ||\r\n\t\t\tstories.some(story =>\r\n\t\t\t\texistingStories.some(\r\n\t\t\t\t\texisting => storyFileName(existing) === storyFileName(story)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tsetFile(file);\r\n\t\t\tsetStories(stories);\r\n\t\t} else {\r\n\t\t\thandleImport(stories);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...props}\r\n\t\t\tclassName=\"story-import-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.storyImport.title')}\r\n\t\t>\r\n\t\t\t<CardContent>\r\n\t\t\t\t<FileChooser onChange={handleFileChange} />\r\n\t\t\t\t{file && stories.length > 0 && (\r\n\t\t\t\t\t<StoryChooser\r\n\t\t\t\t\t\texistingStories={existingStories}\r\n\t\t\t\t\t\tonImport={handleImport}\r\n\t\t\t\t\t\tstories={stories}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t\t{file && stories.length === 0 && (\r\n\t\t\t\t\t<p>{t('dialogs.storyImport.noStoriesInFile')}</p>\r\n\t\t\t\t)}\r\n\t\t\t</CardContent>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import {Thunk} from 'react-hook-thunk-reducer';\r\nimport {\r\n\tpassageWithId,\r\n\tpassageWithName,\r\n\tstoryWithId,\r\n\tPassage,\r\n\tStoriesAction,\r\n\tStoriesState,\r\n\tStory\r\n} from '../stories';\r\nimport {StoriesActionOrThunk} from './undoable-stories.types';\r\n\r\n/**\r\n * Returns an action or thunk to reverse a single action.\r\n */\r\nexport function reverseAction(\r\n\taction: StoriesAction,\r\n\tstate: StoriesState\r\n): StoriesActionOrThunk {\r\n\tswitch (action.type) {\r\n\t\tcase 'createPassage':\r\n\t\t\tif (action.props.id) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: 'deletePassage',\r\n\t\t\t\t\tpassageId: action.props.id,\r\n\t\t\t\t\tstoryId: action.storyId\r\n\t\t\t\t};\r\n\t\t\t} else if (action.props.name) {\r\n\t\t\t\t// This is dependant on the fact that we will only undo this action\r\n\t\t\t\t// immediately--otherwise this could create havoc if the passage has\r\n\t\t\t\t// been renamed in the meantime.\r\n\t\t\t\t//\r\n\t\t\t\t// This also assumes that the create action will succeed--e.g. there are\r\n\t\t\t\t// no conflicts.\r\n\t\t\t\tconst reverseThunk: Thunk<StoriesState, StoriesAction> = (\r\n\t\t\t\t\tdispatch,\r\n\t\t\t\t\tgetState\r\n\t\t\t\t) => {\r\n\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\ttype: 'deletePassage',\r\n\t\t\t\t\t\tpassageId: passageWithName(\r\n\t\t\t\t\t\t\tgetState(),\r\n\t\t\t\t\t\t\taction.storyId,\r\n\t\t\t\t\t\t\taction.props.name!\r\n\t\t\t\t\t\t).id,\r\n\t\t\t\t\t\tstoryId: action.storyId\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn reverseThunk;\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\"Can't reverse a createPassage action without either name or ID\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t// TODO: crashes on a replace all that affects a passage name, unclear why\r\n\r\n\t\tcase 'createPassages':\r\n\t\t\tif (action.props.some(prop => !prop.id && !prop.name)) {\r\n\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\"Can't reverse a createPassages action where a prop set doesn't have either name or ID\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn (dispatch, getState) => {\r\n\t\t\t\taction.props.forEach(props => {\r\n\t\t\t\t\tif (props.id) {\r\n\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\ttype: 'deletePassage',\r\n\t\t\t\t\t\t\tpassageId: props.id,\r\n\t\t\t\t\t\t\tstoryId: action.storyId\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (props.name) {\r\n\t\t\t\t\t\t// This is dependent on the fact that we will only undo this action\r\n\t\t\t\t\t\t// immediately--see comment about the createPassage action.\r\n\r\n\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\ttype: 'deletePassage',\r\n\t\t\t\t\t\t\tpassageId: passageWithName(getState(), action.storyId, props.name)\r\n\t\t\t\t\t\t\t\t.id,\r\n\t\t\t\t\t\t\tstoryId: action.storyId\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\tcase 'deletePassage':\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'createPassage',\r\n\t\t\t\tprops: passageWithId(state, action.storyId, action.passageId),\r\n\t\t\t\tstoryId: action.storyId\r\n\t\t\t};\r\n\r\n\t\tcase 'deletePassages':\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'createPassages',\r\n\t\t\t\tprops: action.passageIds.map(passageId =>\r\n\t\t\t\t\tpassageWithId(state, action.storyId, passageId)\r\n\t\t\t\t),\r\n\t\t\t\tstoryId: action.storyId\r\n\t\t\t};\r\n\r\n\t\tcase 'updatePassage': {\r\n\t\t\tconst passage = passageWithId(state, action.storyId, action.passageId);\r\n\t\t\tconst props = Object.keys(action.props).reduce(\r\n\t\t\t\t(result, propName) => ({\r\n\t\t\t\t\t...result,\r\n\t\t\t\t\t[propName]: passage[propName as keyof Passage]\r\n\t\t\t\t}),\r\n\t\t\t\t{} as Passage\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'updatePassage',\r\n\t\t\t\tprops,\r\n\t\t\t\tpassageId: action.passageId,\r\n\t\t\t\tstoryId: action.storyId\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tcase 'updatePassages':\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'updatePassages',\r\n\t\t\t\tpassageUpdates: Object.keys(action.passageUpdates).reduce(\r\n\t\t\t\t\t(result, passageId) => {\r\n\t\t\t\t\t\tconst passage = passageWithId(state, action.storyId, passageId);\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...result,\r\n\t\t\t\t\t\t\t[passageId]: Object.keys(action.passageUpdates[passageId]).reduce(\r\n\t\t\t\t\t\t\t\t(passageResult, propName) => ({\r\n\t\t\t\t\t\t\t\t\t...passageResult,\r\n\t\t\t\t\t\t\t\t\t[propName]: passage[propName as keyof Passage]\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t{} as Passage\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{} as Record<string, Partial<Passage>>\r\n\t\t\t\t),\r\n\t\t\t\tstoryId: action.storyId\r\n\t\t\t};\r\n\r\n\t\tcase 'updateStory': {\r\n\t\t\tconst story = storyWithId(state, action.storyId);\r\n\t\t\tconst props = Object.keys(action.props).reduce(\r\n\t\t\t\t(result, propName) => ({\r\n\t\t\t\t\t...result,\r\n\t\t\t\t\t[propName]: story[propName as keyof Story]\r\n\t\t\t\t}),\r\n\t\t\t\t{} as Story\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'updateStory',\r\n\t\t\t\tprops,\r\n\t\t\t\tstoryId: action.storyId\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tthrow new Error(`Don't know how to reverse action type \"${action.type}\"`);\r\n}\r\n","import * as React from 'react';\r\nimport {Thunk} from 'react-hook-thunk-reducer';\r\nimport {StoriesAction, StoriesState} from '../stories';\r\nimport {reverseAction} from './reverse-action';\r\nimport {StoriesActionOrThunk} from './undoable-stories.types';\r\n\r\n/**\r\n * Returns a thunk to reverse a thunk's actions. **This only works with thunks\r\n * that dispatch all actions synchronously.**\r\n */\r\nexport function reverseThunk(\r\n\tthunk: Thunk<StoriesState, StoriesAction>,\r\n\tstate: StoriesState\r\n): Thunk<StoriesState, StoriesAction> {\r\n\tconst actions: StoriesActionOrThunk[] = [];\r\n\tconst dispatch: React.Dispatch<StoriesActionOrThunk> = (\r\n\t\tactionOrThunk: StoriesActionOrThunk\r\n\t) => {\r\n\t\tif (typeof actionOrThunk === 'function') {\r\n\t\t\tactions.push(reverseThunk(actionOrThunk, state));\r\n\t\t} else {\r\n\t\t\tactions.push(reverseAction(actionOrThunk, state));\r\n\t\t}\r\n\t};\r\n\r\n\tthunk(dispatch, () => state);\r\n\treturn dispatch => actions.forEach(dispatch);\r\n}\r\n","// This reducer manages tracking undo states only. It does not actually perform\r\n// the undo/redos itself--that is instead done by\r\n// <UndoableStoriesContextProvider>, which orchestrates things between this\r\n// reducer and the main stories reducer.\r\n\r\nimport * as React from 'react';\r\nimport {reverseAction} from './reverse-action';\r\nimport {reverseThunk} from './reverse-thunk';\r\nimport {\r\n\tStoryChange,\r\n\tUndoableStoriesAction,\r\n\tUndoableStoriesState\r\n} from './undoable-stories.types';\r\n\r\nexport const reducer: React.Reducer<\r\n\tUndoableStoriesState,\r\n\tUndoableStoriesAction\r\n> = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'addChange':\r\n\t\t\tconst newChange: StoryChange = {\r\n\t\t\t\tdescription: action.description,\r\n\t\t\t\tredo: action.action,\r\n\t\t\t\tundo:\r\n\t\t\t\t\ttypeof action.action === 'function'\r\n\t\t\t\t\t\t? reverseThunk(action.action, action.storiesState)\r\n\t\t\t\t\t\t: reverseAction(action.action, action.storiesState)\r\n\t\t\t};\r\n\r\n\t\t\t// Slice off any changes after the current one.\r\n\r\n\t\t\tconst newChanges = [\r\n\t\t\t\t...state.changes.slice(0, state.currentChange + 1),\r\n\t\t\t\tnewChange\r\n\t\t\t];\r\n\r\n\t\t\treturn {\r\n\t\t\t\tchanges: newChanges,\r\n\t\t\t\tcurrentChange: newChanges.length - 1\r\n\t\t\t};\r\n\r\n\t\tcase 'updateCurrent':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentChange: Math.min(\r\n\t\t\t\t\tMath.max(state.currentChange + action.change, -1),\r\n\t\t\t\t\tstate.changes.length - 1\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t}\r\n};\r\n","// This context wraps access to a StoriesContext so that changes made can be\r\n// undone. To properly use this, a change should be dispatched via either a\r\n// single action object or a thunk. This context assumes that each dispatch call\r\n// should be treated as a discrete change. If this context is being used, all\r\n// changes should go through this context--the StoriesContext shouldn't be\r\n// accessed directly.\r\n\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {\r\n\tStoriesActionOrThunk,\r\n\tUndoableStoriesContextProps\r\n} from './undoable-stories.types';\r\nimport {reducer} from './reducer';\r\nimport {useStoriesContext} from '../stories';\r\n\r\nexport const UndoableStoriesContext = React.createContext<UndoableStoriesContextProps>(\r\n\t{\r\n\t\tdispatch: () => {},\r\n\t\tstories: []\r\n\t}\r\n);\r\n\r\nUndoableStoriesContext.displayName = 'UndoableStories';\r\n\r\nexport const useUndoableStoriesContext = () =>\r\n\tReact.useContext(UndoableStoriesContext);\r\n\r\nexport const UndoableStoriesContextProvider: React.FC = props => {\r\n\tconst {dispatch: storiesDispatch, stories} = useStoriesContext();\r\n\tconst [state, dispatch] = React.useReducer(reducer, {\r\n\t\tchanges: [],\r\n\t\tcurrentChange: -1\r\n\t});\r\n\tconst dispatchAndRecordStoryAction = React.useCallback(\r\n\t\t(action: StoriesActionOrThunk, description?: string) => {\r\n\t\t\tif (description) {\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addChange',\r\n\t\t\t\t\taction,\r\n\t\t\t\t\tdescription: description,\r\n\t\t\t\t\tstoriesState: stories\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn storiesDispatch(action);\r\n\t\t},\r\n\t\t[stories, storiesDispatch]\r\n\t);\r\n\tconst {t} = useTranslation();\r\n\r\n\tlet redo: (() => void) | undefined = undefined;\r\n\tlet redoLabel: string | undefined = undefined;\r\n\tlet undo: (() => void) | undefined = undefined;\r\n\tlet undoLabel: string | undefined = undefined;\r\n\r\n\tif (state.changes.length > 0) {\r\n\t\tif (state.currentChange >= 0) {\r\n\t\t\tundo = () => {\r\n\t\t\t\tstoriesDispatch(state.changes[state.currentChange].undo);\r\n\t\t\t\tdispatch({type: 'updateCurrent', change: -1});\r\n\t\t\t};\r\n\t\t\tundoLabel = t('common.undoChange', {\r\n\t\t\t\tchange: t(state.changes[state.currentChange].description)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (state.currentChange < state.changes.length - 1) {\r\n\t\t\tredo = () => {\r\n\t\t\t\tstoriesDispatch(state.changes[state.currentChange + 1].redo);\r\n\t\t\t\tdispatch({type: 'updateCurrent', change: 1});\r\n\t\t\t};\r\n\t\t\tredoLabel = t('common.redoChange', {\r\n\t\t\t\tchange: t(state.changes[state.currentChange + 1].description)\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<UndoableStoriesContext.Provider\r\n\t\t\tvalue={{\r\n\t\t\t\tdispatch: dispatchAndRecordStoryAction,\r\n\t\t\t\tredo,\r\n\t\t\t\tredoLabel,\r\n\t\t\t\tstories,\r\n\t\t\t\tundo,\r\n\t\t\t\tundoLabel\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{props.children}\r\n\t\t</UndoableStoriesContext.Provider>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {StoryFormat, sortFormats} from '../../store/story-formats';\r\nimport {TextSelect, TextSelectProps} from '../control/text-select';\r\n\r\nexport interface StoryFormatSelectProps\r\n\textends Omit<TextSelectProps, 'options' | 'value'> {\r\n\tformats: StoryFormat[];\r\n\tselectedFormat: StoryFormat;\r\n}\r\n\r\nexport const StoryFormatSelect: React.FC<StoryFormatSelectProps> = props => {\r\n\tconst {formats, selectedFormat, ...other} = props;\r\n\tconst {t} = useTranslation();\r\n\tconst loadingFormats = formats.filter(\r\n\t\tformat => format.loadState === 'loading'\r\n\t);\r\n\tconst visibleFormats = sortFormats(\r\n\t\tformats.filter(\r\n\t\t\tformat => format.loadState === 'loaded' || format.id === selectedFormat.id\r\n\t\t)\r\n\t);\r\n\tconst options = visibleFormats.map(format => ({\r\n\t\tdisabled: false,\r\n\t\tlabel: `${format.name} ${format.version}`,\r\n\t\tvalue: format.id\r\n\t}));\r\n\r\n\tif (loadingFormats.length !== 0) {\r\n\t\toptions.push({\r\n\t\t\tdisabled: true,\r\n\t\t\tlabel: t('components.storyFormatSelect.loadingCount', {\r\n\t\t\t\tloadingCount: loadingFormats.length\r\n\t\t\t}),\r\n\t\t\tvalue: ''\r\n\t\t});\r\n\t}\r\n\r\n\treturn <TextSelect {...other} options={options} value={selectedFormat.id} />;\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {storyStats, Story} from '../../store/stories';\r\nimport './story-stats.css';\r\n\r\nconst dateFormatter = new Intl.DateTimeFormat([], {\r\n\tdateStyle: 'full',\r\n\ttimeStyle: 'long'\r\n});\r\n\r\nexport interface StoryDetailsDialogStatsProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const StoryDetailsDialogStats: React.FC<StoryDetailsDialogStatsProps> = props => {\r\n\tconst {story} = props;\r\n\tconst stats = storyStats(story);\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<div className=\"story-stats\">\r\n\t\t\t<table className=\"counts\">\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>{stats.characters}</td>\r\n\t\t\t\t\t\t<td>{t('dialogs.storyDetails.stats.characters')}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>{stats.words}</td>\r\n\t\t\t\t\t\t<td>{t('dialogs.storyDetails.stats.words')}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>{stats.passages}</td>\r\n\t\t\t\t\t\t<td>{t('dialogs.storyDetails.stats.passages')}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>{stats.links.length}</td>\r\n\t\t\t\t\t\t<td>{t('dialogs.storyDetails.stats.links')}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>{stats.brokenLinks.length}</td>\r\n\t\t\t\t\t\t<td>{t('dialogs.storyDetails.stats.brokenLinks')}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t\t<div className=\"update-and-ifid\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\t{t('dialogs.storyDetails.stats.lastUpdate', {\r\n\t\t\t\t\t\tdate: dateFormatter.format(story.lastUpdate)\r\n\t\t\t\t\t})}\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\t\t\t{t('dialogs.storyDetails.stats.ifid', {ifid: story.ifid})}&nbsp;\r\n\t\t\t\t\t<a href=\"https://ifdb.org/help-ifid\" target=\"_blank\" rel=\"noreferrer\">\r\n\t\t\t\t\t\t{t('dialogs.storyDetails.stats.ifidExplanation')}\r\n\t\t\t\t\t</a>\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {CheckboxButton} from '../../components/control/checkbox-button';\r\nimport {ButtonBar} from '../../components/container/button-bar';\r\nimport {CardContent} from '../../components/container/card';\r\nimport {DialogCard} from '../../components/container/dialog-card';\r\nimport {StoryFormatSelect} from '../../components/story-format/story-format-select';\r\nimport {storyWithId, updateStory, useStoriesContext} from '../../store/stories';\r\nimport {\r\n\tformatWithId,\r\n\tformatWithNameAndVersion,\r\n\tuseStoryFormatsContext\r\n} from '../../store/story-formats';\r\nimport {FormatLoader} from '../../store/format-loader';\r\nimport {DialogComponentProps} from '../dialogs.types';\r\nimport {StoryDetailsDialogStats} from './story-stats';\r\n\r\nexport interface StoryDetailsDialogProps extends DialogComponentProps {\r\n\tstoryId: string;\r\n}\r\n\r\nexport const StoryDetailsDialog: React.FC<StoryDetailsDialogProps> = props => {\r\n\tconst {storyId, ...other} = props;\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst {formats} = useStoryFormatsContext();\r\n\tconst story = storyWithId(stories, storyId);\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleFormatChange(event: React.ChangeEvent<HTMLSelectElement>) {\r\n\t\tconst newFormat = formatWithId(formats, event.target.value);\r\n\r\n\t\tdispatch(\r\n\t\t\tupdateStory(stories, story, {\r\n\t\t\t\tstoryFormat: newFormat.name,\r\n\t\t\t\tstoryFormatVersion: newFormat.version\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...other}\r\n\t\t\tclassName=\"story-details-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={story.name}\r\n\t\t>\r\n\t\t\t<div className=\"story-format\">\r\n\t\t\t\t<FormatLoader block={false} />\r\n\t\t\t\t<StoryFormatSelect\r\n\t\t\t\t\tformats={formats}\r\n\t\t\t\t\tonChange={handleFormatChange}\r\n\t\t\t\t\tselectedFormat={formatWithNameAndVersion(\r\n\t\t\t\t\t\tformats,\r\n\t\t\t\t\t\tstory.storyFormat,\r\n\t\t\t\t\t\tstory.storyFormatVersion\r\n\t\t\t\t\t)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('common.storyFormat')}\r\n\t\t\t\t</StoryFormatSelect>\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"https://twinery.org/2storyformats\"\r\n\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\trel=\"noreferrer\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('dialogs.storyDetails.storyFormatExplanation')}\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n\t\t\t<ButtonBar>\r\n\t\t\t\t<CheckboxButton\r\n\t\t\t\t\tlabel={t('dialogs.storyDetails.snapToGrid')}\r\n\t\t\t\t\tonChange={value =>\r\n\t\t\t\t\t\tdispatch(updateStory(stories, story, {snapToGrid: value}))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalue={story.snapToGrid}\r\n\t\t\t\t/>\r\n\t\t\t</ButtonBar>\r\n\t\t\t<CardContent>\r\n\t\t\t\t{!other.collapsed && <StoryDetailsDialogStats story={story} />}\r\n\t\t\t</CardContent>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {TextInput} from './text-input';\r\nimport {TextSelect} from './text-select';\r\nimport './font-select.css';\r\n\r\nconst families = ['var(--font-monospaced)', 'var(--font-system)'];\r\nconst scales = [0.8, 0.9, 1, 1.25, 1.5, 2];\r\n\r\nexport interface FontSelectProps {\r\n\tfamilyLabel: string;\r\n\tfontFamily: string;\r\n\tfontScale: number;\r\n\tonChangeFamily: (value: string) => void;\r\n\tonChangeScale: (value: number) => void;\r\n\tscaleLabel: string;\r\n}\r\n\r\nexport const FontSelect: React.FC<FontSelectProps> = props => {\r\n\tconst {\r\n\t\tfamilyLabel,\r\n\t\tfontFamily,\r\n\t\tfontScale,\r\n\t\tonChangeFamily,\r\n\t\tonChangeScale,\r\n\t\tscaleLabel\r\n\t} = props;\r\n\tconst [customScaleVisible, setCustomScaleVisible] = React.useState(\r\n\t\t!scales.includes(fontScale)\r\n\t);\r\n\tconst [customFamilyVisible, setCustomFamilyVisible] = React.useState(\r\n\t\t!families.includes(fontFamily)\r\n\t);\r\n\tconst [customFamily, setCustomFamily] = React.useState(fontFamily);\r\n\tconst [customScale, setCustomScale] = React.useState(\r\n\t\t(fontScale * 100).toString()\r\n\t);\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleFamilyChange(event: React.ChangeEvent<HTMLSelectElement>) {\r\n\t\tif (event.target.value === 'custom') {\r\n\t\t\tsetCustomFamilyVisible(true);\r\n\t\t\tif (families.includes(customFamily)) {\r\n\t\t\t\tsetCustomFamily('');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsetCustomFamilyVisible(false);\r\n\t\t\tonChangeFamily(event.target.value);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleScaleChange(event: React.ChangeEvent<HTMLSelectElement>) {\r\n\t\tif (event.target.value === 'custom') {\r\n\t\t\tsetCustomScaleVisible(true);\r\n\t\t} else {\r\n\t\t\tsetCustomScaleVisible(false);\r\n\t\t\tonChangeScale(parseFloat(event.target.value));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleCustomFamilyChange(\r\n\t\tevent: React.ChangeEvent<HTMLInputElement>\r\n\t) {\r\n\t\tsetCustomFamily(event.target.value);\r\n\r\n\t\tif (event.target.value.trim() !== '') {\r\n\t\t\tonChangeFamily(event.target.value);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleCustomScaleChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n\t\tsetCustomScale(event.target.value);\r\n\r\n\t\tconst value = parseInt(event.target.value);\r\n\r\n\t\tif (Number.isFinite(value)) {\r\n\t\t\tonChangeScale(value / 100);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"font-select\">\r\n\t\t\t<TextSelect\r\n\t\t\t\tonChange={handleFamilyChange}\r\n\t\t\t\toptions={[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: t('components.fontSelect.fonts.system'),\r\n\t\t\t\t\t\tvalue: 'var(--font-system)'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: t('components.fontSelect.fonts.monospaced'),\r\n\t\t\t\t\t\tvalue: 'var(--font-monospaced)'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: t('common.custom'),\r\n\t\t\t\t\t\tvalue: 'custom'\r\n\t\t\t\t\t}\r\n\t\t\t\t]}\r\n\t\t\t\tvalue={customFamilyVisible ? 'custom' : fontFamily}\r\n\t\t\t>\r\n\t\t\t\t{familyLabel}\r\n\t\t\t</TextSelect>\r\n\t\t\t{customFamilyVisible && (\r\n\t\t\t\t<TextInput\r\n\t\t\t\t\tonChange={handleCustomFamilyChange}\r\n\t\t\t\t\torientation=\"vertical\"\r\n\t\t\t\t\tvalue={customFamily}\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('components.fontSelect.customFamilyDetail')}\r\n\t\t\t\t</TextInput>\r\n\t\t\t)}\r\n\t\t\t<TextSelect\r\n\t\t\t\tonChange={handleScaleChange}\r\n\t\t\t\toptions={[\r\n\t\t\t\t\t...scales.map(scale => ({\r\n\t\t\t\t\t\tlabel: t('components.fontSelect.percentage', {\r\n\t\t\t\t\t\t\tpercent: scale * 100\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tvalue: scale.toString()\r\n\t\t\t\t\t})),\r\n\t\t\t\t\t{label: t('common.custom'), value: 'custom'}\r\n\t\t\t\t]}\r\n\t\t\t\tvalue={customScaleVisible ? 'custom' : fontScale.toString()}\r\n\t\t\t>\r\n\t\t\t\t{scaleLabel}\r\n\t\t\t</TextSelect>\r\n\t\t\t{customScaleVisible && (\r\n\t\t\t\t<TextInput\r\n\t\t\t\t\tonChange={handleCustomScaleChange}\r\n\t\t\t\t\torientation=\"vertical\"\r\n\t\t\t\t\tvalue={customScale}\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('components.fontSelect.customScaleDetail')}\r\n\t\t\t\t</TextInput>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n","/**\r\n * Locales supported in the app.\r\n * @see https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\r\n */\r\nexport const locales = [\r\n\t{code: 'ca', name: 'Català'},\r\n\t{code: 'cs', name: 'Čeština'},\r\n\t{code: 'da', name: 'Dansk'},\r\n\t{code: 'de', name: 'Deutsch'},\r\n\t{code: 'en', name: 'English'},\r\n\t{code: 'es', name: 'Castellano'},\r\n\t{code: 'fi', name: 'Suomi'},\r\n\t{code: 'fr', name: 'Français'},\r\n\t{code: 'it', name: 'Italiano'},\r\n\t{code: 'ms', name: 'Bahasa Melayu'},\r\n\t{code: 'nb', name: 'Norsk bokmål'},\r\n\t{code: 'nl', name: 'Nederlands'},\r\n\t{code: 'pt-br', name: 'Português Brasileiro'},\r\n\t{code: 'pt-pt', name: 'Português'},\r\n\t{code: 'ru', name: 'русский'},\r\n\t{code: 'sv', name: 'Svenska'},\r\n\t{code: 'tr', name: 'Türkçe'},\r\n\t{code: 'zh-cn', name: '中文(简体)'}\r\n];\r\n\r\n/**\r\n * Finds the closest match for a locale in app-supported locales, for example\r\n * mapping `en-US` to `en`. If none are plausible, this returns `en` as a\r\n * default.\r\n */\r\nexport function closestAppLocale(code: string) {\r\n\t// Exact match? \r\n\r\n\tif (locales.some(locale => locale.code === code)) {\r\n\t\treturn code;\r\n\t}\r\n\r\n\tif (code.includes('-')) {\r\n\t\tconst roughCode = code.replace(/-.+/, '');\r\n\t\tconst roughMatch = locales.find(locale => locale.code === roughCode || locale.code.replace(/-.+/, '') === roughCode);\r\n\r\n\t\tif (roughMatch) {\r\n\t\t\treturn roughMatch.code;\r\n\t\t}\r\n\t}\r\n\r\n\treturn 'en';\r\n}","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {CardContent} from '../components/container/card';\r\nimport {DialogCard, DialogCardProps} from '../components/container/dialog-card';\r\nimport {CheckboxButton} from '../components/control/checkbox-button';\r\nimport {FontSelect} from '../components/control/font-select';\r\nimport {TextSelect} from '../components/control/text-select';\r\nimport {setPref, usePrefsContext} from '../store/prefs';\r\nimport {closestAppLocale, locales} from '../util/locales';\r\nimport './app-prefs.css';\r\n\r\nexport const AppPrefsDialog: React.FC<\r\n\tOmit<DialogCardProps, 'headerLabel'>\r\n> = props => {\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...props}\r\n\t\t\tclassName=\"app-prefs-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.appPrefs.title')}\r\n\t\t>\r\n\t\t\t<CardContent>\r\n\t\t\t\t<TextSelect\r\n\t\t\t\t\tonChange={e => dispatch(setPref('locale', e.target.value))}\r\n\t\t\t\t\toptions={locales.map(locale => ({\r\n\t\t\t\t\t\tlabel: locale.name,\r\n\t\t\t\t\t\tvalue: locale.code\r\n\t\t\t\t\t}))}\r\n\t\t\t\t\tvalue={closestAppLocale(prefs.locale)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('dialogs.appPrefs.language')}\r\n\t\t\t\t</TextSelect>\r\n\t\t\t\t<TextSelect\r\n\t\t\t\t\tonChange={e => dispatch(setPref('appTheme', e.target.value))}\r\n\t\t\t\t\toptions={[\r\n\t\t\t\t\t\t{label: t('dialogs.appPrefs.themeSystem'), value: 'system'},\r\n\t\t\t\t\t\t{label: t('dialogs.appPrefs.themeLight'), value: 'light'},\r\n\t\t\t\t\t\t{label: t('dialogs.appPrefs.themeDark'), value: 'dark'}\r\n\t\t\t\t\t]}\r\n\t\t\t\t\tvalue={prefs.appTheme}\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('dialogs.appPrefs.theme')}\r\n\t\t\t\t</TextSelect>\r\n\t\t\t\t<TextSelect\r\n\t\t\t\t\tonChange={e =>\r\n\t\t\t\t\t\tdispatch(setPref('dialogWidth', parseInt(e.target.value)))\r\n\t\t\t\t\t}\r\n\t\t\t\t\toptions={[\r\n\t\t\t\t\t\t{label: t('dialogs.appPrefs.dialogWidths.default'), value: '600'},\r\n\t\t\t\t\t\t{label: t('dialogs.appPrefs.dialogWidths.wider'), value: '700'},\r\n\t\t\t\t\t\t{label: t('dialogs.appPrefs.dialogWidths.widest'), value: '800'}\r\n\t\t\t\t\t]}\r\n\t\t\t\t\tvalue={prefs.dialogWidth.toString()}\r\n\t\t\t\t>\r\n\t\t\t\t\t{t('dialogs.appPrefs.dialogWidth')}\r\n\t\t\t\t</TextSelect>\r\n\t\t\t\t<CheckboxButton\r\n\t\t\t\t\tlabel={t('dialogs.appPrefs.editorCursorBlinks')}\r\n\t\t\t\t\tonChange={value => dispatch(setPref('editorCursorBlinks', value))}\r\n\t\t\t\t\tvalue={prefs.editorCursorBlinks}\r\n\t\t\t\t/>\r\n\t\t\t\t<p className=\"font-explanation\">\r\n\t\t\t\t\t{t('dialogs.appPrefs.fontExplanation')}\r\n\t\t\t\t</p>\r\n\t\t\t\t<FontSelect\r\n\t\t\t\t\tfamilyLabel={t('dialogs.appPrefs.passageEditorFont')}\r\n\t\t\t\t\tfontFamily={prefs.passageEditorFontFamily}\r\n\t\t\t\t\tfontScale={prefs.passageEditorFontScale}\r\n\t\t\t\t\tonChangeFamily={value =>\r\n\t\t\t\t\t\tdispatch(setPref('passageEditorFontFamily', value))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonChangeScale={value =>\r\n\t\t\t\t\t\tdispatch(setPref('passageEditorFontScale', value))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tscaleLabel={t('dialogs.appPrefs.passageEditorFontScale')}\r\n\t\t\t\t/>\r\n\t\t\t\t<FontSelect\r\n\t\t\t\t\tfamilyLabel={t('dialogs.appPrefs.codeEditorFont')}\r\n\t\t\t\t\tfontFamily={prefs.codeEditorFontFamily}\r\n\t\t\t\t\tfontScale={prefs.codeEditorFontScale}\r\n\t\t\t\t\tonChangeFamily={value =>\r\n\t\t\t\t\t\tdispatch(setPref('codeEditorFontFamily', value))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonChangeScale={value =>\r\n\t\t\t\t\t\tdispatch(setPref('codeEditorFontScale', value))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tscaleLabel={t('dialogs.appPrefs.codeEditorFontScale')}\r\n\t\t\t\t/>\r\n\t\t\t</CardContent>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {usePersistence} from '../persistence/use-persistence';\r\nimport {useStoreErrorReporter} from '../use-store-error-reporter';\r\nimport {defaults} from './defaults';\r\nimport {PrefsAction, PrefsContextProps, PrefsState} from './prefs.types';\r\nimport {reducer} from './reducer';\r\n\r\nexport const PrefsContext = React.createContext<PrefsContextProps>({\r\n\tdispatch: () => {},\r\n\tprefs: defaults()\r\n});\r\n\r\nPrefsContext.displayName = 'Prefs';\r\n\r\nexport const usePrefsContext = () => React.useContext(PrefsContext);\r\n\r\nexport const PrefsContextProvider: React.FC = props => {\r\n\tconst {prefs} = usePersistence();\r\n\tconst {reportError} = useStoreErrorReporter();\r\n\tconst persistedReducer: React.Reducer<\r\n\t\tPrefsState,\r\n\t\tPrefsAction\r\n\t> = React.useCallback(\r\n\t\t(state, action) => {\r\n\t\t\tconst newState = reducer(state, action);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tprefs.saveMiddleware(newState, action);\r\n\t\t\t} catch (error) {\r\n\t\t\t\treportError(error, 'store.errors.cantPersistPrefs');\r\n\t\t\t}\r\n\r\n\t\t\treturn newState;\r\n\t\t},\r\n\t\t[prefs, reportError]\r\n\t);\r\n\r\n\tconst [state, dispatch] = React.useReducer(persistedReducer, defaults());\r\n\r\n\treturn (\r\n\t\t<PrefsContext.Provider\r\n\t\t\tvalue={{\r\n\t\t\t\tdispatch,\r\n\t\t\t\tprefs: state\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{props.children}\r\n\t\t</PrefsContext.Provider>\r\n\t);\r\n};\r\n","import {PrefsAction, PrefsState} from './prefs.types';\r\nimport {defaults} from './defaults';\r\nimport {formatWithNameAndVersion, newestFormatNamed} from '../story-formats';\r\n\r\nexport const reducer: React.Reducer<PrefsState, PrefsAction> = (\r\n\tstate,\r\n\taction\r\n) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'init':\r\n\t\t\treturn {...state, ...action.state};\r\n\r\n\t\tcase 'repair':\r\n\t\t\tconst defs = defaults();\r\n\r\n\t\t\t// Type check values.\r\n\r\n\t\t\tlet changes: Partial<PrefsState> = Object.entries(defs).reduce(\r\n\t\t\t\t(result, [key, value]) => {\r\n\t\t\t\t\tconst prefKey = key as keyof PrefsState;\r\n\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t(typeof value === 'number' && !Number.isFinite(state[prefKey])) ||\r\n\t\t\t\t\t\ttypeof value !== typeof state[prefKey]\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t\t`Repairing preference \"${key}\" by setting it to ${value}, ` +\r\n\t\t\t\t\t\t\t\t`was ${state[prefKey]} (bad type)`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\treturn {...result, [prefKey]: value};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t);\r\n\r\n\t\t\t// If the proofing or story format don't match an existing format, repair\r\n\t\t\t// them to the most recent version with the same name. If none exist with\r\n\t\t\t// that name, repair to the default.\r\n\r\n\t\t\tconst {proofingFormat, storyFormat} = state;\r\n\t\t\tconst {allFormats} = action;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tformatWithNameAndVersion(\r\n\t\t\t\t\tallFormats,\r\n\t\t\t\t\tproofingFormat.name,\r\n\t\t\t\t\tproofingFormat.version\r\n\t\t\t\t);\r\n\t\t\t} catch {\r\n\t\t\t\tconst format = newestFormatNamed(allFormats, proofingFormat.name);\r\n\r\n\t\t\t\tif (format) {\r\n\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t`Repairing proofing format preference (version doesn't exist) by setting to ${format.name} ${format.version}, was ${proofingFormat.name} ${proofingFormat.version}`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tchanges.proofingFormat = {name: format.name, version: format.version};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t`Repairing proofing format preference (format doesn't exist at all) by setting to default ${defs.proofingFormat.name} ${defs.proofingFormat.version}, was ${proofingFormat.name} ${proofingFormat.version}`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tchanges.proofingFormat = {\r\n\t\t\t\t\t\tname: defs.proofingFormat.name,\r\n\t\t\t\t\t\tversion: defs.proofingFormat.version\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tformatWithNameAndVersion(\r\n\t\t\t\t\tallFormats,\r\n\t\t\t\t\tstoryFormat.name,\r\n\t\t\t\t\tstoryFormat.version\r\n\t\t\t\t);\r\n\t\t\t} catch {\r\n\t\t\t\tconst format = newestFormatNamed(allFormats, storyFormat.name);\r\n\r\n\t\t\t\tif (format) {\r\n\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t`Repairing story format preference (version doesn't exist) by setting to ${format.name} ${format.version}, was ${storyFormat.name} ${storyFormat.version}`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tchanges.storyFormat = {name: format.name, version: format.version};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t`Repairing story format preference (format doesn't exist at all) by setting to default ${defs.storyFormat.name} ${defs.storyFormat.version}, was ${storyFormat.name} ${proofingFormat.version}`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tchanges.storyFormat = {\r\n\t\t\t\t\t\tname: defs.storyFormat.name,\r\n\t\t\t\t\t\tversion: defs.storyFormat.version\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {...state, ...changes};\r\n\r\n\t\tcase 'update': {\r\n\t\t\treturn {...state, [action.name]: action.value};\r\n\t\t}\r\n\t}\r\n};\r\n","import uuid from 'tiny-uuid';\r\nimport * as React from 'react';\r\nimport useThunkReducer from 'react-hook-thunk-reducer';\r\nimport {usePersistence} from '../persistence/use-persistence';\r\nimport {builtins} from './defaults';\r\nimport {\r\n\tStoryFormat,\r\n\tStoryFormatsAction,\r\n\tStoryFormatsContextProps,\r\n\tStoryFormatsState\r\n} from './story-formats.types';\r\nimport {useStoreErrorReporter} from '../use-store-error-reporter';\r\nimport {reducer} from './reducer';\r\n\r\nconst defaultBuiltins: StoryFormat[] = builtins().map(f => ({\r\n\t...f,\r\n\tid: uuid(),\r\n\tloadState: 'unloaded',\r\n\tselected: false,\r\n\tuserAdded: false\r\n}));\r\n\r\nexport const StoryFormatsContext = React.createContext<StoryFormatsContextProps>(\r\n\t{\r\n\t\tdispatch: () => {},\r\n\t\tformats: []\r\n\t}\r\n);\r\n\r\nStoryFormatsContext.displayName = 'StoryFormats';\r\n\r\nexport const useStoryFormatsContext = () =>\r\n\tReact.useContext(StoryFormatsContext);\r\n\r\nexport const StoryFormatsContextProvider: React.FC = props => {\r\n\tconst {storyFormats} = usePersistence();\r\n\tconst {reportError} = useStoreErrorReporter();\r\n\tconst persistedReducer: React.Reducer<\r\n\t\tStoryFormatsState,\r\n\t\tStoryFormatsAction\r\n\t> = React.useCallback(\r\n\t\t(state, action) => {\r\n\t\t\tconst newState = reducer(state, action);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tstoryFormats.saveMiddleware(newState, action);\r\n\t\t\t} catch (error) {\r\n\t\t\t\treportError(error, 'store.errors.cantPersistStoryFormats');\r\n\t\t\t}\r\n\t\t\treturn newState;\r\n\t\t},\r\n\t\t[reportError, storyFormats]\r\n\t);\r\n\r\n\tconst [state, dispatch] = useThunkReducer(persistedReducer, defaultBuiltins);\r\n\r\n\treturn (\r\n\t\t<StoryFormatsContext.Provider\r\n\t\t\tvalue={{\r\n\t\t\t\tdispatch,\r\n\t\t\t\tformats: state\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{props.children}\r\n\t\t</StoryFormatsContext.Provider>\r\n\t);\r\n};\r\n","import uuid from 'tiny-uuid';\r\nimport {builtins} from './defaults';\r\nimport {\r\n\tStoryFormat,\r\n\tStoryFormatsAction,\r\n\tStoryFormatsState\r\n} from './story-formats.types';\r\n\r\nexport const reducer: React.Reducer<StoryFormatsState, StoryFormatsAction> = (\r\n\tstate,\r\n\taction\r\n) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'init':\r\n\t\t\treturn [...action.state];\r\n\r\n\t\tcase 'repair':\r\n\t\t\tconst builtinFormats = builtins();\r\n\r\n\t\t\t// Filter out any outdated builtins.\r\n\r\n\t\t\tconst result = state.filter(format => {\r\n\t\t\t\tconst keep =\r\n\t\t\t\t\tformat.userAdded ||\r\n\t\t\t\t\tbuiltinFormats.some(\r\n\t\t\t\t\t\tf => f.name === format.name && f.version === format.version\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\tif (!keep) {\r\n\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t`Repairing story formats by removing ${format.name} ${format.version} ` +\r\n\t\t\t\t\t\t\t`(outdated version of built-in format)`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn keep;\r\n\t\t\t});\r\n\r\n\t\t\t// Add any builtins not present.\r\n\r\n\t\t\tbuiltinFormats.forEach(builtinFormat => {\r\n\t\t\t\tif (\r\n\t\t\t\t\t!result.some(\r\n\t\t\t\t\t\tf =>\r\n\t\t\t\t\t\t\tf.name === builtinFormat.name &&\r\n\t\t\t\t\t\t\tf.version === builtinFormat.version\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\tconsole.info(\r\n\t\t\t\t\t\t`Repairing story formats by adding built-in ${builtinFormat.name} ${builtinFormat.version}`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\t...builtinFormat,\r\n\t\t\t\t\t\tid: uuid(),\r\n\t\t\t\t\t\tloadState: 'unloaded',\r\n\t\t\t\t\t\tselected: false,\r\n\t\t\t\t\t\tuserAdded: false\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn result;\r\n\r\n\t\tcase 'create':\r\n\t\t\tif (\r\n\t\t\t\tstate.some(\r\n\t\t\t\t\tformat =>\r\n\t\t\t\t\t\tformat.name === action.props.name &&\r\n\t\t\t\t\t\tformat.version === action.props.version\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\treturn state;\r\n\t\t\t}\r\n\r\n\t\t\treturn [...state, {...action.props, id: uuid(), loadState: 'unloaded'}];\r\n\r\n\t\tcase 'delete':\r\n\t\t\treturn state.filter(f => f.id !== action.id);\r\n\r\n\t\tcase 'update':\r\n\t\t\tif (\r\n\t\t\t\tstate.some(\r\n\t\t\t\t\tformat =>\r\n\t\t\t\t\t\tformat.id !== action.id &&\r\n\t\t\t\t\t\tformat.name === action.props.name &&\r\n\t\t\t\t\t\tformat.version === action.props.version\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\treturn state;\r\n\t\t\t}\r\n\r\n\t\t\treturn state.map(format => {\r\n\t\t\t\tif (format.id !== action.id) {\r\n\t\t\t\t\treturn format;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {...format, ...action.props} as StoryFormat;\r\n\t\t\t});\r\n\t}\r\n\r\n\treturn state;\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconCode, IconHeart} from '@tabler/icons';\r\nimport {ButtonBar} from '../../components/container/button-bar';\r\nimport {DialogCard} from '../../components/container/dialog-card';\r\nimport {IconLink} from '../../components/control/icon-link';\r\nimport {getAppInfo} from '../../util/app-info';\r\nimport {DialogComponentProps} from '../dialogs.types';\r\nimport credits from './credits.json';\r\nimport './about-twine.css';\r\n\r\nexport const AboutTwineDialog: React.FC<DialogComponentProps> = props => {\r\n\tconst {t} = useTranslation();\r\n\tconst info = getAppInfo();\r\n\r\n\treturn (\r\n\t\t<DialogCard\r\n\t\t\t{...props}\r\n\t\t\tclassName=\"about-twine-dialog\"\r\n\t\t\tfixedSize\r\n\t\t\theaderLabel={t('dialogs.aboutTwine.title', {\r\n\t\t\t\tversion: info.version\r\n\t\t\t})}\r\n\t\t>\r\n\t\t\t<div className=\"content\">\r\n\t\t\t\t<p>{t('dialogs.aboutTwine.twineDescription')}</p>\r\n\t\t\t\t<p\r\n\t\t\t\t\tdangerouslySetInnerHTML={{\r\n\t\t\t\t\t\t__html: t('dialogs.aboutTwine.license')\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t\t<div className=\"credits\">\r\n\t\t\t\t\t<div className=\"code\">\r\n\t\t\t\t\t\t<h3>{t('dialogs.aboutTwine.codeHeader')}</h3>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t{credits.code.map(c => (\r\n\t\t\t\t\t\t\t\t<li key={c}>{c}</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"localizations\">\r\n\t\t\t\t\t\t<h3>{t('dialogs.aboutTwine.localizationHeader')}</h3>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t{credits.localizations.map(c => (\r\n\t\t\t\t\t\t\t\t<li key={c}>{c}</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ButtonBar>\r\n\t\t\t\t\t<IconLink\r\n\t\t\t\t\t\thref=\"https://twinery.org/donate\"\r\n\t\t\t\t\t\ticon={<IconHeart />}\r\n\t\t\t\t\t\tlabel={t('dialogs.aboutTwine.donateToTwine')}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<IconLink\r\n\t\t\t\t\t\thref=\"https://github.com/klembot/twinejs\"\r\n\t\t\t\t\t\ticon={<IconCode />}\r\n\t\t\t\t\t\tlabel={t('dialogs.aboutTwine.codeRepo')}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</ButtonBar>\r\n\t\t\t</div>\r\n\t\t</DialogCard>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {IconLoading} from '../image/icon';\r\nimport './loading-curtain.css';\r\n\r\nexport const LoadingCurtain: React.FC = () => (\r\n\t<div className=\"loading-curtain\">\r\n\t\t<IconLoading />\r\n\t</div>\r\n);\r\n","// Listens to changes in the locale preference and changes i18n's language\r\n// accordingly.\r\n\r\nimport * as React from 'react';\r\nimport {usePrefsContext} from './prefs';\r\nimport {i18n} from '../util/i18n';\r\n\r\nexport const LocaleSwitcher: React.FC = () => {\r\n\tconst {prefs} = usePrefsContext();\r\n\r\n\tReact.useEffect(() => {\r\n\t\ti18n.changeLanguage(prefs.locale);\r\n\t}, [prefs.locale]);\r\n\r\n\treturn null;\r\n};\r\n","import * as React from 'react';\r\nimport 'element-closest';\r\n\r\nexport interface ClickAwayListenerProps {\r\n\tignoreSelector?: string;\r\n\tonClickAway: () => void;\r\n}\r\n\r\nexport const ClickAwayListener: React.FC<ClickAwayListenerProps> = props => {\r\n\tconst {children, ignoreSelector, onClickAway} = props;\r\n\tconst handleClick: React.MouseEventHandler = event => {\r\n\t\tif (ignoreSelector) {\r\n\t\t\tif (!(event.target as HTMLElement)?.closest(ignoreSelector)) {\r\n\t\t\t\tonClickAway();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tonClickAway();\r\n\t\t}\r\n\t};\r\n\r\n\treturn <div onClick={handleClick}>{children}</div>;\r\n};\r\n","// css 적용하는 코드인듯\r\n\r\n\r\nimport * as React from 'react';\r\nimport './card-group.css';\r\n\r\nexport type CardGroupProps =\r\n\t| {columns: number; maxWidth?: string}\r\n\t| {columnWidth: number | string; maxWidth?: string};\r\n\r\nexport const CardGroup: React.FC<CardGroupProps> = props => {\r\n\tconst style: React.CSSProperties = {\r\n\t\tgridTemplateColumns:\r\n\t\t\t'columnWidth' in props\r\n\t\t\t\t? `repeat(auto-fit, ${\r\n\t\t\t\t\t\ttypeof props.columnWidth === 'number'\r\n\t\t\t\t\t\t\t? props.columnWidth + 'px'\r\n\t\t\t\t\t\t\t: props.columnWidth\r\n\t\t\t\t  })`\r\n\t\t\t\t: `repeat(${props.columns}, 1fr)`,\r\n\t\tmaxWidth: props.maxWidth ?? 'auto'\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"card-group\" style={style}>\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n};\r\n","// 뭔지 모르겠음\r\n\r\n\r\nimport * as React from 'react';\r\nimport {Helmet} from 'react-helmet';\r\nimport {isElectronRenderer} from '../../util/is-electron';\r\n\r\nexport interface DocumentTitleProps {\r\n\ttitle: string;\r\n}\r\n\r\n/**\r\n * Sets the document title. This works around a bug with Electron and may not be\r\n * needed in later versions.\r\n */\r\nexport const DocumentTitle: React.FC<DocumentTitleProps> = ({title}) => {\r\n\t// Using `history.goBack()` doesn't seem to cause Electron to update the\r\n\t// window title bar--possibly tied to using a <HashRouter>. If it does in a\r\n\t// future version, we can just use react-helmet directly.\r\n\r\n\tReact.useEffect(() => {                                          /** setTimeout(실행할 함수, 기다릴 시간) */\r\n\t\tif (isElectronRenderer()) {\r\n\t\t\tconst timeout = window.setTimeout(() => {                   // 반환값 1. const timeout에 1 저장\r\n\t\t\t\tdocument.querySelector('title')!.innerHTML = title;       // title 태그의 내용을 새로만든 스토리의 제목으로 바꿈\r\n\t\t\t}, 0);\r\n\r\n\t\t\treturn () => window.clearTimeout(timeout);                // setTimeout() 해제.\r\n\t\t}\r\n\t}, [title]);                  // title값이 바뀔 때마다 실행\r\n\r\n\t// HTML의 헤더값을 변경할 때 사용하는 리액트 컴포넌트\r\n\t// 새로 만든 스토리의 제목으로 title 변경\r\n\treturn (\r\n\t\t<Helmet>                        \r\n\t\t\t<title>{title}</title>        \r\n\t\t</Helmet>\r\n\t);\r\n};\r\n","import classNames from 'classnames';\r\nimport * as React from 'react';\r\nimport {Point} from '../../util/geometry';\r\nimport {DocumentTitle} from '../document-title/document-title';\r\nimport './main-content.css';\r\n\r\nexport interface MainContentProps                      // 스토리 카드의 메인 콘텐츠(본문?)\r\n\textends React.ComponentPropsWithoutRef<'div'> {      // HTML<div> 태그\r\n\tgrabbable?: boolean;                                 // 그랩 가능 여부\r\n\tpadded?: boolean;                                    // \r\n\ttitle?: string;                                      // 스토리 카드 제목?\r\n}\r\n\r\nexport const MainContent = React.forwardRef<HTMLDivElement, MainContentProps>(       // forwardRef:자식 컴포넌트의 태그에 ref를 넣는 용도\r\n\t(props, ref) => {\r\n\t\tconst {children, grabbable, title} = props;                 // children, grabbable, title 프로퍼티로 전달\r\n\t\tconst containerRef = React.useRef<HTMLDivElement>(null);    // containerRef에 div 엘리멘트를 다룰 수 있게 함?\r\n\t\tconst className = classNames('main-content', {\r\n\t\t\tpadded: props.padded ?? true\r\n\t\t});\r\n\r\n\t\tReact.useImperativeHandle(\r\n\t\t\tref,\r\n\t\t\t() => containerRef.current as HTMLDivElement\r\n\t\t);\r\n\r\n\t\tReact.useEffect(() => {                      /** 두번째 인자 []가 변경될 때마다 특정 작업을 실행하는 함수\r\n\t\t                                                 []가 비어있으면 처음 호출될 때만 실행\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t []를 생략하면 컴포넌트가 리렌더링 될 때마다 실행 됨  */\r\n\t\t\tif (containerRef.current) {\r\n\t\t\t\tcontainerRef.current.focus();            // containerRef의 현재 엘리먼트에 포커스 유지\r\n\t\t\t}\r\n\t\t}, []);\r\n\r\n\t\tReact.useEffect(() => {                                   // grabbable값이 바뀔 때마다 호출\r\n\t\t\tconst container = containerRef.current;                // container는 현재 선택한 div\r\n\t\t\tlet dragScrollStart: Point;\r\n\t\t\tlet dragMouseStart: Point;\r\n\r\n\t\t\tfunction moveListener(event: PointerEvent) {                           // div 드래그\r\n\t\t\t\tif (container) {                                                    // container가 true라면\r\n\t\t\t\t\tcontainer.scrollLeft =\r\n\t\t\t\t\t\tdragScrollStart.left + (dragMouseStart.left - event.clientX);\r\n\t\t\t\t\tcontainer.scrollTop =\r\n\t\t\t\t\t\tdragScrollStart.top + (dragMouseStart.top - event.clientY);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction stopGrab(event: PointerEvent) {                      // div 놓기\r\n\t\t\t\tif (!container) {                                           // container == false일 때, return\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer.releasePointerCapture(event.pointerId);               // container의 현재 pointerId를 엘리먼트에서 해제한다\r\n\t\t\t\tcontainer.removeEventListener('pointerleave', stopGrab);         // div에서 포인터 해제\r\n\t\t\t\tcontainer.removeEventListener('pointermove', moveListener);      // div 드래그\r\n\t\t\t\tcontainer.style.cursor = '';                                    // 커서 스타일 기본으로 변경\r\n\t\t\t\tevent.preventDefault();                                         // 엘리멘트의 기본 기능 차단\r\n\t\t\t}\r\n\r\n\t\t\tfunction upListener(event: PointerEvent) {                     // 포인터가 활성화 되어있지 않으면 시작하는 이벤트\r\n\t\t\t\tif (event.button === 2) {                                   // 버튼 우클릭 시\r\n\t\t\t\t\tstopGrab(event);                                         // stopGrab 호출\r\n\t\t\t\t}                                                          // 우클릭하면 div 놓는 기능\r\n\t\t\t}\r\n\r\n\t\t\tfunction downListener(event: PointerEvent) {                 // 마우스를 누르면 발생하는 이벤트\r\n\t\t\t\tif (event.button !== 2 || !container) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer.setPointerCapture(event.pointerId);                     // 해당 div 포인터를 유지하는 기능\r\n\t\t\t\tcontainer.addEventListener('pointerleave', stopGrab);             \r\n\t\t\t\tcontainer.addEventListener('pointermove', moveListener);\r\n\t\t\t\tcontainer.addEventListener('pointerup', upListener);\r\n\t\t\t\tcontainer.style.cursor = 'grabbing';                           // 커서 모양 바뀜\r\n\t\t\t\tdragScrollStart = {\r\n\t\t\t\t\tleft: container.scrollLeft,\r\n\t\t\t\t\ttop: container.scrollTop\r\n\t\t\t\t};\r\n\t\t\t\tdragMouseStart = {left: event.clientX, top: event.clientY};\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\r\n\t\t\tfunction ignoreContext(event: Event) {                            // 마우스 우클릭 시 메뉴가 나오지 않게함\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\r\n\t\t\tif (grabbable && container) {                                       // div 선택, div잡을 수 있는 상태이면\r\n\t\t\t\tcontainer.addEventListener('pointerdown', downListener);\r\n\t\t\t\tcontainer.addEventListener('contextmenu', ignoreContext);         // contextmenu : 우클릭하였을 때 발생하는 이벤트.\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\tcontainer.removeEventListener('pointerdown', downListener);          // \r\n\t\t\t\t\tcontainer.removeEventListener('contextmenu', ignoreContext);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}, [grabbable]);\r\n\r\n\r\n\t\t// 새로 만든 스토리의 제목을 DocumentTitle로 넘겨서 HTML 형태로 저장\r\n\t\treturn (\r\n\t\t\t<div className={className} ref={containerRef}>                 \r\n\t\t\t\t{title && (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<DocumentTitle title={title} />             \r\n\t\t\t\t\t\t<h1>{title}</h1>\r\n\t\t\t\t\t</>\r\n\t\t\t\t)}\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n);\r\n","import * as React from 'react';\r\nimport './badge.css';\r\n\r\nexport interface BadgeProps {\r\n\tlabel: string;\r\n}\r\n\r\nexport const Badge: React.FC<BadgeProps> = ({label}) => (\r\n\t<span className=\"badge\">{label}</span>\r\n);\r\n","import classNames from 'classnames';                                  // 스토리 카드 선택 기능\r\nimport * as React from 'react';\r\nimport {Card, CardProps} from './card';\r\nimport './selectable-card.css';\r\n\r\nexport interface SelectableCardProps extends CardProps {            // 선택가능한 카드 card.tsx의 인터페이스 상속\r\n\tlabel: string;                                                   // 카드 이름\r\n\tonDoubleClick?: React.MouseEventHandler;                         // 마우스 이벤트(더블클릭)\r\n\tonSelect: (value: boolean, exclusive: boolean) => void;          // 선택한 카드(선택 여부?, 뭔지 모르겠음)\r\n\tselected?: boolean;                                              // 선택됐는지 여부 (위랑 뭔 차이인지 모르겠음)\r\n}\r\n\r\nexport const SelectableCard: React.FC<SelectableCardProps> = props => {\r\n\tconst {label, onDoubleClick, onSelect, selected, ...other} = props;        // props 전달\r\n\tconst onClick = React.useCallback(                    // 재사용 함수\r\n\t\t(event: React.MouseEvent) => {\r\n\t\t\tif (event.ctrlKey || event.shiftKey) {            // 스토리 카드를 클릭하면\r\n\t\t\t\tonSelect(!selected, false);                     // onSelect(!카드 선택 여부, exclusive=false)\r\n\t\t\t} else {                                          // 클릭 안하면\r\n\t\t\t\tonSelect(true, true);                           // onSelect(카드 선택 여부=true, exclusive=true)\r\n\t\t\t}\r\n\t\t},\r\n\t\t[onSelect, selected]\r\n\t);\r\n\tconst onKeyDown = React.useCallback(\r\n\t\t(event: React.KeyboardEvent) => {                         \r\n\t\t\tif (event.key === ' ' || event.key === 'Enter') {        // 스페이스바나 엔터를 누르면\r\n\t\t\t\tevent.preventDefault();                                // 이벤트의 기본 동작을 수행하지 않음. onKeyDown에 넘겨준 것만 실행\r\n\r\n\t\t\t\tif (event.ctrlKey || event.shiftKey) {                 // 컨트롤이나 쉬프트를 누른 상태라면\r\n\t\t\t\t\tonSelect(!selected, false);                          // 카드 선택\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonSelect(true, true);                                // 선택 안함\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t[onSelect, selected]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={classNames('selectable-card', {selected})}      \r\n\t\t\trole=\"button\"\r\n\t\t\taria-label={label}\r\n\t\t\taria-pressed={selected}\r\n\t\t\tonClick={onClick}\r\n\t\t\tonDoubleClick={onDoubleClick}\r\n\t\t\tonKeyDown={onKeyDown}\r\n\t\t\ttabIndex={0}\r\n\t\t>\r\n\t\t\t<Card {...other} />         \r\n\t\t</div>                     // card.tsx의 const Card 실행\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {StoryFormat} from '../../../store/story-formats';\r\n\r\nexport interface StoryFormatCardDetailsProps {\r\n\tformat: StoryFormat;\r\n}\r\n\r\nexport const StoryFormatCardDetails: React.FC<StoryFormatCardDetailsProps> = ({\r\n\tformat\r\n}) => {\r\n\tconst {t} = useTranslation();\r\n\r\n\tif (format.loadState === 'unloaded' || format.loadState === 'loading') {\r\n\t\treturn (\r\n\t\t\t<div className=\"story-format-card-details\">\r\n\t\t\t\t<p>{t('components.storyFormatCard.loadingFormat')}</p>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tif (format.loadState === 'error') {\r\n\t\treturn (\r\n\t\t\t<div className=\"story-format-card-details\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\t{t('components.storyFormatCard.loadError', {\r\n\t\t\t\t\t\terrorMessage: format.loadError.message\r\n\t\t\t\t\t})}\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"story-format-card-details\">\r\n\t\t\t{format.properties.author && (\r\n\t\t\t\t<p\r\n\t\t\t\t\tclassName=\"story-format-card-author\"\r\n\t\t\t\t\tdangerouslySetInnerHTML={{\r\n\t\t\t\t\t\t__html: t('components.storyFormatCard.author', {\r\n\t\t\t\t\t\t\tauthor: format.properties.author\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t\t{format.properties.description && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"story-format-card-description\"\r\n\t\t\t\t\tdangerouslySetInnerHTML={{\r\n\t\t\t\t\t\t__html: format.properties.description\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t\t{format.properties.license && (\r\n\t\t\t\t<p className=\"story-format-card-license\">\r\n\t\t\t\t\t{t('components.storyFormatCard.license', {\r\n\t\t\t\t\t\tlicense: format.properties.license\r\n\t\t\t\t\t})}\r\n\t\t\t\t</p>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n","import {IconAlertTriangle} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {formatImageUrl, StoryFormat} from '../../../store/story-formats';\r\nimport {Badge} from '../../badge/badge';\r\nimport {CardContent} from '../../container/card';\r\nimport {SelectableCard} from '../../container/card/selectable-card';\r\nimport {IconLoading} from '../../image/icon';\r\nimport {StoryFormatCardDetails} from './story-format-card-details';\r\nimport './story-format-card.css';\r\n\r\nexport interface StoryFormatCardProps {\r\n\tdefaultFormat: boolean;\r\n\teditorExtensionsDisabled: boolean;\r\n\tformat: StoryFormat;\r\n\tonSelect: () => void;\r\n\tproofingFormat: boolean;\r\n}\r\n\r\nexport const StoryFormatCard: React.FC<StoryFormatCardProps> = props => {\r\n\tconst {\r\n\t\tdefaultFormat,\r\n\t\teditorExtensionsDisabled,\r\n\t\tformat,\r\n\t\tonSelect,\r\n\t\tproofingFormat\r\n\t} = props;\r\n\tconst {t} = useTranslation();\r\n\r\n\tlet image = <></>;\r\n\r\n\tif (format.loadState === 'error') {\r\n\t\timage = <IconAlertTriangle />;\r\n\t} else if (\r\n\t\tformat.loadState === 'unloaded' ||\r\n\t\tformat.loadState === 'loading'\r\n\t) {\r\n\t\timage = <IconLoading />;\r\n\t} else if (format.loadState === 'loaded' && format.properties.image) {\r\n\t\timage = <img src={formatImageUrl(format)} alt=\"\" />;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"story-format-card\">\r\n\t\t\t<SelectableCard\r\n\t\t\t\tlabel={t('components.storyFormatCard.name', {\r\n\t\t\t\t\tname: format.name,\r\n\t\t\t\t\tversion: format.version\r\n\t\t\t\t})}\r\n\t\t\t\tonSelect={onSelect}\r\n\t\t\t\tselected={format.selected}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<div className=\"story-format-image\">{image}</div>\r\n\t\t\t\t\t<div className=\"story-format-description\">\r\n\t\t\t\t\t\t<h2>\r\n\t\t\t\t\t\t\t{t('components.storyFormatCard.name', {\r\n\t\t\t\t\t\t\t\tname: format.name,\r\n\t\t\t\t\t\t\t\tversion: format.version\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t<StoryFormatCardDetails format={format} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"story-format-badges\">\r\n\t\t\t\t\t\t{!format.userAdded && (\r\n\t\t\t\t\t\t\t<Badge label={t('components.storyFormatCard.builtIn')} />\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{defaultFormat && (\r\n\t\t\t\t\t\t\t<Badge label={t('components.storyFormatCard.defaultFormat')} />\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{editorExtensionsDisabled && (\r\n\t\t\t\t\t\t\t<Badge\r\n\t\t\t\t\t\t\t\tlabel={t('components.storyFormatCard.editorExtensionsDisabled')}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{format.loadState === 'loaded' && format.properties.proofing && (\r\n\t\t\t\t\t\t\t<Badge label={t('components.storyFormatCard.proofing')} />\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{proofingFormat && (\r\n\t\t\t\t\t\t\t<Badge label={t('components.storyFormatCard.proofingFormat')} />\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</CardContent>\r\n\t\t\t</SelectableCard>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import {IconArrowLeft} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {IconButton} from '../control/icon-button';\r\n\r\nexport const BackButton: React.FC = () => {\r\n\tconst history = useHistory();\r\n\tconst {t} = useTranslation();\r\n\r\n\tif (['/', '/stories'].includes(history.location.pathname)) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconArrowLeft />}\r\n\t\t\tvariant=\"primary\"\r\n\t\t\tlabel={\r\n\t\t\t\thistory.length > 1\r\n\t\t\t\t\t? \"이전 페이지\"\r\n\t\t\t\t\t: t('routes.storyList.titleGeneric')\r\n\t\t\t}\r\n\t\t\tonClick={() =>\r\n\t\t\t\thistory.length > 1 ? history.goBack() : history.push('/')\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconHelp} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {Tab, TabList, TabPanel, Tabs} from 'react-tabs';\r\nimport {IconButton} from '../control/icon-button';\r\nimport {BackButton} from './back-button';\r\nimport './route-toolbar.css';\r\n\r\nexport interface RouteToolbarProps {\r\n\thelpUrl?: string;\r\n\tpinnedControls?: React.ReactNode;\r\n\ttabs: Record<string, React.ReactNode>;\r\n}\r\n\r\nexport const RouteToolbar: React.FC<RouteToolbarProps> = props => {\r\n\tconst {helpUrl = 'https://twinery.org/2guide', pinnedControls, tabs} = props;\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<div className=\"route-toolbar\">\r\n\t\t\t<Tabs selectedTabClassName=\"selected\">\r\n\t\t\t\t<div className=\"route-toolbar-top\">\r\n\t\t\t\t\t<BackButton />\r\n\t\t\t\t\t<TabList className=\"route-toolbar-tablist\">\r\n\t\t\t\t\t\t{Object.keys(tabs).map(tabName => (\r\n\t\t\t\t\t\t\t<Tab className=\"route-toolbar-tab\" key={tabName}>\r\n\t\t\t\t\t\t\t\t{tabName}\r\n\t\t\t\t\t\t\t</Tab>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</TabList>\r\n\t\t\t\t\t<div className=\"route-toolbar-pinned-controls\">\r\n\t\t\t\t\t\t{pinnedControls}\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\ticon={<IconHelp />}\r\n\t\t\t\t\t\t\tlabel={t('common.help')}\r\n\t\t\t\t\t\t\tonClick={() => window.open(helpUrl, '_blank')}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{Object.entries(tabs).map(([tabName, tabContent]) => (\r\n\t\t\t\t\t\t<TabPanel key={tabName}>{tabContent}</TabPanel>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\t\t\t</Tabs>\r\n\t\t</div>\r\n\t);\r\n};\r\n","/**\r\n * 스토리를 스토리 포맷에 바인딩하는 코드\r\n */\r\n\r\nimport * as React from 'react';\r\nimport {\r\n\tpublishArchive,\r\n\tpublishStory,\r\n\tpublishStoryWithFormat,\r\n\tPublishOptions\r\n} from '../util/publish';\r\nimport {usePrefsContext} from './prefs';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tloadFormatProperties,\r\n\tuseStoryFormatsContext\r\n} from './story-formats';\r\nimport {storyWithId, useStoriesContext} from './stories';\r\nimport {getAppInfo} from '../util/app-info';\r\n\r\nexport interface UsePublishingProps {\r\n\tproofStory: (storyId: string) => Promise<string>;\r\n\tpublishArchive: (storyIds?: string[]) => Promise<string>;\r\n\tpublishStory: (\r\n\t\tstoryId: string,\r\n\t\tpublishOptions?: PublishOptions\r\n\t) => Promise<string>;\r\n\tpublishStoryData: (storyId: string) => string;\r\n}\r\n\r\n/**\r\n * A React hook publish stories from context. You probably want to use\r\n * `useStoryLaunch` instead--this is for doing the actual binding of the story\r\n * and story format.\r\n * \r\n * React 후크는 컨텍스트에서 스토리를 게시합니다. 대신 `useStoryLaunch`를 사용하고 싶을 것입니다.\r\n * 이것은 스토리와 스토리 형식의 실제 바인딩을 수행하기 위한 것입니다.\r\n */\r\n\r\n//위에 interface받음\r\nexport function usePublishing(): UsePublishingProps {\r\n\t// As little logic as possible should live here--instead it should be in\r\n\t// util/publish.ts.\r\n\r\n\t//반환될 데이터들\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst {dispatch: storyFormatsDispatch, formats} = useStoryFormatsContext();\r\n\tconst {stories} = useStoriesContext();\r\n\r\n\treturn {\r\n\t\tpublishArchive: React.useCallback(                      // 현재 있는 스토리들을 모아서 아카이브 파일 생성\r\n\t\t\tasync () => publishArchive(stories, getAppInfo()),\r\n\t\t\t[stories]\r\n\t\t),\r\n\r\n\t\tproofStory: React.useCallback(\r\n\t\t\tasync storyId => {\r\n\t\t\t\tconst story = storyWithId(stories, storyId);         // 스토리에 아이디를 부여해서 변수에 저장\r\n\t\t\t\tconst format = formatWithNameAndVersion(             // 스토리 포맷과 포맷 이름, 버전을 변수에 저장\r\n\t\t\t\t\tformats,\r\n\t\t\t\t\tprefs.proofingFormat.name,\r\n\t\t\t\t\tprefs.proofingFormat.version\r\n\t\t\t\t);\r\n\t\t\t\tconst formatProperties = await loadFormatProperties(format)(       // 스토리 포맷 프로퍼티 가져옴\r\n\t\t\t\t\tstoryFormatsDispatch\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!formatProperties) {\r\n\t\t\t\t\tthrow new Error(`Couldn't load story format properties`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * 스토리와 스토리 포맷 source를 넘겨서 \r\n\t\t\t\t * 스토리를 스토리 포맷에 맞게 바인딩\r\n\t\t\t\t */\r\n\r\n\t\t\t\treturn publishStoryWithFormat(                                    \r\n\t\t\t\t\tstory,\r\n\t\t\t\t\tformatProperties.source,\r\n\t\t\t\t\tgetAppInfo()                   // 현재 Twine의 정보. 버전 등. <tw-storydata> 태그의 creator, creator-version 속성에 들어가는 정보\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t[\r\n\t\t\t\tformats,\r\n\t\t\t\tprefs.proofingFormat.name,\r\n\t\t\t\tprefs.proofingFormat.version,\r\n\t\t\t\tstories,\r\n\t\t\t\tstoryFormatsDispatch\r\n\t\t\t]\r\n\t\t),\r\n\r\n\t\tpublishStory: React.useCallback(\r\n\t\t\tasync (storyId, publishOptions) => {\r\n\t\t\t\tconst story = storyWithId(stories, storyId);\r\n\t\t\t\tconst format = formatWithNameAndVersion(\r\n\t\t\t\t\tformats,\r\n\t\t\t\t\tstory.storyFormat,\r\n\t\t\t\t\tstory.storyFormatVersion\r\n\t\t\t\t);\r\n\t\t\t\tconst formatProperties = await loadFormatProperties(format)(\r\n\t\t\t\t\tstoryFormatsDispatch\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!formatProperties) {\r\n\t\t\t\t\tthrow new Error(`Couldn't load story format properties`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn publishStoryWithFormat(\r\n\t\t\t\t\tstory,\r\n\t\t\t\t\tformatProperties.source,\r\n\t\t\t\t\tgetAppInfo(),\r\n\t\t\t\t\tpublishOptions\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t[formats, stories, storyFormatsDispatch]\r\n\t\t),\r\n\r\n\t\tpublishStoryData: React.useCallback(\r\n\t\t\t(storyId: string) => {\r\n\t\t\t\tconst story = storyWithId(stories, storyId);\r\n\r\n\t\t\t\treturn publishStory(story, getAppInfo(), {startOptional: true});\r\n\t\t\t},\r\n\t\t\t[stories]\r\n\t\t)\r\n\r\n\t};\r\n}\r\n","/**\r\n * 스토리를 실행하는 코드인듯\r\n * 일렉트론 코드 있음\r\n */\r\n\r\nimport {usePublishing} from './use-publishing';\r\nimport {isElectronRenderer} from '../util/is-electron';\r\nimport {TwineElectronWindow} from '../electron/shared';\r\n\r\nexport interface UseStoryLaunchProps {\r\n\tplayStory: (storyId: string) => Promise<void>;\r\n\tproofStory: (storyId: string) => Promise<void>;\r\n\ttestStory: (storyId: string, startPassageId?: string) => Promise<void>;\r\n}\r\n\r\n/**\r\n * Provides functions to launch a story that include the correct handling for\r\n * both web and Electron contexts.\r\n */\r\nexport function useStoryLaunch(): UseStoryLaunchProps {\r\n\tconst {proofStory, publishStory} = usePublishing();\r\n\r\n\t// 스토리 HTML 파일을 여는 부분인 것 같음\r\n\t\r\n\tif (isElectronRenderer()) {\r\n\t\tconst {twineElectron} = window as TwineElectronWindow;\r\n\r\n\t\tif (!twineElectron) {\r\n\t\t\tthrow new Error('Electron bridge is not present on window.');\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tplayStory: async storyId => {\r\n\t\t\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t\t\t'open-with-temp-file',\r\n\t\t\t\t\tawait publishStory(storyId),                   \r\n\t\t\t\t\t'.html'\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tproofStory: async storyId => {\r\n\t\t\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t\t\t'open-with-temp-file',\r\n\t\t\t\t\tawait proofStory(storyId),\r\n\t\t\t\t\t'.html'\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\ttestStory: async (storyId, startPassageId) => {\r\n\t\t\t\ttwineElectron.ipcRenderer.send(\r\n\t\t\t\t\t'open-with-temp-file',\r\n\t\t\t\t\tawait publishStory(storyId, {\r\n\t\t\t\t\t\tformatOptions: 'debug',\r\n\t\t\t\t\t\tstartId: startPassageId\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t'.html'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tplayStory: async storyId => {\r\n\t\t\twindow.open(`#/stories/${storyId}/play`, '_blank');\r\n\t\t},\r\n\t\tproofStory: async storyId => {\r\n\t\t\twindow.open(`#/stories/${storyId}/proof`, '_blank');\r\n\t\t},\r\n\t\ttestStory: async (storyId, startPassageId) => {\r\n\t\t\twindow.open(\r\n\t\t\t\tstartPassageId\r\n\t\t\t\t\t? `#/stories/${storyId}/test/${startPassageId}`\r\n\t\t\t\t\t: `#/stories/${storyId}/test`,\r\n\t\t\t\t'_blank'\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n}\r\n","import {saveAs} from 'file-saver';\r\n\r\n/**\r\n * Saves text to a file. This works in either a browser or Electron context.\r\n */\r\nexport function saveHtml(source: string, filename: string) {\r\n\tconst data = new Blob([source], {type: 'text/html;charset=utf-8'});\r\n\r\n\tsaveAs(data, filename);\r\n}\r\n","import {Passage, StorySearchFlags, Story} from './stories.types';\r\nimport { passageWithId, storyWithId } from './getters'\r\n\r\n//첫번째 passage 찾기. 첫번째 passage ID반환. 아직 사용 X.\r\nexport function findFirstPassage(\r\n    story : Story\r\n){\r\n    return story.startPassage\r\n}\r\n\r\n//\r\nexport function extractFirstEpsiodeTitle(\r\n    story : Story\r\n) {\r\n    const firstPassageID = findFirstPassage(story);//ID반환\r\n    const firstPassage = story.passages.find(p => p.id === firstPassageID);\r\n    \r\n    if (firstPassage) {\r\n\t\tlet title : string = firstPassage.name;\r\n        return title;\r\n    }\r\n    return \"error\"\r\n}\r\n\r\n\r\n//[[]] 안에 있는 모든 string들 따로 따로 넣어줌.\r\nexport function searchOptionsString(\r\n\tsentences : String[]\r\n) {\r\n\t\r\n\tlet optionsText : String[] = [];\r\n\r\n\t//const regex : RegExp = /\\[\\[.*\\]\\]/;\r\n    for(let i =0; i < sentences.length; i++) {\r\n        if(\r\n            sentences[i].charAt(0) == \"[\" && sentences[i].charAt(1) == \"[\"\r\n        ){\r\n    \r\n            //optionTemp = sentences[i].match(regex)[0]; Refectory할 때 사용할것.\r\n    \r\n            optionsText.push( sentences[i].replace('[[', '').replace(']]', '') );\r\n        }\r\n    };\r\n    \r\n\treturn optionsText\r\n}\r\n\r\n\r\n//일단 첫번째 passage 텍스트만 출력\r\n//story를 인자로 받을 수 있는듯 함\r\nexport function extractEpsiodeText(\r\n    // stories: Story[],\r\n    // storyId: string,\r\n    story : Story\r\n) {\r\n    const firstPassageID = findFirstPassage(story);//ID반환\r\n    const firstPassage = story.passages.find(p => p.id === firstPassageID);\r\n    \r\n    if (firstPassage) {\r\n\t\tlet paragraph : String[] = splitPassageText(firstPassage.text);\r\n        return paragraph;\r\n    }\r\n    return \"error\"\r\n}\r\n\r\n//passage이름과 story를 입력받으면 Text추출하는 함수\r\n//이걸 이용해서 선택지 passage만들어보기\r\nexport function extractSomeEpisodeText(\r\n    story : Story,\r\n    passageName: String\r\n) {\r\n    const Passage = story.passages.find(p => p.name === passageName);//passage반환\r\n    \r\n    if (Passage) {\r\n\t\tlet paragraph : String[] = splitPassageText(Passage.text);\r\n        return paragraph;\r\n    }\r\n    return \"error\"\r\n}\r\n\r\n//단락마다 쪼개는 함수. 쪼갠 값을 배열로 만들어 return한다.\r\nexport function splitPassageText(\r\n    passageText: string\r\n){\r\n    let paragraph : string[] = passageText.split('\\n');\r\n    \r\n    //이건 따로 option을 인식해서 link로 만들어주는 함수가 있을테니 다음에 확인\r\n    // let option : string[];\r\n    \r\n    return paragraph;\r\n}","import {\r\n\tIconEye,\r\n\tIconFileText,\r\n\tIconPlayerPlay,\r\n\tIconTool,\r\n\tIconX,\r\n\tIconDisc\r\n} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next/';\r\nimport {ButtonBar} from '../components/container/button-bar';\r\nimport {CardContent} from '../components/container/card';\r\nimport {CardButton} from '../components/control/card-button';\r\nimport {IconButton} from '../components/control/icon-button';\r\nimport {storyFileName} from '../electron/shared';\r\nimport {Story} from '../store/stories';\r\nimport {usePublishing} from '../store/use-publishing';\r\nimport {useStoryLaunch} from '../store/use-story-launch';\r\nimport {saveHtml} from '../util/save-html';\r\nimport axios from 'axios';\r\n\r\n//story 텍스트를 추출하기 위해 추가한 능력\r\nimport {extractEpsiodeText, extractSomeEpisodeText, extractFirstEpsiodeTitle , searchOptionsString} from './../store/stories/extract_story';\r\n\r\nexport interface BuildActionsProps {\r\n\tstory?: Story;\r\n}\r\n\r\nexport const BuildActions: React.FC<BuildActionsProps> = ({story}) => {\r\n\t//html publish함수\r\n\tconst {publishStory} = usePublishing();\r\n\r\n\tconst [playError, setPlayError] = React.useState<Error>();\r\n\tconst [proofError, setProofError] = React.useState<Error>();\r\n\tconst [publishError, setPublishError] = React.useState<Error>();\r\n\tconst [testError, setTestError] = React.useState<Error>();\r\n\tconst {playStory, proofStory, testStory} = useStoryLaunch();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction resetErrors() {\r\n\t\tsetPlayError(undefined);\r\n\t\tsetProofError(undefined);\r\n\t\tsetPublishError(undefined);\r\n\t\tsetTestError(undefined);\r\n\t}\r\n\r\n\tasync function handlePlay() {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('No story provided to publish');\r\n\t\t}\r\n\r\n\t\tresetErrors();\r\n\r\n\t\ttry {\r\n\t\t\tawait playStory(story.id);\r\n\t\t} catch (error) {\r\n\t\t\tsetPlayError(error as Error);\r\n\t\t}\r\n\t}\r\n\r\n\tasync function handleProof() {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('No story provided to publish');\r\n\t\t}\r\n\r\n\t\tresetErrors();\r\n\r\n\t\ttry {\r\n\t\t\tawait proofStory(story.id);\r\n\t\t} catch (error) {\r\n\t\t\tsetProofError(error as Error);\r\n\t\t}\r\n\t}\r\n\r\n\tasync function handlePublishFile() {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('No story provided to publish');\r\n\t\t}\r\n\r\n\t\tresetErrors();\r\n\r\n\t\t//Html저장 함수\r\n\t\t//saveHtml의 첫번째 인자가 모든 html의 데이터를 받는다.\r\n\t\t//즉 publishStory가 스토리 출력 함수가 됨.\r\n\t\ttry {\r\n\t\t\tsaveHtml(await publishStory(story.id), storyFileName(story));\r\n\t\t} catch (error) {\r\n\t\t\tsetPublishError(error as Error);\r\n\t\t}\r\n\t}\r\n\r\n\tasync function handleTest() {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('No story provided to publish');\r\n\t\t}\r\n\r\n\t\tresetErrors();\r\n\r\n\t\ttry {\r\n\t\t\tawait testStory(story.id);\r\n\t\t} catch (error) {\r\n\t\t\tsetPublishError(error as Error);//모르겠으니 일단 publish error\r\n\t\t}\r\n\t}\r\n\r\n\tasync function postEpisode(option_text : String[], sentences : String[], episode_id : number) {\r\n\t\tlet health_change : String;\r\n\t\tlet money_change : String;\r\n\t\tlet hungry_change : String;\r\n\t\tlet strength_change : String;\r\n\t\tlet agility_change : String;\r\n\t\tlet armour_change : String;\r\n\t\tlet mental_change : String;\r\n\r\n\t\tfor(let i = 0; i < option_text.length; i++) {\r\n\t\t\tconst option_data = extractSomeEpisodeText(story, option_text[i]);\r\n\r\n\t\t\thealth_change = '0';\r\n\t\t\tmoney_change = '0';\r\n\t\t\thungry_change = '0';\r\n\t\t\tstrength_change = '0';\r\n\t\t\tagility_change = '0';\r\n\t\t\tarmour_change = '0';\r\n\t\t\tmental_change = '0';\r\n\t\t\t\r\n\t\t\tswitch(option_data[0]) {\r\n\t\t\t\tcase 'health':\r\n\t\t\t\t\thealth_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'money':\r\n\t\t\t\t\tmoney_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'hungry':\r\n\t\t\t\t\thungry_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'strength':\r\n\t\t\t\t\tstrength_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'agility':\r\n\t\t\t\t\tagility_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'armour':\r\n\t\t\t\t\tarmour_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'mental':\r\n\t\t\t\t\tmental_change = option_data[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tawait axios.post(`http://localhost:3001/game_play/option`, {\r\n\t\t\t\tepisode: episode_id,\r\n\t\t\t\ttext: option_text[i],\r\n\t\t\t\tresult_text: option_data[2],\r\n\t\t\t\thealth_change: health_change,\r\n\t\t\t\tmoney_change: money_change,\r\n\t\t\t\thungry_change: hungry_change,\r\n\t\t\t\tstrength_change: strength_change,\r\n\t\t\t\tagility_change: agility_change,\r\n\t\t\t\tarmour_change: armour_change,\r\n\t\t\t\tmental_change: mental_change\r\n\t\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tconsole.log(res.data);\r\n\t\t\t\tconsole.log(option_text[i]);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\t//추가해준 함수.\r\n\t//save버튼 누르면 실행.\r\n\tasync function handleSaveFile(): Promise<void> {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('No story provided to publish');\r\n\t\t}\r\n\r\n\t\tresetErrors();\r\n\r\n\t\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\tlet sentences : String[];\r\n\t\t\t//await testStory(story.id);\r\n\t\t\t//await는 왜 씀?\r\n\t\t\t\r\n\t\t\tsentences = extractEpsiodeText(story) as String[];\r\n\r\n\t\t\t//배열에 들어있는 선택지 수많큼 반복 출력\r\n\r\n\t\t\taxios.post(`http://localhost:3001/game_play`, {\r\n\t\t\t\tgenre: 1,\r\n\t\t\t\ttitle: extractFirstEpsiodeTitle(story),\r\n\t\t\t\tmainText: sentences[0]\r\n\t\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tconst option_text = searchOptionsString(sentences);\r\n\t\t\t\tconst episode_id = res.data;\r\n\t\t\t\tpostEpisode(option_text, sentences, episode_id);\r\n\t\t\t\talert('에피소드 생성 성공');\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tsetTestError(error as Error);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={testError?.message ?? ''}\r\n\t\t\t\tdisabled={!story}\r\n\t\t\t\ticon={<IconTool />}\r\n\t\t\t\tlabel={t('routeActions.build.test')}\r\n\t\t\t\tonChangeOpen={() => setTestError(undefined)}\r\n\t\t\t\tonClick={handleTest}\r\n\t\t\t\topen={!!testError}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<p>{testError?.message}</p>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\tlabel={t('common.close')}\r\n\t\t\t\t\t\tonClick={() => setTestError(undefined)}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</CardContent>\r\n\t\t\t</CardButton>\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={playError?.message ?? ''}\r\n\t\t\t\tdisabled={!story}\r\n\t\t\t\ticon={<IconPlayerPlay />}\r\n\t\t\t\tlabel={t('routeActions.build.play')}\r\n\t\t\t\tonChangeOpen={() => setPlayError(undefined)}\r\n\t\t\t\tonClick={handlePlay}\r\n\t\t\t\topen={!!playError}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<p>{playError?.message}</p>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\tlabel={t('common.close')}\r\n\t\t\t\t\t\tonClick={() => setPlayError(undefined)}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</CardContent>\r\n\t\t\t</CardButton>\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={proofError?.message ?? ''}\r\n\t\t\t\tdisabled={!story}\r\n\t\t\t\ticon={<IconEye />}\r\n\t\t\t\tlabel={t('routeActions.build.proof')}\r\n\t\t\t\tonChangeOpen={() => setProofError(undefined)}\r\n\t\t\t\tonClick={handleProof}\r\n\t\t\t\topen={!!proofError}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<p>{proofError?.message}</p>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\tlabel={t('common.close')}\r\n\t\t\t\t\t\tonClick={() => setProofError(undefined)}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</CardContent>\r\n\t\t\t</CardButton>\r\n\t\t\t\r\n\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={publishError?.message ?? ''}\r\n\t\t\t\tdisabled={!story}\r\n\t\t\t\ticon={<IconFileText />}\r\n\t\t\t\tlabel={t('routeActions.build.publishToFile')}\r\n\t\t\t\tonChangeOpen={() => setPublishError(undefined)}\r\n\t\t\t\tonClick={handlePublishFile}\r\n\t\t\t\topen={!!publishError}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<p>{publishError?.message}</p>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\tlabel={t('common.close')}\r\n\t\t\t\t\t\tonClick={() => setPublishError(undefined)}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</CardContent>\r\n\t\t\t</CardButton>\r\n\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={publishError?.message ?? ''}\r\n\t\t\t\tdisabled={!story}\r\n\t\t\t\ticon={<IconDisc/>}\r\n\t\t\t\tlabel={\"저장하기\"}\r\n\t\t\t\tonChangeOpen={() => setPublishError(undefined)}\r\n\t\t\t\tonClick={handleSaveFile}\r\n\t\t\t\topen={!!publishError}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<p>{publishError?.message}</p>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\ticon={<IconX />}\r\n\t\t\t\t\t\tlabel={t('common.close')}\r\n\t\t\t\t\t\tonClick={() => setPublishError(undefined)}\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</CardContent>\r\n\t\t\t</CardButton>\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import {IconAward, IconBug, IconFileCode, IconSettings} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {ButtonBar} from '../components/container/button-bar';\r\nimport {IconButton} from '../components/control/icon-button';\r\nimport {AboutTwineDialog, AppPrefsDialog, useDialogsContext} from '../dialogs';\r\n\r\nexport const AppActions: React.FC = () => {\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst history = useHistory();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<IconButton\r\n\t\t\t\ticon={<IconSettings />}\r\n\t\t\t\tlabel={t('routeActions.app.preferences')}\r\n\t\t\t\tonClick={() => dispatch({type: 'addDialog', component: AppPrefsDialog})}\r\n\t\t\t/>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={history.location.pathname === '/story-formats'}\r\n\t\t\t\ticon={<IconFileCode />}\r\n\t\t\t\tlabel={t('routeActions.app.storyFormats')}\r\n\t\t\t\tonClick={() => history.push('/story-formats')}\r\n\t\t\t/>\r\n\t\t\t<IconButton\r\n\t\t\t\ticon={<IconAward />}\r\n\t\t\t\tlabel={t('routeActions.app.aboutApp')}\r\n\t\t\t\tonClick={() =>\r\n\t\t\t\t\tdispatch({type: 'addDialog', component: AboutTwineDialog})\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t\t<IconButton\r\n\t\t\t\ticon={<IconBug />}\r\n\t\t\t\tlabel={t('routeActions.app.reportBug')}\r\n\t\t\t\tonClick={() => window.open('https://twinery.org/2bugs', '_blank')}\r\n\t\t\t/>\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconPlus} from '@tabler/icons';\r\nimport {\r\n\tcreateFromProperties,\r\n\tuseStoryFormatsContext\r\n} from '../../../../store/story-formats';\r\nimport {\r\n\tPromptButton,\r\n\tPromptButtonValidator\r\n} from '../../../../components/control/prompt-button';\r\nimport {fetchStoryFormatProperties} from '../../../../util/story-format';\r\nimport './add-story-format-button.css';\r\n\r\nfunction isValidUrl(value: string) {\r\n\ttry {\r\n\t\tnew URL(value);\r\n\t\treturn true;\r\n\t} catch (e) {}\r\n\r\n\treturn false;\r\n}\r\n\r\nexport const AddStoryFormatButton: React.FC = () => {\r\n\tconst {dispatch, formats} = useStoryFormatsContext();\r\n\tconst [newFormatUrl, setNewFormatUrl] = React.useState('');\r\n\tconst {t} = useTranslation();\r\n\r\n\tasync function handleSubmit() {\r\n\t\tdispatch(\r\n\t\t\tcreateFromProperties(\r\n\t\t\t\tnewFormatUrl,\r\n\t\t\t\tawait fetchStoryFormatProperties(newFormatUrl)\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tconst validate: PromptButtonValidator = async (value: string) => {\r\n\t\tif (newFormatUrl.trim() === '') {\r\n\t\t\treturn {valid: false};\r\n\t\t}\r\n\r\n\t\tif (!isValidUrl(newFormatUrl)) {\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t(\r\n\t\t\t\t\t'routes.storyFormatList.toolbar.addStoryFormatButton.invalidUrl'\r\n\t\t\t\t),\r\n\t\t\t\tvalid: false\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst properties = await fetchStoryFormatProperties(newFormatUrl);\r\n\r\n\t\t\tif (\r\n\t\t\t\tformats.some(\r\n\t\t\t\t\tformat =>\r\n\t\t\t\t\t\tformat.name === properties.name &&\r\n\t\t\t\t\t\tformat.version === properties.version\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tmessage: t(\r\n\t\t\t\t\t\t'routes.storyFormatList.toolbar.addStoryFormatButton.alreadyAdded',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tstoryFormatName: properties.name,\r\n\t\t\t\t\t\t\tstoryFormatVersion: properties.version\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t),\r\n\t\t\t\t\tvalid: false\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t(\r\n\t\t\t\t\t'routes.storyFormatList.toolbar.addStoryFormatButton.addPreview',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstoryFormatName: properties.name,\r\n\t\t\t\t\t\tstoryFormatVersion: properties.version\r\n\t\t\t\t\t}\r\n\t\t\t\t),\r\n\t\t\t\tvalid: true\r\n\t\t\t};\r\n\t\t} catch (error) {\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t(\r\n\t\t\t\t\t'routes.storyFormatList.toolbar.addStoryFormatButton.fetchError',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\terrorMessage: error.message\r\n\t\t\t\t\t}\r\n\t\t\t\t),\r\n\t\t\t\tvalid: false\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<span className=\"add-format-button\">\r\n\t\t\t<PromptButton\r\n\t\t\t\ticon={<IconPlus />}\r\n\t\t\t\tlabel={t('common.add')}\r\n\t\t\t\tonChange={event => setNewFormatUrl(event.target.value)}\r\n\t\t\t\tonSubmit={handleSubmit}\r\n\t\t\t\tprompt={t('routes.storyFormatList.toolbar.addStoryFormatButton.prompt')}\r\n\t\t\t\tsubmitIcon={<IconPlus />}\r\n\t\t\t\tsubmitLabel={t('common.add')}\r\n\t\t\t\tsubmitVariant=\"create\"\r\n\t\t\t\tvalidate={validate}\r\n\t\t\t\tvalue={newFormatUrl}\r\n\t\t\t/>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import {IconStar} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {usePrefsContext} from '../../../../store/prefs';\r\nimport {StoryFormat} from '../../../../store/story-formats';\r\n\r\nexport interface DefaultStoryFormatButtonProps {\r\n\tformat?: StoryFormat;\r\n}\r\n\r\nexport const DefaultStoryFormatButton: React.FC<DefaultStoryFormatButtonProps> = props => {\r\n\tconst {format} = props;\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst disabled =\r\n\t\tformat?.loadState !== 'loaded' ||\r\n\t\tformat.properties.proofing ||\r\n\t\t(prefs.storyFormat.name === format.name &&\r\n\t\t\tprefs.storyFormat.version === format.version);\r\n\tconst handleClick: React.MouseEventHandler = () => {\r\n\t\tif (!format) {\r\n\t\t\tthrow new Error(\"Can't set undefined format as default\");\r\n\t\t}\r\n\r\n\t\tdispatch({\r\n\t\t\ttype: 'update',\r\n\t\t\tname: 'storyFormat',\r\n\t\t\tvalue: {name: format.name, version: format.version}\r\n\t\t});\r\n\t};\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={disabled}\r\n\t\t\ticon={<IconStar />}\r\n\t\t\tlabel={t('routes.storyFormatList.toolbar.useAsDefaultFormat')}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconEye} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {usePrefsContext} from '../../../../store/prefs';\r\nimport {StoryFormat} from '../../../../store/story-formats';\r\n\r\nexport interface ProofingStoryFormatButtonProps {\r\n\tformat?: StoryFormat;\r\n}\r\n\r\nexport const ProofingStoryFormatButton: React.FC<ProofingStoryFormatButtonProps> = props => {\r\n\tconst {format} = props;\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst disabled =\r\n\t\tformat?.loadState !== 'loaded' ||\r\n\t\t!format.properties.proofing ||\r\n\t\t(prefs.proofingFormat.name === format.name &&\r\n\t\t\tprefs.proofingFormat.version === format.version);\r\n\tconst handleClick: React.MouseEventHandler = () => {\r\n\t\tif (!format) {\r\n\t\t\tthrow new Error(\"Can't set undefined format as proofing\");\r\n\t\t}\r\n\r\n\t\tdispatch({\r\n\t\t\ttype: 'update',\r\n\t\t\tname: 'proofingFormat',\r\n\t\t\tvalue: {name: format.name, version: format.version}\r\n\t\t});\r\n\t};\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={disabled}\r\n\t\t\ticon={<IconEye />}\r\n\t\t\tlabel={t('routes.storyFormatList.toolbar.useAsProofingFormat')}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconTrash} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {usePrefsContext} from '../../../../store/prefs';\r\nimport {\r\n\tdeleteFormat,\r\n\tStoryFormat,\r\n\tuseStoryFormatsContext\r\n} from '../../../../store/story-formats';\r\n\r\nexport interface RemoveStoryFormatButtonProps {\r\n\tformat?: StoryFormat;\r\n}\r\n\r\nexport const RemoveStoryFormatButton: React.FC<RemoveStoryFormatButtonProps> = props => {\r\n\tconst {format} = props;\r\n\tconst {dispatch} = useStoryFormatsContext();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst isDefault =\r\n\t\tformat?.name === prefs.storyFormat.name &&\r\n\t\tformat?.version === prefs.storyFormat.version;\r\n\tconst isProofing =\r\n\t\tformat?.name === prefs.proofingFormat.name &&\r\n\t\tformat?.version === prefs.proofingFormat.version;\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={!format || !format.userAdded || isDefault || isProofing}\r\n\t\t\ticon={<IconTrash />}\r\n\t\t\tlabel={t('common.remove')}\r\n\t\t\tonClick={() => format && dispatch(deleteFormat(format))}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconPuzzle} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {setPref, usePrefsContext} from '../../../../store/prefs';\r\nimport {StoryFormat} from '../../../../store/story-formats';\r\n\r\nexport interface StoryFormatExtensionsButtonProps {\r\n\tformat?: StoryFormat;\r\n}\r\n\r\nexport const StoryFormatExtensionsButton: React.FC<StoryFormatExtensionsButtonProps> = props => {\r\n\tconst {format} = props;\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst extensionsDisabled = prefs.disabledStoryFormatEditorExtensions.some(\r\n\t\tother => other.name === format?.name && other.version === format?.version\r\n\t);\r\n\r\n\tfunction handleClick() {\r\n\t\tif (!format) {\r\n\t\t\tthrow new Error('Format is not set');\r\n\t\t}\r\n\r\n\t\t// This logic is a little backwards--the user is setting whether to use the\r\n\t\t// extensions but our preferences track disabled ones.\r\n\r\n\t\tif (extensionsDisabled) {\r\n\t\t\tdispatch(\r\n\t\t\t\tsetPref(\r\n\t\t\t\t\t'disabledStoryFormatEditorExtensions',\r\n\t\t\t\t\tprefs.disabledStoryFormatEditorExtensions.filter(\r\n\t\t\t\t\t\tf => f.name !== format.name || f.version !== format.version\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tdispatch(\r\n\t\t\t\tsetPref('disabledStoryFormatEditorExtensions', [\r\n\t\t\t\t\t...prefs.disabledStoryFormatEditorExtensions,\r\n\t\t\t\t\t{name: format.name, version: format.version}\r\n\t\t\t\t])\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={!format}\r\n\t\t\ticon={<IconPuzzle />}\r\n\t\t\tlabel={t(\r\n\t\t\t\t`routes.storyFormatList.toolbar.${\r\n\t\t\t\t\textensionsDisabled ? 'enable' : 'disable'\r\n\t\t\t\t}FormatExtensions`\r\n\t\t\t)}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {ButtonBar} from '../../../../components/container/button-bar';\r\nimport {StoryFormat} from '../../../../store/story-formats';\r\nimport {AddStoryFormatButton} from './add-story-format-button';\r\nimport {DefaultStoryFormatButton} from './default-story-format-button';\r\nimport {ProofingStoryFormatButton} from './proofing-story-format-button';\r\nimport {RemoveStoryFormatButton} from './remove-story-format-button';\r\nimport {StoryFormatExtensionsButton} from './story-format-extensions-button';\r\n\r\nexport interface FormatActionsProps {\r\n\tselectedFormats: StoryFormat[];\r\n}\r\n\r\nexport const FormatActions: React.FC<FormatActionsProps> = props => {\r\n\tconst {selectedFormats} = props;\r\n\tconst format = selectedFormats.length === 1 ? selectedFormats[0] : undefined;\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<AddStoryFormatButton />\r\n\t\t\t<RemoveStoryFormatButton format={format} />\r\n\t\t\t<StoryFormatExtensionsButton format={format} />\r\n\t\t\t<DefaultStoryFormatButton format={format} />\r\n\t\t\t<ProofingStoryFormatButton format={format} />\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {CheckboxButton} from '../../../components/control/checkbox-button';\r\nimport {setPref, usePrefsContext} from '../../../store/prefs';\r\n\r\nexport const ViewActions: React.FC = () => {\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction setFilter(name: string) {\r\n\t\tdispatch(setPref('storyFormatListFilter', name));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<CheckboxButton\r\n\t\t\t\tdisabled={prefs.storyFormatListFilter === 'current'}\r\n\t\t\t\tlabel={t('routes.storyFormatList.title.current')}\r\n\t\t\t\tonChange={() => setFilter('current')}\r\n\t\t\t\tvalue={prefs.storyFormatListFilter === 'current'}\r\n\t\t\t/>\r\n\t\t\t<CheckboxButton\r\n\t\t\t\tdisabled={prefs.storyFormatListFilter === 'user'}\r\n\t\t\t\tlabel={t('routes.storyFormatList.title.user')}\r\n\t\t\t\tonChange={() => setFilter('user')}\r\n\t\t\t\tvalue={prefs.storyFormatListFilter === 'user'}\r\n\t\t\t/>\r\n\t\t\t<CheckboxButton\r\n\t\t\t\tdisabled={prefs.storyFormatListFilter === 'all'}\r\n\t\t\t\tlabel={t('routes.storyFormatList.title.all')}\r\n\t\t\t\tonChange={() => setFilter('all')}\r\n\t\t\t\tvalue={prefs.storyFormatListFilter === 'all'}\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {RouteToolbar} from '../../../components/route-toolbar';\r\nimport {AppActions} from '../../../route-actions';\r\nimport {StoryFormat} from '../../../store/story-formats';\r\nimport {FormatActions} from './formats/format-actions';\r\nimport {ViewActions} from './view-actions';\r\n\r\nexport interface StoryFormatListToolbarProps {\r\n\tselectedFormats: StoryFormat[];\r\n}\r\n\r\nexport const StoryFormatListToolbar: React.FC<StoryFormatListToolbarProps> = props => {\r\n\tconst {selectedFormats} = props;\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<RouteToolbar\r\n\t\t\ttabs={{\r\n\t\t\t\t[t('common.storyFormat')]: (\r\n\t\t\t\t\t<FormatActions selectedFormats={selectedFormats} />\r\n\t\t\t\t),\r\n\t\t\t\t[t('common.view')]: <ViewActions />,\r\n\t\t\t\t[t('common.appName')]: <AppActions />\r\n\t\t\t}}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {CSSTransition, TransitionGroup} from 'react-transition-group';\r\nimport {ClickAwayListener} from '../../components/click-away-listener';\r\nimport {CardGroup} from '../../components/container/card-group';\r\nimport {MainContent} from '../../components/container/main-content';\r\nimport {StoryFormatCard} from '../../components/story-format/story-format-card/story-format-card';\r\nimport {DialogsContextProvider} from '../../dialogs';\r\nimport {FormatLoader} from '../../store/format-loader';\r\nimport {usePrefsContext} from '../../store/prefs';\r\nimport {\r\n\tdeselectAllFormats,\r\n\tdeselectFormat,\r\n\tfilteredFormats,\r\n\tselectFormat,\r\n\tsortFormats,\r\n\tStoryFormat,\r\n\tuseStoryFormatsContext\r\n} from '../../store/story-formats';\r\nimport {StoryFormatListToolbar} from './toolbar';\r\n\r\nexport const StoryFormatListRoute: React.FC = () => {\r\n\tconst {dispatch: formatsDispatch, formats} = useStoryFormatsContext();\r\n\tconst {dispatch: prefsDispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst selectedFormats = formats.filter(format => format.selected);\r\n\r\n\tconst visibleFormats = sortFormats(\r\n\t\tfilteredFormats(formats, prefs.storyFormatListFilter)\r\n\t);\r\n\r\n\t// Any formats no longer visible should be deselected.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tfor (const format of selectedFormats) {\r\n\t\t\tif (format.selected && !visibleFormats.includes(format)) {\r\n\t\t\t\tformatsDispatch(deselectFormat(format));\r\n\t\t\t}\r\n\t\t}\r\n\t}, [prefsDispatch, selectedFormats, visibleFormats, formatsDispatch]);\r\n\r\n\tfunction handleSelect(format: StoryFormat) {\r\n\t\tformatsDispatch(selectFormat(format, true));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"story-format-list-route\">\r\n\t\t\t<DialogsContextProvider>\r\n\t\t\t\t<StoryFormatListToolbar selectedFormats={selectedFormats} />\r\n\t\t\t\t<ClickAwayListener\r\n\t\t\t\t\tignoreSelector=\".story-format-card\"\r\n\t\t\t\t\tonClickAway={() => formatsDispatch(deselectAllFormats())}\r\n\t\t\t\t>\r\n\t\t\t\t\t<MainContent\r\n\t\t\t\t\t\ttitle={t(\r\n\t\t\t\t\t\t\t`routes.storyFormatList.title.${prefs.storyFormatListFilter}`\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t{t(\r\n\t\t\t\t\t\t\t\tvisibleFormats.length > 0\r\n\t\t\t\t\t\t\t\t\t? 'routes.storyFormatList.storyFormatExplanation'\r\n\t\t\t\t\t\t\t\t\t: 'routes.storyFormatList.noneVisible'\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t<FormatLoader>\r\n\t\t\t\t\t\t\t<CardGroup columnWidth=\"450px\">\r\n\t\t\t\t\t\t\t\t<TransitionGroup component={null}>\r\n\t\t\t\t\t\t\t\t\t{visibleFormats.map(format => (\r\n\t\t\t\t\t\t\t\t\t\t<CSSTransition\r\n\t\t\t\t\t\t\t\t\t\t\tclassNames=\"pop\"\r\n\t\t\t\t\t\t\t\t\t\t\tkey={format.id}\r\n\t\t\t\t\t\t\t\t\t\t\ttimeout={200}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<StoryFormatCard\r\n\t\t\t\t\t\t\t\t\t\t\t\tdefaultFormat={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat.name === prefs.storyFormat.name &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat.version === prefs.storyFormat.version\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\teditorExtensionsDisabled={prefs.disabledStoryFormatEditorExtensions.some(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabledFormat =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat.name === disabledFormat.name &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat.version === disabledFormat.version\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tformat={format}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonSelect={() => handleSelect(format)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tproofingFormat={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat.name === prefs.proofingFormat.name &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat.version === prefs.proofingFormat.version\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</CSSTransition>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</TransitionGroup>\r\n\t\t\t\t\t\t\t</CardGroup>\r\n\t\t\t\t\t\t</FormatLoader>\r\n\t\t\t\t\t</MainContent>\r\n\t\t\t\t</ClickAwayListener>\r\n\t\t\t</DialogsContextProvider>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconPlus} from '@tabler/icons';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {createUntitledPassage, Story} from '../../../../store/stories';\r\nimport {useUndoableStoriesContext} from '../../../../store/undoable-stories';\r\nimport {Point} from '../../../../util/geometry';\r\n\r\nexport interface CreatePassageButtonProps {\r\n\tgetCenter: () => Point;\r\n\tstory: Story;\r\n}\r\n\r\nexport const CreatePassageButton: React.FC<CreatePassageButtonProps> = props => {\r\n\tconst {getCenter, story} = props;\r\n\tconst {dispatch} = useUndoableStoriesContext();\r\n\tconst handleClick = React.useCallback(() => {\r\n\t\tconst {left, top} = getCenter();\r\n\r\n\t\tdispatch(createUntitledPassage(story, left, top), 'undoChange.newPassage');\r\n\t}, [dispatch, getCenter, story]);\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconPlus />}\r\n\t\t\tlabel={t('common.new')}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconTrash} from '@tabler/icons';\r\nimport 'element-closest';\r\nimport * as React from 'react';\r\nimport {useHotkeys} from 'react-hotkeys-hook';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {deletePassages, Passage, Story} from '../../../../store/stories';\r\nimport {useUndoableStoriesContext} from '../../../../store/undoable-stories';\r\n\r\nexport interface DeletePassagesButtonProps {\r\n\tpassages: Passage[];\r\n\tstory: Story;\r\n}\r\n\r\nexport const DeletePassagesButton: React.FC<\r\n\tDeletePassagesButtonProps\r\n> = props => {\r\n\tconst {passages, story} = props;\r\n\tconst {dispatch} = useUndoableStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\tconst disabled = React.useMemo(() => {\r\n\t\tif (passages.length === 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn passages.some(passage => story.startPassage === passage.id);\r\n\t}, [passages, story.startPassage]);\r\n\tconst handleClick = React.useCallback(() => {\r\n\t\tif (passages.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdispatch(\r\n\t\t\tdeletePassages(story, passages),\r\n\t\t\tpassages.length > 1\r\n\t\t\t\t? 'undoChange.deletePassages'\r\n\t\t\t\t: 'undoChange.deletePassage'\r\n\t\t);\r\n\t}, [dispatch, passages, story]);\r\n\r\n\tuseHotkeys('Backspace,Delete', handleClick, [handleClick]);\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={disabled}\r\n\t\t\ticon={<IconTrash />}\r\n\t\t\tlabel={\r\n\t\t\t\t!disabled && passages.length > 1\r\n\t\t\t\t\t? t('common.deleteCount', {count: passages.length})\r\n\t\t\t\t\t: t('common.delete')\r\n\t\t\t}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconEdit} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {PassageEditDialog, useDialogsContext} from '../../../../dialogs';\r\nimport {Passage, Story} from '../../../../store/stories';\r\n\r\nexport interface EditPassagesButtonProps {\r\n\tpassages: Passage[];\r\n\tstory: Story;\r\n}\r\n\r\nexport const EditPassagesButton: React.FC<EditPassagesButtonProps> = props => {\r\n\tconst {passages, story} = props;\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleClick() {\r\n\t\tdispatch(dispatch =>\r\n\t\t\tpassages.forEach(passage =>\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addDialog',\r\n\t\t\t\t\tcomponent: PassageEditDialog,\r\n\t\t\t\t\tprops: {passageId: passage.id, storyId: story.id}\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={passages.length === 0}\r\n\t\t\ticon={<IconEdit />}\r\n\t\t\tlabel={\r\n\t\t\t\tpassages.length > 1\r\n\t\t\t\t\t? t('common.editCount', {count: passages.length})\r\n\t\t\t\t\t: t('common.edit')\r\n\t\t\t}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconMarquee} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {\r\n\tselectAllPassages,\r\n\tStory,\r\n\tuseStoriesContext\r\n} from '../../../../store/stories';\r\n\r\nexport interface SelectAllPassagesButtonProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const SelectAllPassagesButton: React.FC<SelectAllPassagesButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch} = useStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconMarquee />}\r\n\t\t\tlabel={t('common.selectAll')}\r\n\t\t\tonClick={() => dispatch(selectAllPassages(story))}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconRocket} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {\r\n\tPassage,\r\n\tStory,\r\n\tupdateStory,\r\n\tuseStoriesContext\r\n} from '../../../../store/stories';\r\n\r\nexport interface StartAtPassageButtonProps {\r\n\tpassage?: Passage;\r\n\tstory: Story;\r\n}\r\n\r\nexport const StartAtPassageButton: React.FC<StartAtPassageButtonProps> = props => {\r\n\tconst {passage, story} = props;\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleClick() {\r\n\t\tif (!passage) {\r\n\t\t\tthrow new Error('No passage set');\r\n\t\t}\r\n\r\n\t\tdispatch(updateStory(stories, story, {startPassage: passage.id}));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={!passage || passage.id === story.startPassage}\r\n\t\t\ticon={<IconRocket />}\r\n\t\t\tlabel={t('routes.storyEdit.toolbar.startStoryHere')}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconTool} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {Passage, Story} from '../../../../store/stories';\r\nimport {useStoryLaunch} from '../../../../store/use-story-launch';\r\n\r\nexport interface TestPassageButtonProps {\r\n\tpassage?: Passage;\r\n\tstory: Story;\r\n}\r\n\r\nexport const TestPassageButton: React.FC<TestPassageButtonProps> = props => {\r\n\tconst {passage, story} = props;\r\n\tconst {testStory} = useStoryLaunch();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={!passage}\r\n\t\t\ticon={<IconTool />}\r\n\t\t\tlabel={t('routes.storyEdit.toolbar.testFromHere')}\r\n\t\t\tonClick={() => testStory(story.id, passage?.id)}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {ButtonBar} from '../../../../components/container/button-bar';\r\nimport {RenamePassageButton} from '../../../../components/passage/rename-passage-button';\r\nimport {\r\n\tPassage,\r\n\tStory,\r\n\tupdatePassage,\r\n\tuseStoriesContext\r\n} from '../../../../store/stories';\r\nimport {Point} from '../../../../util/geometry';\r\nimport {CreatePassageButton} from './create-passage-button';\r\nimport {DeletePassagesButton} from './delete-passages-button';\r\nimport {EditPassagesButton} from './edit-passages-buttons';\r\nimport {SelectAllPassagesButton} from './select-all-passages-button';\r\nimport {StartAtPassageButton} from './start-at-passage-button';\r\nimport {TestPassageButton} from './test-passage-button';\r\n\r\nexport interface PassageActionsProps {\r\n\tgetCenter: () => Point;\r\n\tstory: Story;\r\n}\r\n\r\nexport const PassageActions: React.FC<PassageActionsProps> = ({\r\n\tgetCenter,\r\n\tstory\r\n}) => {\r\n\tconst {dispatch} = useStoriesContext();\r\n\tconst selectedPassages = React.useMemo(\r\n\t\t() => story.passages.filter(passage => passage.selected),\r\n\t\t[story.passages]\r\n\t);\r\n\tconst soloSelectedPassage = React.useMemo(\r\n\t\t() => (selectedPassages.length === 1 ? selectedPassages[0] : undefined),\r\n\t\t[selectedPassages]\r\n\t);\r\n\r\n\tfunction handleRename(name: string, passage?: Passage) {\r\n\t\tif (!passage) {\r\n\t\t\tthrow new Error('Passage is unset');\r\n\t\t}\r\n\r\n\t\t// Don't create newly linked passages here because the update action will\r\n\t\t// try to recreate the passage as it's been renamed--it sees new links in\r\n\t\t// existing passages, updates them, but does not see that the passage name\r\n\t\t// has been updated since that hasn't happened yet.\r\n\r\n\t\tdispatch(updatePassage(story, passage, {name}, {dontUpdateOthers: true}));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<CreatePassageButton getCenter={getCenter} story={story} />\r\n\t\t\t<EditPassagesButton passages={selectedPassages} story={story} />\r\n\t\t\t<RenamePassageButton\r\n\t\t\t\tonRename={name => handleRename(name, soloSelectedPassage)}\r\n\t\t\t\tpassage={soloSelectedPassage}\r\n\t\t\t\tstory={story}\r\n\t\t\t/>\r\n\t\t\t<DeletePassagesButton passages={selectedPassages} story={story} />\r\n\t\t\t<TestPassageButton passage={soloSelectedPassage} story={story} />\r\n\t\t\t<StartAtPassageButton passage={soloSelectedPassage} story={story} />\r\n\t\t\t<SelectAllPassagesButton story={story} />\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconWriting} from '@tabler/icons';\r\nimport {PromptButton} from '../control/prompt-button';\r\nimport {storyFileName} from '../../electron/shared';\r\nimport {Story} from '../../store/stories';\r\nimport {IconButton} from '../control/icon-button';\r\n\r\n// This is here because it's used in two places--the story list and the story\r\n// info dialog.\r\n\r\nconst DisabledRenameStoryButton: React.FC = () => {\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton disabled icon={<IconWriting />} label={t('common.rename')} />\r\n\t);\r\n};\r\n\r\ninterface EnabledRenameStoryButtonProps {\r\n\texistingStories: Story[];\r\n\tonRename: (value: string) => void;\r\n\tstory: Story;\r\n}\r\n\r\nconst EnabledRenameStoryButton: React.FC<EnabledRenameStoryButtonProps> = props => {\r\n\tconst {existingStories, onRename, story} = props;\r\n\tconst [newName, setNewName] = React.useState(story.name);\r\n\tconst {t} = useTranslation();\r\n\r\n\tReact.useEffect(() => setNewName(story.name), [story]);\r\n\r\n\tfunction validate(name: string) {\r\n\t\tif (name.trim() === '') {\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t('components.renameStoryButton.emptyName'),\r\n\t\t\t\tvalid: false\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\texistingStories.some(\r\n\t\t\t\ts =>\r\n\t\t\t\t\ts.id !== story.id &&\r\n\t\t\t\t\tstoryFileName(s) === storyFileName({...story, name})\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\tmessage: t('components.renameStoryButton.nameAlreadyUsed'),\r\n\t\t\t\tvalid: false\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {valid: true};\r\n\t}\r\n\r\n\treturn (\r\n\t\t<PromptButton\r\n\t\t\ticon={<IconWriting />}\r\n\t\t\tlabel={t('common.rename')}\r\n\t\t\tonChange={event => setNewName(event.target.value)}\r\n\t\t\tonSubmit={onRename}\r\n\t\t\tprompt={t('common.renamePrompt', {name: story.name})}\r\n\t\t\tvalidate={validate}\r\n\t\t\tvalue={newName}\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nexport interface RenameStoryButtonProps\r\n\textends Omit<EnabledRenameStoryButtonProps, 'story'> {\r\n\tstory?: Story;\r\n}\r\n\r\nexport const RenameStoryButton: React.FC<RenameStoryButtonProps> = props => {\r\n\tif (props.story) {\r\n\t\treturn (\r\n\t\t\t<EnabledRenameStoryButton {...(props as EnabledRenameStoryButtonProps)} />\r\n\t\t);\r\n\t}\r\n\r\n\treturn <DisabledRenameStoryButton />;\r\n};","import {IconInfoCircle} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {StoryDetailsDialog, useDialogsContext} from '../../../../dialogs';\r\nimport {Story} from '../../../../store/stories';\r\n\r\nexport interface DetailsButtonProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const DetailsButton: React.FC<DetailsButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconInfoCircle />}\r\n\t\t\tlabel={t('common.details')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addDialog',\r\n\t\t\t\t\tcomponent: StoryDetailsDialog,\r\n\t\t\t\t\tprops: {storyId: story.id}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconSearch} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {StorySearchDialog, useDialogsContext} from '../../../../dialogs';\r\nimport {Story} from '../../../../store/stories';\r\n\r\nexport interface FindReplaceButtonProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const FindReplaceButton: React.FC<FindReplaceButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconSearch />}\r\n\t\t\tlabel={t('routes.storyEdit.toolbar.findAndReplace')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addDialog',\r\n\t\t\t\t\tcomponent: StorySearchDialog,\r\n\t\t\t\t\tprops: {storyId: story.id}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconBraces} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {StoryJavaScriptDialog, useDialogsContext} from '../../../../dialogs';\r\nimport {Story} from '../../../../store/stories';\r\n\r\nexport interface JavaScriptButtonProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const JavaScriptButton: React.FC<JavaScriptButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconBraces />}\r\n\t\t\tlabel={t('routes.storyEdit.toolbar.javaScript')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addDialog',\r\n\t\t\t\t\tcomponent: StoryJavaScriptDialog,\r\n\t\t\t\t\tprops: {storyId: story.id}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconTags} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {PassageTagsDialog, useDialogsContext} from '../../../../dialogs';\r\nimport {Story} from '../../../../store/stories';\r\n\r\nexport interface PassageTagsButtonProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const PassageTagsButton: React.FC<PassageTagsButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconTags />}\r\n\t\t\tlabel={t('routes.storyEdit.toolbar.passageTags')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addDialog',\r\n\t\t\t\t\tcomponent: PassageTagsDialog,\r\n\t\t\t\t\tprops: {storyId: story.id}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconHash} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {StoryStylesheetDialog, useDialogsContext} from '../../../../dialogs';\r\nimport {Story} from '../../../../store/stories';\r\n\r\nexport interface StylesheetButtonProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const StylesheetButton: React.FC<StylesheetButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconHash />}\r\n\t\t\tlabel={t('routes.storyEdit.toolbar.stylesheet')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: 'addDialog',\r\n\t\t\t\t\tcomponent: StoryStylesheetDialog,\r\n\t\t\t\t\tprops: {storyId: story.id}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {ButtonBar} from '../../../../components/container/button-bar';\r\nimport {RenameStoryButton} from '../../../../components/story/rename-story-button';\r\nimport {Story, updateStory, useStoriesContext} from '../../../../store/stories';\r\nimport {DetailsButton} from './details-button';\r\nimport {FindReplaceButton} from './find-replace-button';\r\nimport {JavaScriptButton} from './javascript-button';\r\nimport {PassageTagsButton} from './passage-tags-button';\r\nimport {StylesheetButton} from './stylesheet-button';\r\n\r\nexport interface StoryActionsProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const StoryActions: React.FC<StoryActionsProps> = props => {\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst {story} = props;\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<FindReplaceButton story={story} />\r\n\t\t\t<RenameStoryButton\r\n\t\t\t\texistingStories={stories}\r\n\t\t\t\tonRename={name => dispatch(updateStory(stories, story, {name}))}\r\n\t\t\t\tstory={story}\r\n\t\t\t/>\r\n\t\t\t<DetailsButton story={story} />\r\n\t\t\t<PassageTagsButton story={story} />\r\n\t\t\t<JavaScriptButton story={story} />\r\n\t\t\t<StylesheetButton story={story} />\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconArrowBack, IconArrowForward} from '@tabler/icons';\r\nimport {useUndoableStoriesContext} from '../../../store/undoable-stories';\r\nimport {IconButton} from '../../../components/control/icon-button';\r\n\r\nexport const UndoRedoButtons: React.FC = () => {\r\n\tconst {redo, redoLabel, undo, undoLabel} = useUndoableStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={!undo}\r\n\t\t\t\ticon={<IconArrowBack />}\r\n\t\t\t\tlabel={undoLabel ?? \"되돌리기\"}\r\n\t\t\t\tonClick={undo}\r\n\t\t\t/>\r\n\t\t\t<IconButton\r\n\t\t\t\tdisabled={!redo}\r\n\t\t\t\ticon={<IconArrowForward />}\r\n\t\t\t\tlabel={redoLabel ?? \"앞으로\"}\r\n\t\t\t\tonClick={redo}\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {RouteToolbar} from '../../../components/route-toolbar';\r\nimport {AppActions, BuildActions} from '../../../route-actions';\r\nimport {Story} from '../../../store/stories';\r\nimport {Point} from '../../../util/geometry';\r\nimport {PassageActions} from './passage/passage-actions';\r\nimport {StoryActions} from './story/story-actions';\r\nimport {UndoRedoButtons} from './undo-redo-buttons';\r\n\r\nexport interface StoryEditToolbarProps {\r\n\tgetCenter: () => Point;\r\n\tstory: Story;\r\n}\r\n\r\nexport const StoryEditToolbar: React.FC<StoryEditToolbarProps> = props => {\r\n\tconst {getCenter, story} = props;\r\n\t//i18 인가 뭔가 하는 기능 안 쓰기.\r\n\t//const {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<RouteToolbar\r\n\t\t\tpinnedControls={<UndoRedoButtons />}\r\n\t\t\ttabs={\r\n\t\t\t\t//object를 인자로 받음\r\n\t\t\t\t{\r\n\t\t\t\t[\"스토리 Box\"]: (\r\n\t\t\t\t\t\t<PassageActions getCenter={getCenter} story={story} />\r\n\t\t\t\t\t),\r\n\t\t\t\t[\"에피소드\"]: <StoryActions story={story} />,\r\n\t\t\t\t[\"빌드\"]: <BuildActions story={story} />,\r\n\t\t\t\t[\"Twine 설정\"]: <AppActions />\t\r\n\t\t\t\t// [t('common.passage')]: (\r\n\t\t\t\t// \t<PassageActions getCenter={getCenter} story={story} />\r\n\t\t\t\t// ),\r\n\t\t\t\t// [t('common.story')]: <StoryActions story={story} />,\r\n\t\t\t\t// [t('common.build')]: <BuildActions story={story} />,\r\n\t\t\t\t// [t('common.appName')]: <AppActions />\r\n\t\t\t}\r\n\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {quadOut} from 'eases';\r\nimport {Point} from '../../util/geometry';\r\n\r\n/**\r\n * Information about a single zoom transition.\r\n */\r\ninterface ZoomTransition {\r\n\t/**\r\n\t * How much time has elapsed, in seconds.\r\n\t */\r\n\telapsed: number;\r\n\t/**\r\n\t * The last timestamp an update was done, in seconds.\r\n\t */\r\n\tlastTimestamp?: number;\r\n\t/**\r\n\t * The point the scrollTarget was centered on when the transition began,\r\n\t * normalized for zoom level. e.g. if it was centered on (100, 100) but the\r\n\t * story zoom was 0.5, this is (200, 200).\r\n\t */\r\n\tscrollNormalizedCenter: Point;\r\n\t/**\r\n\t * The current point the scrollTarget is centered on.\r\n\t */\r\n\tscrollCenter: {\r\n\t\theight: number;\r\n\t\twidth: number;\r\n\t};\r\n\t/**\r\n\t * The element whose scroll position is being maintained.\r\n\t */\r\n\tscrollTarget: HTMLElement;\r\n\t/**\r\n\t * How the zoom is changing during this transition.\r\n\t */\r\n\tzoom: {\r\n\t\tstart: number;\r\n\t\tchange: number;\r\n\t};\r\n}\r\n\r\n/**\r\n * Runs a single step of the zoom transition. This is outside the effect to\r\n * avoid dependencies.\r\n * @param setter Setter function for the zoom value\r\n * @param start Value of the zoom when the transition began\r\n * @param change Change in zoom value for the entire transition\r\n * @param time Elapsed time in seconds--assumes total time is 1 second\r\n * \r\n * @return transitioned value of zoom\r\n */\r\nfunction transitionStep(\r\n\tsetter: React.Dispatch<React.SetStateAction<number>>,\r\n\tstart: number,\r\n\tchange: number,\r\n\ttime: number\r\n) {\r\n\tlet value: number;\r\n\r\n\tif (time < 1) {\r\n\t\t// Step toward the change.\r\n\r\n\t\tvalue = start + change * quadOut(time);\r\n\t\tsetter(value);\r\n\t\treturn value;\r\n\t}\r\n\r\n\t// We're done.\r\n\r\n\tsetter(start + change);\r\n}\r\n\r\n/**\r\n * Manages transitioning zoom level of a story while maintaining the scroll\r\n * position's focus. This is meant to be called repeatedly with different\r\n * values, and returns the _visible_ zoom--what the user should see as zoom\r\n * value, which gradually changes over time.\r\n *\r\n * @param target Zoom value to transition towrds\r\n * @param scrollTarget DOM element whose scroll position should be manipulated\r\n * to match the returned value\r\n */\r\nexport function useZoomTransition(\r\n\ttarget: number,\r\n\tscrollTarget: HTMLElement | null\r\n) {\r\n\tconst [current, setCurrent] = React.useState(target);\r\n\tconst transition = React.useRef<ZoomTransition>();\r\n\r\n\t// This queues a single transition step using requestAnimationFrame. It's\r\n\t// crucial that this callback have no dependencies; otherwise things could get\r\n\t// confused in the middle of a transition.\r\n\r\n\tconst step = React.useCallback(() => {\r\n\t\tif (!transition.current) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow.requestAnimationFrame(timestamp => {\r\n\t\t\tconst t = transition.current as ZoomTransition;\r\n\r\n\t\t\tif (t.lastTimestamp) {\r\n\t\t\t\t// Complete the transition in 0.5 seconds, not 1.\r\n\t\t\t\tt.elapsed += (timestamp - t.lastTimestamp) / 500;\r\n\t\t\t\tt.lastTimestamp = timestamp;\r\n\r\n\t\t\t\tconst value = transitionStep(\r\n\t\t\t\t\tsetCurrent,\r\n\t\t\t\t\tt.zoom.start,\r\n\t\t\t\t\tt.zoom.change,\r\n\t\t\t\t\tt.elapsed\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\t// Sync scroll position and request a new animation step.\r\n\r\n\t\t\t\t\tconst newLeft =\r\n\t\t\t\t\t\tt.scrollNormalizedCenter.left * value - t.scrollCenter.width;\r\n\t\t\t\t\tconst newTop =\r\n\t\t\t\t\t\tt.scrollNormalizedCenter.top * value - t.scrollCenter.height;\r\n\r\n\t\t\t\t\tif (newLeft >= 0 && newTop >= 0) {\r\n\t\t\t\t\t\tt.scrollTarget.scrollLeft = newLeft;\r\n\t\t\t\t\t\tt.scrollTarget.scrollTop = newTop;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstep();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// We've reached the end.\r\n\t\t\t\t\ttransition.current = undefined;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// This is the first time we've been called in a transition. Record the\r\n\t\t\t\t// timestamp and try again.\r\n\r\n\t\t\t\tt.lastTimestamp = timestamp;\r\n\t\t\t\tstep();\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\t// Start a new transition.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (!transition.current && current !== target && scrollTarget) {\r\n\t\t\ttransition.current = {\r\n\t\t\t\tscrollTarget,\r\n\t\t\t\telapsed: 0,\r\n\t\t\t\tscrollNormalizedCenter: {\r\n\t\t\t\t\tleft:\r\n\t\t\t\t\t\t(scrollTarget.scrollLeft + scrollTarget.clientWidth / 2) / current,\r\n\t\t\t\t\ttop:\r\n\t\t\t\t\t\t(scrollTarget.scrollTop + scrollTarget.clientHeight / 2) / current\r\n\t\t\t\t},\r\n\t\t\t\tscrollCenter: {\r\n\t\t\t\t\theight: scrollTarget.clientHeight / 2,\r\n\t\t\t\t\twidth: scrollTarget.clientWidth / 2\r\n\t\t\t\t},\r\n\t\t\t\tzoom: {\r\n\t\t\t\t\tstart: current,\r\n\t\t\t\t\tchange: target - current\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\twindow.requestAnimationFrame(step);\r\n\t\t}\r\n\t}, [current, scrollTarget, step, target]);\r\n\r\n\treturn current;\r\n}\r\n","import * as React from 'react';\r\nimport 'element-closest';\r\nimport {rectFromPoints, Point, Rect} from '../../util/geometry';\r\nimport './marquee-selection.css';\r\n\r\nexport interface MarqueeSelectionProps {\r\n\t/**\r\n\t * Container DOM element to attach events to.\r\n\t */\r\n\tcontainer: React.RefObject<HTMLElement>;\r\n\t/**\r\n\t * Ignores click events on any element matching this selector. This is so that\r\n\t * drags beginning on a passage card can be ignored.\r\n\t */\r\n\tignoreEventsOnSelector?: string;\r\n\t/**\r\n\t * Callback for when selection is finalized by the user letting go of the\r\n\t * mouse button.\r\n\t */\r\n\tonSelectRect: (rect: Rect, additive: boolean) => void;\r\n\t/**\r\n\t * Callback for when the user is altering the selection by dragging the mouse.\r\n\t */\r\n\tonTemporarySelectRect: (rect: Rect, additive: boolean) => void;\r\n}\r\n\r\nexport const MarqueeSelection: React.FC<MarqueeSelectionProps> = props => {\r\n\tconst {\r\n\t\tcontainer,\r\n\t\tignoreEventsOnSelector,\r\n\t\tonSelectRect,\r\n\t\tonTemporarySelectRect\r\n\t} = props;\r\n\tconst [additive, setAdditive] = React.useState(false);\r\n\tconst [dragging, setDragging] = React.useState(false);\r\n\tconst [start, setStart] = React.useState<Point>();\r\n\tconst [current, setCurrent] = React.useState<Point>();\r\n\r\n\t// There are two effects here to prevent unnecesary cleanup of event\r\n\t// listeners. One listens to DOM events on the container, the other handles\r\n\t// calling onSelectRect.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst currentContainer = container.current;\r\n\t\tlet currentContainerRect: DOMRect;\r\n\r\n\t\tfunction relativePointerPos(event: PointerEvent) {\r\n\t\t\treturn {\r\n\t\t\t\tleft:\r\n\t\t\t\t\tevent.clientX -\r\n\t\t\t\t\tcurrentContainerRect.left +\r\n\t\t\t\t\tcurrentContainer!.scrollLeft,\r\n\t\t\t\ttop:\r\n\t\t\t\t\tevent.clientY - currentContainerRect.top + currentContainer!.scrollTop\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction upListener(event: PointerEvent) {\r\n\t\t\tif (currentContainer) {\r\n\t\t\t\tcurrentContainer.releasePointerCapture(event.pointerId);\r\n\t\t\t\tcurrentContainer.removeEventListener('pointermove', moveListener);\r\n\t\t\t\tcurrentContainer.removeEventListener('pointerup', upListener);\r\n\t\t\t\tsetDragging(false);\r\n\t\t\t\t// See the second effect for how callbacks are invoked.\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction moveListener(event: PointerEvent) {\r\n\t\t\tsetCurrent(relativePointerPos(event));\r\n\t\t}\r\n\r\n\t\tfunction downListener(event: PointerEvent) {\r\n\t\t\tif (\r\n\t\t\t\tevent.pointerType === 'touch' ||\r\n\t\t\t\tevent.button !== 0 ||\r\n\t\t\t\t!currentContainer\r\n\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tignoreEventsOnSelector &&\r\n\t\t\t\t(event.target as HTMLElement).closest(ignoreEventsOnSelector)\r\n\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcurrentContainerRect = currentContainer.getBoundingClientRect();\r\n\t\t\tcurrentContainer.setPointerCapture(event.pointerId);\r\n\t\t\tcurrentContainer.addEventListener('pointermove', moveListener);\r\n\t\t\tcurrentContainer.addEventListener('pointerup', upListener);\r\n\t\t\tsetAdditive(!!(event.shiftKey || event.ctrlKey));\r\n\t\t\tsetDragging(true);\r\n\t\t\tsetStart(relativePointerPos(event));\r\n\t\t\tsetCurrent(relativePointerPos(event));\r\n\t\t}\r\n\r\n\t\tif (currentContainer) {\r\n\t\t\tcurrentContainer.addEventListener('pointerdown', downListener);\r\n\t\t\treturn () =>\r\n\t\t\t\tcurrentContainer.removeEventListener('pointerdown', downListener);\r\n\t\t}\r\n\t}, [container, ignoreEventsOnSelector]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\t// This effect will trigger constantly if the on* callbacks aren't memoized\r\n\t\t// outside the component.\r\n\r\n\t\tif (start && current) {\r\n\t\t\tif (dragging) {\r\n\t\t\t\tonTemporarySelectRect(rectFromPoints(start, current), additive);\r\n\t\t\t} else {\r\n\t\t\t\tonSelectRect(rectFromPoints(start, current), additive);\r\n\t\t\t\tsetStart(undefined);\r\n\t\t\t\tsetCurrent(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [additive, current, dragging, onSelectRect, onTemporarySelectRect, start]);\r\n\r\n\tconst style = React.useMemo(() => {\r\n\t\tif (!start || !current) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\r\n\t\tconst rect = rectFromPoints(start, current);\r\n\r\n\t\t// This relies on the static dimensions of the div being set at 100x100 in\r\n\t\t// CSS. The point of this is to allow the browser to resize the marquee\r\n\t\t// using GPU only (hopefully), which is more performant than setting bounds\r\n\t\t// directly.\r\n\r\n\t\treturn {\r\n\t\t\ttransform: `translate(${rect.left}px, ${rect.top}px) scale(${\r\n\t\t\t\trect.width / 100\r\n\t\t\t}, ${rect.height / 100})`\r\n\t\t};\r\n\t}, [current, start]);\r\n\r\n\tif (!start || !current) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn <div className=\"marquee-selection\" style={style} />;\r\n};\r\n","import * as React from 'react';\r\nimport {Passage} from '../../../store/stories';\r\nimport {Point} from '../../../util/geometry';\r\nimport './broken-connection.css';\r\n\r\nexport interface BrokenConnectionProps {\r\n\toffset: Point;\r\n\tpassage: Passage;\r\n}\r\n\r\n// Making this equal in length to <StartConnector>.\r\nconst lineOffset = 25 * Math.sqrt(2);\r\n\r\nexport const BrokenConnection: React.FC<BrokenConnectionProps> = props => {\r\n\tconst {offset, passage} = props;\r\n\tconst start: Point = {left: passage.left, top: passage.top};\r\n\r\n\tif (passage.selected) {\r\n\t\tstart.left += offset.left;\r\n\t\tstart.top += offset.top;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<line\r\n\t\t\tclassName=\"broken-connection\"\r\n\t\t\tx1={start.left + passage.width}\r\n\t\t\ty1={start.top + passage.height}\r\n\t\t\tx2={start.left + passage.width + lineOffset}\r\n\t\t\ty2={start.top + passage.height + lineOffset}\r\n\t\t\tstyle={{markerEnd: 'url(#link-broken)'}}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {Point} from './geometry';\r\n\r\nexport interface ArcProps {\r\n\tend: Point;\r\n\tlargeArc?: boolean;\r\n\tradius: Point;\r\n\trotation?: number;\r\n\tstart: Point;\r\n\tsweep?: boolean;\r\n}\r\n\r\n/**\r\n * Returns an SVG path string between two points.\r\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#arcs\r\n */\r\nexport function arc({start, end, radius, largeArc, sweep, rotation}: ArcProps) {\r\n\treturn (\r\n\t\t'M' +\r\n\t\tstart.left +\r\n\t\t',' +\r\n\t\tstart.top +\r\n\t\t' A' +\r\n\t\tradius.left +\r\n\t\t',' +\r\n\t\tradius.top +\r\n\t\t' ' +\r\n\t\t(rotation ?? '0') +\r\n\t\t(largeArc ? ' 1' : ' 0') +\r\n\t\t(sweep ? ' 1 ' : ' 0 ') +\r\n\t\tend.left +\r\n\t\t',' +\r\n\t\tend.top\r\n\t);\r\n}\r\n","import * as React from 'react';\r\nimport {arc} from '../../../util/svg';\r\nimport {\r\n\tlineAngle,\r\n\tlineDistance,\r\n\trectCenter,\r\n\trectIntersectionWithLine,\r\n\tPoint\r\n} from '../../../util/geometry';\r\nimport {Passage} from '../../../store/stories';\r\nimport './passage-connection.css';\r\n\r\nexport interface PassageConnectionProps {\r\n\tend: Passage;\r\n\toffset: Point;\r\n\tstart: Passage;\r\n\tvariant: 'link' | 'reference';\r\n}\r\n\r\nexport const PassageConnection: React.FC<PassageConnectionProps> = props => {\r\n\tconst {end, offset, start, variant} = props;\r\n\tconst path = React.useMemo(() => {\r\n\t\t// If either passage is selected, offset it. We need to take care not to\r\n\t\t// overwrite the passage information.\r\n\r\n\t\tlet offsetStart = start;\r\n\t\tlet offsetEnd = end;\r\n\r\n\t\tif (start.selected) {\r\n\t\t\toffsetStart = {\r\n\t\t\t\t...start,\r\n\t\t\t\tleft: start.left + offset.left,\r\n\t\t\t\ttop: start.top + offset.top\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (end.selected) {\r\n\t\t\toffsetEnd = {\r\n\t\t\t\t...end,\r\n\t\t\t\tleft: end.left + offset.left,\r\n\t\t\t\ttop: end.top + offset.top\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Start at the center of both passages.\r\n\r\n\t\tlet startPoint: Point | null = rectCenter(offsetStart);\r\n\t\tlet endPoint: Point | null = rectCenter(offsetEnd);\r\n\r\n\t\t// Move both points to where they intersect with the edges of their passages.\r\n\r\n\t\tstartPoint = rectIntersectionWithLine(offsetStart, startPoint, endPoint);\r\n\r\n\t\tif (!startPoint) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tendPoint = rectIntersectionWithLine(offsetEnd, startPoint, endPoint);\r\n\r\n\t\tif (!endPoint) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\t// Draw a flattened arc, to make it easier to distinguish between links\r\n\t\t// between passages with the same horizontal or vertical position (which\r\n\t\t// would otherwise be overlapping flat lines).\r\n\t\t//\r\n\t\t// The horizontal radius of our arc is proportional to the distance\r\n\t\t// the line will travel.\r\n\r\n\t\tconst distance = lineDistance(startPoint, endPoint);\r\n\r\n\t\t// Rotate the arc so that its underside will always face downward. We cheat\r\n\t\t// vertical lines so that their undersides face right--an aesthetic choice,\r\n\t\t// and so that bidirectional links line up.\r\n\r\n\t\tlet sweep = startPoint.left < endPoint.left;\r\n\r\n\t\tif (startPoint.left === endPoint.left && startPoint.top < endPoint.top) {\r\n\t\t\tsweep = true;\r\n\t\t}\r\n\r\n\t\tconst angle = lineAngle(startPoint, endPoint);\r\n\r\n\t\t// The Y radius is another aesthetic choice. The lower the ratio, the less\r\n\t\t// curved the lines become.\r\n\r\n\t\treturn arc({\r\n\t\t\tstart: startPoint,\r\n\t\t\tend: endPoint,\r\n\t\t\tradius: {left: distance, top: distance * 0.75},\r\n\t\t\trotation: angle,\r\n\t\t\tsweep\r\n\t\t});\r\n\t}, [end, offset.left, offset.top, start]);\r\n\r\n\treturn (\r\n\t\t<path\r\n\t\t\td={path}\r\n\t\t\tclassName={`passage-connection variant-${variant}`}\r\n\t\t\tstyle={{markerEnd: 'url(#link-arrowhead)'}}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {Passage} from '../../../store/stories';\r\nimport {Point} from '../../../util/geometry';\r\nimport {arc} from '../../../util/svg';\r\nimport './self-connection.css';\r\n\r\nexport interface SelfConnectionProps {\r\n\toffset: Point;\r\n\tpassage: Passage;\r\n\tvariant: 'link' | 'reference';\r\n}\r\n\r\nexport const SelfConnection: React.FC<SelfConnectionProps> = props => {\r\n\tconst {offset, passage, variant} = props;\r\n\tconst start: Point = {left: passage.left, top: passage.top};\r\n\r\n\tif (passage.selected) {\r\n\t\tstart.left += offset.left;\r\n\t\tstart.top += offset.top;\r\n\t}\r\n\r\n\tconst radius = React.useMemo(\r\n\t\t() => 0.4 * Math.min(passage.width, passage.height),\r\n\t\t[passage.height, passage.width]\r\n\t);\r\n\r\n\tconst path = React.useMemo(\r\n\t\t() =>\r\n\t\t\tarc({\r\n\t\t\t\tstart: {\r\n\t\t\t\t\tleft: start.left,\r\n\t\t\t\t\ttop: start.top + passage.height / 2\r\n\t\t\t\t},\r\n\t\t\t\tend: {\r\n\t\t\t\t\tleft: start.left,\r\n\t\t\t\t\ttop: start.top\r\n\t\t\t\t},\r\n\t\t\t\tradius: {\r\n\t\t\t\t\tleft: radius,\r\n\t\t\t\t\ttop: radius\r\n\t\t\t\t},\r\n\t\t\t\tsweep: true,\r\n\t\t\t\tlargeArc: true\r\n\t\t\t}),\r\n\t\t[passage.height, radius, start.left, start.top]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<path\r\n\t\t\tclassName={`self-connection variant-${variant}`}\r\n\t\t\td={path}\r\n\t\t\tstyle={{markerEnd: 'url(#link-arrowhead)'}}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {Passage} from '../../../store/stories';\r\nimport {BrokenConnection} from './broken-connection';\r\nimport {PassageConnection} from './passage-connection';\r\nimport {SelfConnection} from './self-connection';\r\nimport {Point} from '../../../util/geometry';\r\n\r\nexport interface PassageConnectionGroupProps {\r\n\tbroken: Set<Passage>;\r\n\tconnections: Map<Passage, Set<Passage>>;\r\n\toffset: Point;\r\n\tself: Set<Passage>;\r\n\tvariant?: 'link' | 'reference';\r\n}\r\n\r\nexport const PassageConnectionGroup: React.FC<PassageConnectionGroupProps> = React.memo(\r\n\tprops => {\r\n\t\tconst {broken, connections, offset, self, variant = 'link'} = props;\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t{Array.from(connections).map(connection =>\r\n\t\t\t\t\tArray.from(connection[1]).map(end => (\r\n\t\t\t\t\t\t<PassageConnection\r\n\t\t\t\t\t\t\tend={end}\r\n\t\t\t\t\t\t\toffset={offset}\r\n\t\t\t\t\t\t\tkey={connection[0].name + end.name}\r\n\t\t\t\t\t\t\tstart={connection[0]}\r\n\t\t\t\t\t\t\tvariant={variant}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))\r\n\t\t\t\t)}\r\n\t\t\t\t{Array.from(self).map(passage => (\r\n\t\t\t\t\t<SelfConnection\r\n\t\t\t\t\t\tkey={passage.name}\r\n\t\t\t\t\t\toffset={offset}\r\n\t\t\t\t\t\tpassage={passage}\r\n\t\t\t\t\t\tvariant={variant}\r\n\t\t\t\t\t/>\r\n\t\t\t\t))}\r\n\t\t\t\t{Array.from(broken).map(passage => (\r\n\t\t\t\t\t<BrokenConnection\r\n\t\t\t\t\t\tkey={passage.name}\r\n\t\t\t\t\t\toffset={offset}\r\n\t\t\t\t\t\tpassage={passage}\r\n\t\t\t\t\t/>\r\n\t\t\t\t))}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n);\r\n\r\nPassageConnectionGroup.displayName = 'PassageConnectionGroup';","import * as React from 'react';\r\nimport './link-markers.css';\r\n\r\n/**\r\n * Arrowheads used on connectors. Arrowheads must be applied by an inline style.\r\n * There seems to be disagreement on the proper way to implement this, but it\r\n * does not work in an external stylesheet in Firefox.\r\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Element/marker\r\n */\r\nexport const LinkMarkers: React.FC = () => (\r\n\t<defs>\r\n\t\t<marker\r\n\t\t\tid=\"link-arrowhead\"\r\n\t\t\trefX=\"6\"\r\n\t\t\trefY=\"4\"\r\n\t\t\tmarkerWidth=\"8\"\r\n\t\t\tmarkerHeight=\"8\"\r\n\t\t\torient=\"auto\"\r\n\t\t>\r\n\t\t\t<path d=\"M 1,1 7,4 1,7 Z\" />\r\n\t\t</marker>\r\n\t\t<marker\r\n\t\t\tid=\"link-broken\"\r\n\t\t\trefX=\"7.5\"\r\n\t\t\trefY=\"7.5\"\r\n\t\t\tmarkerWidth=\"15\"\r\n\t\t\tmarkerHeight=\"15\"\r\n\t\t>\r\n\t\t\t<circle cx=\"7.5\" cy=\"7.5\" r=\"7.5\" />\r\n\t\t\t<path d=\"M4.5 7.5h 6z\" />\r\n\t\t</marker>\r\n\t\t<marker\r\n\t\t\tid=\"link-start\"\r\n\t\t\tmarkerWidth=\"15\"\r\n\t\t\tmarkerHeight=\"15\"\r\n\t\t\trefX=\"16\"\r\n\t\t\trefY=\"16\"\r\n\t\t\tviewBox=\"0 0 32 32\"\r\n\t\t>\r\n\t\t\t<circle cx=\"16\" cy=\"16\" r=\"16\" />\r\n\t\t\t<path d=\"M8 17a8 8 0 0 1 7 7a6 6 0 0 0 3 -5a9 9 0 0 0 6 -8a3 3 0 0 0 -3 -3a9 9 0 0 0 -8 6a6 6 0 0 0 -5 3\" />\r\n\t\t\t<path d=\"M11 18a6 6 0 0 0 -3 6a6 6 0 0 0 6 -3\" />\r\n\t\t\t<circle className=\"fill-white\" cx=\"19\" cy=\"13\" r=\"1\" />\r\n\t\t</marker>\r\n\t</defs>\r\n);\r\n","import * as React from 'react';\r\nimport {Passage} from '../../../store/stories';\r\nimport {Point} from '../../../util/geometry';\r\nimport './start-connection.css';\r\n\r\nexport interface StartConnectionProps {\r\n\toffset: Point;\r\n\tpassage: Passage;\r\n}\r\n\r\nexport const StartConnection: React.FC<StartConnectionProps> = React.memo(\r\n\tprops => {\r\n\t\tconst {offset, passage} = props;\r\n\t\tconst start: Point = {left: passage.left, top: passage.top};\r\n\r\n\t\tif (passage.selected) {\r\n\t\t\tstart.left += offset.left;\r\n\t\t\tstart.top += offset.top;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<line\r\n\t\t\t\tclassName=\"start-connection\"\r\n\t\t\t\tx1={start.left - 50}\r\n\t\t\t\ty1={start.top + passage.height / 2}\r\n\t\t\t\tx2={start.left}\r\n\t\t\t\ty2={start.top + passage.height / 2}\r\n\t\t\t\tstyle={{markerStart: 'url(#link-start)'}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n);\r\n\r\nStartConnection.displayName = 'StartConnection';","import * as React from 'react';\r\nimport {version as twineVersion} from '../../package.json';\r\nimport {formatEditorExtensions} from '../util/story-format';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tloadFormatProperties,\r\n\tuseStoryFormatsContext\r\n} from './story-formats';\r\nimport {formatEditorExtensionsDisabled, usePrefsContext} from './prefs';\r\n\r\nconst emptyFunc = () => [];\r\n\r\nexport function useFormatReferenceParser(\r\n\tformatName: string,\r\n\tformatVersion: string\r\n) {\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst {dispatch, formats} = useStoryFormatsContext();\r\n\tconst format = formatWithNameAndVersion(formats, formatName, formatVersion);\r\n\tconst [editorExtensions, setEditorExtensions] = React.useState<\r\n\t\tReturnType<typeof formatEditorExtensions>\r\n\t>();\r\n\tconst extensionsDisabled = formatEditorExtensionsDisabled(\r\n\t\tprefs,\r\n\t\tformatName,\r\n\t\tformatVersion\r\n\t);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (extensionsDisabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (format.loadState === 'unloaded') {\r\n\t\t\tdispatch(loadFormatProperties(format));\r\n\t\t} else if (format.loadState === 'loaded') {\r\n\t\t\tsetEditorExtensions(formatEditorExtensions(format, twineVersion));\r\n\t\t}\r\n\t}, [dispatch, extensionsDisabled, format]);\r\n\r\n\tif (extensionsDisabled) {\r\n\t\treturn emptyFunc;\r\n\t}\r\n\r\n\treturn editorExtensions?.references?.parsePassageText ?? emptyFunc;\r\n}\r\n","import * as React from 'react';\r\nimport {Passage, passageConnections} from '../../../store/stories';\r\nimport {Point} from '../../../util/geometry';\r\nimport {PassageConnectionGroup} from './passage-connection-group';\r\nimport {LinkMarkers} from './link-markers';\r\nimport {StartConnection} from './start-connection';\r\nimport {useFormatReferenceParser} from '../../../store/use-format-reference-parser';\r\n\r\nexport interface PassageConnectionsProps {\r\n\tformatName: string;\r\n\tformatVersion: string;\r\n\toffset: Point;\r\n\tpassages: Passage[];\r\n\tstartPassageId: string;\r\n}\r\n\r\nconst emptySet = new Set<Passage>();\r\nconst noOffset: Point = {left: 0, top: 0};\r\n\r\nexport const PassageConnections: React.FC<PassageConnectionsProps> = props => {\r\n\tconst {formatName, formatVersion, offset, passages, startPassageId} = props;\r\n\tconst referenceParser = useFormatReferenceParser(formatName, formatVersion);\r\n\t\r\n\t//드래그 관련\r\n\tconst {draggable: draggableLinks, fixed: fixedLinks} = React.useMemo(\r\n\t\t() => passageConnections(passages),\r\n\t\t[passages]\r\n\t);\r\n\tconst {\r\n\t\tdraggable: draggableReferences,\r\n\t\tfixed: fixedReferences\r\n\t} = React.useMemo(() => passageConnections(passages, referenceParser), [\r\n\t\tpassages,\r\n\t\treferenceParser\r\n\t]);\r\n\r\n\tconst startPassage = React.useMemo(\r\n\t\t() => passages.find(passage => passage.id === startPassageId),\r\n\t\t[passages, startPassageId]\r\n\t);\r\n\r\n\t// References only show existing connections.\r\n\r\n\treturn (\r\n\t\t<svg className=\"link-connectors\">\r\n\t\t\t<LinkMarkers />\r\n\t\t\t{startPassage && (\r\n\t\t\t\t<StartConnection offset={offset} passage={startPassage} />\r\n\t\t\t)}\r\n\t\t\t<PassageConnectionGroup {...draggableLinks} offset={offset} />\r\n\t\t\t<PassageConnectionGroup {...fixedLinks} offset={noOffset} />\r\n\t\t\t<PassageConnectionGroup\r\n\t\t\t\tbroken={emptySet}\r\n\t\t\t\tconnections={draggableReferences.connections}\r\n\t\t\t\toffset={offset}\r\n\t\t\t\tself={emptySet}\r\n\t\t\t\tvariant=\"reference\"\r\n\t\t\t/>\r\n\t\t\t<PassageConnectionGroup\r\n\t\t\t\tbroken={emptySet}\r\n\t\t\t\tconnections={fixedReferences.connections}\r\n\t\t\t\toffset={noOffset}\r\n\t\t\t\tself={emptySet}\r\n\t\t\t\tvariant=\"reference\"\r\n\t\t\t/>\r\n\t\t</svg>\r\n\t);\r\n};\r\n","\r\n\r\n\r\nimport classNames from 'classnames';                                     // 태그에 class를 부여하는 라이브러리\r\nimport {deviceType} from 'detect-it';                                    // 마우스 클릭을 감지\r\nimport * as React from 'react';\r\nimport {DraggableCore, DraggableCoreProps} from 'react-draggable';       // 객체를 드래그할 수 있는 라이브러리\r\nimport {useTranslation} from 'react-i18next';\r\nimport {Passage, TagColors} from '../../store/stories';\r\nimport {CardContent} from '../container/card';\r\nimport {SelectableCard} from '../container/card/selectable-card';\r\nimport {TagStripe} from '../tag/tag-stripe';\r\nimport './passage-card.css';\r\n\r\nexport interface PassageCardProps {\r\n\tonEdit: (passage: Passage) => void;                       // Passage interface 타입을 인자로 보내서 void를 반환하는 함수 타입\r\n\tonDeselect: (passage: Passage) => void;                   // 위와 같음\r\n\tonDragStart?: DraggableCoreProps['onStart'];             // DraggableCoreProps의 onStart 속성으로 타입 지정\r\n\tonDrag?: DraggableCoreProps['onDrag'];                   // DraggableCoreProps의 onDrag 속성으로 타입 지정\r\n\tonDragStop?: DraggableCoreProps['onStop'];               // DraggableCoreProps의 onStop 속성으로 타입 지정\r\n\tonSelect: (passage: Passage, exclusive: boolean) => void;  // Passage 타입과 boolean을 인자로 보내서 void를 반환하는 함수 타입\r\n\tpassage: Passage;\r\n\ttagColors: TagColors;\r\n}\r\n\r\n// Needs to fill a large-sized passage card.\r\nconst excerptLength = 400;\r\n\r\nexport const PassageCard: React.FC<PassageCardProps> = React.memo(props => {\r\n\tconst {\r\n\t\tonDeselect,\r\n\t\tonDrag,\r\n\t\tonDragStart,\r\n\t\tonDragStop,\r\n\t\tonEdit,\r\n\t\tonSelect,\r\n\t\tpassage,\r\n\t\ttagColors\r\n\t} = props;\r\n\tconst {t} = useTranslation();                  // t('...') 형식의 문자열을 번역해줌.\r\n\t/**\r\n\t * passage.select, passage.tags.length, passage.text의 값이 바뀌면,\r\n\t * classNames()호출. \r\n\t * passage-card 클래스는 기본적으로 추가.\r\n\t * empty는 passage.text가 공백이며, passage.tags.length가 0일 때 추가.\r\n\t * selected는 passage.selected가 true일 때 추가\r\n\t */\r\n\tconst className = React.useMemo(                                 \r\n\t\t() =>\r\n\t\t\tclassNames('passage-card', {\r\n\t\t\t\tempty: passage.text === '' && passage.tags.length === 0,\r\n\t\t\t\tselected: passage.selected\r\n\t\t\t}),\r\n\t\t[passage.selected, passage.tags.length, passage.text]\r\n\t);\r\n\tconst container = React.useRef<HTMLDivElement>(null);     // div 엘리먼트의 초기값을 current 속성에 할당. 상태가 변경되어도 다시 렌더링되지 않음\r\n\t/**\r\n\t * passage.text, t값이 변할 때마다\r\n\t * 본문이 있으면, passage의 본문을 발췌하여 excerpt에 리턴.\r\n\t * 본문이 공백 상태라면, placeholder 출력\r\n\t */\r\n\tconst excerpt = React.useMemo(() => {\r\n\t\tif (passage.text.length > 0) {\r\n\t\t\treturn passage.text.substring(0, excerptLength);\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<span className=\"placeholder\">\r\n\t\t\t\t{t(\r\n\t\t\t\t\tdeviceType === 'touchOnly'\r\n\t\t\t\t\t\t? 'components.passageCard.placeholderTouch'\r\n\t\t\t\t\t\t: 'components.passageCard.placeholderClick'\r\n\t\t\t\t)}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}, [passage.text, t]);\r\n\t/**\r\n\t * passage.height, passage.left, passage.top, passage.width 값이 바뀌면,\r\n\t * style에 height, left, top, width 값을 반환\r\n\t */\r\n\tconst style = React.useMemo(\r\n\t\t() => ({\r\n\t\t\theight: passage.height,\r\n\t\t\tleft: passage.left,\r\n\t\t\ttop: passage.top,\r\n\t\t\twidth: passage.width\r\n\t\t}),\r\n\t\t[passage.height, passage.left, passage.top, passage.width]\r\n\t);\r\n\t/**\r\n\t * shift+좌클릭, ctrl+좌클릭하면 passage card 여러 개 선택하는 기능\r\n\t */\r\n\tconst handleMouseDown = React.useCallback(\r\n\t\t(event: MouseEvent) => {\r\n\t\t\tif (event.shiftKey || event.ctrlKey) {\r\n\t\t\t\tif (passage.selected) {\r\n\t\t\t\t\tonDeselect(passage);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonSelect(passage, false);\r\n\t\t\t\t}\r\n\t\t\t} else if (!passage.selected) {\r\n\t\t\t\tonSelect(passage, true);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[onDeselect, onSelect, passage]\r\n\t);\r\n\t/**\r\n\t * passage 값이 바뀌면 새로운 onEdit 호출\r\n\t */\r\n\tconst handleEdit = React.useCallback(\r\n\t\t() => onEdit(passage),\r\n\t\t[onEdit, passage]\r\n\t);\r\n\t/**\r\n\t * passage 값이 바뀌면 새로운 onSelect 호출\r\n\t */\r\n\tconst handleSelect = React.useCallback(\r\n\t\t(value: boolean, exclusive: boolean) => {\r\n\t\t\tonSelect(passage, exclusive);\r\n\t\t},\r\n\t\t[onSelect, passage]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<DraggableCore\r\n\t\t\tnodeRef={container}\r\n\t\t\tonMouseDown={handleMouseDown}\r\n\t\t\tonStart={onDragStart}\r\n\t\t\tonDrag={onDrag}\r\n\t\t\tonStop={onDragStop}\r\n\t\t>\r\n\t\t\t<div className={className} ref={container} style={style}>\r\n\t\t\t\t<SelectableCard                                            // 선택 가능한 passage card\r\n\t\t\t\t\thighlighted={passage.highlighted}\r\n\t\t\t\t\tlabel={passage.name}\r\n\t\t\t\t\tonDoubleClick={handleEdit}             // 더블클릭 시 handleEdit 호출\r\n\t\t\t\t\tonSelect={handleSelect}                // 텍스트가 선택될 때 handleSeelct 호출\r\n\t\t\t\t\tselected={passage.selected}\r\n\t\t\t\t>\r\n\t\t\t\t\t<TagStripe tagColors={tagColors} tags={passage.tags} />\r\n\t\t\t\t\t<h2>{passage.name}</h2>\r\n\t\t\t\t\t<CardContent>{excerpt}</CardContent>\r\n\t\t\t\t</SelectableCard>\r\n\t\t\t</div>\r\n\t\t</DraggableCore>\r\n\t);\r\n});\r\n\r\nPassageCard.displayName = 'PassageCard';","import * as React from 'react';\r\nimport {CSSTransition, TransitionGroup} from 'react-transition-group';\r\nimport {Passage} from '../../store/stories';\r\nimport {PassageCard, PassageCardProps} from './passage-card';\r\nimport '../../styles/animations.css';\r\n\r\nexport interface PassageCardGroupProps\r\n\textends Omit<PassageCardProps, 'passage'> {\r\n\tpassages: Passage[];\r\n}\r\n\r\nexport const PassageCardGroup: React.FC<PassageCardGroupProps> = React.memo(\r\n\tprops => {\r\n\t\tconst {passages} = props;\r\n\r\n\t\t// Passages must be sorted so that tabbing around follows a logical pattern.\r\n\r\n\t\tconst sortedPassages = React.useMemo(\r\n\t\t\t() =>\r\n\t\t\t\t[...passages].sort((a, b) => {\r\n\t\t\t\t\tif (a.top !== b.top) {\r\n\t\t\t\t\t\treturn a.top - b.top;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn a.left - b.left;\r\n\t\t\t\t}),\r\n\t\t\t[passages]\r\n\t\t);\r\n\r\n\t\treturn (\r\n\t\t\t<TransitionGroup component={null}>\r\n\t\t\t\t{sortedPassages.map(passage => (\r\n\t\t\t\t\t<CSSTransition classNames=\"pop\" key={passage.id} timeout={200}>\r\n\t\t\t\t\t\t<PassageCard passage={passage} {...props} />\r\n\t\t\t\t\t</CSSTransition>\r\n\t\t\t\t))}\r\n\t\t\t</TransitionGroup>\r\n\t\t);\r\n\t}\r\n);\r\n\r\nPassageCardGroup.displayName = 'PassageCardGroup';","import * as React from 'react';\r\nimport {DraggableData} from 'react-draggable';\r\nimport {Passage, Story} from '../../../store/stories';\r\nimport {boundingRect, Point} from '../../../util/geometry';\r\nimport {PassageConnections} from '../passage-connections';\r\nimport {PassageCardGroup} from '../passage-card-group';\r\nimport './passage-map.css';\r\nimport classnames from 'classnames';\r\n\r\nexport interface PassageMapProps {\r\n\tformatName: string;\r\n\tformatVersion: string;\r\n\tonDeselect: (passage: Passage) => void;\r\n\tonDrag: (change: Point) => void;\r\n\tonEdit: (passage: Passage) => void;\r\n\tonSelect: (passage: Passage, exclusive: boolean) => void;\r\n\tpassages: Passage[];\r\n\tstartPassageId: string;\r\n\ttagColors: Story['tagColors'];\r\n\tvisibleZoom: number;\r\n\tzoom: number;\r\n}\r\n\r\ninterface DragState {\r\n\tdragging: boolean;\r\n\tdragX: number;\r\n\tdragY: number;\r\n\tstartX: number;\r\n\tstartY: number;\r\n}\r\n\r\ntype DragAction =\r\n\t| {type: 'start'; x: number; y: number}\r\n\t| {type: 'move'; x: number; y: number}\r\n\t| {type: 'stop'; callback: (change: Point) => void};\r\n\r\nfunction dragReducer(state: DragState, action: DragAction) {\r\n\tswitch (action.type) {\r\n\t\tcase 'start':\r\n\t\t\treturn {\r\n\t\t\t\tdragging: true,\r\n\t\t\t\tdragX: action.x,\r\n\t\t\t\tdragY: action.y,\r\n\t\t\t\tstartX: action.x,\r\n\t\t\t\tstartY: action.y\r\n\t\t\t};\r\n\r\n\t\tcase 'move':\r\n\t\t\treturn {...state, dragX: action.x, dragY: action.y};\r\n\r\n\t\tcase 'stop':\r\n\t\t\t// This is bad reducer practice, probably—this dispatch causes a side\r\n\t\t\t// effect. However, it allows us to avoid re-renders as state\r\n\t\t\t// changes--otherwise state becomes a dependency of the handleDragStop\r\n\t\t\t// callback below--which have a large performance impact.\r\n\t\t\t//\r\n\t\t\t// This also must be deferred to avoid changing state mid-render through\r\n\t\t\t// the callback.\r\n\r\n\t\t\tPromise.resolve().then(() =>\r\n\t\t\t\taction.callback({\r\n\t\t\t\t\tleft: state.dragX - state.startX,\r\n\t\t\t\t\ttop: state.dragY - state.startY\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\treturn {dragging: false, dragX: 0, dragY: 0, startX: 0, startY: 0};\r\n\t}\r\n}\r\n\r\nconst compactCardZoom = 0.6;\r\n\r\nexport const PassageMap: React.FC<PassageMapProps> = props => {\r\n\tconst {\r\n\t\tformatName,\r\n\t\tformatVersion,\r\n\t\tonDeselect,\r\n\t\tonDrag,\r\n\t\tonEdit,\r\n\t\tonSelect,\r\n\t\tpassages,\r\n\t\tstartPassageId,\r\n\t\ttagColors,\r\n\t\tvisibleZoom,\r\n\t\tzoom\r\n\t} = props;\r\n\tconst [compactCards, setCompactCards] = React.useState(\r\n\t\tvisibleZoom <= compactCardZoom\r\n\t);\r\n\tconst container = React.useRef<HTMLDivElement>(null);\r\n\tconst passageBounds = React.useMemo(() => {\r\n\t\t// Need to inject a fake rect at the very top-left corner to anchor the\r\n\t\t// bounds there.\r\n\r\n\t\treturn boundingRect([...passages, {top: 0, left: 0, width: 0, height: 0}]);\r\n\t}, [passages]);\r\n\r\n\t// This is a separate memo so that there's less work when visibleZoom changes\r\n\t// during a zoom transition. The max() expression ensures that dialogs will\r\n\t// never overlap it--800px is the largest user-selectable dialog width (see\r\n\t// dialogs/app-prefs.tsx), so we leave 200px padding around that. We hardcode\r\n\t// it here instead of taking a prop mainly for simplicity's sake.\r\n\r\n\tconst style = React.useMemo(() => {\r\n\t\treturn {\r\n\t\t\theight: `calc(${passageBounds.height}px + max(50vh, ${\r\n\t\t\t\t1000 / visibleZoom\r\n\t\t\t}px))`,\r\n\t\t\twidth: `calc(${passageBounds.width}px + max(50vw, ${\r\n\t\t\t\t1000 / visibleZoom\r\n\t\t\t}px))`,\r\n\t\t\ttransform: `scale(${visibleZoom})`\r\n\t\t};\r\n\t}, [passageBounds.height, passageBounds.width, visibleZoom]);\r\n\r\n\tconst [state, dispatch] = React.useReducer(dragReducer, {\r\n\t\tdragging: false,\r\n\t\tdragX: 0,\r\n\t\tdragY: 0,\r\n\t\tstartX: 0,\r\n\t\tstartY: 0\r\n\t});\r\n\r\n\t// Only update the compact card state when visibleZoom and zoom are the same.\r\n\t// This avoids re-rendering the cards in the middle of a zoom transition\r\n\t// (which causes jank).\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (zoom === visibleZoom) {\r\n\t\t\tsetCompactCards(zoom <= compactCardZoom);\r\n\t\t}\r\n\t}, [visibleZoom, zoom]);\r\n\r\n\t// Set CSS variables on the container for drag offsets.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (!container.current) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcontainer.current.style.setProperty(\r\n\t\t\t'--drag-offset-left',\r\n\t\t\t`${(state.dragX - state.startX) / visibleZoom}px`\r\n\t\t);\r\n\t\tcontainer.current.style.setProperty(\r\n\t\t\t'--drag-offset-top',\r\n\t\t\t`${(state.dragY - state.startY) / visibleZoom}px`\r\n\t\t);\r\n\t}, [state.dragX, state.dragY, state.startX, state.startY, visibleZoom]);\r\n\r\n\tconst handleDragStart = React.useCallback((event, data: DraggableData) => {\r\n\t\tdocument.body.classList.add('dragging-passages');\r\n\t\tdispatch({type: 'start', x: data.x, y: data.y});\r\n\t}, []);\r\n\tconst handleDrag = React.useCallback(\r\n\t\t(event, data: DraggableData) =>\r\n\t\t\tdispatch({type: 'move', x: data.x, y: data.y}),\r\n\t\t[]\r\n\t);\r\n\tconst handleDragStop = React.useCallback(() => {\r\n\t\t// We use a timeout to delay this execution until after the click handler on\r\n\t\t// <SelectableCard> runs and triggers handleSelect below, so that function\r\n\t\t// can see that a drag has just finished (and should be ignored as part of\r\n\t\t// the drag interaction).\r\n\t\t//\r\n\t\t// Promise.resolve() doesn't appear to give us the timing we need.\r\n\r\n\t\twindow.setTimeout(() => {\r\n\t\t\tdocument.body.classList.remove('dragging-passages');\r\n\t\t\tdispatch({type: 'stop', callback: onDrag});\r\n\t\t}, 0);\r\n\t}, [onDrag]);\r\n\tconst handleSelect = React.useCallback(\r\n\t\t(passage: Passage, exclusive: boolean) => {\r\n\t\t\t// See comments in handleDragStop above.\r\n\r\n\t\t\tif (!state.dragging) {\r\n\t\t\t\tonSelect(passage, exclusive);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[onSelect, state.dragging]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={classnames('passage-map', {\r\n\t\t\t\t'compact-passage-cards': compactCards\r\n\t\t\t})}\r\n\t\t\tref={container}\r\n\t\t\tstyle={style}\r\n\t\t>\r\n\t\t\t<PassageConnections\r\n\t\t\t\tformatName={formatName}\r\n\t\t\t\tformatVersion={formatVersion}\r\n\t\t\t\toffset={{\r\n\t\t\t\t\tleft: (state.dragX - state.startX) / zoom,\r\n\t\t\t\t\ttop: (state.dragY - state.startY) / zoom\r\n\t\t\t\t}}\r\n\t\t\t\tpassages={passages}\r\n\t\t\t\tstartPassageId={startPassageId}\r\n\t\t\t/>\r\n\t\t\t<PassageCardGroup\r\n\t\t\t\tonDeselect={onDeselect}\r\n\t\t\t\tonDragStart={handleDragStart}\r\n\t\t\t\tonDrag={handleDrag}\r\n\t\t\t\tonDragStop={handleDragStop}\r\n\t\t\t\tonEdit={onEdit}\r\n\t\t\t\tonSelect={handleSelect}\r\n\t\t\t\tpassages={passages}\r\n\t\t\t\ttagColors={tagColors}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {\r\n\tMarqueeSelection,\r\n\tMarqueeSelectionProps\r\n} from '../../components/marquee-selection';\r\nimport {\r\n\tPassageMap,\r\n\tPassageMapProps\r\n} from '../../components/passage/passage-map';\r\nimport {Rect, rectsIntersect} from '../../util/geometry';\r\n\r\nexport interface MarqueeablePassageMapProps\r\n\textends PassageMapProps,\r\n\t\tOmit<\r\n\t\t\tMarqueeSelectionProps,\r\n\t\t\t'ignoreEventsOnSelector' | 'onTemporarySelectRect'\r\n\t\t> {}\r\n\r\n/**\r\n * Marries a MarqueeSelection with a PassageMap. This handles displaying a\r\n * temporary selection while the user drags around the marquee selection\r\n * *without* persisting the change, for performance.\r\n */\r\nexport const MarqueeablePassageMap: React.FC<\r\n\tMarqueeablePassageMapProps\r\n> = props => {\r\n\tconst {container, onSelectRect, ...other} = props;\r\n\tconst [temporaryRect, setTemporaryRect] = React.useState<Rect>();\r\n\tconst [temporaryAdditive, setTemporaryAdditive] = React.useState<boolean>();\r\n\tconst innerPassages = React.useMemo(() => {\r\n\t\tif (!temporaryRect) {\r\n\t\t\treturn props.passages;\r\n\t\t}\r\n\r\n\t\treturn props.passages.map(passage => {\r\n\t\t\tif (temporaryAdditive && passage.selected) {\r\n\t\t\t\treturn passage;\r\n\t\t\t}\r\n\r\n\t\t\tconst selected = rectsIntersect(temporaryRect, passage);\r\n\r\n\t\t\tif (selected === passage.selected) {\r\n\t\t\t\treturn passage;\r\n\t\t\t}\r\n\r\n\t\t\treturn {...passage, selected};\r\n\t\t});\r\n\t}, [props.passages, temporaryAdditive, temporaryRect]);\r\n\r\n\tconst handleTemporarySelectRect = React.useCallback(\r\n\t\t(rect: Rect, additive: boolean) => {\r\n\t\t\tsetTemporaryRect({\r\n\t\t\t\theight: rect.height / props.zoom,\r\n\t\t\t\tleft: rect.left / props.zoom,\r\n\t\t\t\ttop: rect.top / props.zoom,\r\n\t\t\t\twidth: rect.width / props.zoom\r\n\t\t\t});\r\n\t\t\tsetTemporaryAdditive(additive);\r\n\t\t},\r\n\t\t[props.zoom]\r\n\t);\r\n\r\n\tconst handleSelectRect = React.useCallback(\r\n\t\t(rect: Rect, additive: boolean) => {\r\n\t\t\tsetTemporaryRect(undefined);\r\n\t\t\tsetTemporaryAdditive(undefined);\r\n\t\t\tonSelectRect(rect, additive);\r\n\t\t},\r\n\t\t[onSelectRect]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<MarqueeSelection\r\n\t\t\t\tcontainer={container}\r\n\t\t\t\tignoreEventsOnSelector=\".passage-card, .zoom-buttons\"\r\n\t\t\t\tonSelectRect={handleSelectRect}\r\n\t\t\t\tonTemporarySelectRect={handleTemporarySelectRect}\r\n\t\t\t/>\r\n\t\t\t<PassageMap {...other} passages={innerPassages} />\r\n\t\t</>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useParams} from 'react-router-dom';\r\nimport {MainContent} from '../../components/container/main-content';\r\nimport {\r\n\tDialogsContextProvider,\r\n\tPassageEditDialog,\r\n\tuseDialogsContext\r\n} from '../../dialogs';\r\nimport {\r\n\tcreateUntitledPassage,\r\n\tdeselectPassage,\r\n\tmovePassages,\r\n\tPassage,\r\n\tselectPassage,\r\n\tselectPassagesInRect,\r\n\tstoryWithId\r\n} from '../../store/stories';\r\nimport {\r\n\tUndoableStoriesContextProvider,\r\n\tuseUndoableStoriesContext\r\n} from '../../store/undoable-stories';\r\nimport {Point, Rect} from '../../util/geometry';\r\nimport {StoryEditToolbar} from './toolbar';\r\nimport './story-edit-route.css';\r\n\r\nimport {DocumentTitle} from '../../components/document-title/document-title';\r\nimport {useZoomTransition} from './use-zoom-transition';\r\nimport {useZoomShortcuts} from './use-zoom-shortcuts';\r\nimport {MarqueeablePassageMap} from './marqueeable-passage-map';\r\n\r\n\r\nexport const InnerStoryEditRoute: React.FC = () => {\r\n\tconst [inited, setInited] = React.useState(false);\r\n\tconst {dispatch: dialogsDispatch} = useDialogsContext();\r\n\tconst mainContent = React.useRef<HTMLDivElement>(null);\r\n\tconst {storyId} = useParams<{storyId: string}>();\r\n\t//뒤로가기를 가능하게 해 주는 듯.\r\n\t//useUndoableStoriesContext 가 stories를 반환함. 확인해야 함. stories는 sotry의 복수형\r\n\tconst {dispatch: undoableStoriesDispatch, stories} =\r\n\t\tuseUndoableStoriesContext();\r\n\tconst story = storyWithId(stories, storyId);\r\n\r\n\r\n\r\n\tuseZoomShortcuts(story);\r\n\r\n\tconst selectedPassages = React.useMemo(\r\n\t\t() => story.passages.filter(passage => passage.selected),\r\n\t\t[story.passages]\r\n\t);\r\n\r\n\tconst getCenter = React.useCallback(() => {\r\n\t\tif (!mainContent.current) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t'Asked for the center of the main content, but it does not exist in the DOM yet'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tleft:\r\n\t\t\t\t(mainContent.current.scrollLeft + mainContent.current.clientWidth / 2) /\r\n\t\t\t\tstory.zoom,\r\n\t\t\ttop:\r\n\t\t\t\t(mainContent.current.scrollTop + mainContent.current.clientHeight / 2) /\r\n\t\t\t\tstory.zoom\r\n\t\t};\r\n\t}, [story.zoom]);\r\n\r\n\tconst handleDeselectPassage = React.useCallback(\r\n\t\t(passage: Passage) =>\r\n\t\t\tundoableStoriesDispatch(deselectPassage(story, passage)),\r\n\t\t[story, undoableStoriesDispatch]\r\n\t);\r\n\r\n\t//passage 드래그로 옮기는 함수.\r\n\tconst handleDragPassages = React.useCallback(\r\n\t\t(change: Point) => {\r\n\t\t\t// Ignore tiny drags--they're probably caused by the user moving their\r\n\t\t\t// mouse slightly during double-clicking.\r\n\r\n\t\t\t//일정 이상 변하지 않으면 움직임을 취소함.\r\n\t\t\t//마냥 올린다고 내가 원하는 변화가 나는 게 아님. 일정 이상 움직여야지만 움직여지는 기능이 아니라,\r\n\t\t\t//일정 이상 넘으면 그 단위만큼 움직여져야 함\r\n\t\t\t//게다가 훨씬 멀리로 옮기면 그만임. 이상한 곳에 놓을 수 있게 됨\r\n\t\t\tif (Math.abs(change.left) < 1 && Math.abs(change.top) < 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tundoableStoriesDispatch(\r\n\t\t\t\tmovePassages(\r\n\t\t\t\t\tstory,\r\n\t\t\t\t\tstory.passages.reduce<string[]>(\r\n\t\t\t\t\t\t(result, current) =>\r\n\t\t\t\t\t\t\tcurrent.selected ? [...result, current.id] : result,\r\n\t\t\t\t\t\t[]\r\n\t\t\t\t\t),\r\n\t\t\t\t\t//이만큼 옮기게 됨. zoom이 무슨 변수인가?\r\n\t\t\t\t\t//이걸 알기 위해선 story변수에 무엇이 저장되어있는 지를 알아야 한다.\r\n\t\t\t\t\tchange.left / story.zoom,\r\n\t\t\t\t\tchange.top / story.zoom\r\n\t\t\t\t),\r\n\t\t\t\tselectedPassages.length > 1\r\n\t\t\t\t\t? 'undoChange.movePassages'\r\n\t\t\t\t\t: 'undoChange.movePassages'\r\n\t\t\t);\r\n\t\t},\r\n\t\t[selectedPassages.length, story, undoableStoriesDispatch]\r\n\t);\r\n\r\n\tconst handleEditPassage = React.useCallback( //dialog 창(스토리 편집 창)을 띄우는 함수\r\n\t\t(passage: Passage) => {\r\n\t\t\tdialogsDispatch({\r\n\t\t\t\ttype: 'addDialog',\r\n\t\t\t\tcomponent: PassageEditDialog,\r\n\t\t\t\tprops: {passageId: passage.id, storyId: story.id}\r\n\t\t\t})},\r\n\t\t[dialogsDispatch, story.id]\r\n\t);\r\n\r\n\tconst handleSelectPassage = React.useCallback(\r\n\t\t(passage: Passage, exclusive: boolean) =>\r\n\t\t\tundoableStoriesDispatch(selectPassage(story, passage, exclusive)),\r\n\t\t[story, undoableStoriesDispatch]\r\n\t);\r\n\r\n\tconst handleSelectRect = React.useCallback(\r\n\t\t(rect: Rect, exclusive: boolean) => {\r\n\t\t\t// The rect we receive is in screen coordinates--we need to convert to\r\n\t\t\t// logical ones.\r\n\t\t\tconst logicalRect: Rect = {\r\n\t\t\t\theight: rect.height / story.zoom,\r\n\t\t\t\tleft: rect.left / story.zoom,\r\n\t\t\t\ttop: rect.top / story.zoom,\r\n\t\t\t\twidth: rect.width / story.zoom\r\n\t\t\t};\r\n\t\t\t// This should not be undoable.\r\n\t\t\tundoableStoriesDispatch(\r\n\t\t\t\tselectPassagesInRect(\r\n\t\t\t\t\tstory,\r\n\t\t\t\t\tlogicalRect,\r\n\t\t\t\t\texclusive ? selectedPassages.map(passage => passage.id) : []\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t},\r\n\t\t[selectedPassages, story, undoableStoriesDispatch]\r\n\t);\r\n\r\n\t// If we have just mounted and the story has no passages, create one for the\r\n\t// user (and skip undo history, since it was an automatic action).\r\n\r\n\tReact.useEffect(() => {\r\n\t\t\r\n\r\n\t\tif (!inited) {\r\n\t\t\tsetInited(true);\r\n\r\n\t\t\tif (story.passages.length === 0) {\r\n\t\t\t\tconst center = getCenter();\r\n\r\n\t\t\t\tundoableStoriesDispatch(\r\n\t\t\t\t\tcreateUntitledPassage(story, center.left, center.top)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [getCenter, inited, story, undoableStoriesDispatch]);\r\n\r\n\tconst visibleZoom = useZoomTransition(story.zoom, mainContent.current);\r\n\r\n\treturn (\r\n\t\t<div className=\"story-edit-route\">\r\n\t\t\t<DocumentTitle title={story.name} />\r\n\t\t\t<StoryEditToolbar getCenter={getCenter} story={story} />\r\n\t\t\t<MainContent grabbable padded={false} ref={mainContent}>\r\n\t\t\t\t<MarqueeablePassageMap\r\n\t\t\t\t\tcontainer={mainContent}\r\n\t\t\t\t\tformatName={story.storyFormat}\r\n\t\t\t\t\tformatVersion={story.storyFormatVersion}\r\n\t\t\t\t\tonDeselect={handleDeselectPassage}\r\n\t\t\t\t\tonDrag={handleDragPassages}\r\n\t\t\t\t\tonEdit={handleEditPassage}\r\n\t\t\t\t\tonSelect={handleSelectPassage}\r\n\t\t\t\t\tonSelectRect={handleSelectRect}\r\n\t\t\t\t\tpassages={story.passages}\r\n\t\t\t\t\tstartPassageId={story.startPassage}\r\n\t\t\t\t\ttagColors={story.tagColors}\r\n\t\t\t\t\tvisibleZoom={visibleZoom}\r\n\t\t\t\t\tzoom={story.zoom}\r\n\t\t\t\t/>\r\n\t\t\t</MainContent>\r\n\t\t</div>\r\n\t);\r\n};;\r\n\r\n// This is a separate component so that the inner one can use\r\n// `useEditorsContext()` and `useUndoableStoriesContext()` inside it.\r\n\r\nexport const StoryEditRoute: React.FC = () => (\r\n\t<UndoableStoriesContextProvider>\r\n\t\t<DialogsContextProvider>\r\n\t\t\t<InnerStoryEditRoute />\r\n\t\t</DialogsContextProvider>\r\n\t</UndoableStoriesContextProvider>\r\n);\r\n","import {useHotkeys} from 'react-hotkeys-hook';\r\nimport {Story, updateStory, useStoriesContext} from '../../store/stories';\r\n\r\nexport function useZoomShortcuts(story: Story) {\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\r\n\tuseHotkeys(\r\n\t\t'-',\r\n\t\t() => {\r\n\t\t\tswitch (story.zoom) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tdispatch(updateStory(stories, story, {zoom: 0.6}));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 0.6:\r\n\t\t\t\t\tdispatch(updateStory(stories, story, {zoom: 0.3}));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// Do nothing if zoom is 0.3\r\n\t\t\t}\r\n\t\t},\r\n\t\t{keydown: false, keyup: true},\r\n\t\t[dispatch, stories, story]\r\n\t);\r\n\tuseHotkeys(\r\n\t\t'=',\r\n\t\t() => {\r\n\t\t\tswitch (story.zoom) {\r\n\t\t\t\tcase 0.3:\r\n\t\t\t\t\tdispatch(updateStory(stories, story, {zoom: 0.6}));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 0.6:\r\n\t\t\t\t\tdispatch(updateStory(stories, story, {zoom: 1}));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// Do nothing if zoom is 1\r\n\t\t\t}\r\n\t\t},\r\n\t\t{keydown: false, keyup: true},\r\n\t\t[dispatch, stories, story]\r\n\t);\r\n}\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {isElectronRenderer} from '../../util/is-electron';\r\nimport './storage-quota.css';\r\n\r\nexport interface StorageQuotaProps {\r\n\twatch: any;\r\n}\r\n\r\nexport const StorageQuota: React.FC<StorageQuotaProps> = props => {\r\n\tconst {watch} = props;\r\n\tconst [lastWatch, setLastWatch] = React.useState<any>();\r\n\tconst [working, setWorking] = React.useState(false);\r\n\tconst [percentFree, setPercentFree] = React.useState<string>();\r\n\r\n\t// This is set to -1 so that we can hide the percentage while doing the\r\n\t// initial calculation. Later ones will show the same percentage but with a\r\n\t// loading icon beside it until finishes.\r\n\r\n\tconst {t} = useTranslation();\r\n\r\n\tconst hide = isElectronRenderer() || !navigator.storage?.estimate;\r\n\r\n\t// When the watch prop changes, start calculating space.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function run() {\r\n\t\t\tsetWorking(true);\r\n\r\n\t\t\tconst {quota, usage} = await navigator.storage.estimate();\r\n\r\n\t\t\tif (quota !== undefined && usage !== undefined) {\r\n\t\t\t\tsetPercentFree(((1 - usage / quota) * 100).toFixed(0));\r\n\t\t\t}\r\n\r\n\t\t\tsetLastWatch(watch);\r\n\t\t\tsetWorking(false);\r\n\t\t}\r\n\r\n\t\tif (!hide && !working && lastWatch !== watch) {\r\n\t\t\trun();\r\n\t\t}\r\n\t}, [hide, lastWatch, watch, working]);\r\n\r\n\tif (hide) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<span className=\"storage-quota\">\r\n\t\t\t{percentFree &&\r\n\t\t\t\tt('components.storageQuota.freeSpace', {\r\n\t\t\t\t\tpercent: percentFree\r\n\t\t\t\t})}\r\n\t\t</span>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconPackage} from '@tabler/icons';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {useStoriesContext} from '../../../../store/stories';\r\nimport {archiveFilename, publishArchive} from '../../../../util/publish';\r\nimport {saveHtml} from '../../../../util/save-html';\r\nimport {getAppInfo} from '../../../../util/app-info';\r\n\r\nexport const ArchiveButton: React.FC = () => {\r\n\tconst {stories} = useStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconPackage />}\r\n\t\t\tlabel={t('routes.storyList.toolbar.archive')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tsaveHtml(publishArchive(stories, getAppInfo()), archiveFilename())\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconFileImport} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {StoryImportDialog, useDialogsContext} from '../../../../dialogs';\r\n\r\nexport const ImportStoryButton: React.FC = () => {\r\n\t//useDialogsContext 함수가 HTML import하는 기능\r\n\tconst {dispatch} = useDialogsContext();\r\n\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconFileImport />}\r\n\t\t\tlabel={t('common.import')}\r\n\t\t\tonClick={() =>\r\n\t\t\t\tdispatch({type: 'addDialog', component: StoryImportDialog})\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconTags} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {StoryTagsDialog, useDialogsContext} from '../../../../dialogs';\r\n\r\nexport const StoryTagsButton: React.FC = () => {\r\n\tconst {dispatch} = useDialogsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\ticon={<IconTags />}\r\n\t\t\tlabel={t('routes.storyList.toolbar.storyTags')}\r\n\t\t\tonClick={() => {\r\n\t\t\t\tdispatch({type: 'addDialog', component: StoryTagsDialog});\r\n\t\t\t}}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {ButtonBar} from '../../../../components/container/button-bar';\r\nimport {ArchiveButton} from './archive-button';\r\nimport {ImportStoryButton} from './import-story-button';\r\nimport {StoryTagsButton} from './story-tags-button';\r\n\r\nexport const LibraryActions: React.FC = () => (\r\n\t<ButtonBar>\r\n\t\t<StoryTagsButton />\r\n\t\t<ImportStoryButton />\r\n\t\t<ArchiveButton />\r\n\t</ButtonBar>\r\n);\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {IconPlus} from '@tabler/icons';\r\nimport {usePrefsContext} from '../../../../store/prefs';\r\nimport {\r\n\tcreateStory,\r\n\tstoryDefaults,\r\n\tuseStoriesContext\r\n} from '../../../../store/stories';\r\nimport {PromptButton} from '../../../../components/control/prompt-button';\r\nimport {unusedName} from '../../../../util/unused-name';\r\n\r\nexport const CreateStoryButton: React.FC = () => {\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst [newName, setNewName] = React.useState(\r\n\t\tunusedName(\r\n\t\t\tstoryDefaults().name,\r\n\t\t\tstories.map(story => story.name)\r\n\t\t)\r\n\t);\r\n\tconst history = useHistory();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction validateName(value: string) {\r\n\t\tif (value.trim() === '') {\r\n\t\t\treturn {\r\n\t\t\t\tvalid: false,\r\n\t\t\t\tmessage: t('routes.storyList.toolbar.createStoryButton.emptyName')\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tstories.some(story => story.name.toLowerCase() === value.toLowerCase())\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\tvalid: false,\r\n\t\t\t\tmessage: t('routes.storyList.toolbar.createStoryButton.nameConflict')\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {valid: true};\r\n\t}\r\n\r\n\tfunction handleSubmit() {\r\n\t\tconst id = createStory(stories, prefs, {name: newName})(\r\n\t\t\tdispatch,\r\n\t\t\t() => stories\r\n\t\t);\r\n\r\n\t\thistory.push(`/stories/${id}`);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<PromptButton\r\n\t\t\ticon={<IconPlus />}\r\n\t\t\tlabel={t('common.new')}\r\n\t\t\tsubmitLabel={t('common.create')}\r\n\t\t\tsubmitVariant=\"create\"\r\n\t\t\tonChange={e => setNewName(e.target.value)}\r\n\t\t\tonSubmit={handleSubmit}\r\n\t\t\tprompt={t('routes.storyList.toolbar.createStoryButton.prompt')}\r\n\t\t\tvalidate={validateName}\r\n\t\t\tvalue={newName}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconCheck, IconX} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {ButtonBar} from '../container/button-bar';\r\nimport {CardContent} from '../container/card';\r\nimport {CardButton, CardButtonProps} from './card-button';\r\nimport {IconButton, IconButtonProps} from './icon-button';\r\nimport './confirm-button.css';\r\n\r\nexport interface ConfirmButtonProps\r\n\textends Omit<CardButtonProps, 'ariaLabel' | 'open' | 'onChangeOpen'> {\r\n\tcancelIcon?: React.ReactNode;\r\n\tcancelLabel?: string;\r\n\tconfirmIcon?: React.ReactNode;\r\n\tconfirmLabel?: string;\r\n\tconfirmVariant?: IconButtonProps['variant'];\r\n\tonConfirm: () => void;\r\n\tprompt: string;\r\n}\r\n\r\nexport const ConfirmButton: React.FC<ConfirmButtonProps> = props => {\r\n\tconst {\r\n\t\tcancelIcon,\r\n\t\tcancelLabel,\r\n\t\tconfirmIcon,\r\n\t\tconfirmLabel,\r\n\t\tconfirmVariant,\r\n\t\tonConfirm,\r\n\t\tprompt,\r\n\t\t...other\r\n\t} = props;\r\n\tconst [open, setOpen] = React.useState(false);\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleConfirm() {\r\n\t\tsetOpen(false);\r\n\t\tonConfirm();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<span className=\"confirm-button\">\r\n\t\t\t<CardButton\r\n\t\t\t\tariaLabel={prompt}\r\n\t\t\t\tfocusSelector=\"button:nth-child(2)\"\r\n\t\t\t\tonChangeOpen={setOpen}\r\n\t\t\t\topen={open}\r\n\t\t\t\t{...other}\r\n\t\t\t>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<CardContent>{prompt}</CardContent>\r\n\t\t\t\t\t<ButtonBar>\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\ticon={confirmIcon ?? <IconCheck />}\r\n\t\t\t\t\t\t\tlabel={confirmLabel ?? t('common.ok')}\r\n\t\t\t\t\t\t\tonClick={handleConfirm}\r\n\t\t\t\t\t\t\tvariant={confirmVariant ?? 'primary'}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\ticon={cancelIcon ?? <IconX />}\r\n\t\t\t\t\t\t\tlabel={cancelLabel ?? t('common.cancel')}\r\n\t\t\t\t\t\t\tonClick={() => setOpen(false)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</ButtonBar>\r\n\t\t\t\t</div>\r\n\t\t\t</CardButton>\r\n\t\t</span>\r\n\t);\r\n};\r\n","import {IconTrash} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {ConfirmButton} from '../../../../components/control/confirm-button';\r\nimport {deleteStory, Story, useStoriesContext} from '../../../../store/stories';\r\nimport {isElectronRenderer} from '../../../../util/is-electron';\r\n\r\nexport interface DeleteStoryButtonProps {\r\n\tstory?: Story;\r\n}\r\n\r\nexport const DeleteStoryButton: React.FC<DeleteStoryButtonProps> = ({\r\n\tstory\r\n}) => {\r\n\t// We need to store a local copy of the story name so that after it's deleted,\r\n\t// the prompt doesn't change as it transitions out.\r\n\tconst [storyName, setStoryName] = React.useState(story?.name);\r\n\tconst {dispatch} = useStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (story?.name) {\r\n\t\t\tsetStoryName(story.name);\r\n\t\t}\r\n\t}, [story?.name]);\r\n\r\n\treturn (\r\n\t\t<ConfirmButton\r\n\t\t\tconfirmIcon={<IconTrash />}\r\n\t\t\tconfirmLabel={t('common.delete')}\r\n\t\t\tconfirmVariant=\"danger\"\r\n\t\t\tdisabled={!story}\r\n\t\t\ticon={<IconTrash />}\r\n\t\t\tlabel={t('common.delete')}\r\n\t\t\tonConfirm={story ? () => dispatch(deleteStory(story)) : () => {}}\r\n\t\t\tprompt={t(\r\n\t\t\t\t`routes.storyList.toolbar.deleteStoryButton.warning.${\r\n\t\t\t\t\tisElectronRenderer() ? 'electron' : 'web'\r\n\t\t\t\t}`,\r\n\t\t\t\t{storyName}\r\n\t\t\t)}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconCopy} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {\r\n\tduplicateStory,\r\n\tStory,\r\n\tuseStoriesContext\r\n} from '../../../../store/stories';\r\n\r\nexport interface DuplicateStoryButtonProps {\r\n\tstory?: Story;\r\n}\r\n\r\nexport const DuplicateStoryButton: React.FC<DuplicateStoryButtonProps> = ({\r\n\tstory\r\n}) => {\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\tfunction handleClick() {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('No story set');\r\n\t\t}\r\n\r\n\t\tdispatch(duplicateStory(story, stories));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={!story}\r\n\t\t\ticon={<IconCopy />}\r\n\t\t\tlabel={t('common.duplicate')}\r\n\t\t\tonClick={handleClick}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconEdit} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {IconButton} from '../../../../components/control/icon-button';\r\nimport {Story} from '../../../../store/stories';\r\n\r\nexport interface EditStoryButtonProps {\r\n\tstory?: Story;\r\n}\r\n\r\nexport const EditStoryButton: React.FC<EditStoryButtonProps> = ({story}) => {\r\n\tconst history = useHistory();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tdisabled={!story}\r\n\t\t\ticon={<IconEdit />}\r\n\t\t\tlabel={t('common.edit')}\r\n\t\t\tonClick={() => history.push(`/stories/${story?.id}`)}\r\n\t\t/>\r\n\t);\r\n};\r\n","import {IconTag} from '@tabler/icons';\r\nimport * as React from 'react';\r\nimport {AddTagButton} from '../../../../components/tag';\r\nimport {setPref, usePrefsContext} from '../../../../store/prefs';\r\nimport {\r\n\tStory,\r\n\tstoryTags,\r\n\tupdateStory,\r\n\tuseStoriesContext\r\n} from '../../../../store/stories';\r\n\r\nexport interface TagStoryButtonProps {\r\n\tstory?: Story;\r\n}\r\n\r\nexport const TagStoryButton: React.FC<TagStoryButtonProps> = props => {\r\n\tconst {story} = props;\r\n\tconst {dispatch: prefsDispatch, prefs} = usePrefsContext();\r\n\tconst {dispatch: storiesDispatch, stories} = useStoriesContext();\r\n\r\n\tfunction handleAddTag(tagName: string, tagColor?: string) {\r\n\t\tif (!story) {\r\n\t\t\tthrow new Error('Story is unset');\r\n\t\t}\r\n\r\n\t\tstoriesDispatch(\r\n\t\t\tupdateStory(stories, story, {\r\n\t\t\t\ttags: story.tags ? [...story.tags, tagName] : [tagName]\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tif (tagColor) {\r\n\t\t\tprefsDispatch(\r\n\t\t\t\tsetPref('storyTagColors', {\r\n\t\t\t\t\t...prefs.storyTagColors,\r\n\t\t\t\t\t[tagName]: tagColor\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<AddTagButton\r\n\t\t\tassignedTags={story?.tags ?? []}\r\n\t\t\tdisabled={!story}\r\n\t\t\texistingTags={storyTags(stories)}\r\n\t\t\ticon={<IconTag />}\r\n\t\t\tonAdd={handleAddTag}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {ButtonBar} from '../../../../components/container/button-bar';\r\nimport {RenameStoryButton} from '../../../../components/story/rename-story-button';\r\nimport {Story, updateStory, useStoriesContext} from '../../../../store/stories';\r\nimport {CreateStoryButton} from './create-story-button';\r\nimport {DeleteStoryButton} from './delete-story-button';\r\nimport {DuplicateStoryButton} from './duplicate-story-button';\r\nimport {EditStoryButton} from './edit-story-button';\r\nimport {TagStoryButton} from './tag-story-button';\r\n\r\nexport interface StoryActionsProps {\r\n\tselectedStory?: Story;\r\n}\r\n\r\nexport const StoryActions: React.FC<StoryActionsProps> = props => {\r\n\tconst {selectedStory} = props;\r\n\tconst {dispatch, stories} = useStoriesContext();\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<CreateStoryButton />\r\n\t\t\t<EditStoryButton story={selectedStory} />\r\n\t\t\t<TagStoryButton story={selectedStory} />\r\n\t\t\t<RenameStoryButton\r\n\t\t\t\texistingStories={stories}\r\n\t\t\t\tonRename={name =>\r\n\t\t\t\t\tdispatch(updateStory(stories, selectedStory!, {name}))\r\n\t\t\t\t}\r\n\t\t\t\tstory={selectedStory}\r\n\t\t\t/>\r\n\t\t\t<DuplicateStoryButton story={selectedStory} />\r\n\t\t\t<DeleteStoryButton story={selectedStory} />\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconArrowsSort} from '@tabler/icons';\r\nimport {MenuButton} from '../../../../components/control/menu-button';\r\nimport {setPref, usePrefsContext} from '../../../../store/prefs';\r\n\r\nexport const SortByButton: React.FC = () => {\r\n\tconst {t} = useTranslation();\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\r\n\treturn (\r\n\t\t<MenuButton\r\n\t\t\ticon={<IconArrowsSort />}\r\n\t\t\titems={[\r\n\t\t\t\t{\r\n\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\tchecked: prefs.storyListSort === 'date',\r\n\t\t\t\t\tlabel: t('routes.storyList.toolbar.sortByDate'),\r\n\t\t\t\t\tonClick: () => dispatch(setPref('storyListSort', 'date'))\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\tchecked: prefs.storyListSort === 'name',\r\n\t\t\t\t\tlabel: t('routes.storyList.toolbar.sortByName'),\r\n\t\t\t\t\tonClick: () => dispatch(setPref('storyListSort', 'name'))\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tlabel={t('routes.storyList.toolbar.sort')}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {IconTag} from '@tabler/icons';\r\nimport {MenuButton} from '../../../../components/control/menu-button';\r\nimport {usePrefsContext} from '../../../../store/prefs';\r\n\r\nexport interface TagFilterButtonProps {\r\n\ttags: string[];\r\n}\r\n\r\nexport const TagFilterButton: React.FC<TagFilterButtonProps> = props => {\r\n\tconst {dispatch, prefs} = usePrefsContext();\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<MenuButton\r\n\t\t\tdisabled={props.tags.length === 0}\r\n\t\t\ticon={<IconTag />}\r\n\t\t\titems={[\r\n\t\t\t\t{\r\n\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\tchecked: prefs.storyListTagFilter.length === 0,\r\n\t\t\t\t\tlabel: t('routes.storyList.toolbar.showAllStories'),\r\n\t\t\t\t\tonClick: () =>\r\n\t\t\t\t\t\tdispatch({type: 'update', name: 'storyListTagFilter', value: []})\r\n\t\t\t\t},\r\n\t\t\t\t{separator: true},\r\n\t\t\t\t...props.tags.map(tag => ({\r\n\t\t\t\t\tcheckable: true,\r\n\t\t\t\t\tchecked: prefs.storyListTagFilter.includes(tag),\r\n\t\t\t\t\tlabel: tag,\r\n\t\t\t\t\tonClick: () =>\r\n\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\ttype: 'update',\r\n\t\t\t\t\t\t\tname: 'storyListTagFilter',\r\n\t\t\t\t\t\t\tvalue: prefs.storyListTagFilter.includes(tag)\r\n\t\t\t\t\t\t\t\t? prefs.storyListTagFilter.filter(t => t !== tag)\r\n\t\t\t\t\t\t\t\t: [...prefs.storyListTagFilter, tag]\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}))\r\n\t\t\t]}\r\n\t\t\tlabel={t('routes.storyList.toolbar.showTags')}\r\n\t\t/>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {ButtonBar} from '../../../../components/container/button-bar';\r\nimport {storyTags, useStoriesContext} from '../../../../store/stories';\r\nimport {SortByButton} from './sort-by-button';\r\nimport {TagFilterButton} from './tag-filter-button';\r\n\r\nexport const ViewActions: React.FC = () => {\r\n\tconst {stories} = useStoriesContext();\r\n\r\n\treturn (\r\n\t\t<ButtonBar>\r\n\t\t\t<SortByButton />\r\n\t\t\t<TagFilterButton tags={storyTags(stories)} />\r\n\t\t</ButtonBar>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {RouteToolbar} from '../../../components/route-toolbar';\r\nimport {StorageQuota} from '../../../components/storage-quota/storage-quota';\r\nimport {BuildActions, AppActions} from '../../../route-actions';\r\nimport {Story, useStoriesContext} from '../../../store/stories';\r\nimport {LibraryActions} from './library/library-actions';\r\nimport {StoryActions} from './story/story-actions';\r\nimport {ViewActions} from './view/view-actions';\r\n\r\nexport interface StoryListToolbarProps {\r\n\tselectedStories: Story[];\r\n}\r\n\r\nexport const StoryListToolbar: React.FC<StoryListToolbarProps> = props => {\r\n\tconst {selectedStories} = props;\r\n\tconst {stories} = useStoriesContext();\r\n\tconst {t} = useTranslation();\r\n\tconst selectedStory =\r\n\t\tselectedStories.length === 1 ? selectedStories[0] : undefined;\r\n\r\n\treturn (\r\n\t\t<RouteToolbar\r\n\t\t\tpinnedControls={<StorageQuota watch={stories} />}\r\n\t\t\ttabs={{\r\n\t\t\t\t[\"에피소드\"]: <StoryActions selectedStory={selectedStory} />,\r\n\t\t\t\t[\"저장소\"]: <LibraryActions />,\r\n\t\t\t\t[\"빌드\"]: <BuildActions story={selectedStory} />,\r\n\t\t\t\t[\"관리\"]: <ViewActions />,\r\n\t\t\t\t[\"Twine 설정\"]: <AppActions />\r\n\t\t\t\t// [t('common.story')]: <StoryActions selectedStory={selectedStory} />,\r\n\t\t\t\t// [t('routes.storyList.library')]: <LibraryActions />,\r\n\t\t\t\t// [t('common.build')]: <BuildActions story={selectedStory} />,\r\n\t\t\t\t// [t('common.view')]: <ViewActions />,\r\n\t\t\t\t// [t('common.appName')]: <AppActions />\r\n\t\t\t}}\r\n\t\t/>\r\n\t);\r\n};\r\n","/**\r\n * Generates a hue (as in the HSL colorspace) for a string.\r\n */\r\nexport function hueString(value: string): number {\r\n\tlet result = 0;\r\n\r\n\tfor (let i = 0; i < value.length; i++) {\r\n\t\tresult += value.charCodeAt(i);\r\n\t}\r\n\r\n\treturn result % 360;\r\n}\r\n","import * as React from 'react';\r\nimport {Story} from '../../store/stories';\r\nimport {hueString} from '../../util/hue-string';\r\nimport './story-preview.css';\r\n\r\nexport interface StoryPreviewProps {\r\n\tstory: Story;\r\n}\r\n\r\nexport const StoryPreview: React.FC<StoryPreviewProps> = React.memo(props => {\r\n\tconst {story} = props;\r\n\tconst hues = [hueString(story.name)];\r\n\r\n\thues.push((hues[0] + 15) % 360);\r\n\thues.push((hues[0] - 15) % 360);\r\n\thues.push((hues[0] + 30) % 360);\r\n\thues.push((hues[0] - 30) % 360);\r\n\thues.push((hues[0] + 60) % 360);\r\n\r\n\tlet minX = Number.POSITIVE_INFINITY;\r\n\tlet minY = Number.POSITIVE_INFINITY;\r\n\tlet maxX = Number.NEGATIVE_INFINITY;\r\n\tlet maxY = Number.NEGATIVE_INFINITY;\r\n\r\n\tconst circles = story.passages.map(passage => ({\r\n\t\tkey: passage.name,\r\n\t\tx: passage.left + passage.width / 2,\r\n\t\ty: passage.top + passage.height / 2,\r\n\t\tradius: Math.max(passage.width, passage.height)\r\n\t}));\r\n\r\n\tconst svg = circles\r\n\t\t.reduce<[React.ReactNode[], React.ReactNode[]]>(\r\n\t\t\t(result, circle, index) => {\r\n\t\t\t\t// We reduce the circles to an array with two elements so that the\r\n\t\t\t\t// larger, faded circles appear below the smaller, more solid ones.\r\n\r\n\t\t\t\tconst bgRadius = circle.radius + 200;\r\n\r\n\t\t\t\t// Kind of gross to do side effects in a reduce(), but it saves an O(n).\r\n\r\n\t\t\t\tminX = Math.min(minX, circle.x - bgRadius);\r\n\t\t\t\tminY = Math.min(minY, circle.y - bgRadius);\r\n\t\t\t\tmaxX = Math.max(maxX, circle.x + bgRadius);\r\n\t\t\t\tmaxY = Math.max(maxY, circle.y + bgRadius);\r\n\r\n\t\t\t\tresult[0].push(\r\n\t\t\t\t\t<circle\r\n\t\t\t\t\t\tcx={circle.x}\r\n\t\t\t\t\t\tcy={circle.y}\r\n\t\t\t\t\t\tkey={`${circle.key}-bg`}\r\n\t\t\t\t\t\tr={bgRadius}\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tfill: `hsl(${hues[index % hues.length]}, 80%, 80%)`\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\r\n\t\t\t\tresult[1].push(\r\n\t\t\t\t\t<circle\r\n\t\t\t\t\t\tcx={circle.x}\r\n\t\t\t\t\t\tcy={circle.y}\r\n\t\t\t\t\t\tkey={`${circle.key}-fg`}\r\n\t\t\t\t\t\tr={circle.radius}\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tfill: `hsl(${hues[index % hues.length]}, 80%, 60%)`\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\t\t\t[[], []]\r\n\t\t)\r\n\t\t.map((nodes, index) => (\r\n\t\t\t<g className={`story-preview-${index === 0 ? 'bg' : 'fg'}`} key={index}>\r\n\t\t\t\t{nodes}\r\n\t\t\t</g>\r\n\t\t));\r\n\r\n\tconst viewBox = `${minX} ${minY} ${maxX - minX} ${maxY - minY}`;\r\n\r\n\treturn (\r\n\t\t<svg\r\n\t\t\tclassName=\"story-preview\"\r\n\t\t\tviewBox={viewBox}\r\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t>\r\n\t\t\t{svg}\r\n\t\t</svg>\r\n\t);\r\n});\r\n\r\nStoryPreview.displayName = 'StoryPreview';","import * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {Story} from '../../store/stories';\r\nimport {Color} from '../../util/color';\r\nimport {CardContent, CardProps} from '../container/card';\r\nimport {SelectableCard} from '../container/card/selectable-card';\r\nimport {TagButton} from '../tag';\r\nimport './story-card.css';\r\nimport {StoryPreview} from './story-preview';\r\n\r\nconst dateFormatter = new Intl.DateTimeFormat([]);\r\n\r\nexport interface StoryCardProps extends CardProps {\r\n\tonChangeTagColor: (name: string, color: Color) => void;\r\n\tonRemoveTag: (name: string) => void;\r\n\tonEdit: () => void;\r\n\tonSelect: () => void;\r\n\tstory: Story;\r\n\tstoryTagColors: Record<string, Color>;\r\n}\r\n\r\nexport const StoryCard: React.FC<StoryCardProps> = props => {\r\n\tconst {\r\n\t\tonChangeTagColor,\r\n\t\tonEdit,\r\n\t\tonRemoveTag,\r\n\t\tonSelect,\r\n\t\tstory,\r\n\t\tstoryTagColors,\r\n\t\t...otherProps\r\n\t} = props;\r\n\tconst {t} = useTranslation();\r\n\r\n\treturn (\r\n\t\t<div className=\"story-card\">\r\n\t\t\t<SelectableCard\r\n\t\t\t\t{...otherProps}\r\n\t\t\t\tlabel={story.name}\r\n\t\t\t\tonDoubleClick={onEdit}\r\n\t\t\t\tonSelect={onSelect}\r\n\t\t\t\tselected={story.selected}\r\n\t\t\t>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<div className=\"story-card-summary\">\r\n\t\t\t\t\t\t<div className=\"story-card-summary-preview\">\r\n\t\t\t\t\t\t\t<StoryPreview story={story} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"story-card-summary-text\">\r\n\t\t\t\t\t\t\t<h2>{story.name}</h2>\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t{t('components.storyCard.lastUpdated', {\r\n\t\t\t\t\t\t\t\t\tdate: dateFormatter.format(story.lastUpdate)\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t{t('components.storyCard.passageCount', {\r\n\t\t\t\t\t\t\t\t\tcount: story.passages.length\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{story.tags && (\r\n\t\t\t\t\t\t<div className=\"tags\">\r\n\t\t\t\t\t\t\t{story.tags.map(tag => (\r\n\t\t\t\t\t\t\t\t<TagButton\r\n\t\t\t\t\t\t\t\t\tcolor={storyTagColors[tag]}\r\n\t\t\t\t\t\t\t\t\tkey={tag}\r\n\t\t\t\t\t\t\t\t\tname={tag}\r\n\t\t\t\t\t\t\t\t\tonChangeColor={color => onChangeTagColor(tag, color)}\r\n\t\t\t\t\t\t\t\t\tonRemove={() => onRemoveTag(tag)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</CardContent>\r\n\t\t\t</SelectableCard>\r\n\t\t</div>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {CSSTransition, TransitionGroup} from 'react-transition-group';\r\nimport {CardGroup} from '../../components/container/card-group';\r\nimport {StoryCard} from '../../components/story/story-card';\r\nimport {setPref, usePrefsContext} from '../../store/prefs';\r\nimport {Story, updateStory} from '../../store/stories';\r\nimport {useUndoableStoriesContext} from '../../store/undoable-stories';\r\nimport {Color} from '../../util/color';\r\n\r\n/**\r\n * How wide a story card should render onscreen as.\r\n */\r\nconst cardWidth = '360px';\r\n\r\nexport interface StoryCardsProps {\r\n\tonSelectStory: (story: Story) => void;\r\n\tstories: Story[];\r\n}\r\n\r\nexport const StoryCards: React.FC<StoryCardsProps> = props => {\r\n\tconst {onSelectStory, stories} = props;\r\n\tconst {dispatch: prefsDispatch, prefs} = usePrefsContext();\r\n\tconst {dispatch: storiesDispatch} = useUndoableStoriesContext();\r\n\tconst history = useHistory();\r\n\r\n\tfunction handleChangeTagColor(tagName: string, color: Color) {\r\n\t\tprefsDispatch(\r\n\t\t\tsetPref('storyTagColors', {\r\n\t\t\t\t...prefs.storyTagColors,\r\n\t\t\t\t[tagName]: color\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction handleRemoveTag(story: Story, tagName: string) {\r\n\t\tstoriesDispatch(\r\n\t\t\tupdateStory(stories, story, {\r\n\t\t\t\ttags: story.tags.filter(tag => tag !== tagName)\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<CardGroup columnWidth={cardWidth}>\r\n\t\t\t\t<TransitionGroup component={null}>\r\n\t\t\t\t\t{stories.map(story => (\r\n\t\t\t\t\t\t<CSSTransition classNames=\"pop\" key={story.id} timeout={200}>\r\n\t\t\t\t\t\t\t<StoryCard\r\n\t\t\t\t\t\t\t\tonChangeTagColor={handleChangeTagColor}\r\n\t\t\t\t\t\t\t\tonEdit={() => history.push(`/stories/${story.id}`)}\r\n\t\t\t\t\t\t\t\tonRemoveTag={name => handleRemoveTag(story, name)}\r\n\t\t\t\t\t\t\t\tonSelect={() => onSelectStory(story)}\r\n\t\t\t\t\t\t\t\tstory={story}\r\n\t\t\t\t\t\t\t\tstoryTagColors={prefs.storyTagColors}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CSSTransition>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</TransitionGroup>\r\n\t\t\t</CardGroup>\r\n\t\t</>\r\n\t);\r\n};\r\n","import sortBy from 'lodash/sortBy';\r\nimport * as React from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\nimport {MainContent} from '../../components/container/main-content';\r\nimport {SafariWarningCard} from '../../components/error';\r\nimport {\r\n\tAppDonationDialog,\r\n\tDialogsContextProvider,\r\n\tuseDialogsContext\r\n} from '../../dialogs';\r\nimport {usePrefsContext} from '../../store/prefs';\r\nimport {useDonationCheck} from '../../store/prefs/use-donation-check';\r\nimport {\r\n\tdeselectAllStories,\r\n\tdeselectStory,\r\n\tselectStory,\r\n\tuseStoriesContext,\r\n\timportStories as importStoriesByStories, Story\r\n} from '../../store/stories';\r\nimport {UndoableStoriesContextProvider} from '../../store/undoable-stories';\r\nimport {StoryListToolbar} from './toolbar/story-list-toolbar';\r\nimport {StoryCards} from './story-cards';\r\nimport {ClickAwayListener} from '../../components/click-away-listener';\r\nimport {importStories as importStoriesByImport} from '../../util/import'; \r\nimport {testHtml} from './testHTml'\r\n\r\nexport const InnerStoryListRoute: React.FC = () => {\r\n\tconst {dispatch: dialogsDispatch} = useDialogsContext();\r\n\tconst {dispatch: storiesDispatch, stories} = useStoriesContext();\r\n\tconst {prefs} = usePrefsContext();\r\n\tconst {shouldShowDonationPrompt} = useDonationCheck();\r\n\tconst {t} = useTranslation();\r\n\tlet data :string = testHtml;\r\n\r\n\t//db와 스토리를 연동하기 위해 제작한 함수 - 이지원\r\n\t// function handleImport(getStory: Story[]) {\r\n\t// \tstoriesDispatch(importStoriesByStories(getStory, stories)); //dispatch : useState 대신 사용하는 redux같은 것\r\n\t// }\r\n\r\n\tconst selectedStories = React.useMemo(\r\n\t\t() => stories.filter(story => story.selected),\r\n\t\t[stories]\r\n\t);\r\n\t\r\n\tconst visibleStories = React.useMemo(() => {\r\n\t\tconst filteredStories =\r\n\t\t\tprefs.storyListTagFilter.length > 0\r\n\t\t\t\t? stories.filter(story =>\r\n\t\t\t\t\t\tstory.tags.some(tag => prefs.storyListTagFilter.includes(tag))\r\n\t\t\t\t  )\r\n\t\t\t\t: stories;\r\n\r\n\t\tswitch (prefs.storyListSort) {\r\n\t\t\tcase 'date':\r\n\t\t\t\treturn sortBy(filteredStories, 'lastUpdated');\r\n\t\t\tcase 'name':\r\n\t\t\t\treturn sortBy(filteredStories, 'name');\r\n\t\t}\r\n\t}, [prefs.storyListSort, prefs.storyListTagFilter, stories]);\r\n\r\n\t// Any stories no longer visible should be deselected.\r\n\r\n\tReact.useEffect(() => {\r\n\t\tfor (const story of selectedStories) {\r\n\t\t\tif (story.selected && !visibleStories.includes(story)) {\r\n\t\t\t\tstoriesDispatch(deselectStory(story));\r\n\t\t\t}\r\n\t\t}\r\n\t}, [selectedStories, stories, storiesDispatch, visibleStories]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (shouldShowDonationPrompt()) {\r\n\t\t\tdialogsDispatch({type: 'addDialog', component: AppDonationDialog});\r\n\t\t}\r\n\t}, [dialogsDispatch, shouldShowDonationPrompt]);\r\n\r\n\t//제작 페이지 실행시 스토리를 불러오기 위해 쓴 코드 - 이지원\r\n\t// React.useEffect(()=>{\r\n\t// \thandleImport(importStoriesByImport(data));\r\n\t// }, [])\r\n\treturn (\r\n\t\t<div className=\"story-list-route\">\r\n\t\t\t<StoryListToolbar selectedStories={selectedStories} />\r\n\t\t\t<ClickAwayListener\r\n\t\t\t\tignoreSelector=\".story-card\"\r\n\t\t\t\tonClickAway={() => storiesDispatch(deselectAllStories())}\r\n\t\t\t>\r\n\t\t\t\t<MainContent\r\n\t\t\t\t\ttitle={t(\r\n\t\t\t\t\t\tprefs.storyListTagFilter.length > 0\r\n\t\t\t\t\t\t\t? 'routes.storyList.taggedTitleCount'\r\n\t\t\t\t\t\t\t: 'routes.storyList.titleCount',\r\n\t\t\t\t\t\t{count: visibleStories.length}\r\n\t\t\t\t\t)}\r\n\t\t\t\t>\r\n\t\t\t\t\t<SafariWarningCard />\r\n\t\t\t\t\t<div className=\"stories\">\r\n\t\t\t\t\t\t{stories.length === 0 ? (\r\n\t\t\t\t\t\t\t<p>{t('routes.storyList.noStories')}</p>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<StoryCards\r\n\t\t\t\t\t\t\t\tonSelectStory={story =>\r\n\t\t\t\t\t\t\t\t\tstoriesDispatch(selectStory(story, true))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tstories={visibleStories}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</MainContent>\r\n\t\t\t</ClickAwayListener>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport const StoryListRoute: React.FC = () => (\r\n\t<UndoableStoriesContextProvider>\r\n\t\t<DialogsContextProvider>\r\n\t\t\t<InnerStoryListRoute />\r\n\t\t</DialogsContextProvider>\r\n\t</UndoableStoriesContextProvider>\r\n);\r\n","import * as React from 'react';\r\nimport {usePrefsContext} from '.';\r\n\r\n/**\r\n * How long since the user began using Twine to show a donation prompt. It's set\r\n * to 14 days.\r\n */\r\nexport const donationDelay = 1000 * 60 * 60 * 24 * 14;\r\n\r\nexport function useDonationCheck() {\r\n\tconst {prefs} = usePrefsContext();\r\n\r\n\tconst shouldShowDonationPrompt = React.useCallback(() => {\r\n\t\tif (prefs.donateShown) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn Date.now() > prefs.firstRunTime + donationDelay;\r\n\t}, [prefs.donateShown, prefs.firstRunTime]);\r\n\r\n\treturn {shouldShowDonationPrompt};\r\n}\r\n","export function replaceDom(html: string) {\r\n\t// Blast JS globals.\r\n\r\n\tdelete (window as any).CodeMirror;\r\n\tdelete (window as any).SVG;\r\n\tdelete (window as any).Store;\r\n\tdelete (window as any).StoryFormat;\r\n\tdelete (window as any).amdDefine;\r\n\tdelete (window as any).app;\r\n\tdelete (window as any).jQuery;\r\n\r\n\t// Rewrite the document.\r\n\r\n\tdocument.open();\r\n\tdocument.write(html);\r\n\tdocument.close();\r\n}\r\n","import * as React from 'react';\r\nimport {useParams} from 'react-router-dom';\r\nimport {replaceDom} from '../../util/replace-dom';\r\nimport {usePublishing} from '../../store/use-publishing';\r\nimport {ErrorMessage} from '../../components/error';\r\n\r\nexport const StoryPlayRoute: React.FC = () => {\r\n\tconst [publishError, setPublishError] = React.useState<Error>();\r\n\tconst [inited, setInited] = React.useState(false);\r\n\tconst {storyId} = useParams<{storyId: string}>();\r\n\tconst {publishStory} = usePublishing();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function load() {\r\n\t\t\ttry {\r\n\t\t\t\treplaceDom(await publishStory(storyId));\r\n\t\t\t} catch (error) {\r\n\t\t\t\tsetPublishError(error as Error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!inited) {\r\n\t\t\tsetInited(true);\r\n\t\t\tload();\r\n\t\t}\r\n\t}, [inited, publishStory, storyId]);\r\n\r\n\tif (publishError) {\r\n\t\treturn <ErrorMessage>{publishError.message}</ErrorMessage>;\r\n\t}\r\n\r\n\treturn null;\r\n};\r\n","import * as React from 'react';\r\nimport {useParams} from 'react-router-dom';\r\nimport {replaceDom} from '../../util/replace-dom';\r\nimport {usePublishing} from '../../store/use-publishing';\r\nimport {ErrorMessage} from '../../components/error';\r\n\r\nexport const StoryProofRoute: React.FC = () => {\r\n\tconst [publishError, setPublishError] = React.useState<Error>();\r\n\tconst [inited, setInited] = React.useState(false);\r\n\tconst {storyId} = useParams<{storyId: string}>();\r\n\tconst {proofStory} = usePublishing();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function load() {\r\n\t\t\ttry {\r\n\t\t\t\treplaceDom(await proofStory(storyId));\r\n\t\t\t} catch (error) {\r\n\t\t\t\tsetPublishError(error as Error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!inited) {\r\n\t\t\tsetInited(true);\r\n\t\t\tload();\r\n\t\t}\r\n\t}, [inited, proofStory, storyId]);\r\n\r\n\tif (publishError) {\r\n\t\treturn <ErrorMessage>{publishError.message}</ErrorMessage>;\r\n\t}\r\n\r\n\treturn null;\r\n};\r\n","import * as React from 'react';\r\nimport {useParams} from 'react-router-dom';\r\nimport {replaceDom} from '../../util/replace-dom';\r\nimport {usePublishing} from '../../store/use-publishing';\r\nimport {ErrorMessage} from '../../components/error';\r\n\r\nexport const StoryTestRoute: React.FC = () => {\r\n\tconst [publishError, setPublishError] = React.useState<Error>();\r\n\tconst [inited, setInited] = React.useState(false);\r\n\tconst {passageId, storyId} = useParams<{\r\n\t\tpassageId: string;\r\n\t\tstoryId: string;\r\n\t}>();\r\n\tconst {publishStory} = usePublishing();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function load() {\r\n\t\t\ttry {\r\n\t\t\t\treplaceDom(\r\n\t\t\t\t\tawait publishStory(storyId, {\r\n\t\t\t\t\t\tformatOptions: 'debug',\r\n\t\t\t\t\t\tstartId: passageId\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tsetPublishError(error as Error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!inited) {\r\n\t\t\tsetInited(true);\r\n\t\t\tload();\r\n\t\t}\r\n\t}, [inited, passageId, publishStory, storyId]);\r\n\r\n\tif (publishError) {\r\n\t\treturn <ErrorMessage>{publishError.message}</ErrorMessage>;\r\n\t}\r\n\r\n\treturn null;\r\n};\r\n","abstract class SessionStorage<T> {\r\n    abstract setItem(key:string, value:T) :void;\r\n    abstract getItem(key:string) : string | null;\r\n    abstract clearItem(key:string): void;\r\n}\r\n\r\nclass SessionStorageAPI<T> extends SessionStorage<T> {\r\n    setItem(key:string, value:T) {\r\n        //value에 무슨 값이 들어오던 string으로 변환 후 저장\r\n        window.sessionStorage.setItem(key, JSON.stringify(value));\r\n    }\r\n    getItem(key: string): string {\r\n        let value : string | null;\r\n\r\n        value = window.sessionStorage.getItem(key);\r\n        \r\n        if(value === null){\r\n            return null;\r\n        }\r\n        else{\r\n            return value;\r\n        }\r\n    }\r\n    clearItem(key: string): void {\r\n        window.sessionStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nexport default SessionStorageAPI","import * as React from 'react';\r\nimport {Component} from 'react';\r\n\r\ntype ifLogin_props = {\r\n    nickname : string\r\n}\r\n\r\nclass ifLogin extends Component<ifLogin_props>{\r\n    constructor(props){\r\n        super(props);\r\n\r\n    }\r\n\r\n    render(){\r\n\r\n        return(\r\n            <div className=\"btn__container\">\r\n                <a href=\"/#/select\">\r\n                    <div className=\"font-hambak sign-btn\">Play Game</div>\r\n                </a>\r\n                <a href=\"/#/\">\r\n                    <div className=\"font-hambak login-btn\">MyPage</div>\r\n                </a>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default ifLogin;","import * as React from 'react';\r\nimport {Component} from 'react';\r\n\r\ntype ifLogout_props = {\r\n}\r\n\r\nclass ifLogout extends Component<ifLogout_props>{\r\n    constructor(props){\r\n        super(props);\r\n    }\r\n\r\n    render(){\r\n\r\n        return(\r\n            <div className=\"btn__container\">\r\n                <a href=\"/#/login\">\r\n                    <div className=\"font-hambak login-btn\">LOGIN</div>\r\n                </a>\r\n                <a href=\"/#/signup\">\r\n                    <div className=\"font-hambak sign-btn\">SIGN UP</div>\r\n                </a>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default ifLogout;","import * as React from 'react';\r\nimport './home-route.css';\r\nimport SessionStorageAPI from \"../login/session\";\r\nimport IfLogin from \"./ifLogin\";\r\nimport IfLogout from \"./ifLogout\";\r\nimport useIntersectionObserver from './useIntersectionObserver';\r\n\r\nexport const HomeRoute: React.FC = () => {\r\n    const targetRef = React.useRef(null);\r\n    const [scrollY, setScrollY] = React.useState<number>(0);\r\n\r\n    let whetherLoginComponent = <IfLogout></IfLogout>;\r\n\r\n    const sessionStorage = new SessionStorageAPI();\r\n    let nickName_ : string | null = sessionStorage.getItem(\"userNickname\");\r\n\r\n    if(sessionStorage.getItem(\"userToken\") === null){\r\n        whetherLoginComponent = <IfLogout></IfLogout>;\r\n    }\r\n    else{\r\n        whetherLoginComponent = <IfLogin nickname={nickName_}></IfLogin>;\r\n    }\r\n\r\n    const opacityObj = {\r\n        backgroundColor: `rgba(34, 40, 49, ${scrollY / 400})`\r\n    };\r\n    const handleScroll = () => {\r\n        setScrollY(window.scrollY);\r\n    };\r\n    \r\n\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n\r\n    // const title1 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n    // const text1 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n    // const title2 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n    // const text2 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n    // const title3 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n    // const text3 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n    // const btn1 = () => {\r\n\r\n    //     return (\r\n\r\n    //     );\r\n    // };\r\n\r\n    return(\r\n        <body>\r\n        <main className=\"index-main\">\r\n            <header ref={targetRef} className=\"index-header header-position\" style={opacityObj}>\r\n                <div className=\"header-container\">\r\n                    <div className=\"header__left\">\r\n                        <span className=\"font-hambak title\">\r\n                            TEXT ADVENTURE\r\n                            <br />\r\n                            PROJECT\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"header__right\">\r\n                        <div className=\"category__container\">\r\n                            <div className=\"category\">\r\n                                <a href=\"\">\r\n                                    <span className=\"font-game-thick category-span\">게임소개</span>\r\n                                </a>\r\n                            </div>\r\n\r\n                            <div className=\"category\">\r\n                                <a href=\"/#/select\">\r\n                                    <span className=\"font-game-thick category-span\">시작하기</span>\r\n                                </a>\r\n                            </div>\r\n\r\n                            <div className=\"category\">\r\n                                <a href=\"\">\r\n                                    <span className=\"font-game-thick category-span\">커뮤니티</span>\r\n                                </a>\r\n                            </div>\r\n\r\n                            <div className=\"category\">\r\n                                <a href=\"\">\r\n                                    <span className=\"font-game-thick category-span\">버그제보</span>\r\n                                </a>\r\n                            </div>\r\n                        </div>\r\n                        {whetherLoginComponent}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n            <div className=\"first-section\">\r\n                <div>\r\n                    <p className=\"intro font-game-thick\">유저가 만들어가는 텍스트 어드벤쳐 게임</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"second-section\"></div>\r\n\r\n            <div className=\"third-section\">\r\n                <div className=\"third-section-line\"></div>\r\n\r\n                <div className=\"explain-game\">\r\n                    <div className=\"play-game-title-container\">\r\n                        <div className=\"title-line1\"></div>\r\n                        <h1 className=\"font-game-thick explain-game-title\">\r\n                            게임 소개\r\n                        </h1>\r\n                        <div className=\"title-line1\"></div>\r\n                    </div>\r\n\r\n                    <div className=\"play-game-main-text\">\r\n                        <p className=\"explain-main-text description-size\">\r\n                            유저가 만들어가는 텍스트 어드벤쳐 게임은 '콘텐츠가 무한한 게임을 만들 수 있을까?' 라는 질문에서 출발한 프로젝트입니다.\r\n                            <br/>\r\n                            <br/>\r\n                            게임이라는 분야는 게이머도 개발자만큼이나 게임에 대한 이해도가 높다는 특징이 있습니다. 그리하여 유저들이 모두 협업하여 발전시켜나갈 수 있는 게임을 개발해보려고 합니다.\r\n                            <br/>\r\n                            <br/>\r\n                            궁극적으로 이 프로젝트는 게임이면서 동시에 게임 제작 툴을 개발하는 과정입니다.\r\n                            <br/>\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"empty\">\r\n                        <button className=\"go-to-select-btn display-none\" onClick={() => window.location.href = '/#/select'}>\r\n                            <span className=\"font-game-thick\">\r\n                                게임 시작하기\r\n                            </span>\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"make-game-title-container\">\r\n                        <div className=\"title-line1\"></div>\r\n                        <h1 className=\"font-game-thick explain-game-title\">\r\n                            게임을 즐기는 방법\r\n                        </h1>\r\n                        <div className=\"title-line1\"></div>\r\n                    </div>\r\n\r\n                    <div className=\"make-game-main-text\">\r\n                        <p className=\"explain-main-text description-size\">\r\n                            '메인스토리'란 게임의 장르를 결정하는 시작 이야기입니다.\r\n                            <br/>\r\n                            '에피소드'란 메인스토리에 맞추어 이후에 등장하게 되는 작은 사건들입니다. \r\n                            <br/>\r\n                            <br/>\r\n                            에피소드는 유저가 만들 수 있습니다.\r\n                            <br/>\r\n                            <br/>\r\n                            \r\n                        </p>\r\n\r\n                    </div>\r\n\r\n                </div>\r\n                <div></div>\r\n            </div>\r\n\r\n            <div className=\"fourth-section\">\r\n                <div></div>\r\n                <div className=\"block-chain-introduction\">\r\n                    <div className=\"block-chain-title-container\">\r\n                        <div className=\"title-line2\"></div>\r\n                        <h1 className=\"font-game-thick block-chain-title\">\r\n                            유저가 직접 컨텐츠를 추가해나가는\r\n                            <br/>\r\n                            텍스트 게임 개발 방법\r\n                        </h1>\r\n                        <div className=\"title-line2\"></div>\r\n                    </div>\r\n\r\n                    <div className=\"block-chain-main-container\">\r\n                        <p className=\"block-chain-main-text description-size\">\r\n                            다음과 같은 분야에서 활용됩니다.\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"fourth-section-line\"></div>\r\n            </div>\r\n        </main>\r\n        <footer className=\"index-footer\"></footer>\r\n        <script src=\"/js/index.js\"></script>\r\n    </body>\r\n    );\r\n};","export default __webpack_public_path__ + \"static/media/sword-svgrepo-com.dfa127b1.svg\";","export default __webpack_public_path__ + \"static/media/write-svgrepo-com.0e931a97.svg\";","export default __webpack_public_path__ + \"static/media/mode-apo.63ba34d3.png\";","export default __webpack_public_path__ + \"static/media/mode-fantasy.3be543ec.png\";","import React, {Component} from 'react';\r\nimport '../Game_mode.css';\r\nimport apoImg from '../img/mode-apo.png';\r\nimport fantasyImg from '../img/mode-fantasy.png';\r\n\r\ntype Modes_props = {\r\n  click : any,\r\n  onClick : any\r\n}\r\n\r\nclass Game_mode_modes extends Component<Modes_props>{\r\n  render() {\r\n    return(\r\n        <div className='game_mode-modes'>\r\n            <div \r\n              className={\r\n                `game_mode-modes-element ${this.props.click===1 ? 'click' : ''}`\r\n              }\r\n              onClick=\r\n              {\r\n                function(e){\r\n                  this.props.onClick(1);\r\n                }.bind(this)\r\n              }\r\n            >\r\n                <svg className='btn_deco deco1' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <svg className='btn_deco deco2' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <svg className='btn_deco deco3' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <svg className='btn_deco deco4' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <img className='genre-img' src={apoImg} alt=\"\" />\r\n                \r\n                <div className='subtitle'>\r\n                  <h1 className='font-game-thick'>\r\n                    아포칼립스\r\n                  </h1>\r\n                </div>\r\n            </div>\r\n\r\n            <div \r\n              className={\r\n                `game_mode-modes-element ${this.props.click===2 ? 'click' : ''}`\r\n              }\r\n              onClick=\r\n              {\r\n                function(e){\r\n                  this.props.onClick(2);\r\n                }.bind(this)\r\n              }\r\n            >\r\n                <svg className='btn_deco deco1' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <svg className='btn_deco deco2' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <svg className='btn_deco deco3' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <svg className='btn_deco deco4' version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"1280.000000pt\" height=\"1280.000000pt\" viewBox=\"0 0 1280.000000 1280.000000\"\r\n                  preserveAspectRatio=\"xMidYMid meet\">\r\n                  <g transform=\"translate(0.000000,1280.000000) scale(0.100000,-0.100000)\"\r\n                  stroke=\"none\">\r\n                  <path d=\"M0 11645 l0 -1155 1155 0 1155 0 0 1155 0 1155 -1155 0 -1155 0 0\r\n                  -1155z m1820 0 l0 -665 -665 0 -665 0 0 665 0 665 665 0 665 0 0 -665z\"/>\r\n                  <path d=\"M2738 11433 l-3 -1368 -1367 -3 -1368 -2 0 -5030 0 -5030 245 0 245\r\n                  0 0 2735 0 2735 440 0 440 0 0 -1595 0 -1595 930 0 930 0 -2 243 -3 242 -682\r\n                  3 -683 2 0 1350 0 1350 683 2 682 3 0 1610 0 1610 -927 3 -928 2 0 -930 0\r\n                  -930 245 0 245 0 0 685 0 685 438 -2 437 -3 3 -1122 2 -1123 -1125 0 -1125 0\r\n                  0 1805 0 1805 1368 2 1367 3 3 1368 2 1367 1805 0 1805 0 0 -440 0 -440 -1370\r\n                  0 -1370 0 3 -927 2 -928 1610 0 1610 0 3 683 2 682 1350 0 1350 0 2 -682 3\r\n                  -683 243 -3 242 -2 0 930 0 930 -1595 0 -1595 0 0 440 0 440 2735 0 2735 0 0\r\n                  245 0 245 -5030 0 -5030 0 -2 -1367z m4102 -933 l0 -440 -1122 2 -1123 3 -3\r\n                  438 -2 437 1125 0 1125 0 0 -440z\"/>\r\n                  <path d=\"M4106 8691 c-3 -5 -5 -526 -3 -1157 l2 -1149 1155 0 1155 0 0 1155 0\r\n                  1155 -1152 2 c-667 2 -1154 -1 -1157 -6z m1824 -1151 l0 -670 -670 0 -670 0 0\r\n                  670 0 670 670 0 670 0 0 -670z\"/>\r\n                  </g>\r\n                </svg>\r\n                <img className='genre-img' src={fantasyImg} alt=\"\" />\r\n                \r\n                <div className='subtitle'>\r\n                  <h1 className='font-game-thick'>\r\n                    판타지\r\n                  </h1>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Game_mode_modes;\r\n","import React, {Component} from 'react';\r\nimport '../Game_mode.css';\r\n\r\ntype Text_props = {\r\n  click_title : any,\r\n  click_explain : any\r\n}\r\n\r\nclass Game_mode_text extends Component<Text_props>{\r\n  render() {\r\n    return(\r\n        <div className='game_mode-text'>\r\n            <h1 className='title_font text_center font-game-thick'>\r\n              {\r\n                this.props.click_title\r\n              }\r\n            </h1>\r\n            <h2 className='content_font font-game-thin'>\r\n              {\r\n                this.props.click_explain\r\n              }\r\n            </h2>\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Game_mode_text;\r\n","import React, {Component} from 'react';\r\nimport '../Game_mode.css';\r\n\r\ntype Select_props = {\r\n  click : any,\r\n  onClickCancel : any\r\n}\r\n\r\nclass Game_mode_select extends Component<Select_props>{\r\n  render() {\r\n    return(\r\n      <div className='game_mode-select_button'>\r\n        <button \r\n          className='font-game-thin mode_select_btn'\r\n          onClick={\r\n              function(){\r\n                window.location.replace(\"./#/game-play\");\r\n                //axios 써서 데이터 가져오기 : this.props.click 데이터. 숫자1 아포칼립스 2 판타지 등.\r\n                \r\n              }.bind(this)\r\n            }\r\n        >\r\n          선택\r\n        </button>\r\n        <button\r\n          className='font-game-thin mode_select_btn'\r\n          onClick={\r\n            function(){\r\n              this.props.onClickCancel();\r\n            }.bind(this)\r\n          }\r\n        >\r\n          취소\r\n        </button>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Game_mode_select;\r\n","export default __webpack_public_path__ + \"static/media/wave_line.9b11e668.svg\";","import React, {Component, useState} from 'react';\r\nimport './Game_mode.css';\r\nimport Modes from './components/game_mode_modes'\r\nimport Text from './components/game_mode_text'\r\nimport Select from './components/game_mode_select'\r\nimport Line from '../../styles/image/wave_line.svg'\r\n\r\n\r\nexport default function Game_mode(props){\r\n  \r\n  var [click, setClick] = useState(1);\r\n  var [contents, setContents] = useState(\r\n      [\r\n        {id : 1, title : '아포칼립스', explain : '멸망한 세계에서 살아남으세요.'},\r\n        {id : 2, title : '판타지', explain : '마법과 검의 세계에서 당신을 증명하세요.'}\r\n      ]\r\n    );\r\n  \r\n    var click_content = contents.filter(element => (element.id === click))[0];\r\n    return(\r\n      <div className={`game_mode-container ${props.hidden ? 'hidden' : ''}`}>\r\n        <div className='game_mode-background'>\r\n          <img className='line' src={Line} alt=\"\" />\r\n          <div className='game_mode'>\r\n            <div className='mode-container'>\r\n              <Text\r\n                click_title= {\r\n                  click_content.title\r\n                }\r\n                click_explain = {\r\n                  click_content.explain\r\n                }\r\n              />\r\n              {/* 추후 가운데 장르 선택 btn들이 왼쪽의 설명란의 아래로 사라지는 연출을 만들어보기 위해 side-block을 두었음. */}\r\n              <div className='side-block'></div>\r\n              <Modes \r\n                click = {click}\r\n                \r\n                onClick = {\r\n                  function(number){\r\n                    setClick(Number(number))\r\n                  }.bind(this)\r\n                }\r\n              />\r\n              <div className='side-block'></div>\r\n            </div>\r\n            <Select\r\n              click = {click}\r\n              onClickCancel = {\r\n                function(){\r\n                  props.hiddenOff();\r\n                }.bind(this)\r\n              }\r\n            /> \r\n          </div>\r\n          <img className='line' src={Line} alt=\"\" />\r\n        </div>\r\n      </div>\r\n    )\r\n}\r\n\r\n","import * as React from 'react';\r\nimport './select-route.css';\r\nimport swordLogo from '../../styles/image/sword-svgrepo-com.svg';\r\nimport writeLogo from '../../styles/image/write-svgrepo-com.svg';\r\nimport GameMode from './game_mode'\r\nimport UserDialog from './components copy/UserDialog';\r\n\r\nexport const SelectRoute: React.FC = () => {\r\n    var [modeHidden, setmodeHidden] = React.useState(true);\r\n\r\n    return(\r\n        <body className=\"select-body\">\r\n            <main className=\"select-main\">\r\n                <div className=\"game__section\">\r\n                    <div></div>\r\n                    <div className=\"display-flex flex-direction-column justify-align-center introduce-game-animation\">\r\n                        <div className=\"svg-container1\">\r\n                            <img className=\"icon-sword\" src={swordLogo} alt=\"\" />\r\n                        </div>\r\n                        <div className=\"center-line1\"></div>\r\n                        <h1 className=\"font-game-thick introduce-game\">\r\n                            당신의 선택이 만들어나가는 모험\r\n                        </h1>\r\n                    </div>\r\n                    <div className=\"appear-animation\" onClick={function(){setmodeHidden(false)}}>\r\n                        <div className=\"game-start-btn\" >\r\n                            <h1 className=\"font-game-thick\">게임 시작하기</h1>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div></div>\r\n                </div>\r\n                <div className=\"create__section\">\r\n                    <div></div>\r\n                    <div className=\"display-flex flex-direction-column justify-align-center introduce-create-animation\">\r\n                        <div className=\"svg-container2\">\r\n                            <img className=\"icon-write\" src={writeLogo} alt=\"\" />\r\n                        </div>\r\n                        <div className=\"center-line2\"></div>\r\n                        <h1 className=\"font-game-thick introduce-create\">\r\n                            나만의 스토리를 만들어 게임 제작에 참여하세요\r\n                        </h1>\r\n                    </div>\r\n                    <a href=\"/#/story-list\">\r\n                        <div className=\"appear-animation2\">\r\n                            <div className=\"episode-make-btn\">\r\n                                <h1 className=\"font-game-thick\">에피소드 만들기</h1>\r\n                            </div>\r\n                        </div>\r\n                    </a>\r\n                    <div></div>\r\n                </div>\r\n            </main>\r\n            <footer className=\"select-footer\"></footer>\r\n            \r\n            <GameMode hidden = {modeHidden}\r\n                hiddenOff = {\r\n                    function(){\r\n                        setmodeHidden(true);\r\n                    }\r\n                }\r\n            />\r\n        </body>\r\n    );\r\n};","import * as React from 'react';\r\nimport '../game-play-route.css';\r\n\r\nexport var health_class;\r\nexport var hungry_class;\r\nexport var money_class;\r\n\r\nexport default function Right_Ui(){\r\n    health_class = React.useRef(null);\r\n    hungry_class = React.useRef(null);\r\n    money_class = React.useRef(null);\r\n\r\n    return (\r\n            <div className=\"right_ui\">\r\n                <div className='health' ref={health_class}></div>\r\n                <div className='hungry' ref={hungry_class}></div>\r\n                <div className='money' ref={money_class}></div>\r\n            </div>\r\n    );\r\n};","import * as React from 'react';\r\nimport '../game-play-route.css';\r\nimport bookLogo from '../../../styles/image/book-svgrepo-com.svg';\r\nimport heartLogo from \"../../../styles/image/heart.png\"\r\nimport heartBLogo from \"../../../styles/image/heart_b.png\"\r\nimport hungryLogo from \"../../../styles/image/hungry.png\"\r\nimport hungryBLogo from \"../../../styles/image/hungry_b.png\"\r\nimport moneyLogo from \"../../../styles/image/money.png\"\r\nimport money5Logo from \"../../../styles/image/money5.png\"\r\nimport axios from 'axios';\r\nimport { health_class } from './right_ui';\r\nimport { money_class } from './right_ui';\r\nimport { hungry_class } from './right_ui';\r\n\r\ninterface Episode {\r\n    Episode_Text: EpisodeText,\r\n    Option_Stat_Changes: Option_Stat_Changes[],\r\n    Option_Texts: Option_Texts[]\r\n}\r\n\r\ninterface EpisodeText {\r\n    id: number,\r\n    main_text: string,\r\n    mode: number,\r\n    title: string\r\n}\r\ninterface Option_Stat_Changes {\r\n    health_change: number,\r\n    money_change: number,\r\n    hungry_change: number,\r\n    strength_change: number,\r\n    agility_change: number,\r\n    armour_change: number,\r\n    mental_change: number\r\n}\r\n\r\ninterface Status {\r\n    health: number,\r\n    money: number,\r\n    hungry: number,\r\n    strength: number,\r\n    agility: number,\r\n    armour: number,\r\n    mental: number,\r\n};\r\n\r\ninterface Option_Texts {\r\n    text: string,\r\n    result_text: string\r\n};\r\n\r\nlet main_episode: Episode[];\r\nlet normal_episode : Episode;\r\n\r\nlet maxHealth: number = 5;\r\nlet maxHungry: number = 5;\r\n\r\n\r\nlet body_text: string;\r\nlet option_text: Option_Texts[];\r\nlet input_result: any = [];\r\n\r\nlet current_episode_num: number = 0;\r\nlet main_episode_num: number = 0;\r\n\r\nlet split_txt: string[];\r\nlet stop_typing_time: number;\r\nlet click: boolean;\r\nlet typingIdx: number;\r\nlet height_multiple: number;\r\nlet main_text_view_basic_size: number;\r\nlet normal_episode_num = 1;\r\nconst end_episode_num = 11;\r\nlet isEnd = false;\r\nlet typing_end;\r\nlet status_change: Option_Stat_Changes[];\r\n\r\nexport let current_status: Status;\r\n\r\nexport default function Main(props) {\r\n\r\n    let episode_text = React.useRef(null);\r\n    let text_view = React.useRef(null);\r\n    let main_text_view = React.useRef(null);\r\n    let episode_option = React.useRef(null);\r\n    let episode_result_text = React.useRef(null);\r\n    let episode_result_option = React.useRef(null);\r\n    let header_text_view = React.useRef(null);\r\n    let episode_title = React.useRef(null);\r\n    let episode_number_text = React.useRef(null);\r\n\r\n\r\n    function game_start() {\r\n        console.log('게임 스타트 함수 진입');\r\n\r\n        getMainEpisodeDataFromDB();\r\n        getCurrentStatusFromDB();\r\n\r\n        setTimeout(start_episode, 3000);\r\n    };\r\n\r\n    function start_episode() {\r\n        stop_typing_time = 0;\r\n        click = false;\r\n        typingIdx = 0;\r\n        height_multiple = 1;\r\n        main_text_view_basic_size = main_text_view.current.clientHeight;\r\n        // 여기서 에러 발생\r\n        split_txt = body_text.split(\"\"); // 한글자씩 잘라 배열로 저장한다.\r\n        text_view.current.addEventListener(\"click\", click_on);\r\n\r\n\r\n        let promise = async function () {\r\n            for (typing_end = false; typing_end === false;) {\r\n                await new Promise<void>((resolve, reject) => {\r\n                    //episode 타이핑 시작\r\n                    setTimeout(function () {\r\n                        typing_episode();\r\n                        resolve();\r\n                    }, 20);\r\n                })\r\n            }\r\n            //episode 타이핑이 끝난 후\r\n            if (!isEnd) {\r\n                makeOptionDiv();\r\n            }\r\n            else {\r\n                makeResultOptionDiv();\r\n            }\r\n        }\r\n        promise();\r\n    }\r\n\r\n    function typing_episode() {\r\n        //클릭을 안했다면 수행\r\n        if (click !== true) {\r\n            if (typingIdx < split_txt.length) {\r\n                // 타이핑될 텍스트 길이만큼 반복\r\n                if (stop_typing_time !== 0) {\r\n                    stop_typing_time -= 1;\r\n                }\r\n                else {\r\n                    episode_text.current.innerHTML += (split_txt[typingIdx])\r\n                    if (split_txt[typingIdx] === \".\") {\r\n                        stop_typing_time = 10; //온점이 나오면 10번의 반복 기간동안 쉼\r\n                    }\r\n                    typingIdx++;\r\n\r\n                    //글자가 페이지를 넘어간다면\r\n                    if (text_view.current.clientHeight * height_multiple < episode_text.current.clientHeight + header_text_view.current.clientHeight) {\r\n                        episode_text.current.innerText = episode_text.current.innerText.slice(0, -1);\r\n                        main_text_view.current.style.height = `${(text_view.current.clientHeight * height_multiple + main_text_view_basic_size)}px`;\r\n                        moveScrollBottom();\r\n                        stop_typing_time = 30;\r\n                        height_multiple++;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                typing_end = true;\r\n            }\r\n        }\r\n        //클릭을 했다면 탈출\r\n        else {\r\n            typing_end = true;\r\n            body_text = body_text.replace(/\\t/g, \"&nbsp;\");\r\n            body_text = body_text.replace(/\\n/g, \"<br><br>\");\r\n            episode_text.current.innerHTML = body_text;\r\n            text_view.current.removeEventListener(\"click\", click_on);\r\n        }\r\n    }\r\n\r\n    function makeOptionDiv() {\r\n        let optionDiv = [];\r\n        let i = 0;\r\n\r\n        for (i = 0; i < option_text.length; i++) {\r\n            optionDiv[i] = document.createElement('div');\r\n            optionDiv[i].className = \"option_div\"\r\n            optionDiv[i].id = `${i}`;\r\n            optionDiv[i].innerText = option_text[i].text;\r\n            optionDiv[i].addEventListener('click', (e: any) => { makeResultText(e.target.id) });\r\n            episode_option.current.appendChild(optionDiv[i]);\r\n        }\r\n\r\n        episode_option.current.classList.remove(\"hidden\");\r\n    }\r\n\r\n    function makeResultText(optionId: number) {\r\n        episode_result_text.current.classList.remove(\"hidden\");\r\n\r\n        // 선택지를 고른 후 캐릭터 스테이터스 업데이트\r\n        axios.patch(`${process.env.REACT_APP_API_URL}/game_play/changestatus/3`,\r\n            {\r\n                //db에 스탯 변화량 기록\r\n                \"changed_health\": status_change[optionId].health_change,\r\n                \"changed_money\": status_change[optionId].money_change,\r\n                \"changed_hungry\": status_change[optionId].hungry_change,\r\n                \"changed_strength\": status_change[optionId].strength_change,\r\n                \"changed_agility\": status_change[optionId].agility_change,\r\n                \"changed_armour\": status_change[optionId].armour_change,\r\n                \"changed_mental\": status_change[optionId].mental_change\r\n            })\r\n            .then((res) => \r\n            {\r\n                episode_result_text.current.innerHTML += \"<br>\" + option_text[optionId].result_text + \"<br><br>\";\r\n                let isStatChanged = false;\r\n                //stat 증가량 텍스트 입력\r\n                for (let statName in status_change[optionId]) {\r\n                    if (status_change[optionId][statName] != 0) {\r\n                        isStatChanged = true;\r\n                        let statMessage;\r\n                        switch(statName){\r\n                            case 'health_change':\r\n                                statMessage=\"체력이\"\r\n                                break;\r\n                            case 'money_change':\r\n                                statMessage=\"돈이\"\r\n                                break;\r\n                            case 'hungry_change':\r\n                                statMessage=\"허기가\"\r\n                                break;\r\n                            case 'strength_change':\r\n                                statMessage=\"근력이\"\r\n                                break;\r\n                            case 'agility_change':\r\n                                statMessage=\"민첩이\"\r\n                                break;\r\n                            case 'armour_change':\r\n                                statMessage=\"방어가\"\r\n                                break;\r\n                            case 'mental_change':\r\n                                statMessage=\"정신력이\"\r\n                                break;\r\n                        }\r\n                        if (status_change[optionId][statName] < 0)\r\n                            episode_result_text.current.innerHTML += statMessage + \" \" + status_change[optionId][statName] + \"만큼 줄었습니다\\n\";\r\n                        else\r\n                            episode_result_text.current.innerHTML += statMessage + status_change[optionId][statName] + \"만큼 늘었습니다\\n\";\r\n                    }\r\n                }\r\n\r\n                current_status.health += status_change[optionId].health_change;\r\n                current_status.hungry += status_change[optionId].hungry_change;\r\n                current_status.money += status_change[optionId].money_change;\r\n                current_status.strength += status_change[optionId].strength_change;\r\n                current_status.agility += status_change[optionId].agility_change;\r\n                current_status.armour += status_change[optionId].armour_change;\r\n                current_status.mental += status_change[optionId].mental_change;\r\n\r\n                makeResultOptionDiv();\r\n                episode_result_text.current.style.height = `${(text_view.current.clientHeight) - (episode_result_option.current.clientHeight)}px`;\r\n                moveScrollBottom();\r\n                //ui 업데이트\r\n                if(isStatChanged)\r\n                    update_rightUI();\r\n            })\r\n    }\r\n\r\n    function makeResultOptionDiv() {\r\n        let resultDiv: any;\r\n        resultDiv = document.createElement('div');\r\n        resultDiv.className = \"result_div font-game-thick\";\r\n\r\n        if (!isEnd) {\r\n            resultDiv.innerText += \"다음으로 . . .\";\r\n            resultDiv.addEventListener('click', (e: any) => { episodeEnd() });\r\n        }\r\n        else {\r\n            resultDiv.innerText += \"로비로 . . .\";\r\n            resultDiv.addEventListener('click', function onClick() {\r\n                window.location.href = 'http://localhost:3000/#/select';\r\n            });\r\n        }\r\n        episode_result_option.current.appendChild(resultDiv);\r\n\r\n        episode_result_option.current.classList.remove(\"hidden\");\r\n\r\n        moveScrollBottom();\r\n        height_multiple++;\r\n    }\r\n\r\n    function episodeEnd() {\r\n        resetTextDiv();\r\n\r\n        current_episode_num += 1;\r\n\r\n        if (current_status.health <= 0 || current_status.hungry <= 0){\r\n            isEnd = true;\r\n        }\r\n        //게임 끝 판별\r\n        if(isEnd){\r\n            normal_episode_num = end_episode_num;\r\n            getNormalEpisodeDataFromDB();\r\n        }\r\n        //만약 지금이 1,4,7...번째 에피소드라면 메인 에피소드 출력\r\n        else if (((current_episode_num + 1) % 3) === 1) {\r\n            main_episode_num += 1;\r\n            updateEpisodeValue('main');\r\n        }\r\n        //그 외라면 일반 에피소드 출력\r\n        else {\r\n            normal_episode_num = Math.floor(Math.random() * 9) + 2;\r\n            getNormalEpisodeDataFromDB();\r\n        }\r\n\r\n        setTimeout(function () { start_episode() }, 1500)\r\n    }\r\n\r\n    function update_rightUI() {\r\n        health_class.current.innerHTML = \"\";\r\n        hungry_class.current.innerHTML = \"\";\r\n        money_class.current.innerHTML = \"\";\r\n        \r\n        //helath의 개수가 0보다 작거나 current_status.maxHealth보다 클 수 없게 설정\r\n        if (current_status.health < 0)\r\n            current_status.health = 0;\r\n        else if (current_status.health > maxHealth)\r\n            current_status.health = maxHealth\r\n\r\n        if (current_status.hungry < 0)\r\n            current_status.hungry = 0;\r\n        else if (current_status.hungry > maxHungry)\r\n            current_status.hungry = maxHungry\r\n\r\n        let health = current_status.health;\r\n        let hungry = current_status.hungry;\r\n        let money = current_status.money\r\n\r\n        let helathImg = [];\r\n        let helathBImg = [];\r\n        let moneyImg = [];\r\n        let hungryImg = [];\r\n        let hungryBImg = [];\r\n        let money5 = Math.floor(money / 5);\r\n\r\n        let i = 0;\r\n\r\n\r\n        for (i = 0; i < health; i++) {\r\n            helathImg[i] = new Image();\r\n            helathImg[i].className = \"right-ui-img\"\r\n            helathImg[i].src = heartLogo;\r\n            helathImg[i].width = 30;\r\n            health_class.current.appendChild(helathImg[i]);\r\n        }\r\n        for (i = 0; i < maxHealth - health; i++) {\r\n            helathBImg[i] = new Image();\r\n            helathBImg[i].className = \"right-ui-img\"\r\n            helathBImg[i].src = heartBLogo;\r\n            helathBImg[i].width = 30;\r\n            health_class.current.appendChild(helathBImg[i]);\r\n        }\r\n\r\n        for (i = 0; i < hungry; i++) {\r\n            hungryImg[i] = new Image();\r\n            hungryImg[i].className = \"right-ui-img\"\r\n            hungryImg[i].src = hungryLogo;\r\n            hungryImg[i].width = 30;\r\n            hungry_class.current.appendChild(hungryImg[i]);\r\n        }\r\n        for (i = 0; i < maxHungry - hungry; i++) {\r\n            hungryBImg[i] = new Image();\r\n            hungryBImg[i].className = \"right-ui-img\"\r\n            hungryBImg[i].src = hungryBLogo;\r\n            hungryBImg[i].width = 30;\r\n            hungry_class.current.appendChild(hungryBImg[i]);\r\n        }\r\n\r\n        if (money <= 5) {\r\n            for (i = 0; i < money; i++) {\r\n                moneyImg[money5 + i] = new Image();\r\n                moneyImg[money5 + i].className = \"money_img\"\r\n                moneyImg[money5 + i].src = moneyLogo;\r\n                moneyImg[money5 + i].width = 30;\r\n                money_class.current.appendChild(moneyImg[money5 + i]);\r\n            }\r\n        }\r\n        else {\r\n            for (i = 0; i < money5; i++) {\r\n                moneyImg[i] = new Image();\r\n                moneyImg[i].className = \"money5_img\"\r\n                moneyImg[i].src = money5Logo;\r\n                moneyImg[i].width = 30;\r\n                money_class.current.appendChild(moneyImg[i]);\r\n            }\r\n            for (i = 0; i < money % 5; i++) {\r\n                moneyImg[money5 + i] = new Image();\r\n                moneyImg[money5 + i].className = \"money_img\"\r\n                moneyImg[money5 + i].src = moneyLogo;\r\n                moneyImg[money5 + i].width = 30;\r\n                money_class.current.appendChild(moneyImg[money5 + i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    function click_on() {\r\n        click = true\r\n    }\r\n\r\n    function moveScrollBottom() {\r\n        let location = text_view.current.scrollHeight;\r\n        text_view.current.scrollTo({ top: location, behavior: \"smooth\" });\r\n    }\r\n\r\n    function resetTextDiv() {\r\n        episode_text.current.innerText = \"\";\r\n        episode_option.current.innerHTML = \"\";\r\n        episode_result_text.current.innerHTML = \"\";\r\n        episode_result_option.current.innerHTML = \"\";\r\n        main_text_view.current.style.height = \"auto\";\r\n        episode_option.current.classList.add(\"hidden\");\r\n        episode_result_text.current.classList.add(\"hidden\");\r\n        episode_result_option.current.classList.add(\"hidden\");\r\n    }\r\n\r\n    async function getMainEpisodeDataFromDB() {\r\n        console.log('메인 에피소드 가져오기 함수 진입');\r\n        await axios.get(`${process.env.REACT_APP_API_URL}/game_play/mainepisode`)\r\n            .then((res) => {\r\n                console.log('메인 에피소드 가져오기 성공');\r\n                main_episode = res.data.mainEpisodes;\r\n            });\r\n        updateEpisodeValue('main');\r\n    }\r\n\r\n    function getCurrentStatusFromDB(){\r\n        // 캐릭터 스테이터스 가져오기\r\n        axios.get(`${process.env.REACT_APP_API_URL}/game_play/character/1`)\r\n        .then((res) => {\r\n            current_status = res.data;\r\n            update_rightUI();\r\n        });\r\n    }\r\n\r\n    async function getNormalEpisodeDataFromDB() {\r\n        // 에피소드 가져오기\r\n        await axios.get(`${process.env.REACT_APP_API_URL}/game_play/episode/${normal_episode_num}`)\r\n            .then((res) => {\r\n                console.log('노말 에피소드 가져오기 성공');\r\n                normal_episode = res.data;\r\n                debugger;\r\n            });\r\n        updateEpisodeValue('normal');\r\n    }\r\n\r\n    function updateEpisodeValue(episode_type) {\r\n        //메인 에피소드 업데이트\r\n\r\n        let current_episode : Episode\r\n        \r\n        if (episode_type === 'main') {\r\n            current_episode = main_episode[main_episode_num];\r\n        }\r\n        else if(episode_type === 'normal'){\r\n            current_episode = normal_episode;\r\n        }\r\n\r\n        //episode_number\r\n        episode_number_text.current.innerText = '#' + current_episode.Episode_Text.id;\r\n        //episode_title\r\n        episode_title.current.innerText = current_episode.Episode_Text.title;\r\n\r\n        body_text = current_episode.Episode_Text.main_text;\r\n\r\n        // 에피소드 선택지 업데이트\r\n        option_text = current_episode.Option_Texts; \r\n\r\n        status_change = current_episode.Option_Stat_Changes;\r\n        debugger;\r\n    }\r\n\r\n    React.useEffect(game_start, [])\r\n\r\n    return (\r\n        <main className=\"main\">\r\n            <div className=\"episode_logo\">\r\n                <img className=\"icon-book\" src={bookLogo} alt=\"\" />\r\n            </div>\r\n            <div className=\"episode_logo_line\"></div>\r\n            <div className=\"text_view\" ref={text_view}>\r\n                <div className=\"header_text_view\" ref={header_text_view}>\r\n                    <div className=\"episode_number font-game-thick\">\r\n                        <span className=\"episode_number_text\" ref={episode_number_text}>\r\n                            #0 서막\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"episode_title font-game-thick\" ref={episode_title}>\r\n                        모험의 시작\r\n                    </div>\r\n                </div>\r\n                <div className=\"main_text_view\" ref={main_text_view}>\r\n                    <div className=\"episode_text\" ref={episode_text}>\r\n                    </div>\r\n                    <div className=\"episode_option hidden font-game-thick\" ref={episode_option}>\r\n                    </div>\r\n                    <div className=\"episode_result_text hidden\" ref={episode_result_text}>\r\n                    </div>\r\n                    <div className=\"episode_result_option hidden\" ref={episode_result_option}>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className=\"main_ui\">\r\n                <button className=\"main-ui-btn font-game-thin\" onClick={function () { props.stat_window_event() }}>능력치</button>\r\n                <button className=\"main-ui-btn font-game-thin\">SAVE</button>\r\n                <button className=\"main-ui-btn font-game-thin\">인벤토리</button>\r\n                <button className=\"main-ui-btn font-game-thin\">환경설정</button>\r\n            </div>\r\n        </main>\r\n    );\r\n};","export default __webpack_public_path__ + \"static/media/book-svgrepo-com.88ded2c9.svg\";","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABLCAYAAAA4TnrqAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAEB0lEQVR4Xu1cvW7UQBA+h18huCipoUWioUGChleggu54NrrkBXgBChoQFJRAm7SghIifQM7MXGxw7F3dNzP2rJ2spRUON7Mz88342/Xe7hUzh6t8Mz8gM/MhTRWPDosh++e+N4Y2UPV/ycnOoGa8wLo2aBROnXuBtXSKZ1AzJrDKsiy4AR6eADKjF0ECjQZBxP2LPry6JkquKlNSQBRLkmNbIX7kz7gd0UCwCfbXEbusVaz01gHlOYhw4mMDCX/GzTQie2TcmI/xqGewBLkQgdUkdLqf5NwJHJCCEMIET2TO5AnLn7G29USQP6Xo15dKxdkJkT7E3ZLK0gGlDcFPD35CJGD5uT9SSxksQWIgsCykWPnykf7dp/aF2jdqxwIfhxaFX8WCPERkzkFtrfXy4cFGURQ8MxZdq5H08/MjUrouUpQK46Rfz/Dr4lkS6Xe4LFZZtwC/Sg1Q3C/p8bviD8CGlwgXTROLIC4xsJARAi7fSMR/vJDoy04MLGSaIH78Wk5b9fvCAO4HIni4N5ng5MCCZq4RDKzBdvTfv97pmHrweCFLQVM69OaAk37HrqWyrJylByGRpgUsq8spbat8tzhseYRXMwiVxwmVYmB5DOu8JD2pq6DZepNof5P3/Hd3ufjeYSewYq6vjncvVnZUl4n0QxZB0m8/SldU3l8QJQtnXRCI/oeZwRKk3ARWvXTTXsKp1+rbX8LG5AX+JhVtE3zcme5smJdxeF3qJrUb1CTAH9NsvTOI9E7cKLRKgke7Z7ltiXBLFvly1tD9MKqSahjGgwn1msESJCuDJQDL+n4nMLVeNLREE9JKNRDkylqfw38SGawMlgABgWiuLAFYyQgeJWmU9AUxq0VzZQmgy2BlsAQICERzZQnASkbwYyJuFK9cWShSwgU7QbfnUzRXliCvGSwBWLFtktgXoP3ub18S6XeSh8704ZjB9fbQydgxVdaYfAliP3oH4YpxEMxgCUDOYAnAshF8yFC/pC8IJSAKknnIiITgU2yB3COnP1BbFHd3OIm8mfQVtWc2xPrTjr0bep1rbkZym0C6U/8H3e/S/W75afG0v3BtPcXA4hMQ7i/ZBAzP7xi0fbq/X1WaLUKddvDXAmKA8A7AVD9csUdA6ULUa/G20CYW34M8hvbf2k6Jqp3KeZC+nsyDh5pCAeapgyDtGazTDcfQJQHrXPxESgAVeBu7BKyfEPzjF2rOIbkAgmRuIvi28mp/6NvNFJNXUzosP0omqawzTlanWMd01tkEIqKsBqvqfGpHSkxPghUsk3Ekmz3LmJ4EK1jwsNtz0NruTIOUyzE2mv3z8IwcUteCMLMQN2rUWlmoHX7XnPzlBdbUuC2YWC+wpsZtScFy4cahn/O/KODaJ0yA0bkAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABCCAYAAADAD1E9AAAACXBIWXMAABJ0AAASdAHeZh94AAACv0lEQVR4Xu2bsU7DMBCGG8RUlVbq0KEsIF4AdlbepEOl7n2OqnMfgHdghB1eAAEDA0sXqkqVKoqNCILUxr91l6ZJ/kgs6d35/PnsPzZJ0qjOtVHuSoLEO0CMaOMnQIDC6iBAAhQSELqzAoUAD4X+ubsnSbIxV7CdwWBwb4wugoaAQbPZfJ1Op38aNXk0TB5byrz3FYjA+2aiAs/GWi6XxwDnL5O9B4h2JG8730ASoJA8ARKgkIDQHdrvCdtwult1tT+ERGI4HN6s1+urPHKIidlqtd4nk8lR1qfQKRyCZ5PdB3g2j8VisQWPKhxTgh7bQitQIf/CQxQGEJm+hdMBEigMIJBbKUzU98Lo3nU8Ht/N5/PLUlD6J0n1CkSnZhXgUYUVyl+9AhVyKlUIAhQOFwEKAcIqnO5dQ/vX0Wj0vFqtToR5lcYdBhgCl/a4TvCiVBh9PClN6SglyjVQCJIACVBIQOjuFBHXabFR1wcjEOfC9irn7p3CWdEgPPfYOwFScfGJQhHBWTktCZAAhQRA906n8+Iytf8X3nr1yZwW35sDT7WXdcAc98psNpv5eP2575zCdYcXM5JcA0Fa9v1A10WAIEDXUhd1GoO3Uy9LVqBjvI3iPqa37bb2e/o63zOOOlCtQm151DXbtTNz42vRC+3KWIHCqiBAAhQSELqzAh0Afc98fA5sNJ58BWehpX/G5gMtzMqoMKiup6m6ZgGF1NYHlFMYLTWPXa0AxqxtKNdaAYxZ2wgQJSC0c1Zgt9t9FsbdqXuv17v9r8FfChv+bjYyc9+XSlsNme9xI0PrmIPqahsr5Kuruq2BOqP6K0olAOahrijpSgDMQ13rBhDtr7qdswJdU6Ldbr+ptx4I2O/3r8G9665T+2kvRrnUHwHAXsfkCIbUM6vKGqhHJDISAUYCy5oTIAEKCQjdWYFCgJ+f6Yt317jwrQAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,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\"","import * as React from 'react';\r\nimport { current_status } from './main'\r\nimport cristal from \"../../../styles/image/cristal.png\"\r\nimport cristalB from \"../../../styles/image/cristal_b.png\"\r\nimport '../game-play-route.css';\r\n\r\n\r\nfunction StatIconPusher(maxWidth : number, currentWidth : number){\r\n    var cristal_arr = [];\r\n    for(var i = 0; i< currentWidth; i++){\r\n        cristal_arr.push(<img src={cristal} className = \"cristal\"/>)\r\n    }\r\n    for(var i = 0; i< maxWidth-currentWidth; i++){\r\n        cristal_arr.push(<img src={cristalB} className = \"cristal\"/>)\r\n    }\r\n    return cristal_arr\r\n}\r\nexport default function BottomStatUI(){\r\n    return (\r\n    <div className=\"stat-ui font-game-thick\">\r\n\r\n        <div className=\"stat-ui-title\">\r\n        <h1>캐릭터 정보</h1>\r\n        </div>\r\n\r\n        <div className=\"stat-ui-div\">\r\n            <div className=\"stat-img-container\">\r\n                <div className=\"stat-ui-div-text\">힘</div>\r\n            </div>\r\n            <div className=\"stat-all-container\">\r\n                <div className=\"cristal-div\">\r\n                {StatIconPusher(20, current_status.strength)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div className=\"stat-ui-div\">\r\n            <div className=\"stat-img-container\">\r\n                <div className=\"stat-ui-div-text\">민첩</div>\r\n            </div>\r\n            <div className=\"stat-all-container\">\r\n                <div className=\"cristal-div\">\r\n                {StatIconPusher(20, current_status.agility)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div className=\"stat-ui-div\">\r\n            <div className=\"stat-img-container\">\r\n                <div className=\"stat-ui-div-text\">방어력</div>\r\n            </div>\r\n            <div className=\"stat-all-container\">\r\n                <div className=\"cristal-div\">\r\n                {StatIconPusher(20, current_status.armour)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div className=\"stat-ui-div\">\r\n            <div className=\"stat-img-container\">\r\n                <div className=\"stat-ui-div-text\">정신력</div>\r\n            </div>\r\n            <div className=\"stat-all-container\">\r\n                <div className=\"cristal-div\">\r\n                {StatIconPusher(20, current_status.mental)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n    </div>\r\n    );\r\n};","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEOUlEQVR4Xu2czWoUQRDHZ/zMQVBBMYgm6wq+gC8gkkN8AMUHUfQRBPMCvkLEczxI8AW8i7JLEvSQU+5iXLtlN07VbKa6uqo/ZtIDgUy6q7vq39W/7e6ZTV1ldq2vr8+aLu3v72MP65xcPpeTM330pQgoHLWsBJzNZllNTxdtkztsmPfTOHp74ezehxvA74+fD8H9kxc/mve/zc1Fl0BD1ckhA0/E8wjyvIeNqkkOAkoCSj6DkgqowTyNNiQjeEFi7GNrmPfd2K2anyuj0ajCzKvGb0Czm9VrcL+zBXut6/pP4y/H5veoMaXIwGtWPB/xHWyiMzGFgPBj1kGVnKtEFTAGr0wfUWMKzos589ZMFl1yYR6VbZuPblFMtBxcXHZfHVTQoI3Po7hpxaOECVQefJkTQ8CrgcTJotmgAsZgHqViaCaqM9Aw76sJymbdqgbzKIFSMzFEBq7MF8pU7CnK1ZkYQsC7KZRJ1aeqgHPmqbapLYw2l8UMnK/z7phAV2IwjxLUgYnNvbN4nSgW0ARkp+xlKrBMy8VM1JhufRVPZUxFAoZeY6lESDQiZSJ7Chvm2Qe1dm9bWebtvkUnSOg8L4YIXX1gJk624a4SnSeymeiTgf/EG+jFZqKPgAPVzi8sloCGF9FPfP3C8rficp1MWcO8qXHn3sIlzLzxxjt/b5dZHn3qbo8qZ3oznR4Bi/vPbLgnF8lElww8EY/p2xCqkwnmIuAQhAgWQ6eAXB4E8zJhw5QGrRTF76q0mPfwKQwHM4m7DpQyjWmPmfft4BeI58EaXCciJtq6QLNlGSh5VyVhrqTpujCQqTve+gEBqfnO7Guw1Zsi1vid5Na7Ktc3eEJQTGQyi9e5qY3ap5hHtY+Z+PjlsYXmApRxn+JTzvakvPkpUxcGCketCCgUsH0eiJmHmUUxEZdP4ft9FWUvDEibeXidWFXwPKVkoHDAioCKAjYf9wmbPTvmYF9nF4jmOQcQcm/3OVBj+uU9uB+jvTFVHlta7A+198Xl6Hsp3Xth84AFfNEvdrB97K8wUDhqywQ8ELY5RHM7M+1P63Oi88jaMhE9N61mk1edTKQYg5mprXZo5mF/O6dwYSI9vIWB3RqRH6ouApKN0OPUyxpOcZOP7ZqhL2PizpZ9NfD/hc/PQjMxNvNYDMSVCxPbM8llCvdy/sVy2kdAJzbECkC5H3ZsLAae4izoVMpEriAUY7l7W27/PhnI7WPQ9YuAwuHVEJDNDaHPWZlrMBAHBASdbI9BefsZg64e3HdbpL1rZKDUh17bFwGFwxdCwDPFxBAMjMrE2MwT7YWF2T5I8xBTeJBCnRZUDAEHzcQYDFRlYmrmFQYqAybGFFZ2Oa/mioDC8UjBQBYTcWXqextCPdjmJQPZkkGDImARUKiA0DwHBnYycUl8WflcprAwA4uAQxLQ5X+4uNQRasIy/wtEmSJ0Rw54KwAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,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\"","import '../game-play-route.css';\r\nexport default function Left_Ui(){\r\n    return (\r\n            <div className=\"left_ui\">\r\n            </div>\r\n    );\r\n};","import Stat_Window from './component/stat_window'\r\nimport Main from './component/main'\r\nimport Left_Ui from './component/left_ui'\r\nimport Right_Ui from './component/right_ui'\r\nimport * as React from 'react';\r\nimport './game-play-route.css';\r\n\r\n\r\n\r\nexport const GamePlayRoute: React.FC = () => {\r\n    var [statUIOn, setStatUIOn] = React.useState(false);\r\n    var body = React.useRef(null);\r\n\r\n    function stat_window(){\r\n        if(statUIOn){\r\n            return <Stat_Window/>\r\n        }\r\n        else{\r\n            return\r\n        }\r\n    }\r\n\r\n    function stat_window_event(){\r\n        setStatUIOn((statUIOn ? false : true))\r\n    }\r\n    \r\n    // React.useEffect(game_start, [])\r\n    return (\r\n        <div className=\"game_play_body\" >\r\n            <Left_Ui></Left_Ui>\r\n            <Main stat_window_event = {function(){stat_window_event()} }></Main>\r\n            <Right_Ui></Right_Ui>\r\n\r\n            {stat_window()}\r\n        </div>\r\n    );\r\n};","export default __webpack_public_path__ + \"static/media/google-logo.0b50af2f.png\";","export default __webpack_public_path__ + \"static/media/arrow-right-svgrepo-com.44510108.svg\";","import * as React from 'react';\r\nimport './login-route.css';\r\nimport googleLogo from '../../styles/image/google-logo.png';\r\nimport arrow from '../../styles/image/arrow-right-svgrepo-com.svg';\r\nimport axios from 'axios';\r\nimport { useHistory } from \"react-router\";\r\nimport SessionStorageAPI from \"./session\";\r\n\r\nexport const LoginRoute: React.FC = () => {\r\n\r\n    const history = useHistory();\r\n    \r\n    const [email, setEmail] = React.useState(\"\");\r\n    const [pwd, setPwd] = React.useState(\"\");\r\n\r\n    const onChangeEmail = React.useCallback((e) => setEmail(e.target.value), []);\r\n    const onChangePwd = React.useCallback((e) => setPwd(e.target.value), []);\r\n\r\n    const authorizedUser = {\r\n        email: String,\r\n        nickname: String,\r\n        accessToken: String\r\n    };\r\n\r\n    function login() {\r\n        axios({\r\n            method: \"POST\",\r\n            url: `${process.env.REACT_APP_API_URL}/auth/login`,\r\n            data: {\r\n                email: email,\r\n                password: pwd,\r\n            },\r\n        })\r\n        .then((res) => {\r\n            if(res.data.errorMsg == 14) {\r\n                // 존재하지 않는 사용자라는 알림창 띄우기 필요\r\n                console.log('존재하지 않는 사용자입니다.');\r\n            }\r\n            else if(res.data.errorMsg == 15) {\r\n                // 비밀번호가 잘못됐다는 알림창 띄우기 필요\r\n                console.log('잘못된 비밀번호입니다.');\r\n            }\r\n\r\n            authorizedUser.email = res.data.email;\r\n            authorizedUser.nickname = res.data.nickname;\r\n            authorizedUser.accessToken = res.data.access_token;\r\n\r\n            const sesstionStorage = new SessionStorageAPI();\r\n\r\n            //seesion에 토큰을 저장해도 되는가?\r\n            sesstionStorage.setItem(\"userToken\", authorizedUser.accessToken);\r\n            sesstionStorage.setItem(\"userNickname\", authorizedUser.nickname);\r\n\r\n            history.push(\"/\");\r\n        });\r\n    }\r\n\r\n    function googleLogin(e) {\r\n        e.preventDefault();\r\n        window.location.href = `${process.env.REACT_APP_API_URL}/auth/googleAuth`;\r\n    }\r\n\r\n    return(\r\n        <body className=\"login-img\">\r\n            <main className=\"login-main\">\r\n                <header className=\"login-header\">\r\n                    <a href=\"/\">\r\n                        <div>\r\n                            <span className=\"font-hambak login__title\">\r\n                                TEXT ADVENTURE\r\n                                <br />\r\n                                PROJECT\r\n                            </span>\r\n                        </div>\r\n                    </a>\r\n                    <div></div>\r\n                </header>\r\n\r\n                <div className=\"login-div\">\r\n                \r\n                    <div className=\"grid-1 font-game-thick\">로그인</div>\r\n                    <div className=\"grid-2 \">\r\n                        <input type=\"email\" placeholder=\"계정 이메일\" required onChange={onChangeEmail}/>\r\n                        <input type=\"password\" placeholder=\"비밀번호\" required onChange={onChangePwd}/>\r\n                        \r\n                        <form className='google-login-form'>\r\n                                <button className=\"google-login\" onClick={googleLogin}> <img src={googleLogo} />구글 로그인</button>\r\n                        </form>\r\n\r\n                        <div className=\"autoLogin-container\">\r\n                            <input type=\"checkbox\" id=\"autoLogin\" name=\"autoLogin\" />\r\n                            <label className=\"font-game-thin\" htmlFor=\"autoLogin\">로그인 상태 유지</label>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid-3\">\r\n                        <button className=\"login-enter-btn\" onClick={login}>\r\n                            <img src={arrow} alt=\"\" />\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"grid-4 font-game-thin\">\r\n                        <a href=\"\">아이디/비밀번호 찾기</a>\r\n                        <br />\r\n                        <a href=\"/#/signup\">회원가입</a>\r\n                    </div>\r\n                    \r\n                </div>\r\n\r\n                <div></div>\r\n            </main>\r\n            <footer className=\"login-footer font-game-thin\">\r\n                <div className=\"footer-link-container\">\r\n                    <a href=\"/\">홈</a>\r\n                    <a href=\"\">고객센터</a>\r\n                    <a href=\"\">쿠키설정</a>\r\n                    <a href=\"\">언어</a>\r\n                </div>\r\n            </footer>\r\n        </body>\r\n    );\r\n};\r\n","export default __webpack_public_path__ + \"static/media/x.f52a7d36.svg\";","import * as React from 'react';\r\nimport {Component} from 'react';\r\nimport x from '../../../styles/image/x.svg';\r\nimport './signupForm.css';\r\n\r\ntype SignupForm_props = {\r\n    closeForm() : void,\r\n    submitForm(e : any) : void,\r\n    emailDefault : string,\r\n};\r\n\r\ntype SignupForm_states={\r\n    id:string;\r\n};\r\n\r\nclass SignupForm extends Component<SignupForm_props, SignupForm_states>{\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            id: this.props.emailDefault,\r\n        };\r\n    }\r\n\r\n    render() {\r\n\r\n        return(\r\n            <div className='signup-background'>\r\n                <form className='signup-info' onSubmit={function(e){this.props.submitForm(e)}.bind(this)}>\r\n                    <div className='signup-header'>\r\n                        <div></div>\r\n                        <h1 className='font-game-thick'>\r\n                            회원가입\r\n                        </h1>\r\n                        <div className='signup-close' onClick={function(){this.props.closeForm()}.bind(this)}><img src={x}/></div>\r\n                    </div>\r\n                    <div className='signup-title font-game-thick'>\r\n                        <h1>모험에 도전하시는 여러분, 환영합니다.</h1>\r\n                    </div>\r\n                    <div className='signup-line font-game-thin'>\r\n                        <label htmlFor='email'>아이디(이메일)</label>\r\n                        <input type=\"email\" id=\"email\" name='email' value={this.state.id} onChange={\r\n                            function(e){\r\n                                this.setState({id: e.target.value})\r\n                            }.bind(this)}\r\n                        required/>\r\n                    </div>\r\n                    <div className='signup-line font-game-thin'>\r\n                        <label htmlFor='pw'>비밀번호</label>\r\n                        <input type=\"password\" id=\"pw\" name='pw' required/>\r\n                    </div>\r\n                    <div className='signup-line font-game-thin'>\r\n                        <label htmlFor='pwc'>비밀번호 확인</label>\r\n                        <input type=\"password\" id=\"pwc\" name='pwc' required/>\r\n                    </div>\r\n                    <div className='signup-line font-game-thin'>\r\n                        <label htmlFor='nic'>별명</label>\r\n                        <input type=\"text\" id=\"nic\" name='nic' required/>\r\n                    </div>\r\n                    <div className='signup-line font-game-thin input-checkbox'>\r\n                        <label htmlFor='check'>게임 이용 약관 동의 <a className='terms-a' href='/'> 자세히</a></label>\r\n                        <input type=\"checkbox\" id=\"check\" required/>\r\n                    </div>\r\n                    <button className='signup-form-submit-btn'>가입하기</button>\r\n\r\n                </form>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default SignupForm;","import * as React from 'react';\r\nimport {Component, createRef } from 'react';\r\nimport SignupForm from './signupForm';\r\nimport './emailContainer.css';\r\nimport axios from 'axios';\r\n\r\ntype Modes_props = {\r\n    onFormSubmit(email : string) : void,\r\n}\r\n\r\ntype EmailContainerState = {\r\n    mode: string;\r\n    email: string;\r\n    password: string;\r\n    password_con: string;\r\n    nickname: string;\r\n};\r\n\r\nclass EmailContainer extends Component<Modes_props , EmailContainerState>{ // <props 제너릭, state 제너릭>\r\n    \r\n    //private로 형식 선언\r\n    private inputRef: React.RefObject<HTMLInputElement> = createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            mode: 'default',\r\n            email: '',\r\n            password: '',\r\n            password_con: '',\r\n            nickname: '',\r\n        };\r\n        this.inputRef = React.createRef();\r\n    }\r\n    \r\n    render() {\r\n\r\n        let default_email : string = \"\";\r\n        \r\n        //null 값일 때 참조하지 않도록 오류 방지\r\n        if(this.inputRef.current === null){\r\n            \r\n        }\r\n        else{\r\n            default_email = this.inputRef.current.value;\r\n        }\r\n\r\n        const signUpComponent = <SignupForm closeForm={\r\n            function(){this.setState({mode: 'default'})}.bind(this)} \r\n            submitForm={function(e){\r\n                //state에 회원 가입에 필요한 값들을 전달함.\r\n                e.preventDefault();\r\n                this.state.email = e.target.email.value;\r\n                this.state.password = e.target.pw.value;\r\n                this.state.password_con = e.target.pwc.value;\r\n                this.state.nickname = e.target.nic.value;\r\n\r\n                axios({\r\n                    method: \"POST\",\r\n                    url: `${process.env.REACT_APP_API_URL}/auth/signup`,\r\n                    data: {\r\n                        email: this.state.email,\r\n                        nickname: this.state.nickname,\r\n                        password: this.state.password\r\n                    },\r\n                })\r\n                .then((res) => {\r\n                    if(res.data.errorMsg == 13) {\r\n                        // 이미 가입된 회원이라고 알려주는 알림창 필요\r\n                        console.log('이미 가입된 회원입니다.');\r\n                    }\r\n                    else if(res.data.errorMsg == 11) {\r\n                        console.log('서버 문제로 회원가입 실패');\r\n                    }\r\n\r\n                    if(res.data.successMsg == 10) {\r\n                        window.location.href=`${process.env.REACT_APP_HOME_URL}/#/login`;\r\n                    }\r\n                });\r\n\r\n            }.bind(this)}\r\n            emailDefault={default_email}></SignupForm>;\r\n        \r\n        let _signUpForm = signUpComponent;\r\n        //if 문을 써서 signUpForm 안에 태그를 지우면 아무것도 출력 안 되도록 가능\r\n        \r\n        if(this.state.mode === 'default'){\r\n            _signUpForm = null;\r\n        }\r\n        else if(this.state.mode === 'signup'){\r\n            _signUpForm = signUpComponent;\r\n        }\r\n        \r\n        return(\r\n            <div className=\"email-container\">\r\n                {_signUpForm}\r\n                <input className=\"email-input\" type=\"email\" ref={this.inputRef} placeholder=\"이메일 주소\" required />\r\n                <button className=\"font-game-thin signup-button\" onClick={function(e){\r\n                    this.setState({mode: 'signup'});\r\n                }.bind(this)}>시작하기</button>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default EmailContainer;","import * as React from 'react';\r\nimport './signup-route.css';\r\nimport googleLogo from '../../styles/image/google-logo.png';\r\nimport EmailContainer from './components/email-container';\r\n\r\nexport const SignupRoute: React.FC = () => {\r\n\r\n    return(\r\n        <body>\r\n            <div className=\"signup-background-img\"></div>\r\n            <main className=\"signup-main\">\r\n                <h1 className=\"welcome-title font-game-thick\">끝 없는 이야기 속으로.</h1>\r\n                <h2 className=\"welcome-title-2 font-game-thin\">다양한 장르의 텍스트 어드벤처 게임을 즐기세요. 누구나 자신이 원하는 이야기를 만들수도 있습니다.</h2>\r\n                <h3 className=\"welcome-title-3 font-game-thin\">모험을 떠날 준비가 되었나요? 게임을 플레이하거나 스토리를 제작하려면 이메일 주소를 입력하세요.</h3>\r\n\r\n                <div className=\"signup-form-container\">\r\n                    <EmailContainer onFormSubmit={function(){ }.bind(this)}></EmailContainer>\r\n            \r\n                    <button className=\"google-signup-btn\"><img src={googleLogo} alt=\"\" /></button>\r\n                </div>\r\n\r\n            </main>\r\n            <footer className=\"signup-footer\">\r\n                <a href=\"/\">\r\n                    <h1 className=\"signup-footer-logo font-game-thick\">Endless Adventure StorY</h1>\r\n                </a>\r\n                <div className=\"signup-footer-menu\">\r\n                    <select name=\"\" id=\"\">\r\n                        <option value=\"kr\">한국어</option>\r\n                        <option value=\"en\">English</option>\r\n                    </select>\r\n                    <button>로그인</button>\r\n                </div>\r\n            </footer>\r\n        </body>\r\n    );\r\n};","import * as React from 'react';\r\nimport './user-board-route.css';\r\n\r\n\r\n\r\nexport const UserBoardRoute: React.FC = () => {\r\n    return (\r\n        <div className=\"user-board\" >\r\n            <div className=\"top\">\r\n                <div className='search-bar'></div>\r\n            </div>\r\n            <div left-ui></div>\r\n            <div className='main'></div>\r\n        </div>\r\n    );\r\n};","import * as React from 'react';\r\nimport {HashRouter, Route, Switch} from 'react-router-dom';\r\nimport {usePrefsContext} from '../store/prefs';\r\nimport {StoryFormatListRoute} from './story-format-list';\r\nimport {StoryEditRoute} from './story-edit';\r\nimport {StoryListRoute} from './story-list';\r\nimport {StoryPlayRoute} from './story-play';\r\nimport {StoryProofRoute} from './story-proof';\r\nimport {StoryTestRoute} from './story-test';\r\nimport { HomeRoute } from './home';\r\nimport { SelectRoute } from './select/select-route';\r\nimport { GamePlayRoute } from './game-play/game-play-route';\r\nimport { LoginRoute } from './login';\r\nimport { SignupRoute } from './signup';\r\nimport { UserBoardRoute } from './user-board';\r\n\r\nexport const Routes: React.FC = () => {\r\n\tconst {prefs} = usePrefsContext(); //store, 리덕스를 대체기기 위해 만든 훅\r\n\r\n\t// A <HashRouter> is used to make our lives easier--to load local story\r\n\t// formats, we need the document HREF to reflect where the HTML file is.\r\n\t// Otherwise we'd have to store the actual location somewhere, which will\r\n\t// differ between web and Electron contexts.\r\n\r\n\tconsole.log(prefs.welcomeSeen);\r\n\r\n\treturn (\r\n\t\t<HashRouter>\r\n\t\t\t{prefs.welcomeSeen ? (\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/\">\r\n\t\t\t\t\t\t<HomeRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/select\">\r\n\t\t\t\t\t\t<SelectRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/login\">\r\n\t\t\t\t\t\t<LoginRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/signup\">\r\n\t\t\t\t\t\t<SignupRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/game-play\">\r\n\t\t\t\t\t\t<GamePlayRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/story-list\">\r\n\t\t\t\t\t\t<StoryListRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/user-board\">\r\n\t\t\t\t\t\t<UserBoardRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId\">\r\n\t\t\t\t\t\t<StoryEditRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/story-formats\">\r\n\t\t\t\t\t\t<StoryFormatListRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/play\">\r\n\t\t\t\t\t\t<StoryPlayRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/proof\">\r\n\t\t\t\t\t\t<StoryProofRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/test/:passageId\">\r\n\t\t\t\t\t\t<StoryTestRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/test\">\r\n\t\t\t\t\t\t<StoryTestRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<Route\r\n\t\t\t\t\t\tpath=\"*\"\r\n\t\t\t\t\t\trender={path => {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t`No route for path \"${path.location.pathname}\", rendering story list`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\treturn <StoryListRoute />;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t></Route>\r\n\t\t\t\t</Switch>\r\n\t\t\t) : (\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/\">\r\n\t\t\t\t\t\t<HomeRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/select\">\r\n\t\t\t\t\t\t<SelectRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/login\">\r\n\t\t\t\t\t\t<LoginRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/signup\">\r\n\t\t\t\t\t\t<SignupRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/game-play\">\r\n\t\t\t\t\t\t<GamePlayRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/story-list\">\r\n\t\t\t\t\t\t<StoryListRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/story-formats\">\r\n\t\t\t\t\t\t<StoryFormatListRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/play\">\r\n\t\t\t\t\t\t<StoryPlayRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/proof\">\r\n\t\t\t\t\t\t<StoryProofRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/test/:passageId\">\r\n\t\t\t\t\t\t<StoryTestRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId/test\">\r\n\t\t\t\t\t\t<StoryTestRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route path=\"/stories/:storyId\">\r\n\t\t\t\t\t\t<StoryEditRoute />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route\r\n\t\t\t\t\t\tpath=\"*\"\r\n\t\t\t\t\t\trender={path => {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t`No route for path \"${path.location.pathname}\", rendering story list`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\treturn <StoryListRoute />;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t></Route>\r\n\t\t\t\t</Switch>\r\n\t\t\t)}\r\n\t\t</HashRouter>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {defaults, usePrefsContext} from './prefs';\r\nimport {useStoriesContext} from './stories';\r\nimport {\r\n\tformatWithNameAndVersion,\r\n\tStoryFormat,\r\n\tuseStoryFormatsContext\r\n} from './story-formats';\r\nimport {usePersistence} from './persistence/use-persistence';\r\nimport {LoadingCurtain} from '../components/loading-curtain';\r\n\r\nexport const StateLoader: React.FC = ({children}) => {\r\n\tconst [initing, setIniting] = React.useState(false);\r\n\tconst [inited, setInited] = React.useState(false);\r\n\tconst [prefsRepaired, setPrefsRepaired] = React.useState(false);\r\n\tconst [formatsRepaired, setFormatsRepaired] = React.useState(false);\r\n\tconst [storiesRepaired, setStoriesRepaired] = React.useState(false);\r\n\tconst {dispatch: prefsDispatch, prefs: prefsState} = usePrefsContext();\r\n\tconst {dispatch: storiesDispatch} = useStoriesContext();\r\n\tconst {dispatch: formatsDispatch, formats: formatsState} =\r\n\t\tuseStoryFormatsContext();\r\n\tconst {prefs, stories, storyFormats} = usePersistence();\r\n\r\n\t// Done in steps so that the repair action can see the inited state, and then\r\n\t// each repair action can see the results of the preceding ones.\r\n\t//\r\n\t// Repairs must go:\r\n\t// formats -> prefs (so it can repair bad format preferences) -> stories\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function run() {\r\n\t\t\tif (!initing) {\r\n\t\t\t\tconst formatsState = await storyFormats.load();\r\n\t\t\t\tconst prefsState = await prefs.load();\r\n\t\t\t\tconst storiesState = await stories.load();\r\n\r\n\t\t\t\tformatsDispatch({type: 'init', state: formatsState});\r\n\t\t\t\tprefsDispatch({type: 'init', state: prefsState});\r\n\t\t\t\tstoriesDispatch({type: 'init', state: storiesState});\r\n\t\t\t\tsetInited(true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trun();\r\n\t\tsetIniting(true);\r\n\t}, [\r\n\t\tformatsDispatch,\r\n\t\tinited,\r\n\t\tiniting,\r\n\t\tprefs,\r\n\t\tprefsDispatch,\r\n\t\tstories,\r\n\t\tstoriesDispatch,\r\n\t\tstoryFormats\r\n\t]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (inited && !formatsRepaired) {\r\n\t\t\tformatsDispatch({type: 'repair'});\r\n\t\t\tsetFormatsRepaired(true);\r\n\t\t}\r\n\t}, [formatsDispatch, formatsRepaired, inited]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (inited && formatsRepaired && !prefsRepaired) {\r\n\t\t\tprefsDispatch({type: 'repair', allFormats: formatsState});\r\n\t\t\tsetPrefsRepaired(true);\r\n\t\t}\r\n\t}, [formatsRepaired, formatsState, inited, prefsDispatch, prefsRepaired]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (inited && formatsRepaired && prefsRepaired && !storiesRepaired) {\r\n\t\t\t// We try to repair stories to the user's preferred format, but perhaps\r\n\t\t\t// their prefs are out of date/corrupted. In that case, we use the default\r\n\t\t\t// one.\r\n\r\n\t\t\tlet safeFormat: StoryFormat | undefined;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tsafeFormat = formatWithNameAndVersion(\r\n\t\t\t\t\tformatsState,\r\n\t\t\t\t\tprefsState.storyFormat.name,\r\n\t\t\t\t\tprefsState.storyFormat.version\r\n\t\t\t\t);\r\n\t\t\t} catch {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsafeFormat = formatWithNameAndVersion(\r\n\t\t\t\t\t\tformatsState,\r\n\t\t\t\t\t\tdefaults().storyFormat.name,\r\n\t\t\t\t\t\tdefaults().storyFormat.version\r\n\t\t\t\t\t);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\r\n\t\t\t\t\t\t`Could not locate a safe story format, skipping story repair: ${\r\n\t\t\t\t\t\t\t(error as Error).message\r\n\t\t\t\t\t\t}`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (safeFormat) {\r\n\t\t\t\tstoriesDispatch({\r\n\t\t\t\t\ttype: 'repair',\r\n\t\t\t\t\tallFormats: formatsState,\r\n\t\t\t\t\tdefaultFormat: safeFormat\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tsetStoriesRepaired(true);\r\n\t\t}\r\n\t}, [\r\n\t\tformatsDispatch,\r\n\t\tformatsRepaired,\r\n\t\tformatsState,\r\n\t\tinited,\r\n\t\tprefsDispatch,\r\n\t\tprefsRepaired,\r\n\t\tprefsState.storyFormat.name,\r\n\t\tprefsState.storyFormat.version,\r\n\t\tstories,\r\n\t\tstoriesDispatch,\r\n\t\tstoriesRepaired\r\n\t]);\r\n\r\n\treturn inited && formatsRepaired && prefsRepaired && storiesRepaired ? (\r\n\t\t<>{children}</>\r\n\t) : (\r\n\t\t<LoadingCurtain />\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport {useComputedTheme} from './prefs/use-computed-theme';\r\n\r\nexport function ThemeSetter() {\r\n\tconst computedTheme = useComputedTheme();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tdocument.body.dataset.appTheme = computedTheme;\r\n\t}, [computedTheme]);\r\n\r\n\treturn null;\r\n}\r\n","import * as React from 'react';\r\nimport {GlobalErrorBoundary} from './components/error';\r\nimport {LoadingCurtain} from './components/loading-curtain/loading-curtain';\r\nimport {LocaleSwitcher} from './store/locale-switcher';\r\nimport {PrefsContextProvider} from './store/prefs';\r\nimport {Routes} from './routes';\r\nimport {StoriesContextProvider} from './store/stories';\r\nimport {StoryFormatsContextProvider} from './store/story-formats';\r\nimport {StateLoader} from './store/state-loader';\r\nimport {ThemeSetter} from './store/theme-setter';\r\nimport 'focus-visible';\r\nimport './styles/typography.css';\r\nimport './styles/focus-visible-shim.css';\r\n\r\nexport const App: React.FC = () => {\r\n\treturn (\r\n\t\t<GlobalErrorBoundary>\r\n\t\t\t<PrefsContextProvider>\r\n\t\t\t\t<LocaleSwitcher />\r\n\t\t\t\t<ThemeSetter />\r\n\t\t\t\t<StoryFormatsContextProvider>\r\n\t\t\t\t\t<StoriesContextProvider>\r\n\t\t\t\t\t\t<StateLoader>\r\n\t\t\t\t\t\t\t<React.Suspense fallback={<LoadingCurtain />}>\r\n\t\t\t\t\t\t\t\t<Routes />\r\n\t\t\t\t\t\t\t</React.Suspense>\r\n\t\t\t\t\t\t</StateLoader>\r\n\t\t\t\t\t</StoriesContextProvider>\r\n\t\t\t\t</StoryFormatsContextProvider>\r\n\t\t\t</PrefsContextProvider>\r\n\t\t</GlobalErrorBoundary>\r\n\t);\r\n};\r\n","import * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\nimport {App} from './app';\r\nimport './util/i18n';\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<App />\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById('root')\r\n);\r\n"],"sourceRoot":""}